<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Furion Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Furion Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Furion" href="/opensearch.xml"><title data-react-helmet="true">26. 定时任务/后台任务 | Furion</title><meta data-react-helmet="true" property="og:url" content="https://furion.pro/docs/job"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="26. 定时任务/后台任务 | Furion"><meta data-react-helmet="true" name="description" content="以下内容仅限 Furion 2.0.0 + 版本使用。"><meta data-react-helmet="true" property="og:description" content="以下内容仅限 Furion 2.0.0 + 版本使用。"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://furion.pro/docs/job"><link data-react-helmet="true" rel="alternate" href="https://furion.pro/docs/job" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://furion.pro/docs/job" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.a8c77fce.css">
<link rel="preload" href="/assets/js/styles.b4c13270.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.073cd200.js" as="script">
<link rel="preload" href="/assets/js/main.0ad7cce4.js" as="script">
<link rel="preload" href="/assets/js/1.887ae15b.js" as="script">
<link rel="preload" href="/assets/js/2.dfab4be6.js" as="script">
<link rel="preload" href="/assets/js/29798642.afdb1875.js" as="script">
<link rel="preload" href="/assets/js/136.c1e0c466.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.491950ac.js" as="script">
<link rel="preload" href="/assets/js/17896441.e0dfe825.js" as="script">
<link rel="preload" href="/assets/js/22f09a41.469c0620.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div class="furion-give-me-star">⭐️ 如果你喜欢 <a href="https://gitee.com/dotnetchina/Furion" target="_blank">Furion</a> ，可以在 <a href="https://gitee.com/dotnetchina/Furion" target="_blank">Gitee</a> 中给个<a href="https://gitee.com/dotnetchina/Furion" target="_blank"><img class="furion-gitee-star" src="https://gitee.com/dotnetchina/Furion/badge/star.svg?theme=gvp" alt="star"></a> ⭐️</div><div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/furionlogo.png" alt="Furion Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/furionlogo.png" alt="Furion Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Furion</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">文档</a><a class="navbar__item navbar__link" href="/docs/global/app">静态类</a><a class="navbar__item navbar__link" href="/docs/settings/appsettings">配置</a><a class="navbar__item navbar__link" href="/blog">博客</a><a class="navbar__item navbar__link" href="/docs/upgrade">更新日志✨</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link">源码</a><ul class="dropdown__menu"><li><a href="https://gitee.com/dotnetchina/Furion" target="_blank" rel="noopener noreferrer" class="dropdown__link">Gitee</a></li><li><a href="https://github.com/MonkSoul/Furion" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub</a></li></ul></div><a href="https://www.chinadot.net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">社区</a><a class="navbar__item navbar__link" href="/docs/case">案例</a><a class="navbar__item navbar__link" href="/docs/donate">赞助</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/furionlogo.png" alt="Furion Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/furionlogo.png" alt="Furion Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Furion</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs">文档</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/global/app">静态类</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/settings/appsettings">配置</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">博客</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/upgrade">更新日志✨</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">源码</a><ul class="menu__list"><li class="menu__list-item"><a href="https://gitee.com/dotnetchina/Furion" target="_blank" rel="noopener noreferrer" class="menu__link">Gitee</a></li><li class="menu__list-item"><a href="https://github.com/MonkSoul/Furion" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></li><li class="menu__list-item"><a href="https://www.chinadot.net" target="_blank" rel="noopener noreferrer" class="menu__link">社区</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/case">案例</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/donate">赞助</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/img/furionlogo.png" alt="Furion Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/furionlogo.png" alt="Furion Logo" class="themedImage_1VuW themedImage--dark_hz6m"><strong>Furion</strong></a><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">1. 序言</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">1.1 介绍</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/author">1.2 关于作者</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/source">1.3 示例结构</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/case">1.4 框架案例</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/donate">1.5 赞助 Furion</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/upgrade">1.6 更新日志</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/course">1.7 发展大事记</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">2. 入门指南</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/get-start">2.1 一分钟上手</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/template">2.2 官方脚手架</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference">2.3 手动搭建分层</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/appstartup">3. 应用启动 Startup</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">4. 配置与选项</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/configuration">4.1 配置</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/options">4.2 选项</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/dynamic-api-controller">5. 动态 WebAPI</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/specification-document">6. 规范化接口文档 (Swagger)</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/friendly-exception">7. 友好异常处理</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/data-validation">8. 数据校验</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">9. 数据库操作指南（EFCore）</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-start">9.0 入门简要</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext">9.1 数据库上下文</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-locator">9.2 数据库上下文定位器</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/entity">9.3 数据库实体</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-repository">9.4 仓储模式 (Repository)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-add">9.5 新增操作</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-update">9.6 更新操作</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-add-or-update">9.7 新增或更新操作</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-delete">9.8 删除操作</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-batch">9.9 批量操作</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-query">9.10 查询操作</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-hight-query">9.11 高级查询操作</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-view">9.12 视图操作</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-proc">9.13 存储过程操作</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-function">9.14 函数操作</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-sql">9.15 Sql 操作</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-sql-template">9.16 Sql 模板</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-sql-proxy">9.17 Sql 高级代理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-multi-database">9.18 多数据库操作</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-db-first">9.19 数据库生成模型 (Db First)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-code-first">9.20 模型生成数据库 (Code First)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-seed-data">9.21 实体种子数据</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-audit">9.22 审计日志 (Audit)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-filter">9.23 实体/全局查询筛选器</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-Interceptor">9.24 数据库操作拦截器</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-entitytrigger">9.25. 实体数据监听器</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tran">9.26 事务和工作单元 (UnitOfWork)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dbcontext-read-write">9.27 读写分离/主从复制</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/split-db">9.28 分表分库</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/efcore-recommend">9.29 EFCore 最佳实践</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">10. SqlSugar 或其他 ORM</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sqlsugar">10.1. SqlSugar 集成</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dapper">10.2. Dapper 集成</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/saas">11. SaaS 多租户</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dependency-injection">12. 依赖注入/控制反转</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/object-mapper">13. 对象数据映射 Mapper</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/cache">14. 分布式缓存</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/auth-control">15. 安全鉴权</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/cors">16. CORS 跨域</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/view-engine">17. 视图引擎</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/logging">18. 日志记录</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/http">19. 远程请求 (HttpClient)</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/encryption">20. 数据加解密</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/local-language">21. 全球化和本地化（多语言）</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/event-bus">22. 事件总线</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/json-serialization">23. JSON 序列化</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/signalr">24. 即时通讯（编写中 ⏳）</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/process-service">25. 辅助角色服务 (Worker Service)</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/job">26. 定时任务/后台任务</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/idgenerator">27. 分布式 ID 生成</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/module-dev">28. 模块化开发</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/microservice">29. Anno 微服务</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">30. 托管部署</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deploy-iis">30.1 在 IIS 部署</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deploy-docker">30.2 在 Docker 部署</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deploy-nginx">30.3 在 Nginx 部署</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/virtual-deploy">30.4 二级虚拟目录部署</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">31. 持续部署集成</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deploy-docker-auto">31.1 Docker 环境持续部署</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/devops">31.2 持续部署集成</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">32. 测试指南</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/unittest">32.1 单元测试</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/performance">32.2 性能测试</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/benchmark">32.3 基准测试</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/contribute">33. 贡献指南</a></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">26. 定时任务/后台任务</h1></header><div class="markdown"><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>版本说明</h5></div><div class="admonition-content"><p>以下内容仅限 <code>Furion 2.0.0 +</code> 版本使用。</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="261-关于定时任务"></a>26.1 关于定时任务<a class="hash-link" href="#261-关于定时任务" title="Direct link to heading">#</a></h2><p>顾名思义，定时任务就是在特定的时间或符合某种时间规律执行的任务。通常定时任务有四种时间调度方式：</p><ul><li><code>缓隔时间</code> 方式：延迟多少时间后调配任务，这种方式任务只会被调用一次。</li><li><code>间隔时间</code> 方式：每隔一段固定时间调配任务，无间断调用任务。</li><li><code>Cron 表达式</code> 方法：通过 <code>Cron</code> 表达式计算下一次执行时间进行调配任务，可以配置特定时间范围内执行，也可以无间断执行。</li><li><code>自定义下次执行时间</code>：可以通过各种逻辑运算返回下一次执行时间</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="262-如何实现"></a>26.2 如何实现<a class="hash-link" href="#262-如何实现" title="Direct link to heading">#</a></h2><p><code>Furion</code> 框架提供了两种方式实现定时任务：</p><ul><li><code>SpareTime</code> 静态类：<code>SpareTime</code> 静态类提供 <code>SpareTime.Do([options])</code> 方式调用。</li><li><code>ISpareTimeWorker</code> 依赖方式：通过自定义类实现 <code>ISpareTimeWorker</code> 接口并编写一定规则的方法即可。<strong>需要在 <code>Startup.cs</code> 中注册 <code>services.AddTaskScheduler()</code></strong></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="263-缓隔方式使用"></a>26.3 缓隔方式使用<a class="hash-link" href="#263-缓隔方式使用" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2631-特定时间后执行"></a>26.3.1 特定时间后执行<a class="hash-link" href="#2631-特定时间后执行" title="Direct link to heading">#</a></h3><p>这里演示 <code>3s</code> 后执行</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Console.WriteLine(&quot;当前时间：&quot; + DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// timer 是定时器的对象，包含定时器相关信息</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// count 表示执行次数，这里只有一次</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">SpareTime.DoOnce(3000, (timer, count) =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine(&quot;现在时间：&quot; + DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2632-配置任务信息"></a>26.3.2 配置任务信息<a class="hash-link" href="#2632-配置任务信息" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.DoOnce(3000, (timer, count) =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine(&quot;现在时间：&quot; + DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">}, &quot;jobName&quot;, &quot;描述一下这个任务是干什么的&quot;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>jobName</code> 标识任务的唯一标识，通过这个标识可以启动、暂停、销毁任务。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2633-手动启动执行"></a>26.3.3 手动启动执行<a class="hash-link" href="#2633-手动启动执行" title="Direct link to heading">#</a></h3><p>默认情况下，任务初始化后就立即启动，等待符合的时间就执行，有些时候我们仅仅想初始化时间，不希望立即执行，只需要配置 <code>startNow</code> 即可：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.DoOnce(3000, (timer, count) =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine(&quot;现在时间：&quot; + DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">},&quot;jobName&quot;, startNow: false);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// 手动启动执行</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Start(&quot;jobName&quot;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2634-模拟后台执行"></a>26.3.4 模拟后台执行<a class="hash-link" href="#2634-模拟后台执行" title="Direct link to heading">#</a></h3><p>有些时候，我们只需要开启新线程去执行一个任务，比如发短信，发邮件，无需配置。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// 此方法无需主线程等待即可返回，可大大提高性能</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">SpareTime.DoIt(() =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // 这里发送短信，发送邮件或记录访问记录</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>还可以指定多长时间后触发，建议 <code>10-1000</code> 毫秒之间：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.DoIt(() =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // 发送短信</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">}, 100);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2635-isparetimeworker-方式"></a>26.3.5 <code>ISpareTimeWorker</code> 方式<a class="hash-link" href="#2635-isparetimeworker-方式" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">public class JobWorker : ISpareTimeWorker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// 3s 后执行</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;/summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;param name=&quot;timer&quot;&gt;&lt;/param&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;param name=&quot;count&quot;&gt;&lt;/param&gt;</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    [SpareTime(3000, &quot;jobName&quot;, DoOnce = true, StartNow = true)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public void DoSomething(SpareTimer timer, long count)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine(DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>需要在 <code>Startup.cs</code> 中注册 <code>services.AddTaskScheduler()</code></strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="264-间隔方式使用"></a>26.4 间隔方式使用<a class="hash-link" href="#264-间隔方式使用" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2641-每隔一段时间执行"></a>26.4.1 每隔一段时间执行<a class="hash-link" href="#2641-每隔一段时间执行" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// 每隔 1s 执行</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Do(1000, (timer, count) =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine(&quot;现在时间：&quot; + DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2642-配置任务信息"></a>26.4.2 配置任务信息<a class="hash-link" href="#2642-配置任务信息" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Do(1000, (timer, count) =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine(&quot;现在时间：&quot; + DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">}, &quot;jobName&quot;, &quot;这是一个计时器任务&quot;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2643-手动启动执行"></a>26.4.3 手动启动执行<a class="hash-link" href="#2643-手动启动执行" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Do(1000, (timer, count) =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine(&quot;现在时间：&quot; + DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">}, &quot;jobName&quot;, startNow:false);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Start(&quot;jobName&quot;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2644-isparetimeworker-方式"></a>26.4.4 <code>ISpareTimeWorker</code> 方式<a class="hash-link" href="#2644-isparetimeworker-方式" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">public class JobWorker : ISpareTimeWorker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// 每隔 3s 执行</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;/summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;param name=&quot;timer&quot;&gt;&lt;/param&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;param name=&quot;count&quot;&gt;&lt;/param&gt;</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    [SpareTime(3000, &quot;jobName&quot;, StartNow = true)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public void DoSomething(SpareTimer timer, long count)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine(DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>需要在 <code>Startup.cs</code> 中注册 <code>services.AddTaskScheduler()</code></strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="265-cron-表达式使用"></a>26.5 <code>Cron</code> 表达式使用<a class="hash-link" href="#265-cron-表达式使用" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2651-什么是-cron-表达式"></a>26.5.1 什么是 <code>Cron</code> 表达式<a class="hash-link" href="#2651-什么是-cron-表达式" title="Direct link to heading">#</a></h3><p>Cron 表达式是一个字符串，字符串以 <code>5</code> 或 <code>6</code> 个空格隔开，分为 6 或 7 个域，每一个域代表一个含义，Cron 有如下两种语法格式：</p><p>（1） Seconds Minutes Hours DayofMonth Month DayofWeek Year</p><p>（2）Seconds Minutes Hours DayofMonth Month DayofWeek</p><p>Cron 从左到右（用空格隔开）：<code>秒</code> <code>分</code> <code>小时</code> <code>月份中的日期</code> <code>月份</code> <code>星期中的日期</code> <code>年份</code></p><table><thead><tr><th>字段</th><th>允许值</th><th>允许的特殊字符</th></tr></thead><tbody><tr><td>秒（Seconds）</td><td><code>0~59</code> 的整数</td><td><code>, - \* /</code> 四个字符</td></tr><tr><td>分（Minutes）</td><td><code>0~59</code> 的整数</td><td><code>, - \* /</code> 四个字符</td></tr><tr><td>小时（Hours）</td><td><code>0~23</code> 的整数</td><td><code>, - \* /</code> 四个字符</td></tr><tr><td>日期（DayofMonth）</td><td><code>1~31</code> 的整数（但是你需要考虑你月的天数）</td><td><code>,- \* ? / L W C</code> 八个字符</td></tr><tr><td>月份（Month）</td><td><code>1~12</code> 的整数或者 <code>JAN-DEC</code></td><td><code>, - \* /</code> 四个字符</td></tr><tr><td>星期（DayofWeek）</td><td><code>1~7</code> 的整数或者 <code>SUN-SAT （1=SUN）</code></td><td><code>, - \* ? / L C #</code> 八个字符</td></tr><tr><td>年(可选，留空)（Year）</td><td><code>1970~2099</code></td><td><code>, - \* /</code> 四个字符</td></tr></tbody></table><p>每一个域都使用数字，但还可以出现如下特殊字符，它们的含义是：</p><p>（1）<code>_</code>：表示匹配该域的任意值。假如在 <code>Minutes</code> 域使用 <code>\_</code>, 即表示每分钟都会触发事件。</p><p>（2）<code>?</code>：只能用在 <code>DayofMonth</code> 和 <code>DayofWeek</code> 两个域。它也匹配域的任意值，但实际不会。因为 <code>DayofMonth</code> 和 <code>DayofWeek</code> 会相互影响。例如想在每月的 <code>20</code> 日触发调度，不管 <code>20</code> 日到底是星期几，则只能使用如下写法： <code>13 13 15 20 _ ?</code>, 其中最后一位只能用<code>？</code>，而不能使用_，如果使用*表示不管星期几都会触发，实际上并不是这样。</p><p>（3）<code>-</code>：表示范围。例如在 <code>Minutes</code> 域使用 <code>5-20</code>，表示从 <code>5</code> 分到 <code>20</code> 分钟每分钟触发一次</p><p>（4）<code>/</code>：表示起始时间开始触发，然后每隔固定时间触发一次。例如在 <code>Minutes</code> 域使用 <code>5/20</code>，则意味着 <code>5</code> 分钟触发一次，而 <code>25，45</code> 等分别触发一次.</p><p>（5）<code>,</code>：表示列出枚举值。例如：在 <code>Minutes</code> 域使用 <code>5,20</code>，则意味着在 <code>5</code> 和 <code>20</code> 分每分钟触发一次。</p><p>（6）<code>L</code>：表示最后，只能出现在 <code>DayofWeek</code> 和 <code>DayofMonth</code> 域。如果在 <code>DayofWeek</code> 域使用 <code>5L</code>,意味着在最后的一个星期四触发。</p><p>（7）<code>W</code>：表示有效工作日(周一到周五) 只能出现在 <code>DayofMonth</code> 域，系统将在离指定日期的最近的有效工作日触发事件。例如：在 <code>DayofMonth</code> 使用 <code>5W</code>，如果 <code>5</code> 日是星期六，则将在最近的工作日：星期五，即 <code>4</code> 日触发。如果 <code>5</code> 日是星期天，则在 <code>6</code> 日(周一)触发；如果 <code>5</code> 日在星期一到星期五中的一天，则就在 <code>5</code> 日触发。另外一点，<code>W</code> 的最近寻找不会跨过月份 。</p><p>（8）<code>LW</code>：这两个字符可以连用，表示在某个月最后一个工作日，即最后一个星期五。</p><p>（9）<code>#</code>：用于确定每个月第几个星期几，只能出现在 <code>DayofMonth</code> 域。例如在 <code>4#2</code>，表示某月的第二个星期三。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2552-常见-cron-表达式"></a>25.5.2 常见 <code>Cron</code> 表达式<a class="hash-link" href="#2552-常见-cron-表达式" title="Direct link to heading">#</a></h3><table><thead><tr><th>表达式</th><th>表达式代表含义</th><th>格式化</th></tr></thead><tbody><tr><td><code>* * * * *</code></td><td>每分钟</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>*/1 * * * *</code></td><td>每分钟</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>0 0/1 * * * ?</code></td><td>每分钟</td><td><code>CronFormat.IncludeSeconds</code></td></tr><tr><td><code>0 0 * * * ?</code></td><td>每小时</td><td><code>CronFormat.IncludeSeconds</code></td></tr><tr><td><code>0 0 0/1 * * ?</code></td><td>每小时</td><td><code>CronFormat.IncludeSeconds</code></td></tr><tr><td><code>0 23 ? * MON-FRI</code></td><td>晚上 11:00，周一至周五</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>* * * * * *</code></td><td>每秒</td><td><code>CronFormat.IncludeSeconds</code></td></tr><tr><td><code>*/45 * * * * *</code></td><td>每 45 秒</td><td><code>CronFormat.IncludeSeconds</code></td></tr><tr><td><code>*/5 * * * *</code></td><td>每 5 分钟</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>0 0/10 * * * ?</code></td><td>每 10 分钟</td><td><code>CronFormat.IncludeSeconds</code></td></tr><tr><td><code>0 */5 * * * *</code></td><td>每 5 分钟</td><td><code>CronFormat.IncludeSeconds</code></td></tr><tr><td><code>30 11 * * 1-5</code></td><td>周一至周五上午 11:30</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>30 11 * * *</code></td><td>11:30</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>0-10 11 * * *</code></td><td>上午 11:00 至 11:10 之间的每一分钟</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>* * * 3 *</code></td><td>每分钟，只在 3 月份</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>* * * 3,6 *</code></td><td>每分钟，只在 3 月和 6 月</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>30 14,16 * * *</code></td><td>下午 02:30 分和 04:30 分</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>30 6,14,16 * * *</code></td><td>早上 06:30，下午 02:30 和 04:30</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>46 9 * * 1</code></td><td>早上 09:46，只在星期一</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>23 12 15 * *</code></td><td>下午 12:23，在本月的第 15 天</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>23 12 * JAN *</code></td><td>下午 12:23，只在 1 月份</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>23 12 ? JAN *</code></td><td>下午 12:23，只在 1 月份</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>23 12 * JAN-FEB *</code></td><td>下午 12:23，1 月至 2 月</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>23 12 * JAN-MAR *</code></td><td>下午 12:23，1 月至 3 月</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>23 12 * * SUN</code></td><td>下午 12:23，仅在星期天</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>*/5 15 * * MON-FRI</code></td><td>每 5 分钟，下午 0:00 至 03:59，周一至周五</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>* * * * MON#3</code></td><td>每分钟，在月的第三个星期一</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>* * * * 4L</code></td><td>每一分钟，在本月的最后一天</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>*/5 * L JAN *</code></td><td>每月一次每月 5 分钟，只在 1 月份</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>30 02 14 * * *</code></td><td>下午在 02:02:30</td><td><code>CronFormat.IncludeSeconds</code></td></tr><tr><td><code>5-10 * * * * *</code></td><td>每分钟的 5-10 秒</td><td><code>CronFormat.IncludeSeconds</code></td></tr><tr><td><code>5-10 30-35 10-12 * * *</code></td><td>10:00 至 12:00 之间的每分钟 5-10 秒，每小时 30-35 分钟</td><td><code>CronFormat.IncludeSeconds</code></td></tr><tr><td><code>30 */5 * * * *</code></td><td>每分钟的 30 秒，每五分钟</td><td><code>CronFormat.IncludeSeconds</code></td></tr><tr><td><code>0 30 10-13 ? * WED,FRI</code></td><td>每小时的 30 分钟，下午 10:00 至 01:00 之间，仅在周三和周五</td><td><code>CronFormat.IncludeSeconds</code></td></tr><tr><td><code>10 0/5 * * * ?</code></td><td>每分钟的 10 秒，每 05 分钟</td><td><code>CronFormat.IncludeSeconds</code></td></tr><tr><td><code>0 0 6 1/1 * ?</code></td><td>下午 06:00</td><td><code>CronFormat.IncludeSeconds</code></td></tr><tr><td><code>0 5 0/1 * * ?</code></td><td>一个小时的 05 分</td><td><code>CronFormat.IncludeSeconds</code></td></tr><tr><td><code>0 0 L * *</code></td><td>每月最后一天上午 00：00</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>0 0 L-1 * *</code></td><td>每月最后一天的凌晨 00：00</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>0 0 3W * *</code></td><td>每月第 3 个工作日上午 00：00</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>0 0 LW * *</code></td><td>在每月的最后一个工作日，上午 00：00</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>0 0 * * 2L</code></td><td>本月最后一个星期二上午 00：00</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>0 0 * * 6#3</code></td><td>每月第三个星期六上午 00：00</td><td><code>CronFormat.Standard</code></td></tr><tr><td><code>0 0 ? 1 MON#1</code></td><td>1 月第一个星期一上午 00：00</td><td><code>CronFormat.Standard</code></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2553-在线生成-cron-表达式"></a>25.5.3 在线生成 <code>Cron</code> 表达式<a class="hash-link" href="#2553-在线生成-cron-表达式" title="Direct link to heading">#</a></h3><p><a href="https://cron.qqe2.com/" target="_blank" rel="noopener noreferrer">https://cron.qqe2.com/</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2554-macro-标识符"></a>25.5.4 <code>Macro</code> 标识符<a class="hash-link" href="#2554-macro-标识符" title="Direct link to heading">#</a></h3><p>为了方便定义 <code>Cron</code> 表达式，<code>Furion</code> 框架也提供了非常方便的占位符实现常用的时间格式：</p><table><thead><tr><th>占位符</th><th>对应表达式</th><th>占位符代表含义</th></tr></thead><tbody><tr><td><code>@every_second</code></td><td><code>* * * * * *</code></td><td>一秒钟跑一次</td></tr><tr><td><code>@every_minute</code></td><td><code>* * * * *</code></td><td>在分钟开始时每分钟运行一次</td></tr><tr><td><code>@hourly</code></td><td><code>0 * * * *</code></td><td>在小时开始时每小时运行一次</td></tr><tr><td><code>@daily</code></td><td><code>0 0 * * *</code></td><td>每天午夜运行一次</td></tr><tr><td><code>@midnight</code></td><td><code>0 0 * * *</code></td><td>每天午夜运行一次</td></tr><tr><td><code>@weekly</code></td><td><code>0 0 * * 0</code></td><td>周日上午午夜每周运行一次</td></tr><tr><td><code>@monthly</code></td><td><code>0 0 1 * *</code></td><td>每月在每月第一天的午夜运行一次</td></tr><tr><td><code>@yearly</code></td><td><code>0 0 1 1 *</code></td><td>每年 1 月 1 日午夜运行一次</td></tr><tr><td><code>@annually</code></td><td><code>0 0 1 1 *</code></td><td>每年 1 月 1 日午夜运行一次</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2555-使用-cron-表达式"></a>25.5.5 使用 <code>Cron</code> 表达式<a class="hash-link" href="#2555-使用-cron-表达式" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// 每隔 1s 执行</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Do(&quot;* * * * * *&quot;, (timer, count) =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine(&quot;现在时间：&quot; + DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">}, cronFormat: CronFormat.IncludeSeconds);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>关于 CronFormat</h5></div><div class="admonition-content"><p>默认情况下，<code>Furion</code> 框架未启用对 <code>秒</code> 的支持，如需开启，则设置 <code>cronFormat: CronFormat.IncludeSeconds</code> 即可。默认值是 <code>cronFormat: CronFormat.Standard</code></p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2556-使用-macro-占位符"></a>25.5.6 使用 <code>Macro</code> 占位符<a class="hash-link" href="#2556-使用-macro-占位符" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// 每隔 1s 执行</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Do(&quot;@every_second&quot;, (timer, count) =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine(&quot;现在时间：&quot; + DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2557-配置任务信息"></a>25.5.7 配置任务信息<a class="hash-link" href="#2557-配置任务信息" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Do(&quot;* * * * *&quot;, (timer, count) =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine(&quot;现在时间：&quot; + DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">}, &quot;cronName&quot;, &quot;每分钟执行一次&quot;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2558-手动启动执行"></a>25.5.8 手动启动执行<a class="hash-link" href="#2558-手动启动执行" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Do(&quot;* * * * *&quot;, (timer, count) =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine(&quot;现在时间：&quot; + DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">}, &quot;cronName&quot;, &quot;每分钟执行一次&quot;, startNow: false);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Start(&quot;cronName&quot;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2659-isparetimeworker-方式"></a>26.5.9 <code>ISpareTimeWorker</code> 方式<a class="hash-link" href="#2659-isparetimeworker-方式" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">public class JobWorker : ISpareTimeWorker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// 每分钟执行</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;/summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;param name=&quot;timer&quot;&gt;&lt;/param&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;param name=&quot;count&quot;&gt;&lt;/param&gt;</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    [SpareTime(&quot;* * * * *&quot;, &quot;jobName&quot;, StartNow = true)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public void DoSomething(SpareTimer timer, long count)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine(DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="266-自定义下次执行时间"></a>26.6 自定义下次执行时间<a class="hash-link" href="#266-自定义下次执行时间" title="Direct link to heading">#</a></h2><p>有些时候我们需要进行一些业务逻辑，比如数据库查询等操作返回下一次执行时间，这个时候我们可以通过高级自定义方式。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2661-高级自定义间隔方式"></a>26.6.1 高级自定义间隔方式<a class="hash-link" href="#2661-高级自定义间隔方式" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Do(()=&gt;{</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    // 这里可以查询数据库或进行或进行任何业务逻辑</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    if(符合逻辑){</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">        return 1000; // 每秒执行</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    else return -1; // 不符合逻辑取消任务</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(timer,count)=&gt;{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine(DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>配置是否持续检查</h5></div><div class="admonition-content"><p>默认情况下，该自定义会在返回 <code>小于或等于0</code> 时终止任务的执行。但是我们希望该任务不要终止，只要符合条件都一直执行，只需要配置 <code>cancelInNoneNextTime: false</code> 即可</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2662-高级自定义-cron-表达式"></a>26.6.2 高级自定义 <code>Cron</code> 表达式<a class="hash-link" href="#2662-高级自定义-cron-表达式" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Do(()=&gt;{</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    // 这里可以查询数据库或进行或进行任何业务逻辑</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    if(符合逻辑){</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">        return DateTime.Now.AddMinutes(10);  // 十分钟后再执行</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    else return null; // 不符合逻辑取消任务</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(timer,count) =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine(DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>配置是否持续检查</h5></div><div class="admonition-content"><p>默认情况下，该自定义会在返回 <code>null</code> 时终止任务的执行。但是我们希望该任务不要终止，只要符合条件都一直执行，只需要配置 <code>cancelInNoneNextTime: false</code> 即可，如：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Do(()=&gt;{</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    // 这里可以查询数据库或进行或进行任何业务逻辑</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    if(符合逻辑){</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">        return SpareTime.GetCronNextOccurrence(&quot;cron 表达式&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    else return null; // 不符合逻辑继续检查</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(timer,count) =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine(DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">}, cancelInNoneNextTime: false);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="267-isparetimeworker-说明"></a>26.7 <code>ISpareTimeWorker</code> 说明<a class="hash-link" href="#267-isparetimeworker-说明" title="Direct link to heading">#</a></h2><p>除了上面的 <code>SpareTime</code> 静态类方式，<code>Furion</code> 框架还提供了 <code>ISpareTimeWorker</code> 方式，使用该方式非常简单，只需要自定义一个<strong>公开且非抽象非静态</strong>类并实现 <code>ISpareTimeWorker</code> 即可。</p><p>在该类中定义的任务方法需满足以下规则：</p><ul><li>必须是<strong>公开且实例方法</strong></li><li>该方法必须返回 <code>void</code> 且提供 <code>SpareTimer</code> 和 <code>long</code> 两个参数</li><li>必须贴有 <code>[SpareTime]</code> 特性</li></ul><p>如：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">public class JobWorker : ISpareTimeWorker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // 每个一秒执行，且立即启动</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    [SpareTime(1000, &quot;jobName1&quot;, StartNow = true)]</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    public void DoSomething1(SpareTimer timer, long count)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine(DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // 每分钟执行，且立即启动</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    [SpareTime(&quot;* * * * *&quot;, &quot;jobName2&quot;, StartNow = true)]</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    public void DoSomething2(SpareTimer timer, long count)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine(DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // 每秒执行，且等待启动</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    [SpareTime(&quot;* * * * * *&quot;, &quot;jobName3&quot;,CronFormat = CronFormat.IncludeSeconds, StartNow = false)]</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    public void DoSomething3(SpareTimer timer, long count)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine(DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // 每秒执行一次，每分钟也执行一次</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    [SpareTime(1000, &quot;jobName4&quot;, StartNow = true)]</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    [SpareTime(&quot;* * * * *&quot;, &quot;jobName5&quot;, StartNow = true)]</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    public void DoSomething4(SpareTimer timer, long count)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine(DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // 只执行一次</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    [SpareTime(1000, &quot;jobName4&quot;, StartNow = true, DoOnce = true)]</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    public void DoSomething5(SpareTimer timer, long count)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine(DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>关于依赖注入</h5></div><div class="admonition-content"><p><code>ISpareTimeWorker</code> 接口主要是用来查找定时器对象的，也就是它的实现类并未提供依赖注入功能，所以在实现类并不支持构造函数注入依赖项。</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2671-sparetime-特性"></a>26.7.1 <code>[SpareTime]</code> 特性<a class="hash-link" href="#2671-sparetime-特性" title="Direct link to heading">#</a></h3><p><code>[SpareTime]</code> 支持以下配置属性</p><ul><li><code>Interval</code>：间隔时间, <code>double</code> 类型</li><li><code>CronExpression</code>：<code>Cron</code> 表达式，<code>string</code> 类型</li><li><code>WorkerName</code>：任务唯一标识，<code>string</code> 类型，<code>必填</code></li><li><code>Description</code>：任务描述，<code>string</code> 类型</li><li><code>DoOnce</code>：是否只执行一次，<code>bool</code> 类型，默认 <code>false</code></li><li><code>StartNow</code>：是否立即启动，默认 <code>false</code></li><li><code>CronFormat</code>：<code>Cron</code> 表达式格式化方式，<code>CronFormat</code> 枚举类型，默认 <code>CronFormat.Standard</code></li><li><code>ExecuteType</code>：配置任务执行方式，<code>SpareTimeExecuteTypes</code> 枚举类型，默认 <code>SpareTimeExecuteTypes.Parallel</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="268-sparetime-静态类"></a>26.8 <code>SpareTime</code> 静态类<a class="hash-link" href="#268-sparetime-静态类" title="Direct link to heading">#</a></h2><p><code>SpareTime</code> 静态类提供了一些方法方便初始化和管理任务</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2681-初始化任务"></a>26.8.1 初始化任务<a class="hash-link" href="#2681-初始化任务" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// 开启间隔任务</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Do(interval, [options]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// 开启 Cron 表达式任务</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Do(expression, [options]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// 只执行一次任务</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.DoOnce(interval, [options]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// 实现自定义任务</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Do(()=&gt;{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return DateTime.Now.AddMinutes(10);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">},[options]);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2682-实现后台执行"></a>26.8.2 实现后台执行<a class="hash-link" href="#2682-实现后台执行" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// 实现后台执行</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.DoIt(()=&gt;{});</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2683-开始一个任务"></a>26.8.3 开始一个任务<a class="hash-link" href="#2683-开始一个任务" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Start(&quot;任务标识&quot;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2684-暂停一个任务"></a>26.8.4 暂停一个任务<a class="hash-link" href="#2684-暂停一个任务" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Stop(&quot;任务标识&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// 还可以标记一个任务执行失败</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Stop(&quot;任务标识&quot;, true);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2685-取消一个任务"></a>26.8.5 取消一个任务<a class="hash-link" href="#2685-取消一个任务" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Cancel(&quot;任务名称&quot;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2686-销毁所有任务"></a>26.8.6 销毁所有任务<a class="hash-link" href="#2686-销毁所有任务" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Dispose();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2687-获取所有任务"></a>26.8.7 获取所有任务<a class="hash-link" href="#2687-获取所有任务" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var workers = SpareTime.GetWorkers();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2688-解析-cron-表达式"></a>26.8.8 解析 <code>Cron</code> 表达式<a class="hash-link" href="#2688-解析-cron-表达式" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var nextTime = SpareTime.GetCronNextOccurrence(&quot;* * * * *&quot;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="269-并行和串行执行方式"></a>26.9 <code>并行</code>和<code>串行</code>执行方式<a class="hash-link" href="#269-并行和串行执行方式" title="Direct link to heading">#</a></h2><p><code>Furion</code> 框架提供了任务两种执行方式 <code>并行</code> 和 <code>串行</code>：</p><ul><li><code>并行</code>：无需等待上一次任务完成，<strong>默认值</strong></li><li><code>串行</code>：需等待上一次任务完成</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2691-sparetime-静态方式指定"></a>26.9.1 <code>SpareTime</code> 静态方式指定<a class="hash-link" href="#2691-sparetime-静态方式指定" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Do(1000, (t, i) =&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    Thread.Sleep(5000); // 模拟执行耗时任务</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine($&quot;{t.WorkerName} -{t.Description} - {DateTime.Now:yyyy-MM-dd HH:mm:ss} - {i}&quot;);</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">}, &quot;serialName&quot;, &quot;模拟串行任务&quot;, executeType: SpareTimeExecuteTypes.Serial);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="2692-isparetimeworker-方式"></a>26.9.2 <code>ISpareTimeWorker</code> 方式<a class="hash-link" href="#2692-isparetimeworker-方式" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">[SpareTime(1000, &quot;jobName1&quot;, StartNow = true, ExecuteType = SpareTimeExecuteTypes.Serial)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public void DoSomething1(SpareTimer timer, long count)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine(DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Console.WriteLine($&quot;一共执行了：{count} 次&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="2610-任务异常处理"></a>26.10 任务异常处理<a class="hash-link" href="#2610-任务异常处理" title="Direct link to heading">#</a></h2><p>有些时候我们可能在执行任务过程中出现异常，<code>Furion</code> 也提供了属性判断是否有异常和异常信息，方便记录到日志中，如：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Do(1000, (t, c) =&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // 判断是否有异常</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    if (t.Exception.Any())</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine(t.Exception.Values.LastOrDefault()?.Message);</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // 执行第三次抛异常</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (c &gt; 2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">        throw Oops.Oh(&quot;抛异常&quot; + c);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Console.WriteLine($&quot;{t.WorkerName} -{t.Description} - {DateTime.Now:yyyy-MM-dd HH:mm:ss} - {c}&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}, &quot;exceptionJob&quot;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>特别说明</h5></div><div class="admonition-content"><p>如果一个任务错误次数达 <code>10次</code> 则任务将自动停止，并标记任务状态为 <code>Failed</code>。</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="2611-如何在任务中解析对象"></a>26.11 如何在任务中解析对象<a class="hash-link" href="#2611-如何在任务中解析对象" title="Direct link to heading">#</a></h2><p>有些时候我们需要在任务中进行数据库操作或解析服务，这时候我们只需要创建一个新的作用域即可</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpareTime.Do(1000, (timer,count) =&gt; {</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    Scoped.Create((_, scope) =&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        var services = scope.ServiceProvider;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // 获取数据库上下文</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        var dbContext = Db.GetDbContext(services);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // 获取仓储</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        var respository = Db.GetRepository&lt;Person&gt;(services);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // 解析其他服务</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        var otherService = services.GetService&lt;XXX&gt;();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        var otherService2 = App.GetService&lt;XXX&gt;(services);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}, &quot;任务标识&quot;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="2612-在-backgroundservice-中使用"></a>26.12 在 <code>BackgroundService</code> 中使用<a class="hash-link" href="#2612-在-backgroundservice-中使用" title="Direct link to heading">#</a></h2><p><code>BackgroundService</code> 是 <code>.NET Core 3</code> 之后提供的轻量级后台任务，同时可以发布到 <code>Windows</code> 服务和 <code>Linux</code> 守护进程中。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="26121-间隔执行方式"></a>26.12.1 间隔执行方式<a class="hash-link" href="#26121-间隔执行方式" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">using Furion.TaskScheduler;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using Microsoft.Extensions.Hosting;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using Microsoft.Extensions.Logging;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Threading;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Threading.Tasks;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace WorkerService1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public class Worker : BackgroundService</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private readonly ILogger&lt;Worker&gt; _logger;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public Worker(ILogger&lt;Worker&gt; logger)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            _logger = logger;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        protected override async Task ExecuteAsync(CancellationToken stoppingToken)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            while (!stoppingToken.IsCancellationRequested)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">                // 间隔执行任务</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">                await SpareTime.DoAsync(1000, () =&gt;</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">                {</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">                    _logger.LogInformation(&quot;Worker running at: {time}&quot;, DateTimeOffset.Now);</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">                }, stoppingToken);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="26122-cron-表达式执行方式，"></a>26.12.2 <code>Cron</code> 表达式执行方式，<a class="hash-link" href="#26122-cron-表达式执行方式，" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">using Furion.TaskScheduler;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using Microsoft.Extensions.Hosting;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using Microsoft.Extensions.Logging;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Threading;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Threading.Tasks;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace WorkerService1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public class Worker : BackgroundService</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private readonly ILogger&lt;Worker&gt; _logger;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public Worker(ILogger&lt;Worker&gt; logger)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            _logger = logger;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        protected override async Task ExecuteAsync(CancellationToken stoppingToken)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            while (!stoppingToken.IsCancellationRequested)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">                // 执行 Cron 表达式任务</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">                await SpareTime.DoAsync(&quot;*/5 * * * * *&quot;, () =&gt;</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">                {</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">                    _logger.LogInformation(&quot;Worker running at: {time}&quot;, DateTimeOffset.Now);</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">                }, stoppingToken, CronFormat.IncludeSeconds);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="2613-反馈与建议"></a>26.13 反馈与建议<a class="hash-link" href="#2613-反馈与建议" title="Direct link to heading">#</a></h2><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>与我们交流</h5></div><div class="admonition-content"><p>给 Furion 提 <a href="https://gitee.com/dotnetchina/Furion/issues/new?issue" target="_blank" rel="noopener noreferrer">Issue</a>。</p></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://gitee.com/dotnetchina/Furion/tree/master/handbook/docs/job.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-04-23T01:50:29.000Z" class="lastUpdatedDate_1WI_">4/23/2021</time> by <strong>Monk</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/process-service"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 25. 辅助角色服务</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/idgenerator"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">27. 分布式 ID 生成 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#261-关于定时任务" class="table-of-contents__link">26.1 关于定时任务</a></li><li><a href="#262-如何实现" class="table-of-contents__link">26.2 如何实现</a></li><li><a href="#263-缓隔方式使用" class="table-of-contents__link">26.3 缓隔方式使用</a><ul><li><a href="#2631-特定时间后执行" class="table-of-contents__link">26.3.1 特定时间后执行</a></li><li><a href="#2632-配置任务信息" class="table-of-contents__link">26.3.2 配置任务信息</a></li><li><a href="#2633-手动启动执行" class="table-of-contents__link">26.3.3 手动启动执行</a></li><li><a href="#2634-模拟后台执行" class="table-of-contents__link">26.3.4 模拟后台执行</a></li><li><a href="#2635-isparetimeworker-方式" class="table-of-contents__link">26.3.5 <code>ISpareTimeWorker</code> 方式</a></li></ul></li><li><a href="#264-间隔方式使用" class="table-of-contents__link">26.4 间隔方式使用</a><ul><li><a href="#2641-每隔一段时间执行" class="table-of-contents__link">26.4.1 每隔一段时间执行</a></li><li><a href="#2642-配置任务信息" class="table-of-contents__link">26.4.2 配置任务信息</a></li><li><a href="#2643-手动启动执行" class="table-of-contents__link">26.4.3 手动启动执行</a></li><li><a href="#2644-isparetimeworker-方式" class="table-of-contents__link">26.4.4 <code>ISpareTimeWorker</code> 方式</a></li></ul></li><li><a href="#265-cron-表达式使用" class="table-of-contents__link">26.5 <code>Cron</code> 表达式使用</a><ul><li><a href="#2651-什么是-cron-表达式" class="table-of-contents__link">26.5.1 什么是 <code>Cron</code> 表达式</a></li><li><a href="#2552-常见-cron-表达式" class="table-of-contents__link">25.5.2 常见 <code>Cron</code> 表达式</a></li><li><a href="#2553-在线生成-cron-表达式" class="table-of-contents__link">25.5.3 在线生成 <code>Cron</code> 表达式</a></li><li><a href="#2554-macro-标识符" class="table-of-contents__link">25.5.4 <code>Macro</code> 标识符</a></li><li><a href="#2555-使用-cron-表达式" class="table-of-contents__link">25.5.5 使用 <code>Cron</code> 表达式</a></li><li><a href="#2556-使用-macro-占位符" class="table-of-contents__link">25.5.6 使用 <code>Macro</code> 占位符</a></li><li><a href="#2557-配置任务信息" class="table-of-contents__link">25.5.7 配置任务信息</a></li><li><a href="#2558-手动启动执行" class="table-of-contents__link">25.5.8 手动启动执行</a></li><li><a href="#2659-isparetimeworker-方式" class="table-of-contents__link">26.5.9 <code>ISpareTimeWorker</code> 方式</a></li></ul></li><li><a href="#266-自定义下次执行时间" class="table-of-contents__link">26.6 自定义下次执行时间</a><ul><li><a href="#2661-高级自定义间隔方式" class="table-of-contents__link">26.6.1 高级自定义间隔方式</a></li><li><a href="#2662-高级自定义-cron-表达式" class="table-of-contents__link">26.6.2 高级自定义 <code>Cron</code> 表达式</a></li></ul></li><li><a href="#267-isparetimeworker-说明" class="table-of-contents__link">26.7 <code>ISpareTimeWorker</code> 说明</a><ul><li><a href="#2671-sparetime-特性" class="table-of-contents__link">26.7.1 <code>[SpareTime]</code> 特性</a></li></ul></li><li><a href="#268-sparetime-静态类" class="table-of-contents__link">26.8 <code>SpareTime</code> 静态类</a><ul><li><a href="#2681-初始化任务" class="table-of-contents__link">26.8.1 初始化任务</a></li><li><a href="#2682-实现后台执行" class="table-of-contents__link">26.8.2 实现后台执行</a></li><li><a href="#2683-开始一个任务" class="table-of-contents__link">26.8.3 开始一个任务</a></li><li><a href="#2684-暂停一个任务" class="table-of-contents__link">26.8.4 暂停一个任务</a></li><li><a href="#2685-取消一个任务" class="table-of-contents__link">26.8.5 取消一个任务</a></li><li><a href="#2686-销毁所有任务" class="table-of-contents__link">26.8.6 销毁所有任务</a></li><li><a href="#2687-获取所有任务" class="table-of-contents__link">26.8.7 获取所有任务</a></li><li><a href="#2688-解析-cron-表达式" class="table-of-contents__link">26.8.8 解析 <code>Cron</code> 表达式</a></li></ul></li><li><a href="#269-并行和串行执行方式" class="table-of-contents__link">26.9 <code>并行</code>和<code>串行</code>执行方式</a><ul><li><a href="#2691-sparetime-静态方式指定" class="table-of-contents__link">26.9.1 <code>SpareTime</code> 静态方式指定</a></li><li><a href="#2692-isparetimeworker-方式" class="table-of-contents__link">26.9.2 <code>ISpareTimeWorker</code> 方式</a></li></ul></li><li><a href="#2610-任务异常处理" class="table-of-contents__link">26.10 任务异常处理</a></li><li><a href="#2611-如何在任务中解析对象" class="table-of-contents__link">26.11 如何在任务中解析对象</a></li><li><a href="#2612-在-backgroundservice-中使用" class="table-of-contents__link">26.12 在 <code>BackgroundService</code> 中使用</a><ul><li><a href="#26121-间隔执行方式" class="table-of-contents__link">26.12.1 间隔执行方式</a></li><li><a href="#26122-cron-表达式执行方式，" class="table-of-contents__link">26.12.2 <code>Cron</code> 表达式执行方式，</a></li></ul></li><li><a href="#2613-反馈与建议" class="table-of-contents__link">26.13 反馈与建议</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">文档</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/get-start">入门</a></li><li class="footer__item"><a class="footer__link-item" href="/docs">指南</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">社区</h4><ul class="footer__items"><li class="footer__item"><a href="https://gitee.com/dotnetchina/Furion/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">讨论</a></li><li class="footer__item"><a href="https://gitee.com/dotnetchina/Furion/board" target="_blank" rel="noopener noreferrer" class="footer__link-item">看板</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">更多</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">博客</a></li><li class="footer__item"><a href="https://gitee.com/dotnetchina/Furion" target="_blank" rel="noopener noreferrer" class="footer__link-item">仓库</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://gitee.com/dotnetchina" target="_blank" rel="noopener noreferrer" class="footerLogoLink_qW4Z"><img class="footer__logo" src="/img/chinadotnet.png" style="background:#fff;padding:5px 10px"></a></div><div class="footer__copyright">Copyright © 2020-2021 Furion, Baiqian Co.,Ltd.</div></div></div></footer><div class="furion-join-group"><button>加入 dotNET China 交流群</button></div><div class="furion-star-project"><button class="furion-star-close">关闭</button><a href="https://gitee.com/dotnetchina/MiniExcel" target="_blank" title="dotNET China 精选项目第 06 期"><img src="/img/MiniExcel.png"></a></div></div>
<script src="/assets/js/styles.b4c13270.js"></script>
<script src="/assets/js/runtime~main.073cd200.js"></script>
<script src="/assets/js/main.0ad7cce4.js"></script>
<script src="/assets/js/1.887ae15b.js"></script>
<script src="/assets/js/2.dfab4be6.js"></script>
<script src="/assets/js/29798642.afdb1875.js"></script>
<script src="/assets/js/136.c1e0c466.js"></script>
<script src="/assets/js/935f2afb.491950ac.js"></script>
<script src="/assets/js/17896441.e0dfe825.js"></script>
<script src="/assets/js/22f09a41.469c0620.js"></script>
</body>
</html>