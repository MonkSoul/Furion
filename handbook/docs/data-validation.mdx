---
id: data-validation
title: 8. æ•°æ®æ ¡éªŒ
sidebar_label: 8. æ•°æ®æ ¡éªŒ
---

import useBaseUrl from "@docusaurus/useBaseUrl";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

## 8.1 å…³äºæ•°æ®æ ¡éªŒ

æ•°æ®æ ¡éªŒå­—é¢ä¸Šçš„æ„æ€å°±æ˜¯å¯¹ä½¿ç”¨è€…æäº¤è¿‡æ¥çš„æ•°æ®è¿›è¡Œåˆæ³•æ€§éªŒè¯ã€‚åœ¨ä¸€å¥—å®Œå–„çš„åº”ç”¨ç³»ç»Ÿä¸­ï¼Œæ•°æ®æœ‰æ•ˆæ€§æ ¡éªŒæ˜¯å¿…ä¸å¯å°‘çš„ä¸šåŠ¡å¤„ç†ç¬¬ä¸€é“å…³å¡ã€‚

## 8.2 æ•°æ®æ ¡éªŒçš„å¥½å¤„

- è¿‡æ»¤ä¸å®‰å…¨æ•°æ®ï¼Œæé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§
- å‡å°‘ä¸å¿…è¦çš„ä¸šåŠ¡å¼‚å¸¸å¤„ç†ï¼Œæé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦
- å¤§å¤§æé«˜ç³»ç»Ÿç¨³å®šæ€§
- å¤§æ•°æ®å¹¶å‘æ—¶èµ·ç€ä¸€å®šçš„ç¼“å†²ä½œç”¨

## 8.3 æ•°æ®æ ¡éªŒæ–¹å¼

- ä¼ ç»Ÿæ–¹å¼ï¼Œåœ¨ä¸šåŠ¡ä»£ç ä¹‹å‰æ‰‹åŠ¨éªŒè¯
- `Mvc` ç‰¹æ€§æ–¹å¼ï¼Œ`Mvc` å†…ç½®çš„ `DataAnnotations` æ–¹å¼
- **æ¨èæ–¹å¼**ï¼Œ`Fur` æ¡†æ¶å†…ç½®çš„ `DataValidation` éªŒè¯
- å…¶ä»–æ–¹å¼ï¼Œä½¿ç”¨ç¬¬ä¸‰æ–¹éªŒè¯åº“ï¼Œå¦‚ `FluentValidation`

### 8.3.1 ä¼ ç»Ÿæ–¹å¼

åœ¨å¾ˆå¤šè€é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸çœ‹åˆ°è¿™æ ·çš„ä»£ç ï¼š

```cs {4,9,14}
public bool Insert(Person person)
{
    // éªŒè¯å‚æ•°
    if(string.IsNullOrEmty(person.Name))
    {
        throw new System.Exception("åå­—ä¸èƒ½ä¸ºç©º");
    }

    if(person.Age < 18)
    {
        throw new System.Exception("å¹´é¾„ä¸èƒ½å°äº 18 å²");
    }

    if(!person.Password.Equals(person.ConfirmPassword)
    {
        throw new System.Exception("ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´");
    }

    // ä¸šåŠ¡ä»£ç 
    _repository.Insert(person.Adapt<PersonEntity>());

    // ...
}
```

ä»ä¸Šé¢çš„ä»£ç çœ‹èµ·æ¥ï¼Œä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆä¸å¦¥ï¼Œä½†æ˜¯ä»ä¸€ä¸ªç¨‹åºå¯ç»´æŠ¤æ€§æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªç³Ÿç³•çš„ä»£ç ï¼Œå› ä¸ºè¯¥ä¸šåŠ¡ä»£ç ä¸­**åŒ…å«äº†å¤ªå¤šä¸ä¸šåŠ¡æ— å…³çš„æ•°æ®éªŒè¯**ã€‚

è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœè¿™ä¸ª `Person` æœ‰ å‡ åä¸ªå‚æ•°éƒ½éœ€è¦éªŒè¯å‘¢ï¼Ÿå¯æƒ³è€ŒçŸ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªåºå¤§çš„ä¸šåŠ¡ä»£ç ã€‚

å†è€…ï¼Œå¦‚æœå…¶ä»–åœ°æ–¹ä¹Ÿéœ€è¦ç”¨åˆ°è¿™ä¸ª `Person` ç±»éªŒè¯å‘¢ï¼Ÿé‚£ä»£ç å¥½æ¯”è€é¼ å•ƒè¿‡çš„é¢åŒ…å±‘ä¸€æ ·ï¼Œåˆ°å¤„éƒ½æ˜¯ã€‚

å¦‚æ­¤å¾—çŸ¥ï¼Œè¿™æ ·çš„æ–¹å¼æ˜¯æå…¶ä¸æ¨èçš„ï¼Œ**ä¸ä½†æ±¡æŸ“äº†ä¸šåŠ¡ä»£ç ï¼Œä¹Ÿç ´åäº†ä¸šåŠ¡èŒè´£å•ä¸€æ€§åŸç†ï¼Œä¹Ÿè®©éªŒè¯é€»è¾‘æ— æ³•å®ç°é€šç”¨ï¼Œåç»­ç»´æŠ¤éš¾åº¦å¤§å¤§å‡çº§**ã€‚

### 8.3.2 `Mvc` ç‰¹æ€§æ–¹å¼

åœ¨ `ASP.NET Core` ä¸­ï¼Œå¾®è½¯ä¸ºæˆ‘ä»¬æä¾›äº†å…¨æ–°çš„ `ç‰¹æ€§` éªŒè¯æ–¹å¼ï¼Œå¯é€šè¿‡å¯¹å¯¹è±¡è´´ç‰¹æ€§å®ç°æ•°æ®éªŒè¯ã€‚è¿™ç§æ–¹å¼æœ‰æ•ˆçš„å°†æ•°æ®æ ¡éªŒå’Œä¸šåŠ¡ä»£ç å‰¥ç¦»å¼€æ¥ï¼Œè€Œä¸”å®¹æ˜“ä½¿ç”¨å’Œæ‹“å±•ã€‚

- **åœ¨æ¨¡å‹ä¸­éªŒè¯**

```cs {1,7-8,11-12}
using System.ComponentModel.DataAnnotations;

namespace Hoa.Application.Authorization.Dtos
{
    public class SignInInput
    {
        [Required]  // å¿…å¡«éªŒè¯
        [MinLength(4)]  // æœ€å°é•¿åº¦éªŒè¯
        public string Account { get; set; }

        [Required]    // å¿…å¡«éªŒè¯
        [MaxLength(32)]    // æœ€å¤§é•¿åº¦éªŒè¯
        public string Password { get; set; }
    }
}
```

- **åœ¨å‚æ•°ä¸­éªŒè¯**

```cs {2-3,8-9,12-13}
public void CheckMethodParameterValid(
    [Required]    // å¿…å¡«éªŒè¯
    [MinLength(4)]    // æœ€å°é•¿åº¦éªŒè¯
    string name,

    int age,

    [Required]    // å¿…å¡«éªŒè¯
    [RegularExpression("[a-zA-Z0-9_]{8,30}")    // æ­£åˆ™è¡¨è¾¾å¼éªŒè¯
    string password,

    [Required]    // å¿…å¡«éªŒè¯
    [RegularExpression("[a-zA-Z0-9_]{8,30}")    // æ­£åˆ™è¡¨è¾¾å¼éªŒè¯
    string confirmPassword
)
{
    // TODO
}
```

:::note å°æé†’

å¦‚æœå‡½æ•°çš„å‚æ•°å¤§äºæˆ–ç­‰äº 3 ä¸ªï¼Œå»ºè®®æŠ½ç¦»å‡ºæ¨¡å‹ç±»ï¼Œä¹Ÿå°±æ˜¯ä¸å»ºè®®ä¸Šé¢çš„æ–¹å¼ã€‚

:::

- **è‡ªå®šä¹‰ç‰¹æ€§éªŒè¯**

```cs {1,13-24}
public class ClassicMovieAttribute : ValidationAttribute
{
    public ClassicMovieAttribute(int year)
    {
        Year = year;
    }

    public int Year { get; }

    public string GetErrorMessage() =>
        $"Classic movies must have a release year no later than {Year}.";

    protected override ValidationResult IsValid(object value, ValidationContext validationContext)
    {
        var movie = (Movie)validationContext.ObjectInstance;
        var releaseYear = ((DateTime)value).Year;

        if (movie.Genre == Genre.Classic && releaseYear > Year)
        {
            return new ValidationResult(GetErrorMessage());
        }

        return ValidationResult.Success;
    }
}
```

- **`IValidatableObject` å¤æ‚éªŒè¯**

```cs {1,3,10-19}
using System.Collections.Generic;

public class DtoModel : IValidatableObject
{
    [Required]
    [StringLength(100)]
    public string Title { get; set; }

    // ä½ çš„éªŒè¯é€»è¾‘
    public IEnumerable<ValidationResult> Validate(ValidationContext validationContext)
    {
        if (ä½ çš„é€»è¾‘ä»£ç )
        {
            yield return new ValidationResult(
                "é”™è¯¯æ¶ˆæ¯"
                ,new[] { nameof(Title) }  // éªŒè¯å¤±è´¥çš„å±æ€§
            );
        }
    }
}
```

`Mvc` ç‰¹æ€§æ–¹å¼æå¤§çš„å°†ä¸šåŠ¡é€»è¾‘å’ŒéªŒè¯è¿›è¡Œäº†å‰¥ç¦»å’Œè§£è€¦ï¼Œè€Œä¸”è¿˜èƒ½å®ç°è‡ªå®šä¹‰å¤æ‚éªŒè¯ã€‚

**ä½†æ˜¯ `Mvc` ç‰¹æ€§éªŒè¯æ–¹å¼æœ‰å‡ ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹**ï¼š

- åªèƒ½åœ¨ `æ§åˆ¶å™¨` ä¸­çš„ `Action`ï¼ˆåŠ¨ä½œæ–¹æ³•ï¼‰ä¸­ä½¿ç”¨
- **æ— æ³•åœ¨ä»»æ„ç±»ã€ä»»æ„æ–¹æ³•ä¸­ä½¿ç”¨**
- å†…ç½®çš„éªŒè¯ç±»å‹éå¸¸æœ‰é™ï¼Œä¸”ä¸æ˜“æ‹“å±•
- ä¸æ”¯æŒéªŒè¯æ¶ˆæ¯åæœŸé…ç½®

æ‰€ä»¥ï¼Œ`Fur` æä¾›äº†æ–°çš„éªŒè¯å¼•æ“ `DataValidation`ï¼Œåœ¨å®Œå…¨å…¼å®¹ `Mvc` å†…ç½®éªŒè¯çš„åŒæ—¶æä¾›äº†å¤§é‡å¸¸è§éªŒè¯ã€å¤æ‚éªŒè¯ã€è‡ªå®šä¹‰éªŒè¯ç­‰èƒ½åŠ›ã€‚

## 8.4 `DataValidation` éªŒè¯ ğŸ¤—

`DataValidation` æ˜¯ `Fur` æ¡†æ¶æä¾›äº†å…¨æ–°çš„éªŒè¯æ–¹å¼ï¼Œå®Œå…¨å…¼å®¹ `Mvc` å†…ç½®éªŒè¯ï¼Œå¹¶ä¸”èµ‹äºˆäº†è¶…èƒ½ã€‚

### 8.4.1 `DataValidation` ä¼˜ç‚¹

- **å®Œå…¨å…¼å®¹ `Mvc` å†…ç½®éªŒè¯å¼•æ“**
- **å†…ç½®å¸¸è§éªŒè¯ç±»å‹åŠå¯è‡ªå®šä¹‰éªŒè¯ç±»å‹åŠŸèƒ½**
- æä¾›å…¨å±€å¯¹è±¡æ‹“å±•éªŒè¯æ–¹å¼
- æ”¯æŒéªŒè¯æ¶ˆæ¯åæœŸé…ç½®ï¼Œæ”¯æŒå®æ—¶æ›´æ–°
- æ”¯æŒåœ¨ä»»ä½•ç±»ï¼Œä»»ä½•æ–¹æ³•ã€ä»»ä½•ä½ç½®å®ç°æ‰‹åŠ¨éªŒè¯ã€ç‰¹æ€§æ–¹å¼éªŒè¯ç­‰
- æ”¯æŒè®¾ç½®éªŒè¯ç»“æœæ¨¡å‹

## 8.5 `DataValidation` ä½¿ç”¨

### 8.5.1 æ³¨å†ŒéªŒè¯æœåŠ¡

```cs {11} title="Fur.Web.Core\FurWebCoreStartup.cs"
using Microsoft.Extensions.DependencyInjection;

namespace Fur.Web.Core
{
    [AppStartup(800)]
    public sealed class FurWebCoreStartup : AppStartup
    {
        public void ConfigureServices(IServiceCollection services)
        {
            services.AddControllers()
                    .AddDataValidation();
        }
    }
}
```

:::important ç‰¹åˆ«æ³¨æ„

`.AddDataValidation()` éœ€åœ¨ `services.AddControllers()` ä¹‹åæ³¨å†Œã€‚

:::

### 8.5.2 å…¼å®¹ `Mvc` ç‰¹æ€§éªŒè¯

<Tabs
  defaultValue="testdto"
  values={[
    { label: "TestDto", value: "testdto" },
    { label: "FurAppService", value: "furAppService" },
  ]}
>
  <TabItem value="testdto">


```cs {1,7,10}
using System.ComponentModel.DataAnnotations;

namespace Fur.Application
{
    public class TestDto
    {
        [Range(10, 20, ErrorMessage = "Id åªèƒ½åœ¨ 10-20 åŒºé—´å–å€¼")]
        public int Id { get; set; }

        [Required(ErrorMessage = "å¿…å¡«"), MinLength(3, ErrorMessage = "å­—ç¬¦ä¸²é•¿åº¦ä¸èƒ½å°‘äº3ä½")]
        public string Name { get; set; }
    }
}
```

  </TabItem>
  <TabItem value="furAppService">


```cs {12,22}
using Fur.DynamicApiController;

namespace Fur.Application
{
    public class FurAppService : IDynamicApiController
    {
        /// <summary>
        /// å€¼ç±»å‹éªŒè¯
        /// </summary>
        /// <param name="id"></param>
        /// <returns></returns>
        public int Get(int id)
        {
            return id;
        }

        /// <summary>
        /// å¯¹è±¡ç±»å‹éªŒè¯
        /// </summary>
        /// <param name="testDto"></param>
        /// <returns></returns>
        public TestDto Post(TestDto testDto)
        {
            return testDto;
        }
    }
}
```

  </TabItem>
</Tabs>


å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/sjyz1.gif")} />

### 8.5.3 å…¼å®¹ `Mvc` å¤æ‚éªŒè¯

```cs {2,6,14-22}
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;

namespace Fur.Application
{
    public class TestDto : IValidatableObject
    {
        [Range(10, 20, ErrorMessage = "Id åªèƒ½åœ¨ 10-20 åŒºé—´å–å€¼")]
        public int Id { get; set; }

        [Required(ErrorMessage = "å¿…å¡«"), MinLength(3, ErrorMessage = "å­—ç¬¦ä¸²é•¿åº¦ä¸èƒ½å°‘äº3ä½")]
        public string Name { get; set; }

        public IEnumerable<ValidationResult> Validate(ValidationContext validationContext)
        {
            if (Name.StartsWith("Fur"))
            {
                yield return new ValidationResult(
                    "ä¸èƒ½ä»¥ Fur å¼€å¤´"
                    , new[] { nameof(Name) }
                );
            }
        }
    }
}
```

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/sjyz2.gif")} />

## 8.6 æ‰‹åŠ¨éªŒè¯

### 8.7.1 éªŒè¯æ¨¡å‹

```cs {1,11}
using Fur.DataValidation;
using Fur.DynamicApiController;

namespace Fur.Application
{
    public class FurAppService : IDynamicApiController
    {
        [NonValidation] // è·³è¿‡å…¨å±€éªŒè¯
        public DataValidationResult Post(TestDto testDto)
        {
            return testDto.TryValidate();
        }
    }
}
```

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/sjyz3.gif")} />

:::note

æ”¯æŒ **`Mvc`** å†…ç½®çš„ç‰¹æ€§éªŒè¯ã€å±æ€§éªŒè¯åŠå¤æ‚çš„ **`IValidatableObject`** éªŒè¯ã€‚

:::

### 8.7.2 `ValidationTypes` å¸¸è§éªŒè¯

`Fur` å†…ç½®äº†å¾ˆå¤šå¸¸ç”¨ç±»å‹çš„æ•°æ®éªŒè¯ï¼ŒåŒ…æ‹¬ï¼š

- `Required`ï¼šéç©ºã€é Null ç±»å‹
- `Numeric`ï¼šæ•°å€¼ç±»å‹
- `PositiveNumber`ï¼šæ­£æ•°ç±»å‹
- `NegativeNumber`ï¼šè´Ÿæ•°ç±»å‹
- `Integer`ï¼šæ•´æ•°ç±»å‹
- `Money`ï¼šé‡‘é’±ç±»å‹
- `Date`ï¼šæ—¥æœŸç±»å‹
- `Time`ï¼šæ—¶é—´ç±»å‹
- `IDCard`ï¼šèº«ä»½è¯ç±»å‹
- `PostCode`ï¼šé‚®ç¼–ç±»å‹
- `PhoneNumber`ï¼šæ‰‹æœºå·ç±»å‹
- `Telephone`ï¼šå›ºè¯ç±»å‹
- `PhoneOrTelNumber`ï¼šæ‰‹æœºæˆ–å›ºè¯ç±»å‹
- `EmailAddress`ï¼šé‚®ä»¶åœ°å€ç±»å‹
- `Url`ï¼šç½‘å€ç±»å‹
- `Color`ï¼šé¢œè‰²å€¼ç±»å‹
- `Chinese`ï¼šä¸­æ–‡ç±»å‹
- `IPv4`ï¼šIPv4 åœ°å€ç±»å‹
- `IPv6`ï¼šIPv6 åœ°å€ç±»å‹
- `Age`ï¼šå¹´é¾„ç±»å‹
- `ChineseName`ï¼šä¸­æ–‡åç±»å‹
- `EnglishName`ï¼šè‹±æ–‡åç±»å‹
- `Capital`ï¼šçº¯å¤§å†™è‹±æ–‡ç±»å‹
- `Lowercase`ï¼šçº¯å°å†™è‹±æ–‡ç±»å‹
- `Ascii`ï¼šAscii ç±»å‹
- `Md5`ï¼šMd5 å­—ç¬¦ä¸²ç±»å‹
- `Zip`ï¼šå‹ç¼©åŒ…æ ¼å¼ç±»å‹
- `Image`ï¼šå›¾ç‰‡æ ¼å¼ç±»å‹
- `Document`ï¼šæ–‡æ¡£æ ¼å¼ç±»å‹
- `MP3`ï¼šMp3 æ ¼å¼ç±»å‹
- `Flash`ï¼šFlash æ ¼å¼ç±»å‹
- `Video`ï¼šè§†é¢‘æ–‡ä»¶æ ¼å¼ç±»å‹

**ä½¿ç”¨ç¤ºä¾‹**

<Tabs
  defaultValue="dglx"
  values={[
    { label: "å•ä¸ªç±»å‹éªŒè¯", value: "dglx" },
    { label: "å¤šä¸ªç»„åˆç±»å‹éªŒè¯", value: "zhlx" },
  ]}
>
<TabItem value="dglx">


```cs
// éªŒè¯å¿…å¡«
"".TryValidate(ValidationTypes.Required);   // => false

// éªŒè¯ä¸­æ–‡
"æˆ‘å« MonK".TryValidate(ValidationTypes.Chinese); // => false

// éªŒè¯æ•°å€¼
2.TryValidate(ValidationTypes.Numeric); // => true

// éªŒè¯æ•´æ•°
true.TryValidate(ValidationTypes.Integer); // => false

// éªŒè¯é‚®ç®±
"monksoul@outlook.com".TryValidate(ValidationTypes.EmailAddress); // => true

// éªŒè¯è´Ÿæ•°
2.0m.TryValidate(ValidationTypes.NegativeNumber); // => false

// è‡ªå®šä¹‰æ­£åˆ™è¡¨è¾¾å¼éªŒè¯
"Fur".TryValidate("/^Fur$"); // => true
```

</TabItem>
<TabItem value="zhlx">


```cs
// éªŒè¯æ•°å€¼ç±»å‹ä¸”æ˜¯æ•´æ•°
"20".TryValidate(ValidationTypes.Numeric, ValidationTypes.Integer); // => true

// éªŒè¯æ—¶æ—¥æœŸæˆ–æ—¶é—´æ ¼å¼
"2020-05-20".TryValidate(ValidationOptions.AtLeastOne, ValidationTypes.Date, ValidationTypes.Time); // => true
"23:45:20".TryValidate(ValidationOptions.AtLeastOne, ValidationTypes.Date, ValidationTypes.Time); // => true

```

</TabItem>
</Tabs>


:::tip å°çŸ¥è¯†

å¯é€šè¿‡è®¾ç½® `TryValidate([ValidationOptions], params object[] validationTypes)` æ–¹æ³•çš„ `ValidationOptions` å‚æ•°é…ç½®éªŒè¯é€»è¾‘ï¼Œå¦‚ï¼š**`åŒæ—¶æˆç«‹`** æˆ– **`åªè¦ä¸€ä¸ªæˆç«‹`** å³å¯éªŒè¯é€šè¿‡

:::

### 8.7.3 `[DataValidation]` ç‰¹æ€§

`Fur` è¿˜æä¾›äº† `[DataValidation]` ç‰¹æ€§æ–¹ä¾¿åœ¨æ¨¡å‹å‚æ•°ä¸­ä½¿ç”¨ `ValidationTypes` å¸¸è§éªŒè¯æˆ–è‡ªå®šä¹‰éªŒè¯ã€‚

```cs {1,7,10,14,17,20}
using Fur.DataValidation;

namespace Fur.Application
{
    public class TestDto
    {
        [DataValidation(ValidationTypes.Integer)]
        public int Id { get; set; }

        [DataValidation(ValidationTypes.Numeric, ValidationTypes.Integer)]
        public int Cost { get; set; }

        [DataValidation(ValidationOptions.AtLeastOne, ValidationTypes.Chinese, ValidationTypes.Date)]
        public string Name { get; set; }

        // å¯ä»¥å’ŒMvcç‰¹æ€§å…±å­˜
        [Required, DataValidation(ValidationTypes.Age)]
        public int Age { get; set; }

        [DataValidation(ValidationTypes.IDCard, ErrorMessage = "è‡ªå®šä¹‰èº«ä»½è¯æç¤ºæ¶ˆæ¯")]
        public string IDCard { get; set; }
    }
}
```

## 8.7 `[NonValidation]` è·³è¿‡éªŒè¯

`Fur` æ¡†æ¶æä¾›äº†å¯¹è±¡æ¨¡å‹è·³è¿‡éªŒè¯ç‰¹æ€§ `[NonValidation]`ï¼Œæ”¯æŒåœ¨ `æ§åˆ¶å™¨`ï¼Œ`åŠ¨ä½œæ–¹æ³•`ï¼Œ`ç±»` ä¸­ä½¿ç”¨ã€‚

ä¸€æ—¦è´´äº†æ­¤ç‰¹æ€§ï¼Œé‚£ä¹ˆå°†ä¸ä¼šæ‰§è¡ŒéªŒè¯æ“ä½œã€‚

:::note

**`[NonValidation]`** åªå¯¹å¯¹è±¡ç±»å‹æœ‰æ•ˆï¼Œå€¼ç±»å‹æ— æ•ˆã€‚

:::

## 8.8 é«˜çº§è‡ªå®šä¹‰æ“ä½œ

### 8.8.1 è‡ªå®šä¹‰ `ValidationTypes` ç±»å‹

é™¤äº† `Fur` å†…ç½®çš„éªŒè¯ç±»å‹ä»¥å¤–ï¼Œ`Fur` è¿˜æä¾›äº†éå¸¸çµæ´»çš„è‡ªå®šä¹‰éªŒè¯ç±»å‹æœºåˆ¶ã€‚

å®ç°è‡ªå®šä¹‰éªŒè¯ç±»å‹å¿…é¡»éµå¾ªä»¥ä¸‹é…ç½®ï¼š

- éªŒè¯ç±»å‹å¿…é¡»æ—¶å…¬å¼€ä¸”æ—¶ `Enum` æšä¸¾ç±»å‹
- æšä¸¾ç±»å‹å¿…é¡»è´´æœ‰ `[ValidationType]` ç‰¹æ€§
- æšä¸¾ä¸­æ¯ä¸€é¡¹å¿…é¡»è´´æœ‰ `[ValidationItemMetadata]` ç‰¹æ€§

**å¦‚**ï¼š

```cs {1,6,12,18}
using Fur.DataValidation;
using System.Text.RegularExpressions;

namespace Fur.Application
{
    [ValidationType]
    public enum MyValidationTypes
    {
        /// <summary>
        /// å¼ºå¯†ç ç±»å‹
        /// </summary>
        [ValidationItemMetadata(@"^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,10}$", "å¿…é¡»é¡»åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—çš„ç»„åˆï¼Œä¸èƒ½ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ï¼Œé•¿åº¦åœ¨8-10ä¹‹é—´")]
        StrongPassword,

        /// <summary>
        /// ä»¥ Fur å­—ç¬¦ä¸²å¼€å¤´ï¼Œå¿½ç•¥å¤§å°å†™
        /// </summary>
        [ValidationItemMetadata(@"^(fur).*", "é»˜è®¤æç¤ºï¼šå¿…é¡»ä»¥Furå­—ç¬¦ä¸²å¼€å¤´ï¼Œå¿½ç•¥å¤§å°å†™", RegexOptions.IgnoreCase)]
        StartWithFurString
    }
}

```

**ä½¿ç”¨**

- æ‰‹åŠ¨ä½¿ç”¨

```cs
"q1w2e3".TryValidate(MyValidationTypes.StrongPassword); // => false

"furos".TryValidate(MyValidationTypes.StartWithFurString); // => true
```

- `[DataValidation]` ä¸­ä½¿ç”¨

```cs
[DataValidation(MyValidationTypes.StrongPassword)]
public string Password { get; set; }
```

- å¤šä¸ªè‡ªå®šä¹‰ç±»å‹æ··ç”¨

```cs
"Q1w2e3r4t5!*".TryValidate(MyValidationTypes.StrongPassword, ValidationTypes.Required); // => true
```

:::caution ç‰¹åˆ«æ³¨æ„

è‡ªå®šä¹‰çš„éªŒè¯ç±»å‹ä¹Ÿè¦ä¿è¯åç§°å…¨å±€å”¯ä¸€ï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªéªŒè¯ç±»å‹ä¸èƒ½å‡ºç°ä¸€æ ·çš„åå­—ã€‚

:::

### 8.8.2 è‡ªå®šä¹‰ `ValidationTypes` å¤±è´¥æ¶ˆæ¯

`Fur` å†…ç½®çš„ `ValidationTypes` å·²æœ‰é»˜è®¤çš„å¤±è´¥æ¶ˆæ¯ï¼š

- `Required`ï¼š**The Value is required.**
- `Numeric`ï¼š**The Value is not a numeric type.**
- `PositiveNumber`ï¼š**The Value is not a positive number type.**
- `NegativeNumber`ï¼š**The Value is not a negative number type.**
- `Integer`ï¼š**The Value is not a integer type.**
- `Money`ï¼š**The Value is not a money type.**
- `Date`ï¼š**The Value is not a date type.**
- `Time`ï¼š**The Value is not a time type.**
- `IDCard`ï¼š**The Value is not a idcard type.**
- `PostCode`ï¼š**The Value is not a postcode type.**
- `PhoneNumber`ï¼š**The Value is not a phone number type.**
- `Telephone`ï¼š**The Value is not a telephone type.**
- `PhoneOrTelNumber`ï¼š**The Value is not a phone number or telephone type.**
- `EmailAddress`ï¼š**The Value is not a email address type.**
- `Url`ï¼š**The Value is not a url address type.**
- `Color`ï¼š**The Value is not a color type.**
- `Chinese`ï¼š**The Value is not a chinese type.**
- `IPv4`ï¼š**The Value is not a IPv4 type.**
- `IPv6`ï¼š**The Value is not a IPv6 type.**
- `Age`ï¼š**The Value is not a age type.**
- `ChineseName`ï¼š**The Value is not a chinese name type.**
- `EnglishName`ï¼š**The Value is not a english name type.**
- `Capital`ï¼š**The Value is not a capital type.**
- `Lowercase`ï¼š**The Value is not a lowercase type.**
- `Ascii`ï¼š**The Value is not a ascii type.**
- `Md5`ï¼š**The Value is not a md5 type.**
- `Zip`ï¼š**The Value is not a zip type.**
- `Image`ï¼š**The Value is not a image type.**
- `Document`ï¼š**The Value is not a document type.**
- `MP3`ï¼š**The Value is not a mp3 type.**
- `Flash`ï¼š**The Value is not a flash type.**
- `Video`ï¼š**The Value is not a video type.**

æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºç»§æ‰¿ `IValidationMessageTypeProvider` éªŒè¯æ¶ˆæ¯æä¾›å™¨ç±»å‹ï¼Œæˆ–é€šè¿‡ `appsettings.json` é…ç½®ã€‚

- **`[ValidationMessageType]`** æ–¹å¼

```cs {5,9,12,15,19,22}
using Fur.DataValidation;

namespace Fur.Application
{
    [ValidationMessageType]
    public enum MyValidationMessageType
    {
        // ä¿®æ”¹å†…ç½®éªŒè¯ç±»å‹éªŒè¯å¤±è´¥æ¶ˆæ¯
        [ValidationMessage("å€¼ä¸èƒ½ä¸ºç©ºæˆ–Null")]
        Required,

        [ValidationMessage("å¿…é¡»æ˜¯æ•°å€¼ç±»å‹")]
        Numeric,

        [ValidationMessage("å¿…é¡»æ˜¯æ­£æ•°")]
        PositiveNumber,

        // ä¿®æ”¹è‡ªå®šä¹‰ç±»å‹éªŒè¯å¤±è´¥æ¶ˆæ¯
        [ValidationMessage("å¯†ç å¤ªç®€å•äº†")]
        StrongPassword,

        [ValidationMessage("å¿…é¡»ä»¥ Fur å¼€å¤´")]
        StartWithFurString
    }
}
```

:::tip å°çŸ¥è¯†

é™¤äº†è´´ `[ValidationMessageType]` ç‰¹æ€§å¤–ï¼Œ`Fur` æ¡†æ¶è¿˜æä¾›äº† `IValidationMessageTypeProvider` æ–¹å¼æŸ¥æ‰¾éªŒè¯æ¶ˆæ¯ç±»å‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

```cs {1,6,8-12}
using Fur.DataValidation;
using System;

namespace Fur.Application
{
    public class MyValidationTypeMessageProvider : IValidationMessageTypeProvider
    {
        public Type[] Definitions => new[]
        {
            typeof(MyValidationMessageType),
            typeof(MyValidationMessageType2)
        };
    }
}
```

æ³¨å†ŒéªŒè¯æ¶ˆæ¯æä¾›å™¨

```cs {11} title="Fur.Web.Core\FurWebCoreStartup.cs"
using Microsoft.Extensions.DependencyInjection;

namespace Fur.Web.Core
{
    [AppStartup(800)]
    public sealed class FurWebCoreStartup : AppStartup
    {
        public void ConfigureServices(IServiceCollection services)
        {
            services.AddControllers()
                    .AddDataValidation<MyValidationTypeMessageProvider>();
        }
    }
}
```

:::

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/sjyz4.png")} />

- **`appsettings.json` æ–¹å¼**

```json {2-11} title="Fur.Web.Entry/appsettings.json"
{
  "AppSettings": {
    "ValidationTypeMessageSettings": {
      "Definitions": [
        ["Required", "å€¼ä¸èƒ½ä¸ºç©ºæˆ–Null"],
        ["Numeric", "å¿…é¡»æ˜¯æ•°å€¼ç±»å‹"],

        ["StrongPassword", "å¯†ç å¤ªç®€å•äº†!!!"]
      ]
    }
  }
}
```

:::important

`appsettings.json` ä¸­ç›¸åŒçš„ `Key` æˆ–è¦†ç›– `IValidationMessageTypeProvider` æä¾›ç›¸åŒ `Key` çš„å€¼ã€‚

:::

#### é”™è¯¯æ¶ˆæ¯æŸ¥æ‰¾ä¼˜å…ˆçº§

`DefaultErrorMessage` -> `IValidationMessageTypeProvider` -> `appsettings.json` (**ä½ -> é«˜**)

## 8.9 æ¨¡å‹éªŒè¯èŒƒå›´

`Fur` æä¾›å¤šç§æ¨¡å‹éªŒè¯èŒƒå›´è®¾ç½®ï¼š

- å…¨å±€éªŒè¯ï¼ˆé»˜è®¤ï¼‰
- `[NonValidation]` è·³è¿‡éªŒè¯
- `[TypeFilter(typeof(DataValidationFilter))]` å±€éƒ¨éªŒè¯
- `[ApiController]` æ§åˆ¶å™¨èŒƒå›´éªŒè¯

### 8.9.1 å…¨å±€éªŒè¯

é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡ `.AddDataValidation()` æ³¨å†Œæ•°æ®éªŒè¯æœåŠ¡å·²ç»å¯ç”¨äº†å…¨å±€éªŒè¯ï¼Œå¦‚è‹¥ä¸æƒ³å¯ç”¨å…¨å±€éªŒè¯ï¼Œåˆ™ä¼ å…¥ `false` å³å¯ï¼Œå¦‚ï¼š`.AddDataValidation(false)`ã€‚

### 8.9.2 `[NonValidation]` è·³è¿‡éªŒè¯

å¯é€šè¿‡ `[NonValidation]` è´´åœ¨ `æ§åˆ¶å™¨`ï¼Œ`åŠ¨ä½œæ–¹æ³•`ï¼Œ`ç±»` ä¸­è·³è¿‡å…¨å±€éªŒè¯æˆ–ä¸éœ€è¦éªŒè¯

### 8.9.3 `[TypeFilter(typeof(DataValidationFilter))]` å±€éƒ¨éªŒè¯

æˆ‘ä»¬ä¹Ÿå¯ä»¥æ— éœ€æ³¨å†Œ `.AddDataValidation()` æœåŠ¡ï¼Œç›´æ¥åœ¨ `åŠ¨ä½œæ–¹æ³•` ä¸Šè´´ `[TypeFilter(typeof(DataValidationFilter))]` å¯å¯ç”¨å±€éƒ¨éªŒè¯ã€‚å¦‚ï¼š

```cs {1,3,9}
using Fur.DataValidation;
using Fur.DynamicApiController;
using Microsoft.AspNetCore.Mvc;

namespace Fur.Application
{
    public class FurAppService : IDynamicApiController
    {
        [TypeFilter(typeof(DataValidationFilter))]
        public TestDto Post(TestDto testDto)
        {
            return testDto;
        }
    }
}
```

### 8.9.4 `[ApiController]` æ§åˆ¶å™¨èŒƒå›´éªŒè¯

`[ApiController]` æ˜¯ `Mvc` æä¾›çš„æ§åˆ¶å™¨èŒƒå›´ï¼ˆå«æ‰€æœ‰åŠ¨ä½œæ–¹æ³•ï¼‰çš„éªŒè¯ã€‚

```cs {1,5}
using Microsoft.AspNetCore.Mvc;

namespace Fur.Web.Entry.Controllers
{
    [ApiController]
    public class MvcController : Controller
    {
        public IActionResult Index()
        {
            return View();
        }
    }
}
```

## 8.10 `MiniProfiler` æŸ¥çœ‹

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/sjyz5.png")} />

## 8.10 å¤šè¯­è¨€æ”¯æŒ

æ–‡æ¡£æ•´ç†ä¸­...

## 8.11 éªŒè¯æ¨¡å‹æä¾›å™¨

æ–‡æ¡£æ•´ç†ä¸­...

## 8.12 åé¦ˆä¸å»ºè®®

:::note ä¸æˆ‘ä»¬äº¤æµ

ç»™ Fur æ [Issue](https://gitee.com/monksoul/Fur/issues/new?issue)ã€‚

:::
