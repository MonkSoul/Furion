---
id: serverun
title: 2.1 å…¥é—¨æŒ‡å—
sidebar_label: 2.1 å…¥é—¨æŒ‡å—
description: å­¦ä¹  Furion å¦‚ä½•å¿«é€Ÿå…¥é—¨
---

import useBaseUrl from "@docusaurus/useBaseUrl";

import Tag from "@site/src/components/Tag.js";

<details>
  <summary>ğŸ“ æ¨¡å—æ›´æ–°æ—¥å¿—</summary>
  <div>
<div>

- **æ–°ç‰¹æ€§**

  - &nbsp;<Tag>æ–°å¢</Tag> `Serve.IdleHost` æ”¯æŒè¿”å› `http` å’Œ `https` åè®® `Web` åœ°å€ï¼ˆç«¯å£ï¼‰ <sup>4.8.8</sup> <sup>â±ï¸2023.04.13</sup> [fdf7885](https://gitee.com/dotnetchina/Furion/commit/fdf7885f282057599be6b1b3833373dd153db42a)
  - &nbsp;<Tag>æ–°å¢</Tag> `Serve.GetIdleHost([host])` é™æ€æ–¹æ³•ï¼Œå¯è·å–ä¸€ä¸ªæŒ‡å®šä¸»æœºçš„ `Web` åœ°å€ï¼ˆç«¯å£ï¼‰ <sup>4.8.7.43</sup> <sup>â±ï¸2023.04.12</sup> [fdf788](https://gitee.com/dotnetchina/Furion/commit/fdf7885f282057599be6b1b3833373dd153db42a)
  - &nbsp;<Tag>æ–°å¢</Tag> `Serve.IdleHost` é™æ€å±æ€§ï¼Œå¯è·å–ä¸€ä¸ªéšæœºç©ºé—² `Web` ä¸»æœºåœ°å€ï¼ˆç«¯å£ï¼‰ <sup>4.8.7.29</sup> <sup>â±ï¸2023.03.30</sup> [e425063](https://gitee.com/dotnetchina/Furion/commit/e4250634246af612f052ec935416ee050b44d22e)
  - &nbsp;<Tag>æ–°å¢</Tag> `WinForm/WPF` é™æ€æ–¹æ³• `Serve.RunNative()` å¯é…ç½®æ˜¯å¦å¯ç”¨ `Web` ä¸»æœºåŠŸèƒ½ <sup>4.8.7.26</sup> <sup>â±ï¸2023.03.29</sup> [#I6R97L](https://gitee.com/dotnetchina/Furion/issues/I6R97L)
  - &nbsp;<Tag>æ–°å¢</Tag> **`WinForm/WPF` å¿«é€Ÿæ³¨å†Œé™æ€æ–¹æ³•ï¼š`Serve.RunNative()`** <sup>4.8.7.23</sup> <sup>â±ï¸2023.03.27</sup> [53d51c3](https://gitee.com/dotnetchina/Furion/commit/53d51c3645f4066f5d68d4726d78e389fd544560)

- **å…¶ä»–æ›´æ”¹**

  - &nbsp;<Tag>è°ƒæ•´</Tag> `Serve.Run()` è¿·ä½ ä¸»æœºé»˜è®¤æ·»åŠ  `JSON` ä¸­æ–‡ä¹±ç å¤„ç† <sup>4.8.6.3</sup> <sup>â±ï¸2023.02.15</sup> [86b5f9f](https://gitee.com/dotnetchina/Furion/commit/86b5f9f7c2ace503312bf879dccd7add12bd93c4)

- **é—®é¢˜ä¿®å¤**

  - &nbsp;<Tag>ä¿®å¤</Tag> `Serve.IdleHost` è·å–éšæœºç«¯å£çš„æœ¬åœ°åœ°å€å¸¦ `$` ç¬¦å·é—®é¢˜ <sup>4.8.8</sup> <sup>â±ï¸2023.04.13</sup> [ed6f292](https://gitee.com/dotnetchina/Furion/commit/ed6f29263607f58fe0eafdf21dadfc33987309e1)
  - &nbsp;<Tag>ä¿®å¤</Tag> `Serve.Run()` å›  [#I6G02W](https://gitee.com/dotnetchina/Furion/issues/I6G02W) æ›´æ”¹å¯¼è‡´ä¸é…ç½®ç«¯å£æ—¶å‡ºç°å¼‚å¸¸æ— æ³•å¯åŠ¨é—®é¢˜ <sup>4.8.6.10</sup> <sup>â±ï¸2023.02.20</sup> [#I6G6AR](https://gitee.com/dotnetchina/Furion/issues/I6G6AR)
  - &nbsp;<Tag>ä¿®å¤</Tag> `Serve.Run(urls: "ç«¯å£")` è®¾ç½®ç«¯å£åœ¨ `.NET6/7` ä¸‹å‘å¸ƒåå§‹ç»ˆæ˜¯ `80` ç«¯å£é—®é¢˜ <sup>4.8.6.6</sup> <sup>â±ï¸2023.02.18</sup> [#I6G02W](https://gitee.com/dotnetchina/Furion/issues/I6G02W)

</div>
  </div>
</details>

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion 3.6.3 +` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

:::tip æ¨èä½¿ç”¨è„šæ‰‹æ¶

`Furion` å®˜æ–¹æä¾›äº†éå¸¸çµæ´»æ–¹ä¾¿çš„è„šæ‰‹æ¶ï¼Œå¯ä»¥å¿«é€Ÿçš„åˆ›å»ºå¤šå±‚æ¶æ„é¡¹ç›®ã€‚

æ¨èä½¿ç”¨ ã€Š[2.6 å®˜æ–¹è„šæ‰‹æ¶](template.mdx)ã€‹ä»£æ›¿æœ¬ç« èŠ‚åŠŸèƒ½ã€‚

:::

## 2.1.1 å†å²èƒŒæ™¯

ç›¸ä¿¡ä» `ASP.NET 5` å‡çº§è‡³ `ASP.NET 6` çš„å¼€å‘è€…éƒ½ç»å†è¿‡è¿™æ ·å˜æ›´ï¼š

- åœ¨ `ASP.NET 5` ä¸­ï¼Œæˆ‘ä»¬è¿™æ ·åˆ›å»º `Web ä¸»æœº`ï¼š

```cs showLineNumbers {1} title="Program.cs"
Host.CreateDefaultBuilder(args)
    .ConfigureWebHostDefaults(webBuilder =>
    {
        webBuilder.UseStartup<Startup>();
    });
```

- åœ¨ `ASP.NET 6` ä¸­ï¼Œ æˆ‘ä»¬è¿™æ ·åˆ›å»º `Web ä¸»æœº`ï¼š

```cs showLineNumbers {1} title="Program.cs"
var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();
```

è¯•é—®ï¼Œ`ASP.NET 7`ï¼Œ`ASP.NET 8` ... `ASP.NET N` å‘¢ï¼Ÿä¼šä¸ä¼šæ¯ä¸€ä¸ªç‰ˆæœ¬éƒ½æœ‰ä¸åŒçš„åˆ›å»ºæ–¹å¼ï¼Œé‚£åç»­é¡¹ç›®å¦‚ä½•æ— ç¼å‡çº§ï¼Ÿ

**æ‰€ä»¥ï¼Œä¸ºäº†ä¿è¯ä¸€è‡´çš„ä»£ç ä½“éªŒå’Œåç»­æ— ç¼å‡çº§ï¼Œæ¨å‡ºäº† `Serve.Run()`ï¼Œå³ä½¿æœªæ¥åˆ›å»ºæ–¹å¼å˜äº†ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒï¼Œäº¤ç»™æ¡†æ¶å³å¯ã€‚**

## 2.1.2 åˆ›å»º `æ§åˆ¶å°` é¡¹ç›®

- æ‰“å¼€ `Visual Studio 2022` å¹¶åˆ›å»º `æ§åˆ¶å°` é¡¹ç›®

<img src={useBaseUrl("img/01.png")} />

- é…ç½®é¡¹ç›®åç§°

<img src={useBaseUrl("img/02.png")} />

- é€‰æ‹© `.NET6`

<img src={useBaseUrl("img/03.png")} />

:::tip ä½¿ç”¨å‘½ä»¤è¡Œæ–¹å¼

```bash showLineNumbers
// åˆ›å»ºæ§åˆ¶å°é¡¹ç›®
dotnet new console -n HelloFurion
```

:::

## 2.1.3 æ·»åŠ  `Furion` ä¾èµ–åŒ…

<img src={useBaseUrl("img/04.png")} />

:::tip ä½¿ç”¨å‘½ä»¤è¡Œæ–¹å¼

```bash showLineNumbers
// è¿›å…¥åˆ›å»ºçš„ç›®å½•
cd HelloFurion
// æ·»åŠ åŒ…
dotnet add package Furion
```

:::

## 2.1.4 ä¸€å¥è¯æå®š

ä¿®æ”¹ `Program.cs` ä»£ç ä¸ºï¼š

```cs showLineNumbers title="Program.cs"
Serve.Run();
```

å¯¹ï¼Œä½ æ²¡çœ‹é”™ï¼Œ`Furion` å·²ç»é…ç½®å¥½äº†ï¼

:::tip åŠŸèƒ½è¯´æ˜

`Serve.Run()` å·²ç»åŒ…å«äº†åŸºæœ¬çš„ `WebAPI` åŠŸèƒ½ï¼ŒåŒ…å«åŠ¨æ€ `WebAPI`ï¼Œ`è·¨åŸŸ` ç­‰ç­‰ï¼Œå¦‚éœ€å®Œå…¨è‡ªå®šä¹‰é…ç½®å¯ä½¿ç”¨ `Serve.Run(RunOptions.Default)`ï¼Œä¹‹å `AppStartup` æ´¾ç”Ÿç±»è‡ªè¡Œé…ç½®ã€‚

:::

## 2.1.5 å¯åŠ¨æµè§ˆå™¨

å¯åŠ¨æµè§ˆå™¨æŸ¥çœ‹æ•ˆæœ

<img src={useBaseUrl("img/05.png")} />

<img src={useBaseUrl("img/06.png")} />

æ˜¯ä¸æ˜¯è¶…çº§è¶…çº§ç®€å•ï¼ï¼ï¼

## 2.1.6 ç¼–å†™ç¬¬ä¸€ä¸ª `API`

```cs showLineNumbers title="Program.cs" {3,6}
Serve.Run();

[DynamicApiController]
public class HelloService
{
    public string Say()
    {
        return "Hello, Furion";
    }
}
```

å¯åŠ¨æµè§ˆå™¨æŸ¥çœ‹æ•ˆæœ

<img src={useBaseUrl("img/07.png")} />

## 2.1.7 `Serve.Run()` æ›´å¤šé…ç½®

### 2.1.7.1 é…ç½®é»˜è®¤å¯åŠ¨åœ°å€/ç«¯å£

é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ›å»ºçš„ `Web` ä¸»æœºç«¯å£ä¸º `5000/5001` ç«¯å£ï¼Œå¦‚éœ€è‡ªå®šä¹‰é…ç½®ï¼Œå¯é€šè¿‡ç¬¬ä¸€ä¸ªå‚æ•°é…ç½®ï¼š

```cs showLineNumbers
Serve.Run("https://localhost:8080");

// æˆ–
Serve.Run(RunOptions.Default, "https://localhost:8080");
```

åŒæ—¶ä¹Ÿæ”¯æŒ `dotnet run` å’Œ `dotnet watch run` æŒ‡å®šï¼š

```bash showLineNumbers
dotnet run --urls https://localhost:8080

# watch æ–¹å¼
dotnet watch run --urls https://localhost:8080
```

ä¹Ÿå¯ä»¥é€šè¿‡ `ConfigureBuilder` æ–¹å¼é…ç½®ï¼š

```cs showLineNumbers {1,7}
// .NET6+
Serve.Run(RunOptions.Default.ConfigureBuilder(builder =>
{
    builder.WebHost.UseUrls("https://localhost:8080");  // ä¹Ÿå¯ä»¥é€šè¿‡ builder.Configuration è¯»å– urls é…ç½®
}));

// .NET5
Serve.Run(RunOptions.ConfigureWebDefaults(webHostBuilder =>
{
    return webHostBuilder.UseUrls("https://localhost:8080");
}));
```

:::important å…³äº `localhost` å’Œå¤šç«¯å£

å»ºè®®ä½¿ç”¨ `*` ä»£æ›¿ `localhost`ï¼Œè¿™æ ·å¯ä»¥è‡ªé€‚åº”ä¸»æœºåœ°å€ï¼Œå¤šä¸ªç«¯å£ä½¿ç”¨ `;` åˆ†å‰²ï¼Œç»“å°¾æ— éœ€ `;`

:::

:::tip é€šè¿‡ `json` æ–¹å¼é…ç½®

å¦‚éœ€é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®ç«¯å£ï¼Œéœ€ä¸¤ä¸ªè¯¥æ­¥éª¤ï¼š

1. ç¼–è¾‘æ§åˆ¶å°å¯åŠ¨é¡¹ç›® `.csproj` æ–‡ä»¶ï¼Œä¿®æ”¹ `Project` èŠ‚ç‚¹ä¸ºï¼š

```xml showLineNumbers
<Project Sdk="Microsoft.NET.Sdk.Web">
```

ä¹Ÿå°±æ˜¯åœ¨åŸæ¥çš„ `Sdk` ä¸­æ·»åŠ  `.Web` å³å¯ã€‚

2. åœ¨æ§åˆ¶å°å¯åŠ¨é¡¹ç›®ä¸­æ·»åŠ  `Properties` æ–‡ä»¶å¤¹å¹¶åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­åˆ›å»º `launchSettings.json` æ–‡ä»¶ï¼ŒåŒæ—¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```json showLineNumbers {4,8} title="launchSettings.json"
{
  "$schema": "http://json.schemastore.org/launchsettings.json",
  "profiles": {
    "å¯åŠ¨é¡¹ç›®åç§°": {
      "commandName": "Project",
      "launchBrowser": true,
      "launchUrl": "",
      "applicationUrl": "https://localhost:8080;http://localhost:8081",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  }
}
```

é™¤äº† `launchsettings.json` çš„æ–¹å¼ï¼Œè¿˜å¯ä»¥åœ¨ `appsettings.json` ç®€å•é…ç½®

---

```json showLineNumbers {2} title="appsettings.json"
{
  "Urls": "http://localhost:8081"
}
```

:::

- è¿˜å¯ä»¥è·å–éšæœºç©ºé—²ç«¯å£å¯åŠ¨

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion 4.8.7.29 +` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

é€šè¿‡ `Serve.IdleHost` é™æ€å±æ€§å¯ä»¥è·å–éšæœºçš„ `Web` ä¸»æœºåœ°å€ï¼ˆç«¯å£ï¼‰ï¼Œå¦‚ï¼š`http://localhost:éšæœºç«¯å£`ã€‚

```cs showLineNumbers {1,4-7,10-13}
Serve.Run(urls: Serve.IdleHost.Urls);

// å®Œæ•´è¿”å›å€¼
var idleHost = Serve.IdleHost;
var port = idleHost.Port;   // => 44322
var urls = idleHost.Urls;   // => http://localhost:44322
var ssl_urls = idleHost.SSL_Urls;   // => https://localhost:44322ï¼ŒFurion 4.8.7.43+ æ”¯æŒ

// æŒ‡å®šä¸»æœºåï¼ŒFurion 4.8.7.43+ æ”¯æŒ
var idleHost = Serve.GetIdleHost("furion.baiqian.ltd"); // ä¸ä¼ å‚æ•°é»˜è®¤ localhost
var port = idleHost.Port;   // => 44322
var urls = idleHost.Urls;   // => http://furion.baiqian.ltd:44322
var ssl_urls = idleHost.SSL_Urls;   // => http://furion.baiqian.ltd:44322
```

### 2.1.7.2 ä¾¿æ·æœåŠ¡æ³¨å†Œ

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion 4.8.0 +` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

```cs showLineNumbers {1,7,13,19}
Serve.Run(additional: services =>
{
    services.AddRemoteRequest();
});

// é€šç”¨æ³›å‹ä¸»æœºæ–¹å¼
Serve.RunGeneric(additional: services =>
{
    services.AddRemoteRequest();
});

// è¿˜å¯ä»¥çœå» additional
Serve.Run(services =>
{
    services.AddRemoteRequest();
});

// é€šç”¨æ³›å‹ä¸»æœºæ–¹å¼
Serve.RunGeneric(services =>
{
    services.AddRemoteRequest();
});
```

### 2.1.7.3 è‡ªå®šä¹‰é…ç½®

ä¼ å…¥ `RunOptions` å¯¹è±¡ç›¸å½“äºè‡ªç”±å®šä¹‰å’Œæ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯é™¤äº†é»˜è®¤é›†æˆäº† `Furion` ä»¥å¤–ï¼Œæ²¡æœ‰æ³¨å†Œä»»ä½•åŠŸèƒ½ã€‚

- ä»…é›†æˆ `Furion` çš„é»˜è®¤é…ç½®

```cs showLineNumbers
Serve.Run(RunOptions.Default);
```

- é…ç½®æ›´å¤šæœåŠ¡/ä¸­é—´ä»¶

```cs showLineNumbers {1,2,7}
Serve.Run(RunOptions.Default
    .ConfigureBuilder(builder =>
    {
        builder.Services.AddControllers()
                        .AddInject();
    })
    .Configure(app =>
    {
        app.UseRouting();
        app.UseInject(string.Empty);
        app.UseEndpoints(endpoints =>
        {
            endpoints.MapControllers();
        });
    }));
```

- `WebComponent` æ–¹å¼

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion 4.3.5 +` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

```cs showLineNumbers {2,4,6}
Serve.Run(RunOptions.Default
     .AddWebComponent<XXXWebComponent>());

public class XXXWebComponent : IWebComponent
{
    public void Load(WebApplicationBuilder builder, ComponentContext componentContext)
    {
        // ....
    }
}
```

### 2.1.7.4 `Serve.Run` å’Œ `Startup` æœ€ä½³ç»„åˆ

é»˜è®¤æƒ…å†µä¸‹ `Serve.Run()` å†…ç½®äº† `è·¨åŸŸ`ï¼Œ`æ§åˆ¶å™¨`ï¼Œ`è·¯ç”±`ï¼Œ`è§„èŒƒåŒ–ç»“æœ`ã€`é™æ€æ–‡ä»¶` æœåŠ¡/ä¸­é—´ä»¶ã€‚é€‚åˆå¿«é€Ÿå¼€å§‹é¡¹ç›®å’Œç¼–å†™æµ‹è¯•ä»£ç ã€‚

**ä½†ä¸èƒ½å¯¹è¿™äº›å·²æ³¨å†ŒæœåŠ¡/ä¸­é—´ä»¶è¿›è¡Œè‡ªå®šä¹‰é…ç½®**ï¼Œè¿™æ—¶åªéœ€è¦é…ç½® `RunOptions` å±æ€§/æ–¹æ³•å³å¯ï¼Œå¦‚ï¼š

```cs showLineNumbers title="Program.cs"
Serve.Run(RunOptions.Default
    .ConfigureBuilder(...)
    .Configure(..));
```

**ä½†æŠŠæ‰€æœ‰æœåŠ¡/ä¸­é—´ä»¶éƒ½æ”¾åœ¨ `Program.cs` ä¸­å¥½å—ï¼Ÿ**ç­”æ¡ˆæ˜¯ä¸å¥½çš„ï¼Œå› ä¸ºä¼šå¯¼è‡´åç»­è¿ç§»ä»£ç ç»´æŠ¤ä»£ç é€ æˆäº†ä¸€äº›å›°æ‰°ã€‚

æ‰€ä»¥ `Furion` æ¨èä¸‹é¢æ›´åŠ çµæ´»ä¸”æ˜“ç»´æŠ¤çš„æ–¹å¼ï¼Œ`Program.cs` åªéœ€ä¸€å¥è¯å³å¯ï¼š

:::tip æ¨èä½¿ç”¨ç»„ä»¶å¯åŠ¨

`Furion 3.7.3+` å®˜æ–¹æä¾›äº†éå¸¸çµæ´»æ–¹ä¾¿çš„ç»„ä»¶åŒ–å¯åŠ¨é…ç½®æœåŠ¡ã€‚

æ¨èä½¿ç”¨ ã€Š[3.1 ç»„ä»¶åŒ–å¯åŠ¨](./component)ã€‹ä»£æ›¿ `AppStartup` æ–¹å¼åŠŸèƒ½ã€‚

:::

```cs showLineNumbers title="Program.cs"
Serve.Run(RunOptions.Default);
```

ç„¶åæ·»åŠ è‡ªå®šä¹‰ `Startup.cs` æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š

```cs showLineNumbers {8,10,15} title="Startup.cs"
using Furion;
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.DependencyInjection;

namespace HelloFurion;

public class Startup : AppStartup
{
    public void ConfigureServices(IServiceCollection services)
    {
        // ....
    }

    public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
    {
        // ....
    }
}
```

:::tip å°æç¤º

æ­£å¸¸æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰ `Startup.cs` æ–‡ä»¶åº”è¯¥æ”¾åœ¨ç‹¬ç«‹çš„ `YourProject.Web.Core` å±‚æˆ–å…¶ä»–å±‚ã€‚

:::

### 2.1.7.5 æ›´å¤šé…ç½®

å¦‚é…ç½® `WebHost`...

```cs showLineNumbers
Serve.Run(RunOptions.Default
    .ConfigureBuilder(builder => {
        builder.WebHost.....
    }));
```

## 2.1.8 æ”¯æŒ `Furion` æ‰€æœ‰åŠŸèƒ½

`Serve.Run()` çœ‹ä¼¼éå¸¸ç®€å•ï¼Œå®åˆ™éå¸¸çµæ´»ï¼Œè€Œä¸”æ”¯æŒ `Furion` å’Œ `.NET` æ‰€æœ‰åŠŸèƒ½ã€‚

### 2.1.8.1 æ·»åŠ  `appsettings.json`

åˆ›å»º `appsettings.json` æ–‡ä»¶ï¼Œå¹¶è®¾ç½® `å±æ€§` ä¸º `å¦‚æœè¾ƒæ–°åˆ™å¤åˆ¶` å’Œ `å†…å®¹`ï¼ˆç”Ÿæˆæ“ä½œï¼‰

```json showLineNumbers
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft": "Warning",
      "Microsoft.Hosting.Lifetime": "Information",
      "Microsoft.EntityFrameworkCore": "Information"
    }
  },
  "AllowedHosts": "*"
}
```

åœ¨ä»£ç ä¸­è¯»å–é…ç½®ï¼š

```cs showLineNumbers {10}
using Furion;

Serve.Run();

[DynamicApiController]
public class HelloService
{
    public string Say()
    {
        return "Hello, Furion " + App.Configuration["Logging:LogLevel:Default"];
    }
}
```

<img src={useBaseUrl("img/08.png")} />

### 2.1.8.2 æ·»åŠ è‡ªå®šä¹‰ `Startup`

åœ¨ `Furion` ä¸­å¯ä»¥æ´¾ç”Ÿè‡ª `AppStartup` å¯ä»¥å®ç°æ›´å¤šé…ç½®ï¼Œå¦‚ï¼š

```cs showLineNumbers title="Program.cs"
Serve.Run();
```

:::important ç‰¹åˆ«æ³¨æ„

å¦‚æœæ‚¨æƒ³è‡ªå·±é…ç½® `Web` é¡¹ç›®æœåŠ¡ï¼Œå¯é€šè¿‡ `Serve.Run(RunOptions.Default);` æ–¹å¼ï¼Œå› ä¸º `Serve.Run()` å·²ç»åŒ…å«äº†å¸¸ç”¨çš„ `Web` å¯èƒ½ä¼šæç¤ºé‡å¤æ³¨å†Œé”™è¯¯ã€‚

:::

```cs showLineNumbers {8,10,12,15,17} title="MyStartup.cs"
using Furion;
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.DependencyInjection;

namespace HelloFurion;

public class MyStartup : AppStartup
{
    public void ConfigureServices(IServiceCollection services)
    {
        Console.WriteLine("è°ƒç”¨æœåŠ¡æ³¨å†Œå•¦~~");
    }

    public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
    {
        Console.WriteLine("è°ƒç”¨ä¸­é—´ä»¶æ³¨å†Œå•¦");
    }
}
```

<img src={useBaseUrl("img/09.png")} />

### 2.1.8.3 å°†æ§åˆ¶å°é¡¹ç›®å˜æˆ `Web` é¡¹ç›®

åªéœ€è¦ç¼–è¾‘ `.csproj` æ–‡ä»¶ï¼Œå°†ç¬¬ä¸€è¡Œ `Project` èŠ‚ç‚¹çš„ `Sdk`

```xml showLineNumbers
<Project Sdk="Microsoft.NET.Sdk">
```

ä¿®æ”¹ä¸ºï¼š

```xml showLineNumbers
<Project Sdk="Microsoft.NET.Sdk.Web">
```

å³å¯å®Œæˆè½¬æ¢ï¼Œå®é™…ä¸Šåªæ˜¯è¿½åŠ äº† `.Web`ã€‚

### 2.1.8.4 æ·»åŠ  `args` å¯åŠ¨å‚æ•°

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion 4.2.4 +` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

```cs showLineNumbers {1,3,5}
Serve.Run(args: args);

Serve.Run(RunOptions.Default.WithArgs(args));

Serve.Run(RunOptions.Main(args));
```

### 2.1.8.5 è¿˜æ²¡çœ‹å¤Ÿï¼Ÿ

æ˜¯ä¸æ˜¯éå¸¸å¼ºå¤§å•Šï¼Œ`Serve.Run()` è™½ç„¶ç®€å•ï¼Œä½†æ˜¯ 100% æ”¯æŒ `Furion` å’Œ `.NET` æ‰€æœ‰åŠŸèƒ½ã€‚å°½æƒ…å»ä½“éªŒå§ï¼

## 2.1.9 `RunOptions`ï¼Œ`LegacyRunOptions` å’Œ `GenericRunOptions`

`Serve.Run` æä¾›äº† `RunOptions`ï¼Œ`LegacyRunOptions` å’Œ `GenericRunOptions` é‡è½½å‚æ•°ç±»å‹ï¼Œä»–ä»¬çš„ä¸»è¦åŒºåˆ«ï¼š

- `RunOptions`ï¼šä½¿ç”¨çš„æ˜¯ `WebApplication` æ–¹å¼ï¼Œ**åˆ›å»º `Web` ä¸»æœºä¼˜å…ˆæ¨èæ–¹å¼**
- `LegacyRunOptions`ï¼šä½¿ç”¨çš„æ˜¯ `Host` æ–¹å¼ï¼Œä½†é»˜è®¤é…ç½®äº† `Web` ä¸»æœº
- `GenericRunOptions`ï¼šä½¿ç”¨çš„æ˜¯ `Host` æ–¹å¼ï¼Œé€šç”¨ç±»å‹ä¸»æœºï¼Œå¯ç”¨äº `WorkerService`

`LegacyRunOptions` é…ç½®ä¾‹å­ï¼š

```cs showLineNumbers {5-6,15-16}
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.DependencyInjection;

Serve.Run(LegacyRunOptions.Default
    // é…ç½® Web ä¸»æœº
    .ConfigureWebDefaults(builder => builder.ConfigureServices(services =>
        {
            // ...
        })
        .Configure(app =>
        {
            // ...
        });
    })
    // é…ç½® Host ä¸»æœº
    .ConfigureBuilder(builder => builder....));
```

`GenericRunOptions` é…ç½®ä¾‹å­ï¼š

```cs showLineNumbers {2-3}
Serve.Run(GenericRunOptions.Default
    // é…ç½® Host ä¸»æœº
    .ConfigureBuilder(hostBuilder => hostBuilder....);
```

æ›´å¤šå‘å¸ƒå‘½ä»¤è¯´æ˜å¯æŸ¥é˜…å¾®è½¯å®˜æ–¹æ–‡æ¡£ [https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-publish](https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-publish)

## 2.1.10 åœ¨ `WinForm/WPF/Console` ä¸­ä½¿ç”¨

åœ¨ `WinForm` æˆ– `WPF` æˆ– `Console` ä¸­ä½¿ç”¨ï¼Œè¯·ç¡®ä¿ `Serve.RunNative()` åœ¨åº”ç”¨ç¨‹åºä¹‹å‰åˆå§‹åŒ–ï¼š

### 2.1.10.1 `WinForm` åˆå§‹åŒ–

```cs showLineNumbers {3,8}
namespace WinFormsApp2;

internal static class Program
{
    [STAThread]
    static void Main()
    {
        Serve.RunNative();  // Furion 4.8.7.26+ æ”¯æŒ

        ApplicationConfiguration.Initialize();
        Application.Run(new Form1());
    }
}
```

:::tip `Serve.RunNative` ç«¯å£å ç”¨é—®é¢˜

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Serve.RunNative()` ä¼šå¯åŠ¨ä¸€ä¸ªè¿·ä½ å°å‹ `Web` ä¸»æœºï¼Œé»˜è®¤ç«¯å£ä¸º `5000`ï¼Œå¦‚æ— éœ€ `Web` åŠŸèƒ½å¯é…ç½® `includeWeb` å…³é—­ï¼Œå¦‚ï¼š

```cs showLineNumbers {2,5,8,11}
// å…³é—­è¿·ä½  Web ä¸»æœºåŠŸèƒ½
Serve.RunNative(includeWeb: false);

// æˆ–æ›´æ¢è¿·ä½  Web ä¸»æœºç«¯å£
Serve.RunNative(urls: "http://localhost:8080");

// è¿˜å¯ä»¥å®Œå…¨è‡ªå®šä¹‰é…ç½® Web ä¸»æœº
Serve.RunNative(RunOptions.Default);

// è¿˜å¯ä»¥éšæœºè·å–ä¸€ä¸ªç©ºé—²ä¸»æœºç«¯å£ï¼ˆæ¨èï¼‰
Serve.RunNative(urls: Serve.IdleHost.Urls);
```

:::

### 2.1.10.2 `WPF` åˆå§‹åŒ–

```cs showLineNumbers {3,7}
namespace WpfApp1;

public partial class App : Application
{
    public App()
    {
        Serve.RunNative();  // Furion 4.8.7.23+
    }
}
```

:::tip `Serve.RunNative` ç«¯å£å ç”¨é—®é¢˜

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Serve.RunNative()` ä¼šå¯åŠ¨ä¸€ä¸ªè¿·ä½ å°å‹ `Web` ä¸»æœºï¼Œé»˜è®¤ç«¯å£ä¸º `5000`ï¼Œå¦‚æ— éœ€ `Web` åŠŸèƒ½å¯é…ç½® `includeWeb` å…³é—­ï¼Œå¦‚ï¼š

```cs showLineNumbers {2,5,8,11}
// å…³é—­è¿·ä½  Web ä¸»æœºåŠŸèƒ½
Serve.RunNative(includeWeb: false);

// æˆ–æ›´æ¢è¿·ä½  Web ä¸»æœºç«¯å£
Serve.RunNative(urls: "http://localhost:8080");

// è¿˜å¯ä»¥å®Œå…¨è‡ªå®šä¹‰é…ç½® Web ä¸»æœº
Serve.RunNative(RunOptions.Default);

// è¿˜å¯ä»¥éšæœºè·å–ä¸€ä¸ªç©ºé—²ä¸»æœºç«¯å£ï¼ˆæ¨èï¼‰
Serve.RunNative(urls: Serve.IdleHost.Urls);
```

:::

### 2.1.10.3 `Console` åˆå§‹åŒ–

```cs showLineNumbers {2}
Console.WriteLine("Hello World");
Serve.RunNative();  // Furion 4.8.7.23+
Console.ReadKey();
```

### 2.1.10.4 æ³¨å†ŒæœåŠ¡

å¦‚æœæƒ³æ³¨å†ŒæœåŠ¡ï¼Œæ”¯æŒä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š

- `Serve.RunNative` æ–¹å¼

```cs showLineNumbers {1,3}
Serve.RunNative(services =>
{
    services.AddRemoteRequest();
});
```

- `Startup.cs` æ–¹å¼

```cs showLineNumbers {2,4}
// åœ¨è¿·ä½  Web ä¸»æœºåŸºç¡€ä¸Šè‡ªå®šä¹‰
Serve.RunNative();

// æˆ–å®Œå…¨è‡ªå®šä¹‰
Serve.RunNative(RunOptions.Default);
```

```cs showLineNumbers {6,8,10} title="YourStartup.cs"
using Furion;
using Microsoft.Extensions.DependencyInjection;

namespace YourProject;

public class YourStartup : AppStartup
{
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddRemoteRequest();
    }
}
```

## 2.1.11 é™é»˜å¯åŠ¨

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Serve.Run()` ä½¿ç”¨é˜»å¡çº¿ç¨‹æ–¹å¼å¯åŠ¨ï¼Œä½†æœ‰äº›æ—¶å€™æˆ‘ä»¬ä¸å¸Œæœ›é˜»å¡ç°æœ‰çš„ä»£ç ï¼Œå¯ä½¿ç”¨**é™é»˜å¯åŠ¨**çš„æ–¹å¼ï¼š

```cs showLineNumbers {1}
Serve.Run(silence: true);

Console.WriteLine("Hello, World!");
Console.ReadKey();
```

ä¹Ÿå¯ä»¥é€šè¿‡ `RunOptions`ï¼Œ`LegacyRunOptions` æˆ– `GenericRunOptions` æ–¹å¼ï¼Œå¦‚ï¼š

```cs showLineNumbers {2,5,8}
// RunOptions æ–¹å¼
Serve.Run(RunOptions.DefaultSilence);

// LegacyRunOptions æ–¹å¼
Serve.Run(LegacyRunOptions.DefaultSilence);

// GenericRunOptions æ–¹å¼
Serve.Run(GenericRunOptions.DefaultSilence);
```

## 2.1.12 `.NET5` æ¨¡å¼æ‰¾ä¸åˆ° `Views` è§†å›¾è·¯å¾„

ç”±äº `.NET5` å¿…é¡»åœ¨ä½¿ç”¨ `.UseStartup<>` é…ç½®å¯åŠ¨é¡¹ï¼Œæ‰€ä»¥ `Serve.Run()` æ¨¡å¼ä¼šæç¤ºæ‰¾ä¸åˆ° `Views` è§†å›¾è·¯å¾„ï¼Œè¿™æ—¶å€™åªéœ€è¦åœ¨å¯åŠ¨ç›®å½•åˆ›å»º `Startup.cs` æ–‡ä»¶å¹¶é€šè¿‡æ³›å‹æ–¹å¼æŒ‡å®šå³å¯ï¼Œå¦‚ï¼š

```cs showLineNumbers title="Startup.cs"
using Microsoft.AspNetCore.Builder;
using Microsoft.Extensions.DependencyInjection;

namespace YourProject.Web.Entity
{
    public class Startup
    {
        public void ConfigureServices(IServiceCollection _)
        {
        }

        public void Configure(IApplicationBuilder _)
        {
        }
    }
}
```

å°† `Startup` ç±»é€šè¿‡ `Serve.Run` æ³›å‹æŒ‡å®šï¼š

```cs showLineNumbers
Serve.Run<Startup>(LegacyRunOptions.Default);
```

## 2.1.13 åé¦ˆä¸å»ºè®®

:::note ä¸æˆ‘ä»¬äº¤æµ

ç»™ Furion æ [Issue](https://gitee.com/dotnetchina/Furion/issues/new?issue)ã€‚

:::
