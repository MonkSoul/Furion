---
id: specification-document
title: 6. è§„èŒƒåŒ–æ¥å£æ–‡æ¡£
sidebar_label: 6. è§„èŒƒåŒ–æ¥å£æ–‡æ¡£ (Swagger)
---

import Tag from "@site/src/components/Tag.js";

<details>
  <summary>ğŸ“ æ¨¡å—æ›´æ–°æ—¥å¿—</summary>
  <div>
<div>

- **æ–°ç‰¹æ€§**

  - &nbsp;<Tag>æ–°å¢</Tag> `Swagger` è¯·æ±‚æˆæƒå¤±è´¥åè‡ªåŠ¨é€€å‡ºæˆæƒçŠ¶æ€ <sup>4.8.6.12</sup> <sup>â±ï¸2023.02.20</sup> [!717](https://gitee.com/dotnetchina/Furion/pulls/717)
  - &nbsp;<Tag>æ–°å¢</Tag> `Swagger` å¯ç”¨ç™»å½•åé…ç½® `CheckUrl` å¯è·å–æœ¬åœ°å­˜å‚¨çš„ `Authorization` è¯·æ±‚æŠ¥æ–‡å¤´ <sup>4.8.6.2</sup> <sup>â±ï¸2023.02.10</sup> [#I6E3LB](https://gitee.com/dotnetchina/Furion/issues/I6E3LB)
  - &nbsp;<Tag>æ–°å¢</Tag> `Swagger` æ”¯æŒå¤åˆ¶è·¯ç”±åœ°å€åŠŸèƒ½ <sup>4.8.4.13</sup> <sup>â±ï¸2023.01.11</sup> [#I5VNJI](https://gitee.com/dotnetchina/Furion/issues/I5VNJI)

- **é—®é¢˜ä¿®å¤**

  - &nbsp;<Tag>ä¿®å¤</Tag> `Swagger` è¿›è¡Œåˆ†ç»„å `Tags` ä¸èƒ½è¿›è¡Œåˆ†ç»„è¿‡æ»¤é—®é¢˜ <sup>4.8.8.22</sup> <sup>â±ï¸2023.05.25</sup> [#I78A55](https://gitee.com/dotnetchina/Furion/issues/I78A55)
  - &nbsp;<Tag>ä¿®å¤</Tag> å›  `4.8.7.22` ç‰ˆæœ¬å¯¼è‡´åŠ¨æ€ `WebAPI` ç±»å‹æ³¨é‡Šä¸¢å¤±é—®é¢˜ <sup>4.8.7.27</sup> <sup>â±ï¸2023.03.29</sup> [#I6QM23](https://gitee.com/dotnetchina/Furion/issues/I6QM23)
  - &nbsp;<Tag>ä¿®å¤</Tag> `Swagger UI` ä¸æ˜¾ç¤º `ControllerBase` æ´¾ç”Ÿç±»æ³¨é‡Š <sup>4.8.7.22</sup> <sup>â±ï¸2023.03.27</sup> [#I6QM23](https://gitee.com/dotnetchina/Furion/issues/I6QM23)
  - &nbsp;<Tag>ä¿®å¤</Tag> å¯ç”¨è§„èŒƒåŒ–ç»“æœåå¯¼è‡´ `WebSocket` è¿æ¥æ–­å¼€æ—¶å‡ºç°å¼‚å¸¸ <sup>4.8.7.20</sup> <sup>â±ï¸2023.03.23</sup> [#I6PI5E](https://gitee.com/dotnetchina/Furion/issues/I6PI5E)
  - &nbsp;<Tag>ä¿®å¤</Tag> `Swagger` æ¥å£æ’åºåŒæ—¶æŒ‡å®š `Tag` å’Œ `Order` ä¹‹åæ— æ•ˆ <sup>4.8.7.2</sup> <sup>â±ï¸2023.03.01</sup> [#I6IQDI](https://gitee.com/dotnetchina/Furion/issues/I6IQDI) [#I6IP66](https://gitee.com/dotnetchina/Furion/issues/I6IP66)
  - &nbsp;<Tag>ä¿®å¤</Tag> è§„èŒƒåŒ–ç»“æœä¸å¸¦ `mini-profiler` ç‰ˆæœ¬å¯åŠ¨ç™»å½• `UI` åä¸èƒ½ä¼ é€’ `headers` é—®é¢˜ <sup>4.8.6.11</sup> <sup>â±ï¸2023.02.20</sup> [#I6G8IR](https://gitee.com/dotnetchina/Furion/issues/I6G8IR)
  - &nbsp;<Tag>ä¿®å¤</Tag> **è§„èŒƒåŒ–ç»“æœä¸æ”¯æŒ `OData` åè®®æ§åˆ¶å™¨** <sup>4.8.5.5</sup> <sup>â±ï¸2023.02.01</sup> [!571](https://gitee.com/dotnetchina/Furion/pulls/571)
  - &nbsp;<Tag>ä¿®å¤</Tag> å¯ç”¨ `Swagger` ç™»å½•åŠŸèƒ½ä¹‹åä¸èƒ½è§¦å‘å“åº”æ‹¦æˆªå™¨ <sup>4.8.5.5</sup> <sup>â±ï¸2023.02.01</sup> [#I6C9A2](https://gitee.com/dotnetchina/Furion/issues/I6C9A2) [!702](https://gitee.com/dotnetchina/Furion/pulls/702) [!703](https://gitee.com/dotnetchina/Furion/pulls/703)

</div>
  </div>
</details>

import useBaseUrl from "@docusaurus/useBaseUrl";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

## 6.1 ä»€ä¹ˆæ˜¯æ¥å£æ–‡æ¡£

åœ¨ç°åœ¨ç§»åŠ¨ä¸ºç‹ã€å¤šç«¯äº’è¾…ã€å‰ç«¯ç™¾èŠ±é½æ”¾çš„å¼€æ”¾æ—¶ä»£ï¼Œä¸å†æ˜¯ä¸€äººåŒ…æ½å¼å¼€å‘ï¼Œå¤§å®¶å„å¸å…¶èŒï¼Œåç«¯å·¥ç¨‹å¸ˆè´Ÿè´£æ¥å£å¼€å‘ï¼Œå‰ç«¯è´Ÿè´£æ¥å£è”è°ƒï¼Œä¹Ÿå°±æ˜¯äº’è”ç½‘ç°åœ¨æµè¡Œçš„å‰åç«¯åˆ†ç¦»æ¶æ„ã€‚

æ‰€ä»¥å°±éœ€è¦ç”±å‰åç«¯å·¥ç¨‹å¸ˆå…±åŒå®šä¹‰æ¥å£ï¼Œç¼–å†™æ¥å£æ–‡æ¡£ï¼Œä¹‹åå¤§å®¶æŒ‰ç…§è¿™ä¸ªæ¥å£æ–‡æ¡£è¿›è¡Œå¼€å‘ã€ç»´æŠ¤åŠå¼€æ”¾ç»™ç¬¬ä¸‰æ–¹ã€‚

## 6.2 ä¸ºä»€ä¹ˆè¦å†™æ¥å£æ–‡æ¡£

- èƒ½å¤Ÿè®©å‰ç«¯å¼€å‘ä¸åå°å¼€å‘äººå‘˜æ›´å¥½çš„é…åˆï¼Œæé«˜å·¥ä½œæ•ˆç‡
- é¡¹ç›®è¿­ä»£æˆ–è€…é¡¹ç›®äººå‘˜æ›´è¿­æ—¶ï¼Œæ–¹ä¾¿åæœŸäººå‘˜æŸ¥çœ‹å’Œç»´æŠ¤
- æ–¹ä¾¿æµ‹è¯•äººå‘˜è¿›è¡Œæ¥å£æµ‹è¯•

## 6.3 ä¸ºä»€ä¹ˆéœ€è¦è§„èŒƒåŒ–æ–‡æ¡£

ç”±äºæ¯ä¸ªå…¬å¸åç«¯äººå‘˜æŠ€æœ¯å‚å·®ä¸é½ï¼ŒæŠ€æœ¯æ–‡æ¡£èƒ½åŠ›ä¹Ÿä¸ä¾‹å¤–ï¼Œå¯¼è‡´æ¥å£å®šä¹‰åŠæ–‡æ¡£äº”èŠ±å…«é—¨ï¼Œä¸åŒé¡¹ç›®æˆ–ä¸åŒå…¬å¸å¯¹æ¥æå…¶å›°éš¾ï¼Œè€Œä¸”ä½“éªŒç³Ÿç³•ã€‚æ‰€ä»¥ï¼Œæ— è§„çŸ©ä¸æˆæ–¹åœ†ï¼Œä¸ºäº†å¼€å‘äººå‘˜é—´æ›´å¥½çš„é…åˆï¼Œè¿«åˆ‡éœ€è¦æ•´ç†å‡ºä¸€å¥—è§„èŒƒã€‚

é€šå¸¸æ¥å£è§„èŒƒåˆ†ä¸ºå…­ä¸ªéƒ¨åˆ†ï¼š

### 6.3.1 åè®®è§„èŒƒ

ä¸ºäº†ç¡®ä¿ä¸åŒç³»ç»Ÿ/æ¨¡å—é—´çš„æ•°æ®äº¤äº’ï¼Œéœ€è¦äº‹å…ˆçº¦å®šå¥½é€šè®¯åè®®ï¼Œå¦‚ï¼šTCPã€HTTPã€HTTPS åè®®ã€‚ä¸ºäº†ç¡®ä¿æ•°æ®äº¤äº’å®‰å…¨ï¼Œå»ºè®®ä½¿ç”¨ HTTPS åè®®

### 6.3.2 æ¥å£è·¯å¾„è§„èŒƒ

ä½œä¸ºæ¥å£è·¯å¾„ï¼Œä¸ºäº†æ–¹ä¾¿æ¸…æ™°çš„åŒºåˆ†æ¥è‡ªä¸åŒçš„ç³»ç»Ÿï¼Œå¯ä»¥é‡‡ç”¨ä¸åŒç³»ç»Ÿ/æ¨¡å—åä½œä¸ºæ¥å£è·¯å¾„å‰ç¼€ï¼Œå¦‚ï¼šæ”¯ä»˜æ¨¡å—ï¼š`/pay/xxx`ï¼Œè®¢å•æ¨¡å—ï¼š`/order/xxx`

### 6.3.3 ç‰ˆæœ¬æ§åˆ¶è§„èŒƒ

ä¸ºäº†ä¾¿äºåæœŸæ¥å£çš„å‡çº§å’Œç»´æŠ¤ï¼Œå»ºè®®åœ¨æ¥å£è·¯å¾„ä¸­åŠ å…¥ç‰ˆæœ¬å·ï¼Œä¾¿äºç®¡ç†ï¼Œå®ç°æ¥å£å¤šç‰ˆæœ¬çš„å¯ç»´æŠ¤æ€§ã€‚å¦‚ï¼šæ¥å£è·¯å¾„ä¸­æ·»åŠ ç±»ä¼¼"`v1`"ã€"`v2`"ç­‰ç‰ˆæœ¬å·

### 6.3.4 æ¥å£å‘½åè§„èŒƒ

å’Œ C# å‘½åè§„èŒƒä¸€æ ·ï¼Œå¥½çš„ã€ç»Ÿä¸€çš„æ¥å£å‘½åè§„èŒƒï¼Œä¸ä»…å¯ä»¥å¢å¼ºå…¶å¯è¯»æ€§ï¼Œè€Œä¸”è¿˜ä¼šå‡å°‘å¾ˆå¤šä¸å¿…è¦çš„å£å¤´/ä¹¦é¢ä¸Šçš„è§£é‡Šã€‚å¯ä½¿ç”¨"é©¼å³°å‘½åæ³•"æŒ‰ç…§å®ç°æ¥å£çš„**ä¸šåŠ¡ç±»å‹ã€ä¸šåŠ¡åœºæ™¯**ç­‰å‘½åï¼Œæœ‰å¿…è¦æ—¶å¯é‡‡å–å¤šçº§ç›®å½•å‘½åï¼Œä½†ç›®å½•ä¸å®œè¿‡é•¿ï¼Œä¸¤çº§ç›®å½•è¾ƒä¸ºé€‚å®œ

- `å¸¸è§å‘½åæ–¹å¼`:
  - `æ¥å£åç§°åŠ¨è¯å‰/åç¼€åŒ–`ï¼š æ¥å£åç§°ä»¥æ¥å£æ•°æ®æ“ä½œçš„åŠ¨è¯ä¸ºå‰/åç¼€ï¼Œå¸¸è§åŠ¨è¯æœ‰ï¼š`Addã€Deleteã€Updateã€Queryã€Getã€Sendã€Saveã€Detailã€List`ç­‰ï¼Œå¦‚ï¼šæ–°å»ºç”¨æˆ· `AddUser`ã€æŸ¥è¯¢è®¢å•è¯¦æƒ… `QueryOrderDetail`ã€‚
  - `æ¥å£åç§°åŠ¨è¯ + è¯·æ±‚æ–¹å¼`ï¼šæ¥å£è·¯å¾„ä¸­åŒ…å«å…·ä½“æ¥å£åç§°çš„åè¯ï¼Œæ¥å£æ•°æ®æ“ä½œåŠ¨ä½œä»¥ HTTP è¯·æ±‚æ–¹å¼æ¥åŒºåˆ†ã€‚å¸¸ç”¨çš„ HTTP è¯·æ±‚æ–¹å¼æœ‰ï¼š
    - `GET`ï¼šä»æœåŠ¡å™¨å–å‡ºèµ„æºï¼ˆä¸€é¡¹æˆ–å¤šé¡¹ï¼‰
    - `POST`ï¼šåœ¨æœåŠ¡å™¨æ–°å»ºä¸€ä¸ªèµ„æº
    - `PUT`ï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜åçš„å®Œæ•´èµ„æºï¼‰
    - `PATCH`ï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜çš„å±æ€§ï¼‰
    - `DELETE`ï¼šä»æœåŠ¡å™¨åˆ é™¤èµ„æº

### 6.3.5 è¯·æ±‚å‚æ•°è§„èŒƒ

- `è¯·æ±‚æ–¹å¼`ï¼šæŒ‰ç…§ `GETã€POSTã€PUT` ç­‰å«ä¹‰å®šä¹‰ï¼Œé¿å…å‡ºç°ä¸ä¸€è‡´ç°è±¡ï¼Œå¯¹äººé€ æˆè¯¯è§£ã€æ­§ä¹‰
  - `è¯·æ±‚å¤´`ï¼šè¯·æ±‚å¤´æ ¹æ®é¡¹ç›®éœ€æ±‚æ·»åŠ é…ç½®å‚æ•°ã€‚å¦‚ï¼šè¯·æ±‚æ•°æ®æ ¼å¼ï¼Œ`accept=application/json` ç­‰ã€‚å¦‚æœ‰éœ€è¦ï¼Œè¯·æ±‚å¤´å¯æ ¹æ®é¡¹ç›®éœ€æ±‚è¦æ±‚ä¼ å…¥ç”¨æˆ· tokenã€å”¯ä¸€éªŒç­¾ç ç­‰åŠ å¯†æ•°æ®
  - `è¯·æ±‚å‚æ•°/è¯·æ±‚ä½“`ï¼š è¯·æ±‚å‚æ•°å­—æ®µï¼Œå°½å¯èƒ½ä¸æ•°æ®åº“è¡¨å­—æ®µã€å¯¹è±¡å±æ€§åç­‰ä¿æŒä¸€è‡´ï¼Œå› ä¸ºä¿æŒä¸€è‡´æ˜¯æœ€çœäº‹ï¼Œæœ€èˆ’æœçš„ä¸€ä»¶äº‹

### 6.3.6 è¿”å›æ•°æ®è§„èŒƒ

ç»Ÿä¸€è§„èŒƒè¿”å›æ•°æ®çš„æ ¼å¼ï¼Œå¯¹å·±å¯¹å½¼éƒ½æœ‰å¥½å¤„ï¼Œæ­¤å¤„ä»¥ json æ ¼å¼ä¸ºä¾‹ã€‚è¿”å›æ•°æ®åº”åŒ…å«ï¼š**è¿”å›çŠ¶æ€ç ã€è¿”å›çŠ¶æ€ä¿¡æ¯ã€å…·ä½“æ•°æ®**ã€‚**è¿”å›æ•°æ®ä¸­çš„çŠ¶æ€ç ã€çŠ¶æ€ä¿¡æ¯ï¼Œå¸¸æŒ‡å…·ä½“çš„ä¸šåŠ¡çŠ¶æ€ï¼Œä¸å»ºè®®å’Œ HTTP çŠ¶æ€ç æ··åœ¨ä¸€èµ·**ã€‚HTTP çŠ¶æ€ï¼Œæ˜¯ç”¨æ¥ä½“ç° HTTP é“¾è·¯çŠ¶æ€æƒ…å†µï¼Œå¦‚ï¼š404-Not Foundã€‚HTTP çŠ¶æ€ç å’Œ json ç»“æœä¸­çš„çŠ¶æ€ç ï¼Œå¹¶å­˜å°šå¯ï¼Œç”¨äºä½“ç°ä¸åŒç»´åº¦çš„çŠ¶æ€ã€‚

## 6.4 ä»€ä¹ˆæ˜¯ Swagger

ç›¸ä¿¡æ— è®ºæ˜¯å‰ç«¯è¿˜æ˜¯åç«¯å¼€å‘ï¼Œéƒ½æˆ–å¤šæˆ–å°‘åœ°è¢«æ¥å£æ–‡æ¡£æŠ˜ç£¨è¿‡ã€‚å‰ç«¯ç»å¸¸æŠ±æ€¨åç«¯ç»™çš„æ¥å£æ–‡æ¡£ä¸å®é™…æƒ…å†µä¸ä¸€è‡´ã€‚åç«¯åˆè§‰å¾—ç¼–å†™åŠç»´æŠ¤æ¥å£æ–‡æ¡£ä¼šè€—è´¹ä¸å°‘ç²¾åŠ›ï¼Œç»å¸¸æ¥ä¸åŠæ›´æ–°ã€‚

å…¶å®æ— è®ºæ˜¯å‰ç«¯è°ƒç”¨åç«¯ï¼Œè¿˜æ˜¯åç«¯è°ƒç”¨åç«¯ï¼Œéƒ½æœŸæœ›æœ‰ä¸€ä¸ªå¥½çš„æ¥å£æ–‡æ¡£ã€‚ä½†æ˜¯è¿™ä¸ªæ¥å£æ–‡æ¡£å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œå°±è·Ÿæ³¨é‡Šä¸€æ ·ï¼Œç»å¸¸ä¼šæŠ±æ€¨åˆ«äººå†™çš„ä»£ç æ²¡æœ‰å†™æ³¨é‡Šï¼Œç„¶è€Œè‡ªå·±å†™èµ·ä»£ç èµ·æ¥ï¼Œæœ€è®¨åŒçš„ï¼Œä¹Ÿæ˜¯å†™æ³¨é‡Šã€‚æ‰€ä»¥ä»…ä»…åªé€šè¿‡å¼ºåˆ¶æ¥è§„èŒƒå¤§å®¶æ˜¯ä¸å¤Ÿçš„ï¼Œéšç€æ—¶é—´æ¨ç§»ï¼Œç‰ˆæœ¬è¿­ä»£ï¼Œæ¥å£æ–‡æ¡£å¾€å¾€å¾ˆå®¹æ˜“å°±è·Ÿä¸ä¸Šä»£ç äº†ã€‚

**å‘ç°äº†ç—›ç‚¹å°±è¦å»æ‰¾è§£å†³æ–¹æ¡ˆã€‚è§£å†³æ–¹æ¡ˆç”¨çš„äººå¤šäº†ï¼Œå°±æˆäº†æ ‡å‡†çš„è§„èŒƒï¼Œè¿™å°±æ˜¯ `Swagger` çš„ç”±æ¥**ã€‚

é€šè¿‡è¿™å¥—è§„èŒƒï¼Œä½ åªéœ€è¦æŒ‰ç…§å®ƒçš„è§„èŒƒå»å®šä¹‰æ¥å£åŠæ¥å£ç›¸å…³çš„ä¿¡æ¯ã€‚å†é€šè¿‡ `Swagger` è¡ç”Ÿå‡ºæ¥çš„ä¸€ç³»åˆ—é¡¹ç›®å’Œå·¥å…·ï¼Œå°±å¯ä»¥åšåˆ°ç”Ÿæˆå„ç§æ ¼å¼çš„æ¥å£æ–‡æ¡£ï¼Œç”Ÿæˆå¤šç§è¯­è¨€çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ä»£ç ï¼Œä»¥åŠåœ¨çº¿æ¥å£è°ƒè¯•é¡µé¢ç­‰ç­‰ã€‚

è¿™æ ·ï¼Œå¦‚æœæŒ‰ç…§æ–°çš„å¼€å‘æ¨¡å¼ï¼Œåœ¨å¼€å‘æ–°ç‰ˆæœ¬æˆ–è€…è¿­ä»£ç‰ˆæœ¬çš„æ—¶å€™ï¼Œåªéœ€è¦æ›´æ–° `Swagger` æè¿°æ–‡ä»¶ï¼Œå°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£å’Œå®¢æˆ·ç«¯æœåŠ¡ç«¯ä»£ç ï¼Œåšåˆ°è°ƒç”¨ç«¯ä»£ç ã€æœåŠ¡ç«¯ä»£ç ä»¥åŠæ¥å£æ–‡æ¡£çš„ä¸€è‡´æ€§ã€‚

æ‰€ä»¥ï¼ŒSwagger æ˜¯ä¸€ä¸ªè§„èŒƒå’Œå®Œæ•´çš„æ¡†æ¶ï¼Œç”¨äºç”Ÿæˆã€æè¿°ã€è°ƒç”¨å’Œå¯è§†åŒ–`RESTful` é£æ ¼çš„ `Web` æœåŠ¡ã€‚

æ€»ä½“ç›®æ ‡æ˜¯ä½¿å®¢æˆ·ç«¯å’Œæ–‡ä»¶ç³»ç»Ÿä½œä¸ºæœåŠ¡å™¨ä»¥åŒæ ·çš„é€Ÿåº¦æ¥æ›´æ–°ã€‚æ–‡ä»¶çš„æ–¹æ³•ã€å‚æ•°å’Œæ¨¡å‹ç´§å¯†é›†æˆåˆ°æœåŠ¡å™¨ç«¯çš„ä»£ç ï¼Œå…è®¸ API æ¥å§‹ç»ˆä¿æŒåŒæ­¥ã€‚`Swagger` è®©éƒ¨ç½²ç®¡ç†å’Œä½¿ç”¨åŠŸèƒ½å¼ºå¤§çš„ `API` ä»æœªå¦‚æ­¤ç®€å•ã€‚

## 6.5 Swagger ä½¿ç”¨

`Furion` æ¡†æ¶æä¾›äº†éå¸¸æ–¹ä¾¿ä¸”çµæ´»çš„ `Swagger` é…ç½®ï¼Œæ— éœ€å¢åŠ é¢å¤–å­¦ä¹ æˆæœ¬ã€‚

### 6.5.1 æ³¨å†ŒæœåŠ¡

:::tip å°æç¤º

`.UseInject()` å·²ç»åŒ…å«äº† `.UseSpecificationDocuments()` æ³¨å†Œï¼Œ**æ— éœ€å†æ¬¡æ³¨å†Œ**ã€‚

:::

```cs showLineNumbers  {13,21} title="Furion.Web.Core\Startup.cs"
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;

namespace Furion.Web.Core
{
    [AppStartup(800)]
    public sealed class FurWebCoreStartup : AppStartup
    {
        public void ConfigureServices(IServiceCollection services)
        {
            services.AddSpecificationDocuments();
            services.AddControllers();
        }

        public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
        {
            // Other Codes

            app.UseSpecificationDocuments();

            app.UseEndpoints(endpoints =>
            {
                endpoints.MapControllers();
            });
        }
    }
}
```

:::tip å°çŸ¥è¯†

`services.AddSpecificationDocuments()` é€šå¸¸å’Œ `.AddDynamicApiControllers()` æˆå¯¹å‡ºç°ã€‚

:::

### 6.5.2 é»˜è®¤åœ°å€

åœ¨ `Furion` æ¡†æ¶ä¸­ï¼Œé»˜è®¤ `è§„èŒƒåŒ–æ–‡æ¡£` åœ°å€ä¸º `/api` ç›®å½•ï¼Œ**æ”¯æŒè‡ªå®šä¹‰é…ç½®**ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/swagger1.png")} />

å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼é…ç½®ï¼š

- `app.UseInject("è·¯ç”±")` æ–¹å¼ï¼Œå¦‚

```cs showLineNumbers
app.UseInject("testapi"); // é‚£ä¹ˆ  /testapi å°±æ˜¯è§„èŒƒåŒ–åœ°å€
```

- `é…ç½®æ–‡ä»¶é…ç½®`ï¼š

```cs showLineNumbers  {3}
{
  "SpecificationDocumentSettings": {
    "RoutePrefix": "testapi"
  }
}
```

**é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§å¤§äº `UseInject()` æ–¹å¼**

### 6.5.3 é»˜è®¤åˆ†ç»„

`Furion` æ¡†æ¶ä¸­é»˜è®¤åˆ†ç»„åä¸º `Default`ï¼Œ**æ”¯æŒè‡ªå®šä¹‰é…ç½®**ã€‚

```cs showLineNumbers  {3}
{
  "SpecificationDocumentSettings": {
    "DefaultGroupName": "MyGroup"
  }
}
```

### 6.5.4 æ–‡æ¡£æ³¨é‡Š

è§„èŒƒåŒ–æ–‡æ¡£é»˜è®¤æ‰«æ `Furion.Application`ï¼Œ`Furion.Web.Core`ï¼Œ`Furion.Web.Entry` ä¸‰ä¸ªç¨‹åºé›†`.xml` æ³¨é‡Šæ–‡ä»¶ï¼Œ**æ”¯æŒè‡ªå®šä¹‰é…ç½®**ã€‚

åªæ”¯æŒ `///` æ ‡è¯†çš„æ³¨é‡Šè¯­æ³•ï¼Œå¦‚ï¼š**ç±»ã€æ–¹æ³•ã€å±æ€§ã€å‚æ•°ã€è¿”å›å€¼ã€éªŒè¯ç‰¹æ€§**ã€‚

```cs showLineNumbers  {5-7,10-13,19-23}
using Furion.DynamicApiController;

namespace Furion.Application
{
    /// <summary>
    /// ç±»æ³¨é‡Š
    /// </summary>
    public class FurionAppService : IDynamicApiController
    {
        /// <summary>
        /// æ–¹æ³•æ³¨é‡Š
        /// </summary>
        /// <returns></returns>
        public string Get()
        {
            return nameof(Furion);
        }

        /// <summary>
        /// å¸¦ ID å‚æ•°çš„æ–¹æ³•æ³¨é‡Š
        /// </summary>
        /// <param name="id"></param>
        /// <returns></returns>
        public int Get(int id)
        {
            return id;
        }
    }
}
```

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/swagger2.png")} />

:::note å°æç¤º

å¦‚æœæ–‡æ¡£æ³¨é‡Šæ²¡æœ‰æ˜¾ç¤ºï¼Œè¯·æ£€æŸ¥é¡¹ç›® `å±æ€§->ç”Ÿæˆ->è¾“å‡º` ä¸­ XML æ–‡æ¡£æ˜¯å¦é…ç½®è¾“å‡ºè·¯å¾„ã€‚**æ³¨æ„ï¼šåªæœ‰ä¸å¸¦è·¯å¾„çš„ ã€é¡¹ç›®åç§°.xmlã€‘ æ‰ä¼šè‡ªåŠ¨åŠ è½½ã€‚**

:::

:::info ç‰¹åˆ«è¯´æ˜

`Debug` æ¨¡å¼ä¸‹å’Œ `Release` æ¨¡å¼ä¸‹çš„æ³¨é‡Šæ–‡ä»¶æ˜¯ä¸é€šç”¨çš„ï¼Œæ‰€ä»¥å¯¼è‡´å¾ˆå¤šå¼€å‘è€…å‘å¸ƒåˆ°æœåŠ¡å™¨ä¸Šå‘ç°æ²¡æœ‰æ˜¾ç¤ºæ³¨é‡Šã€‚æˆ‘ä»¬åªéœ€è¦åœ¨ `Visual Studio` ä¸­åˆ‡æ¢ `Debug` æ¨¡å¼ä¸º `Release`ï¼Œç„¶åé‡æ–°é…ç½®ä¸€æ¬¡å³å¯ã€‚

è¿™æ ·ä¸ç®¡æ˜¯ `Debug` è¿˜æ˜¯ `Release` æ¨¡å¼éƒ½ä¼šæ˜¾ç¤ºæ³¨é‡Šäº†ã€‚

:::

### 6.5.5 å¤šåˆ†ç»„æ”¯æŒ

å¤šåˆ†ç»„æ˜¯ä¸€ä¸ªç³»ç»Ÿä¸­å¿…å¤‡åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç³»ç»Ÿåˆ’åˆ†ä¸ºå¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—éƒ½ç‹¬ç«‹çš„ `api` é…ç½®ã€‚åœ¨ `Furion` æ¡†æ¶ä¸­ï¼Œå®ç°å¤šåˆ†ç»„éå¸¸ç®€å•ã€‚å¦‚ï¼š

```cs showLineNumbers  {5,21,32}
using Furion.DynamicApiController;

namespace Furion.Application
{
    [ApiDescriptionSettings("Group1")]
    public class FurionAppService : IDynamicApiController
    {
        /// <summary>
        /// éšçˆ¶ç±» Group1 åˆ†ç»„
        /// </summary>
        /// <returns></returns>
        public string Post()
        {
            return nameof(Furion);
        }

        /// <summary>
        /// åœ¨ Group1ã€Group3 éƒ½æœ‰æˆ‘
        /// </summary>
        /// <returns></returns>
        [ApiDescriptionSettings("Group1", "Group3")]
        public string Get()
        {
            return nameof(Furion);
        }

        /// <summary>
        /// æˆ‘åªåœ¨ Group2 å‡ºç°
        /// </summary>
        /// <param name="id"></param>
        /// <returns></returns>
        [ApiDescriptionSettings("Group2")]
        public int Get(int id)
        {
            return id;
        }
    }
}
```

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/swagger3.gif")} />

### 6.5.6 å¤šåˆ†ç»„æ’åº

<Tabs
  defaultValue="fz1"
  values={[
    { label: "æ–¹å¼ä¸€", value: "fz1" },
    { label: "æ–¹å¼äºŒ", value: "fz2" },
  ]}
>
  <TabItem value="fz1">

**é€šè¿‡åˆ†ç»„åç§°æ·»åŠ  `@æ•´æ•°` è¿›è¡Œæ’åº**

```cs showLineNumbers  {5,19}
using Furion.DynamicApiController;

namespace Furion.Application
{
    [ApiDescriptionSettings("Group1@1")]
    public class FurionAppService : IDynamicApiController
    {
        public string Post()
        {
            return nameof(Furion);
        }

        [ApiDescriptionSettings("Group1", "Group3")]
        public string Get()
        {
            return nameof(Furion);
        }

        [ApiDescriptionSettings("Group@2")]
        public int Get(int id)
        {
            return id;
        }
    }
}
```

å¯ä»¥é€šè¿‡åœ¨åˆ†ç»„ååé¢æ·»åŠ  `@æ•´æ•°` è¿›è¡Œæ’åºï¼Œ`æ•´æ•°` è¶Šå¤§æ’å‰é¢ã€‚å¦‚æœåˆ†ç»„åç§°å¤šæ¬¡æŒ‡å®šä¸”å¤šæ¬¡æŒ‡å®šäº† `@æ•´æ•°` ï¼Œåˆ™è‡ªåŠ¨**å–è¯¥åˆ†ç»„æœ€å¤§çš„æ•´æ•°**è¿›è¡Œæ’åºã€‚

  </TabItem>
  <TabItem value="fz2">

**é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®æ’åº**

```json showLineNumbers  {2-17} title="Furion.Web.Entry/appsettings.json"
{
  "SpecificationDocumentSettings": {
    "GroupOpenApiInfos": [
      {
        "Group": "Group1",
        "Order": 1
      },
      {
        "Group": "Group2",
        "Order": 2
      },
      {
        "Group": "Group3",
        "Order": 0
      }
    ]
  }
}
```

  </TabItem>
</Tabs>

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/swagger4.png")} />

:::tip æ’åºè¯´æ˜

åˆ†ç»„é»˜è®¤æ’åº `Order` ä¸º `0`ã€‚å¦‚æœåŒæ—¶é…ç½®äº† `@æ•´æ•°` å’Œ `appsettings.json` é…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆä¼˜å…ˆé‡‡ç”¨ `appsettings.json` ä¸­çš„ `Order`

:::

### 6.5.7 å¤šåˆ†ç»„ä¿¡æ¯é…ç½®

`Furion` æ¡†æ¶æä¾›äº†å¯é€šè¿‡ `appsetting.json` é…ç½®åˆ†ç»„ä¿¡æ¯ï¼š

```json showLineNumbers  {3-20} title="Furion.Web.Entry/appsettings.json"
{
  "SpecificationDocumentSettings": {
    "GroupOpenApiInfos": [
      {
        "Group": "Group1",
        "Title": "åˆ†ç»„æ ‡é¢˜",
        "Description": "è¿™é‡Œæ˜¯åˆ†ç»„æè¿°",
        "Version": "ç‰ˆæœ¬å·",
        "TermsOfService": "https://furion.baiqian.ltd",
        "Contact": {
          "Name": "ç™¾å°åƒ§",
          "Url": "https://gitee.com/monksoul",
          "Email": "monksoul@outlook.com"
        },
        "License": {
          "Name": "MIT",
          "Url": "https://gitee.com/dotnetchina/Furion/blob/alpha/LICENSE"
        }
      }
    ]
  }
}
```

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/swagger5.png")} />

### 6.5.8 æ§åˆ¶å™¨å’Œæ–¹æ³•æ’åº

æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å¯¹æ§åˆ¶å™¨æˆ–è€…æ–¹æ³•è¿›è¡Œæ’åºï¼Œæ¡†æ¶æä¾›äº† `[ApiDescriptionSettings]` ç‰¹æ€§çš„ `Order` å±æ€§ï¼Œ**å…¶å€¼è¶Šå¤§æ’åºè¶Šé å‰**ï¼Œå¦‚ï¼š

```cs showLineNumbers {1,9,15,22}
[ApiDescriptionSettings(Order = 10)]
public class FurionAppService : IDynamicApiController
{
    public string Post()
    {
        return nameof(Furion);
    }

    [ApiDescriptionSettings(Order = 5)]
    public string Get()
    {
        return nameof(Furion);
    }

    [ApiDescriptionSettings(Order = 4)]
    public int Get(int id)
    {
        return id;
    }
}

[ApiDescriptionSettings(Order = 9)]
public class Furion2AppService : IDynamicApiController
{
    // ...
}

```

:::tip æ’åºè¯´æ˜

æœ€ç»ˆè¾“å‡ºåˆ° `Swagger` ç•Œé¢æ—¶ï¼Œ`FurionAppService` æ¯” `Furion2AppService` é å‰ï¼Œè€Œ `FurionAppService` ä¸­å®šä¹‰çš„æ–¹æ³•æ’åºæ—¶ï¼š`Get` > `Get(int id)` > `Post`ã€‚

:::

### 6.5.9 ç»„ä¸­ç»„ï¼ˆæ ‡ç­¾ï¼‰

`Tag` é…ç½®ä¸»è¦ç”¨äºé…ç½® `Swagger` æ ‡ç­¾åˆ†ç»„ä¿¡æ¯åŠåˆå¹¶æ ‡ç­¾ã€‚ä¹Ÿå°±æ˜¯ `ç»„ä¸­ç»„`:

<Tabs
  defaultValue="tag1"
  values={[
    { label: "æ ‡ç­¾å‘½å", value: "tag1" },
    { label: "åˆå¹¶æ ‡ç­¾", value: "tag2" },
  ]}
>
  <TabItem value="tag1">

#### æœªè´´æ ‡ç­¾ä¹‹å‰

```cs showLineNumbers
using Furion.DynamicApiController;

namespace Furion.Application
{
    public class FurionAppService : IDynamicApiController
    {
        public string Get()
        {
            return nameof(Furion);
        }

        public int Get(int id)
        {
            return id;
        }
    }

    public class TestAppService : IDynamicApiController
    {
        public string Get()
        {
            return nameof(Furion);
        }

        public int Get(int id)
        {
            return id;
        }
    }
}
```

#### è´´æ ‡ç­¾ä¹‹å

```cs showLineNumbers  {5,19}
using Furion.DynamicApiController;

namespace Furion.Application
{
    [ApiDescriptionSettings(Tag = "åˆ†ç»„ä¸€")]
    public class FurionAppService : IDynamicApiController
    {
        public string Get()
        {
            return nameof(Furion);
        }

        public int Get(int id)
        {
            return id;
        }
    }

    [ApiDescriptionSettings(Tag = "åˆ†ç»„äºŒ")]
    public class TestAppService : IDynamicApiController
    {
        public string Get()
        {
            return nameof(Furion);
        }

        public int Get(int id)
        {
            return id;
        }
    }
}
```

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/tag1.png")} />

  </TabItem>
  <TabItem value="tag2">

```cs showLineNumbers  {5,19}
using Furion.DynamicApiController;

namespace Furion.Application
{
    [ApiDescriptionSettings(Tag = "åˆå¹¶æ‰€æœ‰æ ‡ç­¾")]
    public class FurionAppService : IDynamicApiController
    {
        public string Get()
        {
            return nameof(Furion);
        }

        public int Get(int id)
        {
            return id;
        }
    }

    [ApiDescriptionSettings(Tag = "åˆå¹¶æ‰€æœ‰æ ‡ç­¾")]
    public class TestAppService : IDynamicApiController
    {
        public string Get()
        {
            return nameof(Furion);
        }

        public int Get(int id)
        {
            return id;
        }
    }
}
```

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/tag2.png")} />

  </TabItem>
</Tabs>

:::tip å°çŸ¥è¯†

å¦‚æœ `Tag` åå­—ä¸€æ ·ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆå¹¶ï¼Œå¦åˆ™åªæ˜¯å‘½åã€‚

:::

### 6.5.10 é»˜è®¤å±•å¼€æ‰€æœ‰æ–‡æ¡£

```json showLineNumbers  {2-4} title="Furion.Web.Entry/appsettings.json"
{
  "SpecificationDocumentSettings": {
    "DocExpansionState": "Full"
  }
}
```

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/swagger6.gif")} />

`DocExpansionState` é…ç½®è¯´æ˜ï¼š

- `List`ï¼šåˆ—è¡¨å¼ï¼ˆå±•å¼€å­ç±»ï¼‰ï¼Œ**é»˜è®¤å€¼**
- `Full`ï¼šå®Œå…¨å±•å¼€
- `None`ï¼šåˆ—è¡¨å¼ï¼ˆä¸å±•å¼€å­ç±»ï¼‰

### 6.5.11 é…ç½®æ–‡æ¡£æ ‡é¢˜

```json showLineNumbers  {2-4} title="Furion.Web.Entry/appsettings.json"
{
  "SpecificationDocumentSettings": {
    "DocumentTitle": "æˆ‘æ˜¯è‡ªå®šä¹‰æ ‡é¢˜"
  }
}
```

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/swagger7.png")} />

### 6.5.12 æˆæƒæ§åˆ¶

**æ–°ç‰ˆæœ¬ `Furion` å·²ç»é»˜è®¤å¯ç”¨äº† Bearer Token æˆæƒé…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®**ï¼Œå¦‚éœ€æ‰‹åŠ¨é…ç½®ï¼Œå¯æ‰‹åŠ¨æ·»åŠ ä»¥ä¸‹ç±»ä¼¼é…ç½®ï¼š

```json showLineNumbers  title="Furion.Web.Entry/appsettings.json"
{
  "SpecificationDocumentSettings": {
    "EnableAuthorized": true,

    "SecurityDefinitions": [
      {
        "Id": "Bearer",
        "Type": "Http",
        "Name": "Authorization",
        "Description": "JWT Authorization header using the Bearer scheme.",
        "BearerFormat": "JWT",
        "Scheme": "bearer",
        "In": "Header",

        "Requirement": {
          "Scheme": {
            "Reference": {
              "Id": "Bearer",
              "Type": "SecurityScheme"
            },
            "Accesses": []
          }
        }
      }
    ]
  }
}
```

### 6.5.13 åœ¨çº¿æµ‹è¯•

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/swagger8.gif")} />

### 6.5.14 æ€§èƒ½ç›‘è§† `MiniProfiler`

è§„èŒƒåŒ–æ–‡æ¡£é»˜è®¤é›†æˆäº† `MiniProfiler` ç¬¬ä¸‰æ–¹æ€§èƒ½ç»„ä»¶ï¼Œé€šè¿‡è¯¥ç»„ä»¶å¯ä»¥æ–¹ä¾¿æŸ¥çœ‹è¯·æ±‚æ€§èƒ½ã€å¼‚å¸¸å †æ ˆã€æ•°æ®åº“æ“ä½œç­‰ä¿¡æ¯ã€‚é»˜è®¤åœ¨ `Swagger` é¦–é¡µå·¦ä¸Šè§’æ˜¾ç¤ºã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/mipr.png")} />

:::note å°æç¤º

ä¹Ÿå¯ä»¥é€šè¿‡ **`appsetting.json`** ä¸­ **`AppSettings:InjectMiniProfiler`** è®¾ä¸º **`false`** å…³é—­ã€‚

:::

### 6.5.15 å®šä¹‰æ¥å£è¾“å‡ºç±»å‹

```cs showLineNumbers  {2,8-9}
using Furion.DynamicApiController;
using Microsoft.AspNetCore.Mvc;

namespace Furion.Application
{
    public class FurionAppService : IDynamicApiController
    {
        [ProducesResponseType(201, Type = typeof(TestDto))]
        [ProducesResponseType(400)]
        public string Get()
        {
            return nameof(Furion);
        }
    }
}
```

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/fhzlx.png")} />

### 6.5.16 éšè—ç‰¹å®šåˆ†ç»„

`Furion` æ–°ç‰ˆæœ¬æä¾›äº†éšè—åˆ†ç»„çš„ `Visible` é…ç½®ï¼Œè®¾ç½®ä¸º `false` ä¹‹åè¯¥åˆ†ç»„å°†ä¸æ˜¾ç¤ºåœ¨è§„èŒƒåŒ–æ–‡æ¡£ä¸­ï¼Œå¦‚ï¼š

```json showLineNumbers  title="appsetting.json"
{
  "SpecificationDocumentSettings": {
    "GroupOpenApiInfos": [
      {
        "Group": "Group1",
        "Visible": false
      }
    ]
  }
}
```

### 6.5.17 ä¸­æ–‡ä¹±ç é—®é¢˜

é»˜è®¤æƒ…å†µä¸‹,`.json` æ–‡ä»¶å¹¶æœªé‡‡ç”¨ `utf-8` ç¼–ç ï¼Œæ‰€ä»¥å¦‚æœé…ç½®ä¸­æ–‡åˆ†ç»„ä¿¡æ¯å°±ä¼šå‡ºç°ä¹±ç æƒ…å†µï¼Œè¿™æ—¶å€™ï¼Œåªéœ€è¦ä¿®æ”¹ `.json` æ–‡ä»¶ç¼–ç ä¸º `utf-8` å³å¯ã€‚

### 6.5.18 ç”Ÿäº§ç¯å¢ƒä¸­å…³é—­ `Swagger`

å¦‚æœä¸éœ€è¦çº¿ä¸Šç¯å¢ƒå¼€å¯ `Swagger` åŠŸèƒ½ï¼Œåªéœ€è¦åœ¨ `appsetting.json` é…ç½®å³å¯ï¼š

```json showLineNumbers  {3}
{
  "AppSettings": {
    "InjectSpecificationDocument": false
  }
}
```

### 6.5.19 è®¾ç½® `Example Value` é»˜è®¤å€¼

`Swagger` ä¼šè‡ªåŠ¨æ ¹æ®å¯¹è±¡ç±»å‹è¾“å…¥å‚æ•°æ·»åŠ  `Example Value` é»˜è®¤å€¼ï¼Œä½†æ˜¯è¯¥é»˜è®¤å€¼é€šå¸¸æ˜¯å¯¹è±¡å±æ€§çš„ç±»å‹å­—ç¬¦ä¸²æˆ–ç¼ºçœå€¼ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰è¿™äº›é»˜è®¤å€¼ï¼Œåªéœ€è¦æ·»åŠ  `/// <example>é»˜è®¤å€¼</example>` æ³¨é‡Šå³å¯ã€‚

å¦‚ï¼š

```cs showLineNumbers  {4}
/// <summary>
/// å¹´é¾„
/// </summary>
/// <example>13</example>
[Required, Range(10, 110)]
public int Age { get; set; }
```

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/sd20.png")} />

æ›´å¤šç±»å‹é»˜è®¤å€¼è®¾ç½®ç¤ºä¾‹ï¼š

- `bool` ç±»å‹ï¼š`/// <example>true</example>`
- `string` ç±»å‹ï¼š`/// <example>foobar</example>`
- `number` ç±»å‹ï¼š`/// <example>123</example>`
- `null` ç±»å‹ï¼š `/// <example>null</example>`
- `array` ç±»å‹ï¼š`/// <example>[ 1, 2, 3 ]</example>`

:::important å…³äº `object` ç±»å‹è¾“å…¥å‚æ•°

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Example Value` ä¸ä¼šæ˜¾ç¤º `object` ç±»å‹çš„å¯¹è±¡å±æ€§ï¼Œå› ä¸º `Swagger` è®¤ä¸ºè¿™æ˜¯ä¸åˆç†çš„å®šä¹‰ã€‚å¦‚æœéœ€è¦å¼ºåˆ¶æ˜¾ç¤ºï¼Œåªéœ€è¦æ·»åŠ  `/// <example>"object"</example>` æ³¨é‡Šå³å¯ã€‚

:::

### 6.5.20 è‡ªå®šä¹‰ `Swagger` é…ç½®

`Furion` æ¡†æ¶é™¤äº†å†…ç½®äº†ä¸å°‘é…ç½®ä»¥å¤–ï¼Œè¿˜æä¾›äº†ç›´æ¥é…ç½® `Swagger` Api çš„å‚æ•°ï¼Œå¦‚ï¼š

```cs showLineNumbers {5}
public void ConfigureServices(IServiceCollection services)
{
    services.AddInject(options =>
    {
        options.ConfigureSwaggerGen(gen =>
        {
           // ....
        });
    });
}
```

```cs showLineNumbers {6,11}
 public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
 {
      // å¦‚æœä½¿ç”¨ Furion 4.4.8+ ç‰ˆæœ¬å¯ä»¥ app.UseInject(options => {}) äº†ï¼Œæ— éœ€æŒ‡å®š configure:
      app.UseInject(configure: options =>
      {
          options.ConfigureSwagger(swg =>
          {
              // ....
          });

          options.ConfigureSwaggerUI(ui =>
          {
              // ....
          });
      });
}

```

### 6.5.21 é…ç½® `Swagger`çš„ `SchemaIds`

`Furion` æ¡†æ¶é»˜è®¤åªæ˜¾ç¤ºåç§°ï¼Œå¦‚æœéœ€è¦è‡ªå®šä¹‰æ˜¾ç¤ºè§„åˆ™ï¼Œåªéœ€è¦æ·»åŠ é…ç½®å³å¯ã€‚

```cs showLineNumbers {4,6}
services.AddControllersWithViews()
        .AddInject(options =>
        {
            options.ConfigureSwaggerGen(gen =>
            {
                gen.CustomSchemaIds(x => x.FullName);
            });
        });
```

### 6.5.22 è‡ªå®šä¹‰ `swagger.json` è·¯ç”±æ¨¡æ¿

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Furion` æ¡†æ¶ä¼šç”Ÿæˆç»Ÿä¸€çš„åˆ†ç»„æ¨¡æ¿ï¼Œå¦‚ï¼š`swagger/{documentName}/swagger.json`ï¼Œ`{documentName}` ä¼šåœ¨è¿è¡Œæ—¶æ›¿æ¢ä¸ºåˆ†ç»„åï¼Œå¦‚éœ€è‡ªå®šä¹‰ï¼Œé…ç½® `RouteTemplate` å³å¯ï¼š

```json showLineNumbers  title="appsetting.json"
{
  "SpecificationDocumentSettings": {
    "RouteTemplate": "myapp/{documentName}/xxxx.json"
  }
}
```

### 6.5.23 å…³äº `application/x-www-form-urlencoded` è¯·æ±‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Swagger` å¹¶æœªæ·»åŠ  `application/x-www-form-urlencoded` æ”¯æŒï¼Œå¦‚éœ€å¯ç”¨è¯¥é…ç½®ï¼Œåªéœ€åœ¨æ–¹æ³•é¡¶éƒ¨è´´ `[Consumes]` ç‰¹æ€§å³å¯ï¼Œå¦‚ï¼š

```cs showLineNumbers  {1,2}
[Consumes("application/x-www-form-urlencoded")]
public async Task<IActionResult> Test([FromForm] TestRequest testRequest)
{
  // ....
}

public class TestRequest
{
   public string TestValue { get; set; }
}
```

:::important ç‰¹åˆ«æ³¨æ„

å‚æ•°å¿…é¡»è´´ `[FromForm]` ç‰¹æ€§ã€‚å¦å¤–è¯·æ±‚æ—¶å°†å‚æ•°æŒ‰ `URL` åœ°å€æ‹¼æ¥å¹¶æ”¾åœ¨ `Body` ä¸­è¯·æ±‚ã€‚

:::

### 6.5.24 `Swagger` å‡ºç° `CORS` é—®é¢˜è§£å†³

å¦‚æœ `Swagger` å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼Œå¦‚å›¾ï¼š

<img src={useBaseUrl("img/swerror.png")} />

åˆ™éœ€è¦æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```json showLineNumbers  {2,3}
{
  "SpecificationDocumentSettings": {
    "HideServers": true
  }
}
```

### 6.5.25 `Swagger` å‡ºç°é»˜è®¤ `text/xml`/`text/plain` å‚æ•°é—®é¢˜è§£å†³

**äº§ç”Ÿæ­¤åŸå› æœ‰ä¸¤ä¸ªå¿…è¦æ¡ä»¶ï¼š**

1. ä½¿ç”¨äº† `Microsoft.AspNetCore.Mvc.NewtonsoftJson` åŒ…å¹¶æ·»åŠ äº† `AddNewtonsoftJson()` æ³¨å†Œã€‚
2. `.AddNewtonsoftJson()` å†™åœ¨äº† `.AddInjectWithUnifyResult()` åé¢ã€‚

æ‰€ä»¥è§£å†³æ–¹æ³•æ˜¯ï¼Œå…ˆæ³¨å†Œ `.AddNewtonsoftJson()` å†æ³¨å†Œè§„èŒƒåŒ–ç»“æœï¼Œå¦‚ï¼š

```cs showLineNumbers  {2}
services.AddControllers()
        .AddNewtonsoftJson()
        .AddInjectWithUnifyResult();
```

### 6.5.26 `Swagger` å¤šè¯­è¨€æ”¯æŒ

åœ¨ `Furion 2.9.0 + ` ç‰ˆæœ¬å·²ç»æ”¯æŒäº† `Swagger` æ–‡æ¡£åœ°å€ `?culture=en-US` å‚æ•°å¤šè¯­è¨€è½¬å‘åŠŸèƒ½äº†ï¼Œä¹Ÿå°±æ˜¯ `Swagger` åœ°å€å¸¦ `?culture=` å‚æ•°å°†è‡ªåŠ¨æ·»åŠ åˆ°æ¯ä¸€ä¸ªè¯·æ±‚çš„ `api` åœ°å€ä¸­ã€‚

### 6.5.27 è‡ªå®šä¹‰é€»è¾‘æ§åˆ¶ `Swagger` æ¯ä¸€ä¸ª `api` å¯è§æ€§

æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ `Swagger` æ¥å£å¯è§æ€§ï¼Œæ¯”å¦‚æ ¹æ®æƒé™ï¼Œä¸åŒç”¨æˆ·ç±»å‹ï¼Œå„ç§é€»è¾‘æ§åˆ¶ï¼Œå¦‚ï¼š

```cs showLineNumbers {4,6}
// ä¹Ÿå¯ä»¥ç”¨ .AddInjectWithUnifyResult
services.AddInject(options =>
{
    options.ConfigureSwaggerGen(gen =>
    {
        gen.DocInclusionPredicate((currentGroup, apiDescription) =>
        {
            // Furion å†…éƒ¨æ£€æŸ¥ï¼Œå¿…é¡»æ”¾ç¬¬ä¸€è¡Œ
            var isShow = SpecificationDocumentBuilder.CheckApiDescriptionInCurrentGroup(currentGroup, apiDescription);

            // è·å–å½“å‰æ–¹æ³•
            _ = apiDescription.TryGetMethodInfo(out var method);

            // æœ‰äº†æ–¹æ³•ï¼Œè¿™é‡Œåšä½ æƒ³åšçš„äº‹æƒ…ï¼ŒisShow è®¾ç½® true å¯è§ï¼Œè®¾ç½® false ä¸å¯è§

            return isShow;
        });
    });
});
```

### 6.5.28 é…ç½® `MVC` æ§åˆ¶å™¨æ”¯æŒè§„èŒƒåŒ–å¤„ç†

```json showLineNumbers
{
  "UnifyResultSettings": {
    "SupportMvcController": true
  }
}
```

### 6.5.29 `Swagger` åˆ·æ–°è®°ä½æˆæƒçŠ¶æ€

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Swagger` åˆ·æ–°æµè§ˆå™¨åï¼ŒæˆæƒçŠ¶æ€å°†è¢«é‡ç½®ï¼Œä¹Ÿå°±æ˜¯éœ€è¦é‡æ–°ç™»å½•ï¼Œé€šè¿‡ä¸‹é¢ä»£ç åœ¨ **ç”¨æˆ·ç™»å½•æˆåŠŸå** è°ƒç”¨å³å¯ï¼š

```cs showLineNumbers
// ....éªŒè¯ç”¨æˆ·å/å¯†ç ....

_httpContextAccessor.HttpContext.SigninToSwagger("ä¼ å…¥ token");
```

### 6.5.30 å¸¦ç™»å½•çš„ `Swagger` æ–‡æ¡£

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion v3.3.3+` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Swagger` æ˜¯ä»»ä½•äººéƒ½å¯ä»¥è®¿é—®çš„ï¼Œè¿™æ ·ä¹Ÿæš´éœ²å‡ºä¸€äº›å®‰å…¨é—®é¢˜ï¼Œæ‰€ä»¥åœ¨è¯¥ç‰ˆæœ¬ä¹‹åæ·»åŠ äº†ç™»å½•åŠŸèƒ½ï¼Œåªéœ€è¦é…ç½® `SpecificationDocumentSettings` çš„ `LoginInfo` å³å¯ï¼š

```json showLineNumbers {2-6}
{
  "SpecificationDocumentSettings": {
    "LoginInfo": {
      "Enabled": true,
      "CheckUrl": "/Home/CheckUrl",
      "SubmitUrl": "/Home/SubmitUrl",
      "UserName": "admin",
      "Password": "admin"
    }
  }
}
```

#### é…ç½®è¯´æ˜

- `LoginInfo`ï¼šé…ç½® `Swagger` æ˜¯å¦éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®ï¼Œ`SpecificationLoginInfo` ç±»å‹ï¼Œé»˜è®¤ `null`ï¼Œ**ä»…åœ¨ Furion v3.3.3+` æœ‰æ•ˆ**
  - `Enabled`ï¼šæ˜¯å¦å¯ç”¨ç™»å½•æˆæƒï¼Œé»˜è®¤ `false`
  - `CheckUrl`ï¼šæ£€æŸ¥ç™»å½•çŠ¶æ€çš„ `Url` åœ°å€ï¼Œ**è¯¥åœ°å€å¿…é¡»æ˜¯ `POST` è¯·æ±‚**ï¼Œå·²æˆæƒè¿”å› `200`ï¼Œå¦åˆ™è¿”å› `401`ï¼Œæ”¯æŒç›¸å¯¹åœ°å€ï¼Œä»¥ `/` å¼€å¤´
  - `SubmitUrl`ï¼šæäº¤ç™»å½•çš„ `Url` åœ°å€ï¼Œ**è¯¥åœ°å€å¿…é¡»æ˜¯ `POST` è¯·æ±‚ä¸”åªæœ‰ä¸€ä¸ª `SpecificationAuth` ç±»å‹å‚æ•°**ï¼ŒæˆåŠŸç™»å½•è¿”å› `200`ï¼Œå¦åˆ™è¿”å› `401`ï¼Œæ”¯æŒç›¸å¯¹åœ°å€ï¼Œä»¥ `/` å¼€å¤´

#### é…ç½®ç¤ºä¾‹

```cs showLineNumbers {10-14,16-31}
using Furion.SpecificationDocument;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using System.ComponentModel.DataAnnotations;

namespace Furion.Web.Entry.Controllers;

public class HomeController : Controller
{
    [HttpPost, AllowAnonymous, NonUnify]
    public int CheckUrl()
    {
        return 401;
    }

    [HttpPost, AllowAnonymous, NonUnify]
    public int SubmitUrl([FromForm] SpecificationAuth auth)
    {
        // è¯»å–é…ç½®ä¿¡æ¯
        var userName = App.Configuration["SpecificationDocumentSettings:LoginInfo:UserName"];
        var password = App.Configuration["SpecificationDocumentSettings:LoginInfo:Password"];

        if (auth.UserName == userName && auth.Password == password)
        {
            return 200;
        }
        else
        {
            return 401;
        }
    }
}
```

<img src={useBaseUrl("img/swgdl.png")} />

### 6.5.31 `inheritdoc` å®ç°æ³¨é‡Šç»§æ‰¿

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion v3.3.3+` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

åœ¨è¿‡å»æˆ‘ä»¬åœ¨æ¥å£å®šä¹‰çš„æ—¶å€™ç¼–å†™äº†å®Œæ•´çš„æˆå‘˜æ³¨é‡Šï¼Œç„¶ååœ¨æ´¾ç”Ÿæˆå‘˜ä¸­åˆè¦é‡å¤å†™ä¸€æ¬¡ï¼Œå®é™…ä¸Šåšäº†å¾ˆå¤§æ— ç”¨åŠŸï¼Œç°åœ¨ `Furion` æ”¯æŒäº†æ³¨é‡Šç»§æ‰¿äº†ï¼ŒåŒæ—¶ `Swagger` ä¸­ä¹Ÿèƒ½æ­£ç¡®æ˜¾ç¤ºã€‚

```cs showLineNumbers {5,8,14}
using Furion.DynamicApiController;

namespace Furion.Application
{
    /// <inheritdoc cref="ITestInheritdoc" />
    public class TestInheritdoc : ITestInheritdoc, IDynamicApiController
    {
        /// <inheritdoc cref="ITestInheritdoc.GetName"/>
        public string GetName()
        {
            return "Furion";
        }

        /// <inheritdoc />
        public string GetVersion()
        {
            return "3.3.3";
        }
    }

    /// <summary>
    /// æµ‹è¯•æ³¨é‡Šç»§æ‰¿
    /// </summary>
    public interface ITestInheritdoc
    {
        /// <summary>
        /// è·å–åç§°
        /// </summary>
        /// <returns></returns>
        string GetName();

        /// <summary>
        /// è·å–ç‰ˆæœ¬
        /// </summary>
        /// <returns></returns>
        string GetVersion();
    }
}

```

æ˜¾ç¤ºæ•ˆæœï¼š

<img src={useBaseUrl("img/cdr22.png")} />

:::important æ³¨æ„äº‹é¡¹

`<inheritdoc />` ä¸æŒ‡å®š `cref` **ä»…é™æˆå‘˜å¯ç”¨**ä¸”æ‰€åœ¨çš„ç±»å‹å¿…é¡»æŒ‡å®š `<inheritdoc cref="" />`ï¼Œè¿™æ ·æ‰èƒ½è‡ªåŠ¨è¯†åˆ«ã€‚

:::

### 6.5.32 å¯ç”¨ `All Groups` åˆ†ç»„åŠŸèƒ½

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion v3.3.4+` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

æœ‰æ—¶å€™æˆ‘ä»¬ä¸ºäº†æ›´å¥½çš„å¯¹æ¥å£è¿›è¡Œå½’ç±»ï¼Œé…ç½®äº† `Swagger` å¤šä¸ªåˆ†ç»„çš„åŠŸèƒ½ï¼Œä½†è¿™æ ·ä¹Ÿå¯¹ç”Ÿæˆå®¢æˆ·ç«¯è¯·æ±‚ä»£ç é€ æˆäº†å›°æ‰°ï¼Œæ‰€ä»¥æ·»åŠ äº†æ–°çš„é…ç½®ï¼š

```json showLineNumbers {2-3}
{
  "SpecificationDocumentSettings": {
    "EnableAllGroups": true
  }
}
```

### 6.5.33 æ¥å£è¿‡æ—¶æ§åˆ¶

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion v3.3.5+` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

æœ‰æ—¶å€™æˆ‘ä»¬æŸä¸ªæ¥å£å·²ç»è¿‡æ—¶ï¼Œæç¤ºå°½æ—©è°ƒç”¨æœ€æ–°æ¥å£ï¼Œåªéœ€è¦åœ¨æ–¹æ³•ä¸Šé¢è´´ `[Obsolete]` å³å¯ï¼Œå¦‚ï¼š

```cs showLineNumbers {1,7}
[Obsolete("GetName() å·²ç»è¿‡æ—¶ï¼Œè¯·è°ƒç”¨ GetFrameworkName() æ›¿ä»£")]
public string GetName()
{
  return nameof(Furion);
}

[Obsolete]
public string Other()
{
  // ...
}
```

<img src={useBaseUrl("img/swg2.png")} />

### 6.5.34 å•ä¸€æ¥å£æ›´å¤šæè¿°

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion v3.3.5+` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

åœ¨è¯¥ç‰ˆæœ¬æ–°å¢äº† `[ApiDescriptionSettings]` çš„ `Description` å±æ€§ï¼Œæ”¯æŒå®šä¹‰æ›´å¤šæè¿°ï¼Œå¦‚ï¼š

```cs showLineNumbers {1}
[ApiDescriptionSettings(Description = "æˆ‘æ˜¯ä¸€æ®µæè¿°ï¼Œæ˜¾ç¤ºæ›´å¤šå†…å®¹ <button>æˆ‘æ˜¯æŒ‰é’®</button>")]
public string add()
{
  //....
}
```

<img src={useBaseUrl("img/swg1.png")} />

### 6.5.35 `Swagger` å¼‚å¸¸/ä¸èƒ½æ˜¾ç¤º/é”™è¯¯å¤„ç†

æœ‰æ—¶å€™å¯èƒ½å› ä¸ºé”™è¯¯çš„é…ç½®å¯¼è‡´ `Swagger` ä¸èƒ½æ˜¾ç¤ºï¼Œè¿™æ—¶å€™åªéœ€è¦å¤åˆ¶æç¤ºçš„é”™è¯¯ `.json` é“¾æ¥åœ°å€åˆ°æµè§ˆå™¨ä¸­è®¿é—®å³å¯ï¼Œå¦‚ï¼š

```bash showLineNumbers
https://localhost:ä½ çš„ç«¯å£/swagger/Default/swagger.json
```

åé¢çš„ `/swagger/Default/swagger.json` å°±æ˜¯ `Swagger` é”™è¯¯æç¤ºçš„ `.json` é“¾æ¥åœ°å€ã€‚

è¿™æ ·å°±å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„é”™è¯¯äº†ã€‚

<img src={useBaseUrl("img/sperr.png")} />

<img src={useBaseUrl("img/sperr2.png")} />

### 6.5.36 è‡ªå®šä¹‰ `Swagger` çš„ `SchemaId`

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion v3.6.4+` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

æœ‰æ—¶å€™ï¼Œä¸åŒç¨‹åºé›†ä¼šå®šä¹‰ç›¸åŒçš„ç±»å‹åç§° `Name`ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ç”Ÿæˆ `Swagger` çš„ `SchemaId` å‡ºç°å†²çªï¼Œè¿™æ—¶åªéœ€è¦åœ¨ç±»å‹ä¸Šè´´ `[SchemaId]` ç‰¹æ€§å³å¯ï¼Œå¦‚ï¼š

```cs showLineNumbers {3}
using Furion.SpecificationDocument;

[SchemaId("Other_")]
public class PersonDto
{
  // ...
}
```

- `SchemaIdAttribute` é…ç½®é€‰é¡¹ï¼š
  - `SchemaId`ï¼šè‡ªå®šä¹‰ `SchemaId`ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œåªèƒ½æ˜¯ `å­—æ¯,æ•°å­—ï¼Œä¸‹åˆ’çº¿` ç»„åˆ
  - `Replace`ï¼šæ˜¯å¦å®Œå…¨æ›¿æ¢ï¼Œ`bool` ç±»å‹ï¼Œé»˜è®¤ `false`ï¼Œé»˜è®¤æ˜¯ä½œä¸ºå‰ç¼€æ‹¼æ¥ï¼Œå¦‚ä¸Šé¢çš„ `PersonDto` ä¼šç”Ÿæˆ `Other_PersonDto`ï¼Œå¦‚æœè®¾ç½®ä¸º `true`ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ `Other_`

### 6.5.37 è‡ªå®šä¹‰ `Swagger` çš„ `OperationId`

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion 4.1.7+` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

é€šè¿‡æˆ‘ä»¬æ ¹æ® `swagger.json` ç”Ÿæˆå‰ç«¯ä»£ç æ—¶ï¼Œ`Swagger` ä¼šè‡ªåŠ¨æ ¹æ®è·¯ç”±åœ°å€ç”Ÿæˆè°ƒç”¨çš„ `api` åç§°ï¼Œä½†è¿™æ ·çš„åç§°å¾€å¾€ä¸æ˜“è¯»ï¼Œè¿™æ—¶å€™å¯è‡ªå®šä¹‰ `[OperationId]` æ¥é…ç½®ç”Ÿæˆçš„å‰ç«¯åç§°ã€‚

```cs showLineNumbers {5}
using Furion.SpecificationDocument;

public class PersonDto
{
  [OperationId("MyClientMethodName")]
  public string TestMethod()
  {
    // ...
  }
}
```

### 6.5.38 `Swagger` æ¥å£æ–‡æ¡£æ”¯æŒå®Œæ•´çš„ `Markdown`

åœ¨ `Furion` æœ€æ–°ç‰ˆä¸­ï¼Œæ”¯æŒäº†å®Œæ•´çš„ `Markdown` æ³¨å†Œï¼Œå¦‚ï¼š

````cs showLineNumbers {4,80}
/// <summary>
/// æµ‹è¯• Markdown
/// </summary>
/// <remarks>
/// # å…ˆçŸ¥ / Furion ([æ¢ç´¢ç‰ˆ](https://gitee.com/dotnetchina/Furion/tree/experimental/))
///
///     ä¸€ä¸ªåº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œæ‚¨å¯ä»¥å°†å®ƒé›†æˆåˆ°ä»»ä½•.NET/C# åº”ç”¨ç¨‹åºä¸­ã€‚
///
/// An application framework that you can integrate into any.NET/C# application.
///
/// ## å®‰è£… / Installation
///
/// - [Package Manager] (https://www.nuget.org/packages/Furion)
///
/// ```powershell
/// Install-Package Furion
/// ```
///
/// - [.NET CLI] (https://www.nuget.org/packages/Furion)
///
/// ```powershell
/// dotnet add package Furion
/// ```
///
/// ## ä¾‹å­ / Examples
///
/// æˆ‘ä»¬åœ¨[ä¸»é¡µ](https://furion.baiqian.ltd)ä¸Šæœ‰ä¸å°‘ä¾‹å­ï¼Œè¿™æ˜¯è®©æ‚¨å…¥é—¨çš„ç¬¬ä¸€ä¸ªï¼š
///
/// We have several examples [on the website] (https://furion.baiqian.ltd). Here is the first one to get you started:
///
/// ```cs
/// Serve.Run();
///
///     [DynamicApiController]
///     public class HelloService
///     {
///         public string Say()
///         {
///             return "Hello, Furion";
///         }
///     }
/// ```
///
/// æ‰“å¼€æµè§ˆå™¨è®¿é—® `https://localhost:5001`ã€‚
///
/// Open browser access `https://localhost:5001`.
///
/// ## æ–‡æ¡£ / Documentation
///
/// æ‚¨å¯ä»¥åœ¨[ä¸»é¡µ] (https://furion.baiqian.ltd)æˆ–[å¤‡ä»½ä¸»é¡µ](https://furion.baiqian.ltd)æ‰¾åˆ° Furion æ–‡æ¡£ã€‚
///
/// You can find the Furion documentation[on the website](https://furion.baiqian.ltd) or [on the backup website](https://furion.baiqian.ltd).
///
/// ## è´¡çŒ® / Contributing
///
/// è¯¥å­˜å‚¨åº“çš„ä¸»è¦ç›®çš„æ˜¯ç»§ç»­å‘å±• Furion æ ¸å¿ƒï¼Œä½¿å…¶æ›´å¿«ã€æ›´æ˜“äºä½¿ç”¨ã€‚ Furion çš„å¼€å‘åœ¨[Gitee](https://gitee.com/dotnetchina/Furion) ä¸Šå…¬å¼€è¿›è¡Œï¼Œæˆ‘ä»¬æ„Ÿè°¢ç¤¾åŒºè´¡çŒ®é”™è¯¯ä¿®å¤å’Œæ”¹è¿›ã€‚
///
/// é˜…è¯»[è´¡çŒ®æŒ‡å—] (https://furion.baiqian.ltd/docs/contribute)å†…å®¹ï¼Œäº†è§£å¦‚ä½•å‚ä¸æ”¹è¿› Furionã€‚
///
/// The main purpose of this repository is to continue evolving Furion core, making it faster and easier to use.Development of Furion happens in the open on[Gitee] (https://gitee.com/dotnetchina/Furion), and we are grateful to the community for contributing bugfixes and improvements.
///
/// Read[contribution documents] (https://furion.baiqian.ltd/docs/contribute) to learn how you can take part in improving Furion.
///
/// ## è®¸å¯è¯ / License
///
/// Furion é‡‡ç”¨[MIT](https://gitee.com/dotnetchina/Furion/blob/v4/LICENSE) å¼€æºè®¸å¯è¯ã€‚
///
/// Furion uses the[MIT] (https://gitee.com/dotnetchina/Furion/blob/v4/LICENSE) open source license.
///
/// ```
/// CopyrightÂ© 2020-present ç™¾å°åƒ§, Baiqian Co., Ltd.
/// Furion is licensed under Mulan PSL v2.
/// You can use this software according to the terms andconditions of the Mulan PSL v2.
/// You may obtain a copy of Mulan PSL v2 at:
///             https://gitee.com/dotnetchina/Furion/blob/v4/LICENSE
/// THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUTWARRANTIES OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT, MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
/// See the Mulan PSL v2 for more details.
/// ```
///
/// </remarks>
/// <returns></returns>
public string Hello()
{
    return "Furion";
}
````

<img src={useBaseUrl("img/mdx.png")} />

### 6.5.39 ç¬¬ä¸‰æ–¹ `UI` é›†æˆï¼Œå¦‚ `Knife4jUI`

åœ¨ `Furion` æ¡†æ¶ä¸­ï¼Œé›†æˆç¬¬ä¸‰æ–¹ `SwaggerUI` éå¸¸å®¹æ˜“ï¼Œæ¯”å¦‚é›†æˆ `IGeekFan.AspNetCore.Knife4jUI`ï¼š

:::note å®‰è£…åŒ…

åªéœ€è¦åœ¨ `YourPoject.Web.Core` å±‚å®‰è£… `IGeekFan.AspNetCore.Knife4jUI` å³å¯ã€‚

:::

**`Knife4jUI` ç‹¬ç«‹ç‰ˆæœ¬é…ç½®**

```cs showLineNumbers {1,3,12}
var routePrefix = "api";    // å®šä¹‰ swagger è·¯ç”±åœ°å€ï¼Œå¦‚æœæ˜¯è·Ÿç›®å½•ï¼Œè®¾ç½® string.Empty å³å¯

app.UseKnife4UI(options =>
{
    options.RoutePrefix = routePrefix;  // é…ç½® Knife4UI è·¯ç”±åœ°å€
    foreach (var groupInfo in SpecificationDocumentBuilder.GetOpenApiGroups())
    {
        options.SwaggerEndpoint("/" + groupInfo.RouteTemplate, groupInfo.Title);
    }
});

app.UseInject(routePrefix); // é…ç½® Furion è·¯ç”±åœ°å€
```

**`Knife4jUI` å’Œ `Swagger` å…±å­˜ç‰ˆæœ¬é…ç½®**

```cs showLineNumbers {1,3,10}
app.UseKnife4UI(options =>
{
    options.RoutePrefix = "newapi";  // é…ç½® Knife4UI è·¯ç”±åœ°å€ï¼Œç°åœ¨æ˜¯ /newapi
    foreach (var groupInfo in SpecificationDocumentBuilder.GetOpenApiGroups())
    {
        options.SwaggerEndpoint("/" + groupInfo.RouteTemplate, groupInfo.Title);
    }
});

app.UseInject();  // Furion é»˜è®¤ api åœ°å€ä¸º  /api
```

<img src={useBaseUrl("img/sg20.png")} />

**å¦‚éœ€å®ç°ç™»å½•ä¹‹åè‡ªåŠ¨å°† `token` æ·»åŠ åˆ°å¤´éƒ¨å¯åœ¨ç™»å½•æ¥å£ `AfterScript` æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š**

```js
ke.global.setAllHeader(
  "Authorization",
  "Bearer " + ke.response.headers["access-token"]
);
```

<img src={useBaseUrl("img/kni.jpg")} />

### 6.5.40 æ·»åŠ  `Swagger` è¯·æ±‚å“åº”æ‹¦æˆª

æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›åœ¨ `Swagger` è¯·æ±‚ä¹‹å‰è¿›è¡Œæ‹¦æˆªï¼Œæ¯”å¦‚ä¿®æ”¹ `Url` å‚æ•°ï¼Œæ·»åŠ é¢å¤–è¯·æ±‚å¤´ç­‰ï¼Œåˆæˆ–è€…æƒ³åœ¨å“åº”ä¹‹åæ‰“å°è¿”å›å€¼åˆ°æ§åˆ¶å°æˆ–è¿›è¡Œå…¶ä»–æ“ä½œã€‚è¿™æ—¶å€™å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¤„ç†ï¼Œå¦‚ï¼š

```cs showLineNumbers {1,3,6,8}
app.UseInject(options =>
{
    options.ConfigureSwaggerUI(ui =>
    {
        // è¯·æ±‚æ‹¦æˆª
        ui.UseRequestInterceptor("function(request) { return defaultRequestInterceptor(request); }");
        // å“åº”æ‹¦æˆª
        ui.UseResponseInterceptor("function(response) { return defaultResponseInterceptor(response); }");
    });
});
```

æ³¨æ„ï¼Œ`UseRequestInterceptor` å’Œ `UseResponseInterceptor` ä»£ç ä¸èƒ½æ¢è¡Œä¸”é¡»åœ¨ `defaultRequestInterceptor(request)` å’Œ `defaultResponseInterceptor(response)` ä¹‹å‰ç¼–å†™è‡ªå®šä¹‰ä»£ç ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

ä¸‹é¢ç»™å‡ºè¯·æ±‚æ·»åŠ è‡ªå®šä¹‰ `header` ç¤ºä¾‹ï¼š

```cs showLineNumbers {6}
app.UseInject(options =>
{
    options.ConfigureSwaggerUI(ui =>
    {
        // æ·»åŠ è¯·æ±‚å¤´ framework: Furionï¼Œæ³¨æ„ä»£ç ä¸èƒ½æ¢è¡Œï¼Œå¦åˆ™ Swagger æ— æ³•åŠ è½½ !!!!
        ui.UseRequestInterceptor("function(request) { request.headers['framework']='Furion'; return defaultRequestInterceptor(request); }");
    });
});
```

## 6.6 `SpecificationDocumentSettings` é…ç½®

é™¤äº†ä¸Šè¿°ä¾‹å­å¤–ï¼Œ`Furion` æä¾›äº†ä¸€äº›é…ç½®é€‰é¡¹ï¼Œå¦‚ï¼š

- `DocumentTitle`ï¼šæ–‡æ¡£æ ‡é¢˜ï¼Œ`string`ï¼Œé»˜è®¤ `Specification Api Document`
- `DefaultGroupName`ï¼šé»˜è®¤åˆ†ç»„åï¼Œ`string`ï¼Œé»˜è®¤ `Default`
- `EnableAuthorized`ï¼šæ˜¯å¦å¯ç”¨æƒé™æ§åˆ¶ï¼Œ`bool`ï¼Œé»˜è®¤ `true`
- `FormatAsV2`ï¼šé‡‡ç”¨ `Swagger 2.0` ç‰ˆæœ¬ï¼Œ`bool`ï¼Œé»˜è®¤ `false` **[å·²å¼ƒç”¨](https://github.com/domaindrivendev/Swashbuckle.WebApi/issues/1393)**
- `RoutePrefix`ï¼šè§„èŒƒåŒ–æ–‡æ¡£åœ°å€ï¼Œ`string`ï¼Œé»˜è®¤ `api`ï¼Œ**å¦‚æœå¸Œæœ›åœ¨é¦–é¡µï¼Œæ”¹ä¸ºç©ºå­—ç¬¦ä¸²å³å¯**ã€‚
- `DocExpansionState`ï¼šæ–‡æ¡£æ˜¾ç¤ºæ–¹å¼ï¼Œ`DocExpansion`ï¼Œé»˜è®¤ `List`ï¼Œå–å€¼ï¼š
  - `List`ï¼šåˆ—è¡¨å¼ï¼ˆå±•å¼€å­ç±»ï¼‰ï¼Œ**é»˜è®¤å€¼**
  - `Full`ï¼šå®Œå…¨å±•å¼€
  - `None`ï¼šåˆ—è¡¨å¼ï¼ˆä¸å±•å¼€å­ç±»ï¼‰
- `XmlComments`ï¼šç¨‹åºé›†æ³¨é‡Šæè¿°æ–‡ä»¶åï¼ˆå¯å¸¦ `.xml`ï¼Œ`string`ï¼Œé»˜è®¤ `Furion.Application, Furion.Web.Entry, Furion.Web.Core`
- `GroupOpenApiInfos`ï¼šåˆ†ç»„ä¿¡æ¯é…ç½®ï¼Œ`SpecificationOpenApiInfo[]`ï¼Œé»˜è®¤ `{ 'Group': 'Default'}`
- `SecurityDefinitions`ï¼šå®‰å…¨ç­–ç•¥å®šä¹‰é…ç½®ï¼Œ`SpecificationOpenApiSecurityScheme[]`ï¼Œé»˜è®¤ `[]`
- `Servers`ï¼šé…ç½® Server ä¸‹æ‹‰åˆ—è¡¨ï¼Œ`OpenApiServer[]` ç±»å‹ï¼Œé»˜è®¤ `[]`ï¼Œå¦‚ï¼š`{Servers:[ { Url:"åœ°å€", Description:"æè¿°"} ]}`
- `HideServers`ï¼šæ˜¯å¦éšè— Server ä¸‹æ‹‰åˆ—è¡¨ï¼Œ`bool` ç±»å‹ï¼Œé»˜è®¤ `true`
- `RouteTemplate`ï¼šé…ç½®æ–‡æ¡£ `swagger.json` è·¯ç”±æ¨¡æ¿ï¼Œé»˜è®¤æ¨¡æ¿ï¼š`swagger/{documentName}/swagger.json`, `{documentName}` ä»£è¡¨åˆ†ç»„åï¼Œ**å¿…é¡»ä¿ç•™åŸæ ·**
- `PackagesGroups`ï¼šé…ç½®æ¨¡å—åŒ–å†…ç½®åˆ†ç»„åç§°ï¼Œ`string[]` ç±»å‹ï¼Œé»˜è®¤ `[]`
- `EnableEnumSchemaFilter`ï¼šå¯ç”¨æšä¸¾ Schema ç­›é€‰å™¨ï¼Œ`bool` ç±»å‹ï¼Œé»˜è®¤ `true`
- `EnableTagsOrderDocumentFilter`ï¼šå¯ç”¨æ ‡ç­¾æ’åºç­›é€‰å™¨ï¼Œ`bool` ç±»å‹ï¼Œé»˜è®¤ `true`
- `ServerDir`ï¼šé…ç½® `IIS` æ·»åŠ  `Application` éƒ¨ç½²åï¼Œ`string` ç±»å‹ï¼Œé»˜è®¤ç©ºï¼Œ**ä»…åœ¨ Furion v3.2.0+` æœ‰æ•ˆ**
- `LoginInfo`ï¼šé…ç½® `Swagger` æ˜¯å¦éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®ï¼Œ`SpecificationLoginInfo` ç±»å‹ï¼Œé»˜è®¤ `null`ï¼Œ**ä»…åœ¨ Furion v3.3.3+` æœ‰æ•ˆ**
  - `Enabled`ï¼šæ˜¯å¦å¯ç”¨ç™»å½•æˆæƒï¼Œé»˜è®¤ `false`
  - `CheckUrl`ï¼šæ£€æŸ¥ç™»å½•çŠ¶æ€çš„ `Url` åœ°å€ï¼Œ**è¯¥åœ°å€å¿…é¡»æ˜¯ `POST` è¯·æ±‚**ï¼Œå·²æˆæƒè¿”å› `200`ï¼Œå¦åˆ™è¿”å› `401`
  - `SubmitUrl`ï¼šæäº¤ç™»å½•çš„ `Url` åœ°å€ï¼Œ**è¯¥åœ°å€å¿…é¡»æ˜¯ `POST` è¯·æ±‚ä¸”åªæœ‰ä¸€ä¸ª `SpecificationAuth` ç±»å‹å‚æ•°**ï¼ŒæˆåŠŸç™»å½•è¿”å› `200`ï¼Œå¦åˆ™è¿”å› `401`ï¼Œæ”¯æŒç›¸å¯¹åœ°å€ï¼Œä»¥ `/` å¼€å¤´
- `EnableAllGroups`ï¼šå¯ç”¨ `Swagger` æ€»åˆ†ç»„åŠŸèƒ½ï¼Œè‡ªåŠ¨å°†æ‰€æœ‰åˆ†ç»„çš„æ¥å£åˆå¹¶åˆ° `All Groups` ä¸­ï¼Œ`bool` ç±»å‹ï¼Œé»˜è®¤ `false`ï¼Œ**ä»…åœ¨ Furion v3.3.4+` æœ‰æ•ˆ**

å¦å¤– `SpecificationOpenApiInfo` å†…ç½®é…ç½®å¦‚ä¸‹ï¼š

- `Group`ï¼šåˆ†ç»„å”¯ä¸€æ ‡è¯†ï¼Œ`string` ç±»å‹ï¼Œå¿…å¡«
- `Order`ï¼šåˆ†ç»„æ’åºï¼Œ`int` ç±»å‹ï¼Œæ•°å­—è¶Šå¤§æ’å‰é¢ï¼Œé»˜è®¤ `0`
- `Visible`ï¼šé…ç½®åˆ†ç»„æ˜¯å¦å¯è§ï¼Œ`bool` ç±»å‹ï¼Œé»˜è®¤ `true`
- `Title`ï¼šé…ç½®åˆ†ç»„æ ‡é¢˜ï¼Œ`string` ç±»å‹
- `Description`ï¼šé…ç½®åˆ†ç»„æè¿°ï¼Œ`string` ç±»å‹
- `Version`ï¼šé…ç½®åˆ†ç»„ç‰ˆæœ¬ï¼Œé»˜è®¤ `1.0`
- `TermsOfService`ï¼šé…ç½®ç›¸å…³é“¾æ¥åœ°å€ï¼Œ`Uri` ç±»å‹
- `Contact`ï¼šé…ç½®è”ç³»æ–¹å¼ï¼Œ`OpenApiContact` ç±»å‹
- `License`ï¼šé…ç½®åè®®ï¼Œ`OpenApiLicense` ç±»å‹

é…ç½®ç¤ºä¾‹ï¼š

```json showLineNumbers
{
  "SpecificationDocumentSettings": {
    "GroupOpenApiInfos": [
      {
        "Group": "Group1",
        "Title": "åˆ†ç»„æ ‡é¢˜",
        "Description": "è¿™é‡Œæ˜¯åˆ†ç»„æè¿°",
        "Version": "ç‰ˆæœ¬å·",
        "TermsOfService": "https://furion.baiqian.ltd",
        "Contact": {
          "Name": "ç™¾å°åƒ§",
          "Url": "https://gitee.com/monksoul",
          "Email": "monksoul@outlook.com"
        },
        "License": {
          "Name": "MIT",
          "Url": "https://gitee.com/dotnetchina/Furion/blob/alpha/LICENSE"
        }
      }
    ]
  }
}
```

## 6.7 ç»Ÿä¸€è¿”å›å€¼æ¨¡å‹/è§„èŒƒåŒ–ç»“æœ/API è¿”å›å€¼

`Furion` æ¡†æ¶æä¾› `è§„èŒƒåŒ–ç»“æœ` åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡å®ç° `IUnifyResultProvider` æä¾›å™¨å®ç°ç»Ÿä¸€è§„èŒƒåŒ–è¿”å›å€¼å®šåˆ¶ï¼Œå¦‚ï¼š

- **å®šä¹‰ç»“æœåŒ…è£…ç±»å‹**

```cs showLineNumbers {1-2}
// å¿…é¡»æ˜¯æ³›å‹ç±»å‹
public class YourRESTfulResult<T>
{
    /// <summary>
    /// çŠ¶æ€ç 
    /// </summary>
    public int? StatusCode { get; set; }

    /// <summary>
    /// æ•°æ®
    /// </summary>
    public T Data { get; set; }

    /// <summary>
    /// æ‰§è¡ŒæˆåŠŸ
    /// </summary>
    public bool Succeeded { get; set; }

    /// <summary>
    /// é”™è¯¯ä¿¡æ¯
    /// </summary>
    public object Errors { get; set; }

    /// <summary>
    /// é™„åŠ æ•°æ®
    /// </summary>
    public object Extras { get; set; }

    /// <summary>
    /// æ—¶é—´æˆ³
    /// </summary>
    public long Timestamp { get; set; }
}
```

- **å®šä¹‰ `IUnifyResultProvider` å®ç°ç±»ï¼Œå¹¶è´´ç‰¹æ€§ `[UnifyModel(typeof(YourRESTfulResult<>))]`**

```cs showLineNumbers  {15-16,24,36,48,61}
using Furion.DataValidation;
using Furion.DependencyInjection;
using Furion.UnifyResult.Internal;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.Filters;
using System;
using System.Threading.Tasks;

namespace YourProject.UnifyResult
{
    /// <summary>
    /// RESTful é£æ ¼è¿”å›å€¼
    /// </summary>
    [UnifyModel(typeof(YourRESTfulResult<>))]
    public class YourRESTfulResultProvider  : IUnifyResultProvider
    {
        /// <summary>
        /// å¼‚å¸¸è¿”å›å€¼
        /// </summary>
        /// <param name="context"></param>
        /// <param name="metadata"></param>
        /// <returns></returns>
        public IActionResult OnException(ExceptionContext context, ExceptionMetadata metadata)
        {
            return new JsonResult(YourRESTfulResult(metadata.StatusCode, data: metadata.Data, errors: metadata.Errors)
                , UnifyContext.GetSerializerSettings(context)); // å½“å‰è¡Œä»…é™ Furion 4.6.6+ ä½¿ç”¨
        }

        /// <summary>
        /// æˆåŠŸè¿”å›å€¼
        /// </summary>
        /// <param name="context"></param>
        /// <param name="data"></param>
        /// <returns></returns>
        public IActionResult OnSucceeded(ActionExecutedContext context, object data)
        {
            return new JsonResult(YourRESTfulResult(StatusCodes.Status200OK, true, data)
                , UnifyContext.GetSerializerSettings(context)); // å½“å‰è¡Œä»…é™ Furion 4.6.6+ ä½¿ç”¨
        }

        /// <summary>
        /// éªŒè¯å¤±è´¥è¿”å›å€¼
        /// </summary>
        /// <param name="context"></param>
        /// <param name="metadata"></param>
        /// <returns></returns>
        public IActionResult OnValidateFailed(ActionExecutingContext context, ValidationMetadata metadata)
        {
            return new JsonResult(YourRESTfulResult(metadata.StatusCode ?? StatusCodes.Status400BadRequest, data: metadata.Data, errors: metadata.ValidationResult)
                , UnifyContext.GetSerializerSettings(context)); // å½“å‰è¡Œä»…é™ Furion 4.6.6+ ä½¿ç”¨
        }

        /// <summary>
        /// ç‰¹å®šçŠ¶æ€ç è¿”å›å€¼
        /// </summary>
        /// <param name="context"></param>
        /// <param name="statusCode"></param>
        /// <param name="unifyResultSettings"></param>
        /// <returns></returns>
        public async Task OnResponseStatusCodes(HttpContext context, int statusCode, UnifyResultSettingsOptions unifyResultSettings)
        {
            // è®¾ç½®å“åº”çŠ¶æ€ç 
            UnifyContext.SetResponseStatusCodes(context, statusCode, unifyResultSettings);

            switch (statusCode)
            {
                // å¤„ç† 401 çŠ¶æ€ç 
                case StatusCodes.Status401Unauthorized:
                    await context.Response.WriteAsJsonAsync(YourRESTfulResult(statusCode, errors: "401 Unauthorized")
                        , App.GetOptions<JsonOptions>()?.JsonSerializerOptions);
                    break;
                // å¤„ç† 403 çŠ¶æ€ç 
                case StatusCodes.Status403Forbidden:
                    await context.Response.WriteAsJsonAsync(YourRESTfulResult(statusCode, errors: "403 Forbidden")
                        , App.GetOptions<JsonOptions>()?.JsonSerializerOptions);
                    break;
                default: break;
            }
        }

        /// <summary>
        /// è¿”å› RESTful é£æ ¼ç»“æœé›†
        /// </summary>
        /// <param name="statusCode"></param>
        /// <param name="succeeded"></param>
        /// <param name="data"></param>
        /// <param name="errors"></param>
        /// <returns></returns>
        private static YourRESTfulResult<object> YourRESTfulResult(int statusCode, bool succeeded = default, object data = default, object errors = default)
        {
            return new YourRESTfulResult<object>
            {
                StatusCode = statusCode,
                Succeeded = succeeded,
                Data = data,
                Errors = errors,
                Extras = UnifyContext.Take(),
                Timestamp = DateTimeOffset.UtcNow.ToUnixTimeMilliseconds()
            };
        }
    }
}
```

ä¹‹ååœ¨ `Startup.cs` ä¸­æ³¨å†Œå³å¯ï¼š

```cs showLineNumbers
services.AddControllers()
        .AddInjectWithUnifyResult<YourRESTfulResultProvider>();
```

:::important ç‰¹åˆ«æ³¨æ„

é»˜è®¤æƒ…å†µä¸‹ï¼Œè§„èŒƒåŒ–ç»“æœä¸ä¼šå¯¹ `401` å’Œ `403`ã€`404` çŠ¶æ€ç è¿›è¡Œè§„èŒƒåŒ–å¤„ç†ï¼Œå¦‚éœ€å¯åŠ¨è¯¥çŠ¶æ€ç å¤„ç†ï¼Œåªéœ€åœ¨ `Startup.cs` ä¸­çš„ `Configure` ä¸­å¯ç”¨æ¥å£ï¼š

```cs showLineNumbers
public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    if (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
    }
    // æ·»åŠ è§„èŒƒåŒ–ç»“æœçŠ¶æ€ç ï¼Œéœ€è¦åœ¨è¿™é‡Œæ³¨å†Œ
    app.UseUnifyResultStatusCodes();
    // å…¶ä»–æ³¨å†Œ...
}
```

:::

### 6.7.1 æ’é™¤è§„èŒƒåŒ–å¤„ç†

æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬æŸäº›æ¥å£ä¸éœ€è¦è¿›è¡Œè§„èŒƒåŒ–å¤„ç†ï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å¸– `[NonUnify]` ç‰¹æ€§å³å¯ã€‚

### 6.7.2 è§„èŒƒåŒ–ç»“æœæ·»åŠ é¢å¤–æ•°æ®

é»˜è®¤çš„è§„èŒƒåŒ–ç»“æœä¸­åŒ…å« `extras` å±æ€§ï¼Œå¯ä»¥é…ç½®é¢å¤–æ•°æ®è¿”å›åˆ°å®¢æˆ·ç«¯ï¼š

```cs showLineNumbers
UnifyContext.Fill(new { Message = "æ“ä½œæˆåŠŸ" });
```

### 6.7.3 è‡ªå®šä¹‰ç‰¹åˆ«æ¥å£è§„èŒƒåŒ–ç»“æœ

æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬ç‰¹å®šæ¥å£éœ€è¿”å›ç‰¹å®šçš„æ¥å£ç±»å‹ï¼Œæ— éœ€è§„èŒƒåŒ–å¤„ç†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬åªéœ€è¦è´´ `[UnifyResult(typeof(ç»“æœç±»))]` æˆ– `[ProducesResponseType(typeof(ç»“æœç±»),200)]`ï¼Œå¦‚ï¼š

```cs showLineNumbers
[UnifyResult(typeof(Person))]
public Person GetPerson(int id)
{
  // ...
}
```

## 6.8 æ”¯æŒå¤šå¥—è§„èŒƒåŒ–é…ç½®

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion 4.4.4 +` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦é’ˆå¯¹ç‰¹å®šçš„æ§åˆ¶å™¨ï¼ˆåŠ¨æ€ WebAPIï¼‰æˆ–ç‰¹å®šçš„æ–¹æ³•ä½¿ç”¨ä¸åŒçš„è§„èŒƒåŒ–å¤„ç†æœºåˆ¶ï¼Œè¿™æ—¶å°±éœ€è¦å¤šå¥—è§„èŒƒåŒ–å¤„ç†æä¾›å™¨ï¼Œå¦‚ï¼š

1. **å®šä¹‰è§„èŒƒåŒ–å¤„ç†æä¾›ç¨‹åº**

```cs showLineNumbers {1-2,25}
[UnifyModel(typeof(MyResult<>))]
public class SpeciallyResultProvider : IUnifyResultProvider
{
    public IActionResult OnException(ExceptionContext context, ExceptionMetadata metadata)
    {
        // å‚è€ƒä¸Šé¢çš„è§„èŒƒåŒ–å¤„ç†å†™æ³•
    }

    public IActionResult OnSucceeded(ActionExecutedContext context, object data)
    {
        // å‚è€ƒä¸Šé¢çš„è§„èŒƒåŒ–å¤„ç†å†™æ³•
    }

    public IActionResult OnValidateFailed(ActionExecutingContext context, ValidationMetadata metadata)
    {
        // å‚è€ƒä¸Šé¢çš„è§„èŒƒåŒ–å¤„ç†å†™æ³•
    }

    public async Task OnResponseStatusCodes(HttpContext context, int statusCode, UnifyResultSettingsOptions unifyResultSettings)
    {
        // å‚è€ƒä¸Šé¢çš„è§„èŒƒåŒ–å¤„ç†å†™æ³•
    }
}

public class MyResult<T>
{
    /// <summary>
    /// æ•°æ®
    /// </summary>
    public T Data { get; set; }
}
```

2. **æ³¨å†Œè§„èŒƒåŒ–å¤„ç†æä¾›å™¨**

```cs showLineNumbers
services.AddUnifyProvider<SpeciallyResultProvider>("specially");  // æŒ‡å®šè§„èŒƒåŒ–å”¯ä¸€åç§°ï¼Œå¦‚æœä¸æŒ‡å®šå°±ä¼šæ›¿ä»£é»˜è®¤çš„
```

3. **åœ¨æ§åˆ¶å™¨/åŠ¨æ€ WebAPI ä¸­ä½¿ç”¨**

```cs showLineNumbers {3,8,14}
public class TestUnifyProvider : IDynamicApiController
{
    public string DefaultUnify()
    {
        return "test";
    }

    [UnifyProvider]
    public string DefaultUnify2()
    {
        return "test";
    }

    [UnifyProvider("specially")]
    public string SpeciallyUnify()
    {
        return "ç‰¹åˆ«";
    }
}
```

## 6.9 é’ˆå¯¹ç‰¹å®šæ§åˆ¶å™¨æˆ–ç‰¹å®šæ–¹æ³•é…ç½®åºåˆ—åŒ–é€‰é¡¹

å¾ˆå°‘å¼€å‘è€…æ³¨æ„åˆ° `new JsonResult(data)` å®é™…ä¸Šæœ‰ç¬¬äºŒä¸ªå‚æ•°çš„ï¼Œä¹Ÿå°±æ˜¯ `new JsonResult(data, serializerSettings)`ï¼Œé‚£ä¹ˆå¯ä»¥æ ¹æ®è‡ªå·±çš„é€»è¾‘ä¼ é€’ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¦‚æœä¸ä¼ é€’åˆ™é‡‡ç”¨å…¨å±€é…ç½®çš„åºåˆ—åŒ–é€‰é¡¹ã€‚

`Furion` æ¡†æ¶æä¾›ä¸¤ç§å¤„ç†æ–¹å¼ã€‚

### 6.9.1 é€šè¿‡ `JsonResult` è®¾ç½®ç¬¬äºŒä¸ªå‚æ•°

è¿™ç§æ–¹å¼æ¯”è¾ƒåŸå§‹åŒ–ï¼Œä»£ç æ¯”è¾ƒç¹æ‚ï¼Œä¹Ÿä¸åˆ©äºç»´æŠ¤ã€‚

```cs showLineNumbers {1,4,13-16}
[NonUnify]
public IActionResult SpecialApi()
{
    return new JsonResult(new YourRESTfulResult<object>
    {
        StatusCode = 200,
        Succeeded = true,
        Data = new
        {
            Name = "Furion"
        },
        Timestamp = DateTimeOffset.UtcNow.ToUnixTimeMilliseconds()
    }, new JsonSerializerOptions
    {
        PropertyNamingPolicy = null
    });
}
```

### 6.9.2 æ³¨å†Œå¤šå¥—åºåˆ—åŒ–é…ç½®é€‰é¡¹ **(æ¨è)**

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion 4.6.6 +` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

åœ¨ `Startup.cs` ä¸­æ³¨å†Œä¸€å¥—æ–°çš„è§„åˆ™ï¼š

```cs showLineNumbers {1}
services.AddUnifyJsonOptions("special", new JsonSerializerOptions // å¦‚æœä½¿ç”¨ Newtonsoft.Json => new JsonSerializerSettings
{
    PropertyNamingPolicy = null
});
```

ä»£ç ä½¿ç”¨ï¼š

```cs showLineNumbers {1}
[UnifySerializerSetting("special")]
public object SpecialApi()
{
    return new
    {
      Name = "Furion"
    }
}
```

ä¹Ÿå¯ä»¥æ‰‹åŠ¨è¿”å› `IActionResult` æ–¹å¼ï¼š

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion 4.8.7.1 +` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

```cs showLineNumbers {3,6}
public IActionResult SpecialApi()
{
  return new JsonResult(new
  {
      Name = "Furion"
  }, UnifyContext.GetSerializerSettings("special"));
}
```

:::warning ç‰¹åˆ«æé†’

ç›®å‰ `Swagger` æš‚æœªæä¾›ä¸ªåˆ«çš„æ¥å£è‡ªå®šä¹‰ `schema` åºåˆ—åŒ–é€‰é¡¹ã€‚

:::

## 6.10 åé¦ˆä¸å»ºè®®

:::note ä¸æˆ‘ä»¬äº¤æµ

ç»™ Furion æ [Issue](https://gitee.com/dotnetchina/Furion/issues/new?issue)ã€‚

:::
