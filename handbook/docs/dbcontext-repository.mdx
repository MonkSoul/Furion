---
id: dbcontext-repository
title: 9.5 ä»“å‚¨æ¨¡å¼
sidebar_label: 9.5 ä»“å‚¨æ¨¡å¼ (Repository)
---

import Tag from "@site/src/components/Tag.js";

<details>
  <summary>ğŸ“ æ¨¡å—æ›´æ–°æ—¥å¿—</summary>
  <div>
<div>

- **æ–°ç‰¹æ€§**

  - &nbsp;<Tag>æ–°å¢</Tag> `IRepositoryFactory<TEntity, TDbContextLocator>` ä»“å‚¨åŠŸèƒ½ï¼Œè§£å†³åœ¨ `Blazor` ä¸­ä½¿ç”¨ `EFCore` é—®é¢˜ <sup>4.9.1.1</sup> <sup>â±ï¸2023.11.16</sup> [4285ec0](https://gitee.com/dotnetchina/Furion/commit/4285ec0b8debc2d71c7f978126cb3dc394a8ad30) [æ–‡æ¡£è¯´æ˜](https://learn.microsoft.com/zh-cn/aspnet/core/blazor/blazor-ef-core?view=aspnetcore-7.0)

</div>
  </div>
</details>

## 9.5.1 ä»€ä¹ˆæ˜¯ä»“å‚¨

> åœ¨é¢†åŸŸå±‚å’Œæ•°æ®æ˜ å°„å±‚çš„ä¸­ä»‹,ä½¿ç”¨ç±»ä¼¼é›†åˆçš„æ¥å£æ¥å­˜å–é¢†åŸŸå¯¹è±¡ï¼Œå®é™…ä¸Šï¼Œä»“å‚¨è¢«ç”¨äºé¢†åŸŸå¯¹è±¡åœ¨æ•°æ®åº“ä¸Šçš„æ“ä½œï¼ˆå®ä½“ Entity å’Œå€¼å¯¹è±¡ Value typesï¼‰ã€‚ä¸€èˆ¬æ¥è¯´,æˆ‘ä»¬é’ˆå¯¹ä¸åŒçš„å®ä½“(æˆ–èšåˆæ ¹ Aggregate Root)ä¼šåˆ›å»ºç›¸å¯¹åº”çš„ä»“å‚¨ã€‚

ç®€å•æ¥è¯´ï¼Œä»“å‚¨å°±æ˜¯æ•°æ®å­˜å–æ“ä½œçš„è½½ä½“ï¼Œä½†ä¸é™å®šäºæ•°æ®åº“ã€‚

## 9.5.2 å†…ç½®ä»“å‚¨

`Furion` æ¡†æ¶å†…ç½®äº†ä¸€ä¸ªæ•°æ®åº“æ“ä½œçš„ä»“å‚¨ï¼Œæ–¹ä¾¿å¤§å®¶æ‹“å±•å’Œé›†æˆï¼š

:::info å…³äºä¾èµ–æ³¨å…¥è¯´æ˜

ç›®å‰èƒ½å¤Ÿè¢«ä¾èµ–æ³¨å…¥è§£ææœåŠ¡çš„ä»“å‚¨æœ‰ï¼š

- `IRepository`
- `IRepository<TEntity>`
- `IRepository<TEntity, TDbContextLocator>`
- `ISqlRepository`
- `ISqlRepository<TDbContextLocator>`
- `IMSRepository`
- `IMSRepository<TMasterDbContextLocator>`
- `IMSRepository<TMasterDbContextLocator,...TSlaveDbContextLocator8>`
- `IDbRepository<TDbContextLocator>`

è¿˜æœ‰ä¸¤ä¸ªç§æœ‰ä»“å‚¨ï¼Œä¹Ÿæ˜¯æ‰€æœ‰ä»“å‚¨çš„åŸºç±»ï¼ˆç”¨äºé«˜çº§è‡ªå®šä¹‰å¼€å‘ï¼‰

- `IPrivateRepository<TEntity>`ï¼šæ‰€æœ‰å®ä½“ä»“å‚¨çš„åŸºç±»
- `IPrivateSqlRepository`ï¼šæ‰€æœ‰æ•°æ®åº“æ“ä½œçš„åŸºç±»

é™¤æ­¤ä¹‹åçš„æ‰€æœ‰ä»“å‚¨åªèƒ½é€šè¿‡ `rep.Constraint<TRepository>()` è¿›è¡Œçº¦æŸåˆ›å»ºï¼Œå¦‚ï¼Œåªè¯»ä»“å‚¨ï¼š

```cs showLineNumbers
var readRepository = rep.Constraint<IReadableRepository<TEntity>>();
```

:::

### 9.5.2.1 éæ³›å‹è¶…çº§ä»“å‚¨

- `IRepository`ï¼šé»˜è®¤éæ³›å‹ä»“å‚¨æ¥å£ï¼Œæ”¯æŒåˆ‡æ¢åˆ°ä»»ä½•ä»“å‚¨
- `EFCoreRepository`ï¼šé»˜è®¤éæ³›å‹ä»“å‚¨å®ç°

### 9.5.2.2 æ³›å‹å®ä½“ä»“å‚¨

- `IRepository<TEntity>`ï¼šé»˜è®¤æ•°æ®åº“å®ä½“ä»“å‚¨æ¥å£
- `EFCoreRepository<TEntity>`ï¼šé»˜è®¤æ•°æ®åº“å®ä½“ä»“å‚¨å®ç°

### 9.5.2.3 æ³›å‹å¤šæ•°æ®åº“å®ä½“ä»“å‚¨

- `IRepository<TEntity, TDbContextLocator>`ï¼šä»»æ„æ•°æ®åº“çš„å®ä½“ä»“å‚¨æ¥å£
- `EFCoreRepository<TEntity, TDbContextLocator>`ï¼šä»»æ„æ•°æ®åº“çš„å®ä½“ä»“å‚¨å®ç°

### 9.5.2.4 `Sql` æ“ä½œä»“å‚¨

- `ISqlRepository`ï¼šé»˜è®¤æ•°æ®åº“ `Sql` æ“ä½œä»“å‚¨æ¥å£
- `SqlRepository`ï¼šé»˜è®¤æ•°æ®åº“ `Sql` æ“ä½œä»“å‚¨å®ç°

### 9.5.2.5 å¤šæ•°æ®åº“ `Sql` æ“ä½œä»“å‚¨

- `ISqlRepository<TDbContextLocator>`ï¼šä»»æ„æ•°æ®åº“çš„ `Sql` æ“ä½œä»“å‚¨æ¥å£
- `SqlRepository<TDbContextLocator>`ï¼šä»»æ„æ•°æ®åº“çš„ `Sql` æ“ä½œä»“å‚¨å®ç°

### 9.5.2.6 åªè¯»å®ä½“ä»“å‚¨ï¼ˆæ”¯æŒå¤šåº“ï¼‰

- `IReadableRepository<TEntity>`ï¼šé»˜è®¤æ•°æ®åº“åªè¯»å®ä½“ä»“å‚¨æ¥å£
- `IReadableRepository<TEntity, TDbContextLocator>`ï¼šå¤šæ•°æ®åº“åªè¯»å®ä½“ä»“å‚¨å®ç°

### 9.5.2.7 åªå†™å®ä½“ä»“å‚¨ï¼ˆæ”¯æŒå¤šåº“ï¼‰

- `IWritableRepository<TEntity>`ï¼šé»˜è®¤æ•°æ®åº“åªå†™å®ä½“ä»“å‚¨æ¥å£
- `IWritableRepository<TEntity, TDbContextLocator>`ï¼šå¤šæ•°æ®åº“åªå†™å®ä½“ä»“å‚¨å®ç°

### 9.5.2.8 åªå…è®¸æ–°å¢å®ä½“ä»“å‚¨ï¼ˆæ”¯æŒå¤šåº“ï¼‰

- `IInsertableRepository<TEntity>`ï¼šé»˜è®¤æ•°æ®åº“åªå…è®¸æ–°å¢çš„å®ä½“ä»“å‚¨æ¥å£
- `IInsertableRepository<TEntity, TDbContextLocator>`ï¼šå¤šæ•°æ®åº“åªå…è®¸æ–°å¢çš„å®ä½“ä»“å‚¨å®ç°

### 9.5.2.9 åªå…è®¸æ›´æ–°å®ä½“ä»“å‚¨ï¼ˆæ”¯æŒå¤šåº“ï¼‰

- `IUpdateableRepository<TEntity>`ï¼šé»˜è®¤æ•°æ®åº“åªå…è®¸æ›´æ–°çš„å®ä½“ä»“å‚¨æ¥å£
- `IUpdateableRepository<TEntity, TDbContextLocator>`ï¼šå¤šæ•°æ®åº“åªå…è®¸æ›´æ–°çš„å®ä½“ä»“å‚¨å®ç°

### 9.5.2.10 åªå…è®¸åˆ é™¤å®ä½“ä»“å‚¨ï¼ˆæ”¯æŒå¤šåº“ï¼‰

- `IDeletableRepository<TEntity>`ï¼šé»˜è®¤æ•°æ®åº“åªå…è®¸åˆ é™¤çš„å®ä½“ä»“å‚¨æ¥å£
- `IDeletableRepository<TEntity, TDbContextLocator>`ï¼šå¤šæ•°æ®åº“åªå…è®¸åˆ é™¤çš„å®ä½“ä»“å‚¨å®ç°

### 9.5.2.11 åªå…è®¸æ‹“å±•æ“ä½œå®ä½“ä»“å‚¨ï¼ˆæ”¯æŒå¤šåº“ï¼‰

:::warning åŠŸèƒ½ç§»é™¤å£°æ˜

è¯¥åŠŸèƒ½åœ¨ `Furion 2.5.1 +` ç‰ˆæœ¬ä¸­å·²ç§»é™¤ã€‚æ­¤æ“ä½œè®©å¾ˆå¤šä¸äº†è§£ `EFCore` çš„å¼€å‘è€…äº§ç”Ÿäº†å¾ˆå¤§çš„è¯¯è§£ï¼Œä¸çŸ¥ä½•æ—¶æ–°å¢æˆ–ä½•æ—¶æ›´æ–°ï¼Œæ•…ç§»é™¤æ­¤åŠŸèƒ½ã€‚

:::

- `IOperableRepository<TEntity>`ï¼šé»˜è®¤æ•°æ®åº“åªå…è®¸æ‹“å±•æ“ä½œå®ä½“ä»“å‚¨æ¥å£
- `IOperableRepository<TEntity, TDbContextLocator>`ï¼šå¤šæ•°æ®åº“åªå…è®¸æ‹“å±•æ“ä½œå®ä½“ä»“å‚¨å®ç°

### 9.5.2.12 åªå…è®¸ `Sql` æŸ¥è¯¢ä»“å‚¨ï¼ˆæ”¯æŒå¤šåº“ï¼‰

- `ISqlReaderRepository`ï¼šé»˜è®¤æ•°æ®åº“åªå…è®¸ `Sql` æŸ¥è¯¢ä»“å‚¨æ¥å£
- `ISqlReaderRepository<TDbContextLocator>`ï¼šå¤šæ•°æ®åº“åªå…è®¸ `Sql` æŸ¥è¯¢ä»“å‚¨å®ç°

### 9.5.2.13 åªå…è®¸ `Sql` éæŸ¥è¯¢ä»“å‚¨ï¼ˆæ”¯æŒå¤šåº“ï¼‰

- `ISqlExecutableRepository`ï¼šé»˜è®¤æ•°æ®åº“åªå…è®¸ `Sql` éæŸ¥è¯¢ä»“å‚¨æ¥å£
- `ISqlExecutableRepository<TDbContextLocator>`ï¼šå¤šæ•°æ®åº“åªå…è®¸ `Sql` éæŸ¥è¯¢ä»“å‚¨å®ç°

### 9.5.2.14 è¯»å†™åˆ†ç¦»ä»“å‚¨

- `IMSRepository`ï¼šæœ€å¤šæ”¯æŒ **ä¸€ä¸» 7 ä»** ä»“å‚¨

### 9.5.2.15 å®šä½å™¨ä»“å‚¨

- `IDbRepository<TDbContextLocator>`ï¼šåˆå§‹åŒ–ç‰¹å®šæ•°æ®åº“ä»“å‚¨

### 9.5.2.15 ä»“å‚¨å·¥å‚

- `IRepositoryFactory<TEntity>`ï¼šåˆ›å»ºæ–°çš„æœªé‡Šæ”¾çš„ `IRepository<TEntity>` ä»“å‚¨ï¼Œ`Furion 4.9.1.1+` æ”¯æŒ
- `IRepositoryFactory<TEntity, TDbContextLocator>`ï¼šåˆ›å»ºæ–°çš„æœªé‡Šæ”¾çš„ `IRepository<TEntity, TDbContextLocator>` ä»“å‚¨ï¼Œ`Furion 4.9.1.1+` æ”¯æŒ

## 9.5.3 ä»“å‚¨ä½¿ç”¨

`Furion` æä¾›äº†éå¸¸å¤šçš„æ–¹å¼åˆ›å»ºä»“å‚¨ï¼Œç›®çš„æ˜¯ä¸ºäº†è®©å¤§å®¶å¯ä»¥åœ¨ä¸åŒçš„åœºæ™¯ä¸­ä½¿ç”¨ã€‚

### 9.5.3.1 æ„é€ å‡½æ•°æ³¨å…¥

```cs showLineNumbers  {2}
private readonly IRepository<Person> _personRepository;
public FurionService(IRepository<Person> personRepository)
{
    _personRepository = personRepository;
}
```

### 9.5.3.2 æ–¹æ³•å‚æ•°æ³¨å…¥

```cs showLineNumbers  {1}
public async Task<List<PersonDto>> GetAll([FromServices] IRepository<Person> repository, string keyword)
{
    var persons = await repository.AsQueryable().ToListAsync();
    return persons.Adapt<List<PersonDto>>();
}
```

### 9.5.3.3 `Db.GetRepository` è·å–

```cs showLineNumbers
// éæ³›å‹ä»“å‚¨
var repository = Db.GetRepository();

// æ³›å‹ä»“å‚¨
var repository = Db.GetRepository<Person>();

// Sql ä»“å‚¨
var sqlRepository = Db.GetSqlRepository();
```

:::important ç‰¹åˆ«è¯´æ˜

ä¸ç®¡é‡‡ç”¨å“ªç§æ–¹å¼ï¼Œ`Furion` éƒ½ä¿è¯äº†ä»“å‚¨ä¸€æ¬¡è¯·æ±‚å”¯ä¸€æ€§ã€‚åŒæ—¶ `Db.GetRepository<TEntity>()` æ–¹å¼æ”¯æŒä»»ä½•é™æ€ç±»ä¸­ä½¿ç”¨ã€‚

:::

## 9.5.4 ä»“å‚¨é«˜çº§ç”¨æ³•

### 9.5.4.1 åŠ¨æ€åˆ‡æ¢å®ä½“ä»“å‚¨

```cs showLineNumbers
var userRepository = personRepository.Change<User>();
var userRepository = personRepository.Change<User, MasterDbContextLocator>();   // è¿˜å¯ä»¥åŸºäºå®šä½å™¨åˆ‡æ¢
```

### 9.5.4.2 åŠ¨æ€åˆ‡æ¢ä»“å‚¨ç±»å‹

æ¯”å¦‚ï¼Œè¯»å†™åˆ†ç¦»/ä¸»ä»åº“ä»“å‚¨ï¼š

```cs showLineNumbers
// åªè¯»ä»“å‚¨
var readRepository = personRepository.Constraint<IReadableRepository<User>>();

// åªå†™ä»“å‚¨
var writeRepository = personRepository.Constraint<IWritableRepository<User>>();
```

:::tip å°çŸ¥è¯†

`.Constraint` æ”¯æŒåˆ‡æ¢ä»»ä½•ä»“å‚¨ç±»å‹ã€‚

:::

### 9.5.4.3 è·å– `Sql` æ“ä½œä»“å‚¨

```cs showLineNumbers
var sqlRepository = repository.Sql();
```

## 9.5.5 å¤šæ•°æ®åº“æ“ä½œ

`Furion` é€šè¿‡ `DbContextLocator` æ•°æ®åº“ä¸Šä¸‹æ–‡å®šä½å™¨å®ç°å¤šç§æ•°æ®åº“æ“ä½œï¼Œå¯ä»¥éšæ„åˆ‡æ¢æ•°æ®åº“

### 9.5.5.1 åŠ¨æ€åˆ‡æ¢å¤šä¸ªæ•°æ®åº“

#### åŠ¨æ€åˆ‡æ¢æ•°æ®åº“

```cs showLineNumbers
// åˆ‡æ¢åˆ° MSSQL æ“ä½œ Personè¡¨
var mssqlRepository = repository.Change<Person, MsSqlDbContextLocator>();

// åˆ‡æ¢åˆ° MySql æ“ä½œ Personè¡¨
var mysqlRepository = repository.Change<Person, MySqlDbContextLocator>();

// åˆ‡æ¢åˆ° Sqlite æ“ä½œ Personè¡¨
var sqliteRepository = repository.Change<Person, SqliteDbContextLocator>();

// å…¶ä»–æ›´å¤šæ•°æ®åº“ä¸€æ ·çš„æ“ä½œ
```

#### å¦å¤–ä»»ä½•ä»“å‚¨æˆ–å®ä½“é…ç½®éƒ½æ”¯æŒå¤šä¸ªæ•°æ®åº“åŒæ—¶æ“ä½œ

ä»“å‚¨æ–¹å¼

```cs showLineNumbers
IRepository<Person, MsSqlDbContextLocator> mssqlRepository

ISqlRepository<MsSqlDbContextLocator> mssqlRepository;
```

åŠ¨æ€ `sql` æ–¹å¼

```cs showLineNumbers
"select * from person".Change<MsSqlDbContextLocator>().SqlQuery();
```

å®ä½“é…ç½®æ–¹å¼

```cs showLineNumbers
public class User:Entity<int, MsSqlDbContextLocator, MySqlDbContextLocator>
{
}
```

`Sql` ä»£ç†æ–¹å¼

```cs showLineNumbers
[SqlFunction("funcName", DbContextLocator = typeof(MySqlDbContextLocator))]
int GetAge(int id);
```

`Linq` ä¸­æ–¹å¼

```cs showLineNumbers
[QueryableFunction("funcName","dbo", DbContextLocator = typeof(MySqlDbContextLocator))]
string GetName()=> throw Oops.Oh("ä¸æ”¯æŒè¯¥æ•°æ®åº“æ“ä½œ");
```

## 9.5.6 åœ¨åå°ä»»åŠ¡ä¸­ä½¿ç”¨

ç”±äº `DbContext` é»˜è®¤æ³¨å†Œä¸º `Scoped` ç”Ÿå­˜å‘¨æœŸï¼Œæ‰€ä»¥åœ¨åå°ä»»åŠ¡ä¸­ä½¿ç”¨ `IServiceScopeFactory` è·å–æ‰€æœ‰æœåŠ¡ï¼Œå¦‚ï¼š

```cs showLineNumbers
public class JobService : BackgroundService
{
    // æ—¥å¿—å¯¹è±¡
    private readonly ILogger<JobService> _logger;

    // æœåŠ¡å·¥å‚
    private readonly IServiceScopeFactory _scopeFactory;
    public JobService(ILogger<JobService> logger
        , IServiceScopeFactory scopeFactory)
    {
        _logger = logger;
        _scopeFactory = scopeFactory;
    }

    protected override Task ExecuteAsync(CancellationToken stoppingToken)
    {
        _logger.LogInformation("å†™æ—¥å¿—~~");

        using (var scope = _scopeFactory.CreateScope())
        {
            var services = scope.ServiceProvider;

            // è·å–æ•°æ®åº“ä¸Šä¸‹æ–‡
            var dbContext = Db.GetDbContext(services);

            // è·å–ä»“å‚¨
            var respository = Db.GetRepository<Person>(services);

            // è§£æå…¶ä»–æœåŠ¡
            var otherService = services.GetService<XXX>();
        }

        return Task.CompletedTask;
    }
}
```

:::important æ•°æ®åº“æ“ä½œæ³¨æ„

å¦‚æœä½œç”¨åŸŸä¸­å¯¹**æ•°æ®åº“æœ‰ä»»ä½•å˜æ›´æ“ä½œ**ï¼Œéœ€æ‰‹åŠ¨è°ƒç”¨ `SaveChanges` æˆ–å¸¦ `Now` ç»“å°¾çš„æ–¹æ³•ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ `Scoped.CreateUow(handler)` ä»£æ›¿ã€‚

:::

## 9.5.7 è‡ªå®šä¹‰ä»“å‚¨

æœ‰äº›æ—¶å€™æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä»“å‚¨ï¼Œæ‹“å±•ç°æœ‰çš„ä»“å‚¨åŠŸèƒ½ï¼Œå¯å‚è€ƒä»¥ä¸‹ä»£ç ï¼ˆå«å®šä½å™¨ä»“å‚¨å’Œé»˜è®¤ä»“å‚¨å®ç°ï¼‰

```cs showLineNumbers
/// <summary>
/// è‡ªå®šä¹‰ä»“å‚¨æ¥å£
/// </summary>
/// <typeparam name="TEntity"></typeparam>
/// <typeparam name="TDbContextLocator"></typeparam>
public interface IMyRepository<TEntity, TDbContextLocator> : IPrivateRepository<TEntity>
    where TEntity : class, IPrivateEntity, new()
    where TDbContextLocator : class, IDbContextLocator
{
    /// <summary>
    /// è‡ªå®šä¹‰æ–¹æ³•
    /// </summary>
    void MyMethod();
}

/// <summary>
/// è‡ªå®šä¹‰ä»“å‚¨å®ç°ç±»
/// </summary>
/// <typeparam name="TEntity"></typeparam>
/// <typeparam name="TDbContextLocator"></typeparam>
public class MyRepository<TEntity, TDbContextLocator> : PrivateRepository<TEntity>, IMyRepository<TEntity, TDbContextLocator>, IScoped
    where TEntity : class, IPrivateEntity, new()
    where TDbContextLocator : class, IDbContextLocator
{
    /// <summary>
    /// å®ç°åŸºç±»æ„é€ å‡½æ•°
    /// </summary>
    /// <param name="serviceProvider"></param>
    public MyRepository(IServiceProvider serviceProvider)
        : base(typeof(TDbContextLocator), serviceProvider)
    {
    }

    /// <summary>
    /// è‡ªå®šä¹‰æ–¹æ³•
    /// </summary>
    public void MyMethod()
    {
        throw new System.NotImplementedException();
    }
}

/// <summary>
/// é»˜è®¤æ•°æ®åº“è‡ªå®šä¹‰ä»“å‚¨æ¥å£
/// </summary>
/// <typeparam name="TEntity"></typeparam>
public interface IMyRepository<TEntity> : IMyRepository<TEntity, MasterDbContextLocator>
    where TEntity : class, IPrivateEntity, new()
{
}

/// <summary>
/// é»˜è®¤æ•°æ®åº“è‡ªå®šä¹‰ä»“å‚¨å®ç°
/// </summary>
/// <typeparam name="TEntity"></typeparam>
public class MyRepository<TEntity> : MyRepository<TEntity, MasterDbContextLocator>, IMyRepository<TEntity>, IScoped
    where TEntity : class, IPrivateEntity, new()
{
    public MyRepository(IServiceProvider serviceProvider) : base(serviceProvider)
    {
    }
}
```

## 9.5.8 ä»“å‚¨å·¥å‚ `IRepositoryFactory<TEntity>`

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion 4.9.1.1 +` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›å¯ä»¥é€šè¿‡ç±»å‹ `new` çš„æ–¹å¼åˆ›å»ºä¸€ä¸ª `IRepository<TEntity>` å®ä¾‹ï¼Œç„¶åé€šè¿‡ `using` å®ç°æ‰‹åŠ¨é‡Šæ”¾ï¼Œå¦‚ï¼š

```cs showLineNumbers {5,12,15}
public class YourAppServices : IDynamicApiController
{
    private readonly IRepositoryFactory<Person> _repositoryFactory;

    public YourAppServices(IRepositoryFactory<Person> repositoryFactory)
    {
        _repositoryFactory = repositoryFactory;
    }

    public void Create()
    {
        using var repository = _repositoryFactory.CreateRepository();
        var persons = repository.DetachedEntities.ToList();

        using (var repository2 = _repositoryFactory.CreateRepository())
        {
            var persons2 = repository.DetachedEntities.ToList();
        }

        var persons3 = repository.DetachedEntities.ToList();
    }
}
```

è¿™æ ·çš„åŠŸèƒ½éå¸¸é€‚ç”¨äºå¤šçº¿ç¨‹æˆ–è€… `Blazor` é¡¹ç›®ä¸­ï¼ˆ[ç›¸å…³æ–‡æ¡£](https://learn.microsoft.com/zh-cn/aspnet/core/blazor/blazor-ef-core?view=aspnetcore-7.0)ï¼‰ï¼Œå¦‚ï¼š

```cs showLineNumbers {1,5-6}
@inject IRepositoryFactory<Person> Factory; // å¯ä»¥æ³¨å…¥å¤šä¸ª

private async Task GetListAsync()
{
    // åˆ«å¿˜è®° using
    using var repository = Factory.CreateRepository();  // ä¹Ÿå¯ä»¥é€šè¿‡ using var dbContext = Db.CreateDbContext() è·å–æ–°çš„ DbContext

    var list = await respository.DetachedEntities.ToListAsync();
}
```

## 9.5.9 åé¦ˆä¸å»ºè®®

:::note ä¸æˆ‘ä»¬äº¤æµ

ç»™ Furion æ [Issue](https://gitee.com/dotnetchina/Furion/issues/new?issue)ã€‚

:::
