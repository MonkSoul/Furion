---
id: get-start
title: 2. ä¸€åˆ†é’Ÿå…¥é—¨
sidebar_label: 2. ä¸€åˆ†é’Ÿå…¥é—¨
---

import useBaseUrl from "@docusaurus/useBaseUrl";

## 2.1 Hello Fur

### 2.1.1 åˆ›å»º `FurService` ç±»

è®¾ç½® `Fur.Web.Entry` ä¸ºå¯åŠ¨é¡¹ï¼Œå¹¶åœ¨ `Fur.Application` ä¸­åˆ›å»º `FurService` ç±»ï¼Œå¹¶è¾“å…¥ä»¥ä¸‹å†…å®¹:

```cs {1,5,6,12}
using Fur.DynamicApiController;

namespace Fur.Application
{
    [DynamicApiController] // è¿™é‡Œä½¿ç”¨ç‰¹æ€§æ–¹å¼
    public class FurService /*: IDynamicApiController*/ // ä¹Ÿå¯ä»¥ä½¿ç”¨æ¥å£æ–¹å¼
    {
        /// <summary>
        /// å‘ä¸–ç•Œé—®å¥½
        /// </summary>
        /// <returns></returns>
        public string SayHello()
        {
            return $"Hello {nameof(Fur)}";
        }
    }
}
```

### 2.1.2 åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹æ•ˆæœ

åœ¨ `Fur.Web.Entry` é¡¹ç›®ä¸­é€‰æ‹© `wwwroot` å³é”®é€‰æ‹©åœ¨ `æµè§ˆå™¨ä¸­æŸ¥çœ‹`

<img src={useBaseUrl("img/getstart1.png")} style={{ height: 400 }} />

æ•ˆæœå¦‚ä¸‹ï¼š

<img src={useBaseUrl("img/getstart2.gif")} />

## 2.2 æ·»åŠ æ•°æ®åº“æ”¯æŒ

### 2.2.1 æ·»åŠ  `Person` å®ä½“ç±»

åœ¨ `Fur.Core` ä¸­æ–°å»º `Person` å®ä½“ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š

```cs {1,7}
using Fur.DatabaseAccessor;
using System;
using System.ComponentModel.DataAnnotations;

namespace Fur.Core
{
    public class Person : Entity    // ç»§æ‰¿è‡ª Entity æŠ½è±¡ç±»
    {
        /// <summary>
        /// æ„é€ å‡½æ•°
        /// </summary>
        public Person()
        {
            CreatedTime = DateTime.Now;
            IsDeleted = false;
        }

        /// <summary>
        /// å§“å
        /// </summary>
        [MaxLength(32)]
        public string Name { get; set; }

        /// <summary>
        /// å¹´é¾„
        /// </summary>
        public int Age { get; set; }

        /// <summary>
        /// ä½å€
        /// </summary>
        public string Address { get; set; }
    }
}
```

### 2.2.2 åˆ›å»ºæ•°æ®åº“ä¸Šä¸‹æ–‡

åœ¨ `Fur.EntityFramework.Core` ä¸­æ·»åŠ  `FurDbContext` æ•°æ®åº“ä¸Šä¸‹æ–‡ï¼Œä»£ç å¦‚ä¸‹ï¼š

```cs {1-2,6-7,13}
using Fur.DatabaseAccessor;
using Microsoft.EntityFrameworkCore;

namespace Fur.EntityFramework.Core
{
    [AppDbContext("Data Source=./Fur.db")]   // é…ç½®è¿æ¥å­—ç¬¦ä¸²
    public class FurDbContext : AppDbContext<FurDbContext>  // ç»§æ‰¿ AppDbContext<> ç±»
    {
        /// <summary>
        /// ç»§æ‰¿çˆ¶ç±»æ„é€ å‡½æ•°
        /// </summary>
        /// <param name="options"></param>
        public FurDbContext(DbContextOptions<FurDbContext> options) : base(options)
        {
        }
    }
}
```

### 2.2.3 é…ç½®æ•°æ®åº“ä¸Šä¸‹æ–‡

åœ¨ `Fur.EntityFramework.Core` çš„ `FurEntityFrameworkCoreStartup` ä¸­é…ç½®æ•°æ®åº“ä¸Šä¸‹æ–‡ï¼Œä»£ç å¦‚ä¸‹ï¼š

```cs {11-14} title="Fur\framework\Fur.EntityFramework.Core\FurEntityFrameworkCoreStartup.cs"
using Fur.DatabaseAccessor;
using Microsoft.Extensions.DependencyInjection;

namespace Fur.EntityFramework.Core
{
    [AppStartup(600)]
    public sealed class FurEntityFrameworkCoreStartup : AppStartup
    {
        public void ConfigureServices(IServiceCollection services)
        {
            services.AddDatabaseAccessor(options =>
            {
                options.AddDbPool<FurDbContext>(DbProvider.Sqlite);
            });
        }
    }
}
```

:::important ç‰¹åˆ«è¯´æ˜

`Fur` æ¼”ç¤ºç¤ºä¾‹ä¸­ï¼Œé»˜è®¤å·²ç»åœ¨ `Fur.EntityFramework.Core` å±‚å®‰è£…äº† `Microsoft.EntityFrameworkCore.Sqlite` åŒ…ã€‚

å¦‚æœä½ éœ€è¦å®‰è£…å¯¹åº”çš„æ•°æ®åº“ç‰ˆæœ¬ï¼Œå¯ä»¥æŸ¥é˜… ã€[9.18 å¤šæ•°æ®åº“æ“ä½œ](dbcontext-multi-database)ã€‘ ç« èŠ‚ã€‚

:::

### 2.2.4 é€šè¿‡å‘½ä»¤åˆ›å»ºæ•°æ®åº“è¡¨

æ‰“å¼€ `ç¨‹åºåŒ…ç®¡ç†æ§åˆ¶å°`ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/getstart3.png")} style={{ height: 400 }} />

é€‰æ‹© `é»˜è®¤é¡¹ç›®ä¸º`ï¼š`Fur.Database.Migrations`ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src={useBaseUrl("img/getstart4.png")} />

**è¾“å…¥ä»¥ä¸‹å‘½ä»¤**ï¼š

```
Add-Migration v0.0.1
```

<img src={useBaseUrl("img/getstart5.png")} />

**æäº¤åˆ°æ•°æ®åº“æ›´æ”¹**

```
Update-Database
```

<img src={useBaseUrl("img/getstart6.png")} />

<img src={useBaseUrl("img/getstart7.png")} style={{ height: 400 }} />

## 2.3 å¢åˆ æŸ¥æ”¹åˆ†é¡µä¾‹å­

```cs {14-19}
using Fur.Core;
using Fur.DatabaseAccessor;
using Fur.DynamicApiController;
using Mapster;
using Microsoft.EntityFrameworkCore;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace Fur.Application
{
    [DynamicApiController] // è¿™é‡Œä½¿ç”¨ç‰¹æ€§æ–¹å¼
    public class FurService /*: IDynamicApiController*/ // ä¹Ÿå¯ä»¥ä½¿ç”¨æ¥å£æ–¹å¼
    {
        // åˆå§‹åŒ–ä»“å‚¨
        private readonly IRepository<Person> _personRepository;
        public FurService(IRepository<Person> personRepository)
        {
            _personRepository = personRepository;
        }

        /// <summary>
        /// æ–°å¢ä¸€æ¡
        /// </summary>
        public async Task<int> Insert(PersonDto personDto)
        {
            // å¦‚æœä¸éœ€è¦è¿”å›è‡ªå¢Idï¼Œä½¿ç”¨ InsertAsyncå³å¯
            var newEntity = await _personRepository.InsertNowAsync(personDto.Adapt<Person>());
            return newEntity.Entity.Id;

            // è¿˜å¯ä»¥ç›´æ¥æ“ä½œ
            // await personDto.Adapt<Person>().InsertNowAsync();
        }

        /// <summary>
        /// æ›´æ–°ä¸€æ¡
        /// </summary>
        /// <param name="personDto"></param>
        public async Task Update(PersonDto personDto)
        {
            await _personRepository.UpdateAsync(personDto.Adapt<Person>());

            // è¿˜å¯ä»¥ç›´æ¥æ“ä½œ
            // await personDto.Adapt<Person>().UpdateAsync();
        }

        /// <summary>
        /// åˆ é™¤ä¸€æ¡
        /// </summary>
        /// <param name="id"></param>
        public async Task Delete(int id)
        {
            await _personRepository.DeleteAsync(id);
        }

        /// <summary>
        /// æŸ¥è¯¢ä¸€æ¡
        /// </summary>
        /// <param name="id"></param>
        public async Task<PersonDto> Find(int id)
        {
            var person = await _personRepository.FindAsync(id);
            return person.Adapt<PersonDto>();
        }

        /// <summary>
        /// æŸ¥è¯¢æ‰€æœ‰
        /// </summary>
        /// <returns></returns>
        public async Task<List<PersonDto>> GetAll()
        {
            var persons = await _personRepository.AsAsyncEnumerable();
            return persons.Adapt<List<PersonDto>>();
        }

        /// <summary>
        /// åˆ†é¡µæŸ¥è¯¢
        /// </summary>
        /// <param name="pageIndex"></param>
        /// <param name="pageSize"></param>
        /// <returns></returns>
        public async Task<PagedList<PersonDto>> GetAllByPage(int pageIndex = 1, int pageSize = 10)
        {
            var pageResult = await _personRepository.AsQueryable().ToPagedListAsync(pageIndex, pageSize);
            return pageResult.Adapt<PagedList<PersonDto>>();
        }
    }
}
```

<img src={useBaseUrl("img/getstart8.gif")} />

### é™„ä¸Š `PersonDto`

```cs
using System.ComponentModel.DataAnnotations;

namespace Fur.Application
{
    public class PersonDto
    {
        /// <summary>
        /// Id
        /// </summary>
        public int? Id { get; set; }

        /// <summary>
        /// å§“å
        /// </summary>
        [StringLength(32, MinimumLength = 2)]
        public string Name { get; set; }

        /// <summary>
        /// å¹´é¾„
        /// </summary>
        public int Age { get; set; }
    }
}
```

è¯´å¥½ä¸€åˆ†é’Ÿå…¥é—¨ï¼Œä½ ä»¬ç”¨äº†å¤šé•¿æ—¶é—´ã€‚ğŸ˜
