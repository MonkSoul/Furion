---
id: clayobj
title: 29. ç²˜åœŸå¯¹è±¡
sidebar_label: 29. ç²˜åœŸå¯¹è±¡
---

import Tag from "@site/src/components/Tag.js";

<details>
  <summary>ğŸ“ æ¨¡å—æ›´æ–°æ—¥å¿—</summary>
  <div>
<div>

- **æ–°ç‰¹æ€§**

  - &nbsp;<Tag>æ–°å¢</Tag> ç²˜åœŸå¯¹è±¡ `.ConvertTo` æ”¯æŒè‡ªå®šä¹‰å€¼æä¾›å™¨ <sup>4.8.8.40</sup> <sup>â±ï¸2023.08.03</sup> [70d5888](https://gitee.com/dotnetchina/Furion/commit/70d58888b3cec88c5c2a8458654dca1881e2a88b)
  - &nbsp;<Tag>æ–°å¢</Tag> ç²˜åœŸå¯¹è±¡æ”¯æŒç»“æ„ `struct` å¯¹è±¡ç±»å‹ <sup>4.8.8.7</sup> <sup>â±ï¸2023.04.30</sup> [a0fa3aa](https://gitee.com/dotnetchina/Furion/commit/a0fa3aa7ae536e948740401b510d99cf45e251dc)
  - &nbsp;<Tag>æ–°å¢</Tag> ç²˜åœŸå¯¹è±¡å¯åå°„è½¬æ¢æˆç‰¹å®š `IEnumerable<T>` ç±»å‹ï¼š`clay.ConverTo<T>()` <sup>4.8.8</sup> <sup>â±ï¸2023.04.13</sup> [5d54a65](https://gitee.com/dotnetchina/Furion/commit/5d54a6579be3d710649bb199dd985f60acaf9787)
  - &nbsp;<Tag>æ–°å¢</Tag> **ç²˜åœŸå¯¹è±¡å¯é…ç½®è®¿é—®ä¸å­˜åœ¨ `Key` æ—¶æ˜¯æŠ›å¼‚å¸¸è¿˜æ˜¯è¿”å› `null`** <sup>4.8.7.40</sup> <sup>â±ï¸2023.04.10</sup> [e994d53](https://gitee.com/dotnetchina/Furion/commit/e994d53b64a825461673f48960df1716be44f192)
  - &nbsp;<Tag>æ–°å¢</Tag> **ç²˜åœŸå¯¹è±¡å¯è½¬æ¢æˆ `IEnumerable<T>` å¯¹è±¡å¹¶å®ç° `Lambda/Linq` æ“ä½œ** <sup>4.8.7.19</sup> <sup>â±ï¸2023.03.22</sup> [2b14ed9](https://gitee.com/dotnetchina/Furion/commit/2b14ed9da03699619b1fade6e053f65b77a5b0fe)

<details style={{ marginLeft: 50 }}>
  <summary>æŸ¥çœ‹å˜åŒ–</summary>
  <div>

```cs showLineNumbers {3-4,6-12}
dynamic clay = Clay.Parse("{\"Foo\":\"json\",\"Bar\":100,\"Nest\":{\"Foobar\":true},\"Arr\":[\"NOR\",\"XOR\"]}");

// å°† clay.Arr è½¬æ¢æˆ IEnumerable<dynamic>
IEnumerable<dynamic> query = clay.Arr.AsEnumerator<dynamic>();

// å®ç° Lambda/Linq æ“ä½œ
var result = query.Where(u => u.StartsWith("N"))
                  .Select(u => new
                  {
                      Name = u
                  })
                  .ToList();
```

  </div>
</details>

- - &nbsp;<Tag>æ–°å¢</Tag> ç²˜åœŸå¯¹è±¡æ”¯æŒä»»ä½•å­—ç¬¦ä½œä¸º `JSON/XML` é”® <sup>4.8.6.9</sup> <sup>â±ï¸2023.02.19</sup> [f99aee8](https://gitee.com/dotnetchina/Furion/commit/f99aee8dafddf3cfd148922166abd3998e8eb087) [#note_16329657](https://gitee.com/dotnetchina/Furion/commit/4961e01486f604db12a8d8d71f9bd563ed7d7d48#note_16329657)

- **é—®é¢˜ä¿®å¤**

  - &nbsp;<Tag>ä¿®å¤</Tag> ç²˜åœŸå¯¹è±¡ä¸æ”¯æŒæšä¸¾ç±»å‹é—®é¢˜ <sup>4.8.8.41</sup> <sup>â±ï¸2023.08.25</sup> [#I7VDDL](https://gitee.com/dotnetchina/Furion/issues/I7VDDL)
  - &nbsp;<Tag>ä¿®å¤</Tag> `ExpandoObject.ToDictionary()` è½¬æ¢å¼‚å¸¸ <sup>4.8.8.25</sup> <sup>â±ï¸2023.06.14</sup> [#I7BY0P](https://gitee.com/dotnetchina/Furion/issues/I7BY0P)
  - &nbsp;<Tag>ä¿®å¤</Tag> ç²˜åœŸå¯¹è±¡è½¬æ¢ä¸º `Dictionary<string, object>` ç±»å‹å¼‚å¸¸ <sup>4.8.7.41</sup> <sup>â±ï¸2023.04.11</sup> [f96baeb](https://gitee.com/dotnetchina/Furion/commit/f96baebbb06b53fc481ea7925cbbfbcb191f9c10)
  - &nbsp;<Tag>ä¿®å¤</Tag> ç²˜åœŸå¯¹è±¡ä¸æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€è®¾ç½®æºå¸¦ç‰¹æ®Šå­—ç¬¦çš„ `Key` é”® <sup>4.8.7.39</sup> <sup>â±ï¸2023.04.10</sup> [6572515](https://gitee.com/dotnetchina/Furion/commit/6572515abbd93c4572cc513da4dd5aa497d144d2)
  - &nbsp;<Tag>ä¿®å¤</Tag> ç²˜åœŸå¯¹è±¡éå†å¯¹è±¡é”®å€¼å¯¹å›  `4.8.7.19` ç‰ˆæœ¬æ›´æ–°å¯¼è‡´å¼‚å¸¸ <sup>4.8.7.25</sup> <sup>â±ï¸2023.03.28</sup> [#I6R4ZU](https://gitee.com/dotnetchina/Furion/issues/I6R4ZU)
  - &nbsp;<Tag>ä¿®å¤</Tag> ç²˜åœŸå¯¹è±¡ä¸æ”¯æŒ `æ•°å­—` ä½œä¸º `JSON/XML` é”®é—®é¢˜ <sup>4.8.6.9</sup> <sup>â±ï¸2023.02.19</sup> [#note_16329657](https://gitee.com/dotnetchina/Furion/commit/4961e01486f604db12a8d8d71f9bd563ed7d7d48#note_16329657)
  - &nbsp;<Tag>ä¿®å¤</Tag> ç²˜åœŸå¯¹è±¡ä¸æ”¯æŒ `ä¸­æ–‡` ä½œä¸º `JSON/XML` é”®é—®é¢˜ <sup>4.8.6.6</sup> <sup>â±ï¸2023.02.18</sup> [4961e01](https://gitee.com/dotnetchina/Furion/commit/4961e01486f604db12a8d8d71f9bd563ed7d7d48)

- **å…¶ä»–æ›´æ”¹**

  - &nbsp;<Tag>è°ƒæ•´</Tag> ç²˜åœŸå¯¹è±¡ `number` ç±»å‹å¤„ç†ï¼Œè‹¥å« `.` è½¬ `double` ç±»å‹ï¼Œå¦åˆ™è½¬ `long` ç±»å‹ <sup>4.8.7.24</sup> <sup>â±ï¸2023.03.28</sup> [e82e883](https://gitee.com/dotnetchina/Furion/commit/e82e883d54282b749390ae5e93df8c3e7acaa97e)

</div>
  </div>
</details>

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion 2.1.12 +` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

## 29.1 å…³äºç²˜åœŸå¯¹è±¡

ç²˜åœŸå¯¹è±¡æ˜¯ `Furion` æ¡†æ¶æ¨å‡ºçš„ä¸€ç§åŠ¨æ€ç±»å‹ï¼Œå¯ä»¥æ¨¡æ‹Ÿå¼±ï¼ˆåŠ¨æ€ï¼‰è¯­è¨€æ“ä½œç‰¹æ€§ï¼Œä½¿ C# å¯¹è±¡å®ç°ç±»ä¼¼ `JavaScript` ä¸€æ ·æ“ä½œå¯¹è±¡ã€‚åªéœ€é€šè¿‡ `Clay` ç±»åˆå§‹åŒ–å³å¯ã€‚

**ä¸ºä»€ä¹ˆèµ·åä¸º â€œç²˜åœŸâ€ å‘¢ï¼Ÿå› ä¸ºè¿™ä¸ªå¯¹è±¡å¯ä»¥è‡ªç”±çš„æ·»åŠ å±æ€§ï¼Œç§»é™¤å±æ€§ï¼Œåˆå¯ä»¥å›ºåŒ–æˆä»»ä½•å¯¹è±¡ï¼Œå…·æœ‰å¯æ‹“å±•ã€å¯å¡‘é€ çš„ç‰¹ç‚¹ã€‚**

### 29.1.1 ä½¿ç”¨åœºæ™¯

ç²˜åœŸå¯¹è±¡å¸¸ç”¨äºéœ€è¦åŠ¨æ€æ„å»ºå¯¹è±¡çš„åœ°æ–¹ï¼Œå¦‚ `CMS` ç³»ç»Ÿçš„ `ViewModel`ï¼Œæˆ–è€…è¿è¡Œæ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæˆ–è€…è¯·æ±‚ç¬¬ä¸‰æ–¹ `API` æƒ…å†µã€‚

### 29.1.2 å…³äºæ€§èƒ½

ç²˜åœŸæ€§èƒ½å®é™…ä¸Šå¹¶ä¸é«˜æ•ˆï¼Œä½†æ˜¯æ€§èƒ½ä¹Ÿå¹¶ä¸ä½ä¸‹ï¼Œåªä¸è¿‡ç•¥è¾“äºå¼ºç±»å‹è°ƒç”¨ã€‚ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å¯ä»¥çœ‹ä»¥ä¸Šçš„ã€ä½¿ç”¨åœºæ™¯ã€‘ã€‚

## 29.2 `Clay` å¯¹è±¡

`Clay` å¯¹è±¡æ˜¯ç»§æ‰¿è‡ª `DynamicObject` çš„ä¸€ä¸ªç‰¹æ®Šå¯¹è±¡ï¼Œæä¾›äº†åƒå¼±ï¼ˆåŠ¨æ€ï¼‰è¯­è¨€ä¸€æ ·æ“ä½œå¯¹è±¡çš„æ–¹æ³•åŠç´¢å¼•è·å–æ–¹å¼ã€‚

## 29.3 å¦‚ä½•ä½¿ç”¨

### 29.3.1 åˆ›å»ºä¸€ä¸ªå¯¹è±¡

```cs showLineNumbers {2,5,8}
// åˆ›å»ºä¸€ä¸ªç©ºçš„ç²˜åœŸå¯¹è±¡
dynamic clay = new Clay();

// ä»ç°æœ‰çš„å¯¹è±¡åˆ›å»º
dynamic clay2 = Clay.Object(new {});

// ä» json å­—ç¬¦ä¸²åˆ›å»ºï¼Œå¯ç”¨äºç¬¬ä¸‰æ–¹ API å¯¹æ¥ï¼Œéå¸¸æœ‰ç”¨
dynamic clay3 = Clay.Parse(@"{""foo"":""json"", ""bar"":100, ""nest"":{ ""foobar"":true } }");
```

### 29.3.2 è¯»å–/è·å–å±æ€§

```cs showLineNumbers {1,11-14}
dynamic clay = Clay.Object(new
{
    Foo = "json",
    Bar = 100,
    Nest = new
    {
        Foobar = true
    }
});

var r1 = clay.Foo; // "json" - stringç±»å‹
var r2 = clay.Bar; // 100 - doubleç±»å‹
var r3 = clay.Nest.Foobar; // true - boolç±»å‹
var r4 = clay["Nest"]["Foobar"]; // è¿˜å¯ä»¥å’Œ JavaScript ä¸€æ ·é€šè¿‡ç´¢å¼•å™¨è·å–
```

### 29.3.3 æ–°å¢å±æ€§

```cs showLineNumbers {1,12-14}
dynamic clay = Clay.Object(new
{
    Foo = "json",
    Bar = 100,
    Nest = new
    {
        Foobar = true
    }
});

// æ–°å¢
clay.Arr = new string[] { "NOR", "XOR" }; // æ·»åŠ ä¸€ä¸ªæ•°ç»„
clay.Obj1 = new City { }; // æ–°å¢ä¸€ä¸ªå®ä¾‹å¯¹è±¡
clay.Obj2 = new { Foo = "abc", Bar = 100 }; // æ–°å¢ä¸€ä¸ªåŒ¿åç±»
```

### 29.3.4 æ›´æ–°å±æ€§å€¼

```cs showLineNumbers {1,12-14}
dynamic clay = Clay.Object(new
{
    Foo = "json",
    Bar = 100,
    Nest = new
    {
        Foobar = true
    }
});

// æ›´æ–°
clay.Foo = "Furion";
clay["Nest"].Foobar = false;
clay.Nest["Foobar"] = true;
```

### 29.3.5 åˆ é™¤å±æ€§

```cs showLineNumbers {1,13-16}
dynamic clay = Clay.Object(new
{
    Foo = "json",
    Bar = 100,
    Nest = new
    {
        Foobar = true
    },
    Arr = new string[] { "NOR", "XOR" }
});

// åˆ é™¤æ“ä½œ
clay.Delete("Foo"); // é€šè¿‡ Delete æ–¹æ³•åˆ é™¤
clay.Arr.Delete(0); // æ”¯æŒæ•°ç»„ Delete ç´¢å¼•åˆ é™¤
clay("Bar");    // æ”¯æŒç›´æ¥é€šè¿‡å¯¹è±¡ä½œä¸ºæ–¹æ³•åˆ é™¤
clay.Arr(1);    // æ”¯æŒæ•°ç»„ä½œä¸ºæ–¹æ³•åˆ é™¤
```

### 29.3.6 åˆ¤æ–­é”®/ç´¢å¼•æ˜¯å¦å­˜åœ¨

```cs showLineNumbers {1,13-18}
dynamic clay = Clay.Object(new
{
    Foo = "json",
    Bar = 100,
    Nest = new
    {
        Foobar = true
    },
    Arr = new string[] { "NOR", "XOR" }
});

// åˆ¤æ–­å±æ€§æ˜¯å¦å­˜åœ¨
var a = clay.IsDefined("Foo"); // true
var b = clay.IsDefined("Foooo"); // false
var c = clay.Foo(); // true
var d = clay.Foooo(); // false;
var e = clay.Arr.IsDefined(0);  // true
var f = clay.Arr.IsDefined(3);  // false
```

### 29.3.7 éå†å¯¹è±¡

```cs showLineNumbers {12,18,24,33,36}
dynamic clay = Clay.Object(new
{
    Foo = "json",
    Bar = 100,
    Nest = new
    {
        Foobar = true
    },
    Arr = new string[] { "NOR", "XOR" }
});

// éå†æ•°ç»„
foreach (string item in clay.Arr)
{
    Console.WriteLine(item); // NOR, XOR
}

// éå†æ•´ä¸ªå¯¹è±¡å±æ€§åŠå€¼ï¼Œç±»ä¼¼ JavaScript çš„ for (var p in obj)
foreach (KeyValuePair<string, dynamic> item in clay)
{
    Console.WriteLine(item.Key + ":" + item.Value); // Foo:json, Bar: 100, Nest: { "Foobar":true}, Arr:["NOR","XOR"]
}

// æ•°ç»„/é›†åˆ å¯ä½¿ç”¨ Lambda æ–¹å¼ï¼ŒFurion 4.8.7.19+ æ”¯æŒ
IEnumerable<dynamic> query = clay.Arr.AsEnumerator<dynamic>();   // é€šè¿‡ .AsEnumerator<T>() è½¬æ¢æˆ IEnumerable<T> ç±»å‹
var result = query.Where(u => u.StartsWith("N"))
                  .Select(u => new
                  {
                      Name = u
                  })
                  .ToList();

// ä¹Ÿå¯ä»¥é€šè¿‡åŸç”Ÿæ–¹æ³•è½¬æ¢æˆ IEnumerable å¯¹è±¡
IEnumerable<dynamic> query = ((System.Collections.IEnumerable)clay.Arr).Cast<dynamic>();   // å…¶ä¸­ Cast<T> çš„ T å¯ä»¥æ—¶ä»»æ„ç±»å‹ï¼Œæ¯”å¦‚ Cast<string>();

// è·å–å¯¹è±¡æ‰€æœ‰é”®æˆ–æ•°ç»„æ‰€æœ‰ç´¢å¼•
IEnumerable<string> keys = clay.GetDynamicMemberNames();
```

### 29.3.8 è½¬æ¢æˆå…·ä½“å¯¹è±¡

```cs showLineNumbers {5-7,11-13}
dynamic clay = new Clay();
clay.Arr = new string[] { "Furion", "Fur" };

// æ•°ç»„è½¬æ¢ç¤ºä¾‹
var a1 = clay.Arr.Deserialize<string[]>(); // é€šè¿‡ Deserialize æ–¹æ³•
var a2 = (string[])clay.Arr;    // å¼ºåˆ¶è½¬æ¢
string[] a3 = clay.Arr; // å£°æ˜æ–¹å¼

// å¯¹è±¡è½¬æ¢ç¤ºä¾‹
clay.City = new City { Id = 1, Name = "ä¸­å±±å¸‚" };
var c1 = clay.City.Deserialize<City>(); // é€šè¿‡ Deserialize æ–¹æ³•
var c2 = (City)clay.City;    // å¼ºåˆ¶è½¬æ¢
City c3 = clay.City; // å£°æ˜æ–¹å¼
```

### 29.3.9 å›ºåŒ–ç²˜åœŸ

å›ºåŒ–ç²˜åœŸåœ¨å¾ˆå¤šæ—¶å€™å’Œåºåˆ—åŒ–å¾ˆåƒï¼Œä½†æ˜¯å¦‚æœç›´æ¥è°ƒç”¨ `Deserialize<object>` æˆ– `Deserialize<dynamic>` æ— æ³•è¿”å›å®é™…ç±»å‹ï¼Œæ‰€ä»¥å°±æœ‰äº†å›ºåŒ–ç±»å‹çš„åŠŸèƒ½ï¼Œå¦‚ï¼š

```cs showLineNumbers {2,5,8}
// è¿”å› object
var obj = clay.Solidify();

// è¿”å› dynamic
var obj1 = clay.Solidify<dynamic>();

// è¿”å›å…¶ä»–ä»»æ„ç±»å‹
var obj2 = clay.Solidify<City>();
```

### 29.3.10 è¾“å‡º `JSON`

```cs showLineNumbers {1,13}
dynamic clay = Clay.Object(new
{
    Foo = "json",
    Bar = 100,
    Nest = new
    {
        Foobar = true
    },
    Arr = new string[] { "NOR", "XOR" }
});

// è¾“å‡º JSON
var json = clay.ToString(); // "{\"Foo\":\"json\",\"Bar\":100,\"Nest\":{\"Foobar\":true},\"Arr\":[\"NOR\",\"XOR\"]}"
```

:::tip `Clay` åºåˆ—åŒ–æˆ `JSON` é”®å¤§å°å†™æ§åˆ¶

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Clay` è¾“å‡ºæˆ `JSON` åå°†ä¿æŒåŸæ ·è¾“å‡ºï¼Œå¦‚æœéœ€è¦å®ç°é”®å‘½åæ§åˆ¶ï¼Œåˆ™éœ€è¦å…ˆè½¬æ¢æˆ `Dictionary` ç„¶åå†é…ç½® `AddJsonOptions` æœåŠ¡ï¼Œå¦‚ï¼š

```cs showLineNumbers {8-9}
public IActionResult OutputClay()
{
    dynamic clay = Clay.Object(new
    {
       // ....
    });

    // è½¬æ¢æˆ dictionary
    var dic = clay.ToDictionary();

    return new JsonResult(dic);
}
```

é…ç½®åºåˆ—åŒ– `Dictionary` é”®å‘½åç­–ç•¥æ”¯æŒï¼š

```cs showLineNumbers {2,4}
services.AddControllers()
        .AddJsonOptions(options =>
         {
            options.JsonSerializerOptions.DictionaryKeyPolicy = JsonNamingPolicy.CamelCase;    // é…ç½® Dictionary ç±»å‹åºåˆ—åŒ–è¾“å‡º
         });
```

:::

### 29.3.11 è¾“å‡º `XML` å¯¹è±¡

```cs showLineNumbers {1,13}
dynamic clay = Clay.Object(new
{
    Foo = "json",
    Bar = 100,
    Nest = new
    {
        Foobar = true
    },
    Arr = new string[] { "NOR", "XOR" }
});

// è¾“å‡º XElement
var xml = clay.XmlElement;
```

### 29.3.12 å…³é”®å­—å¤„ç†

```cs showLineNumbers {2-3}
dynamic clay = new Clay();
clay.@int = 1;
clay.@event = "äº‹ä»¶";
```

### 29.3.13 è½¬æ¢æˆå­—å…¸ç±»å‹

```cs showLineNumbers {3}
dynamic clay = Clay.Object(new { name = "å¼ ä¸‰" });
clay.name = "ç™¾å°åƒ§";
Dictionary<string, object> parms = clay.ToDictionary();
```

### 29.3.14 è·å–ä¸å­˜åœ¨ `Key` å¤„ç†

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion 4.8.7.40 +` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœé€šè¿‡ç²˜åœŸå¯¹è±¡è·å–ä¸å­˜åœ¨çš„å€¼ä¼šæŠ›å‡º `Microsoft.CSharp.RuntimeBinder.RuntimeBinderException` å¼‚å¸¸ï¼Œå¦‚ï¼š

```cs showLineNumbers {12}
dynamic clay = Clay.Object(new
{
    Foo = "json",
    Bar = 100,
    Nest = new
    {
        Foobar = true
    }
});

// è·å–ä¸å­˜åœ¨çš„å€¼
var undefined = clay["undefined"];  // æŠ›å‡º Microsoft.CSharp.RuntimeBinder.RuntimeBinderException å¼‚å¸¸
```

è¿™æ—¶æˆ‘ä»¬å¯ä»¥é…ç½®ç²˜åœŸå¯¹è±¡çš„ `ThrowOnUndefined` å±æ€§è¡Œä¸ºï¼Œ**é…ç½® `true` æ—¶è·å–ä¸å­˜åœ¨çš„ `Key` æŠ›å¼‚å¸¸ï¼Œ`false` è¡¨ç¤ºè¿”å› `null`**ã€‚å¦‚ï¼š

```cs showLineNumbers {1,10,12,14,25-27,29,40-41,43-46}
// æ–¹å¼ä¸€ï¼Œåˆå§‹åŒ–æŒ‡å®š throwOnUndefined: falseï¼Œæ‰€æœ‰æ„é€ å‡½æ•°å’Œé™æ€åˆå§‹åŒ–æ–¹æ³•éƒ½æœ‰è¯¥å‚æ•°
dynamic clay = Clay.Object(new
{
    Foo = "json",
    Bar = 100,
    Nest = new
    {
        Foobar = true
    }
}, throwOnUndefined: false);

var undefined = clay.Undefined; // => null

// æ–¹å¼äºŒï¼Œæ“ä½œæ—¶æŒ‡å®šï¼Œè®¾ç½® ThrowOnUndefined å±æ€§
dynamic clay = Clay.Object(new
{
    Foo = "json",
    Bar = 100,
    Nest = new
    {
        Foobar = true
    }
});

var undefined = clay.Undefined; // æŠ›å‡º Microsoft.CSharp.RuntimeBinder.RuntimeBinderExceptionnull
clay.ThrowOnUndefined = false;
var undefined = clay.Undefined; // => null

// æ–¹å¼ä¸‰ï¼Œåªé…ç½®å±€éƒ¨å¯¹è±¡
dynamic clay = Clay.Object(new
{
    Foo = "json",
    Bar = 100,
    Nest = new
    {
        Foobar = true
    }
});

var undefined = clay.Undefined; // æŠ›å‡º Microsoft.CSharp.RuntimeBinder.RuntimeBinderException
var bar = clay.Nest.Bar;    // æŠ›å‡º Microsoft.CSharp.RuntimeBinder.RuntimeBinderException

// è®¾ç½® Nest èŠ‚ç‚¹ä¸æŠ›å¼‚å¸¸
clay.Nest.ThrowOnUndefined = false;
var undefined = clay.Undefined; // æŠ›å‡º Microsoft.CSharp.RuntimeBinder.RuntimeBinderException
var bar = clay.Nest.Bar; // => null
```

### 29.3.15 è½¬æ¢ä¸ºç‰¹å®šé›†åˆ

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion 4.8.8 +` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

```cs showLineNumbers {2}
dynamic clay = Clay.Parse(@"[]");
IEnumerable<SysMenu> data = clay.ConvertTo<SysMenu>();
```

è¿™ç§æ–¹å¼åŒºåˆ«äº `.Solidify<T>`ï¼Œ`ConvertTo<T>` å†…éƒ¨é€šè¿‡åå°„åˆ›å»ºå¯¹è±¡å¹¶è‡ªåŠ¨é€‚é…å±æ€§ç±»å‹ã€‚

å¦å¤–åœ¨ `Furion 4.8.8.40+` ç‰ˆæœ¬æä¾›äº† `ConvertTo` è‡ªå®šä¹‰å€¼å‚æ•°ï¼Œå¯ä»¥é’ˆå¯¹ç‰¹å®šå±æ€§è¿›è¡Œé¢å¤–å¤„ç†ï¼Œå¦‚ï¼š

```cs showLineNumbers {1,4-7,12}
Func<PropertyInfo, object, object> valueProvider = (property, oldValue) =>
{
    // ä¾‹å¦‚é’ˆå¯¹å±æ€§åä¸º Device çš„è¿›è¡Œé¢å¤–å¤„ç†
    if (property.Name == "Device")
    {
        return JsonSerializer.Deserialize<Device>(oldValue.ToString());
    }

    return oldValue;
};

IEnumerable<SysMenu> data = clay.ConvertTo<SysMenu>(valueProvider);
```

## 29.4 åºåˆ—åŒ–æ”¯æŒ

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Clay` ä¸ºåŠ¨æ€ç±»å‹å¯¹è±¡ï¼Œä¸æ”¯æŒç›´æ¥é€šè¿‡ `System.Text.Json` å’Œ `Newtonsoft.Json` è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œè¿™æ—¶åªéœ€æ·»åŠ ä»¥ä¸‹é…ç½®å³å¯ã€‚

- `System.Text.Json` æ–¹å¼

```cs showLineNumbers {2,4}
services.AddControllersWithViews()
        .AddJsonOptions(options =>
        {
            options.JsonSerializerOptions.Converters.AddClayConverters();
        });
```

- `Newtonsoft.Json` æ–¹å¼

```cs showLineNumbers {3}
.AddNewtonsoftJson(options =>
{
     options.SerializerSettings.Converters.AddClayConverters();
})
```

## 29.5 åé¦ˆä¸å»ºè®®

:::note ä¸æˆ‘ä»¬äº¤æµ

ç»™ Furion æ [Issue](https://gitee.com/dotnetchina/Furion/issues/new?issue)ã€‚

:::
