---
id: encryption
title: 20. æ•°æ®åŠ è§£å¯†
sidebar_label: 20. æ•°æ®åŠ è§£å¯†
---

import Tag from "@site/src/components/Tag.js";

<details>
  <summary>ğŸ“ æ¨¡å—æ›´æ–°æ—¥å¿—</summary>
  <div>
<div>

- **æ–°ç‰¹æ€§**

  - &nbsp;<Tag>æ–°å¢</Tag> `AES` æ”¯æŒå¯¹æ–‡ä»¶ï¼ˆå«è¶…å¤§æ–‡ä»¶ï¼‰è¿›è¡ŒåŠ è§£å¯† <sup>4.8.8.11</sup> <sup>â±ï¸2023.05.05</sup> [1d2265b](https://gitee.com/dotnetchina/Furion/commit/1d2265be04cfd7c6c2b9db932a77ebd620ef6054)
  - &nbsp;<Tag>æ–°å¢</Tag> `RSA` æ”¯æŒå¯¹è¶…é•¿å­—ç¬¦ï¼ˆè¶… `245` ä½ï¼‰è¿›è¡Œåˆ†æ®µåŠ è§£å¯† <sup>4.8.8.2</sup> <sup>â±ï¸2023.04.19</sup> [!788](https://gitee.com/dotnetchina/Furion/pulls/788) æ„Ÿè°¢ [@YaChengMu](https://gitee.com/YaChengMu)
  - &nbsp;<Tag>æ–°å¢</Tag> `byte[]` ç±»å‹ `MD5` åŠ å¯†/æ¯”è¾ƒé‡è½½æ–¹æ³• <sup>4.8.6.3</sup> <sup>â±ï¸2023.02.15</sup> [#I6F1NT](https://gitee.com/dotnetchina/Furion/issues/I6F1NT)

</div>
  </div>
</details>

## 20.1 æ•°æ®åŠ è§£å¯†

ç”±äºç°åœ¨çš„äº’è”ç½‘è¶Šå…·å‘è¾¾ï¼Œæ•°æ®æˆä¸ºäº†æˆ‘ä»¬ç”Ÿæ´»çš„ä¸€éƒ¨åˆ†ï¼Œå½“ç„¶ä¹Ÿå¸¦æ¥äº†å¾ˆå¤šæ•°æ®å®‰å…¨æ€§çš„é—®é¢˜ï¼Œæ¯”å¦‚ç”¨æˆ·å¯†ç æ˜æ–‡å­˜å‚¨ï¼Œç”¨æˆ·ä¿¡æ¯æ˜æ–‡å­˜åœ¨åœ¨æµè§ˆå™¨ `cookies` ä¸­ç­‰ç­‰ä¸å®‰å…¨æ“ä½œã€‚

æ‰€ä»¥ï¼Œå¯¹æ•°æ®çš„åŠ è§£å¯†æ˜¯ç³»ç»Ÿå¼€å‘å¿…è¦çš„ç¯èŠ‚ã€‚

## 20.2 å†…ç½®åŠ å¯†ç®—æ³•

- `MD5` åŠ å¯†
- `DESC` åŠ è§£å¯†
- `AES` åŠ è§£å¯†
- `JWT` åŠ è§£å¯†
- `PBKDF2` åŠ å¯†ï¼ˆ`Furion v2.12 +` ç‰ˆæœ¬å·²ç§»é™¤ï¼‰
- `RSA` åŠ è§£å¯†

## 20.3 åŠ è§£å¯†ä½¿ç”¨

### 20.3.1 `MD5` åŠ å¯†

```cs showLineNumbers
// æµ‹è¯• MD5 åŠ å¯†ï¼Œæ¯”è¾ƒ
var md5Hash = MD5Encryption.Encrypt("ç™¾å°åƒ§");  // åŠ å¯†
var isEqual = MD5Encryption.Compare("ç™¾å°åƒ§", md5Hash); // æ¯”è¾ƒ
return (md5Hash, isEqual);

// è¾“å‡ºå¤§å†™ MD5 åŠ å¯†
var md5Hash = MD5Encryption.Encrypt("ç™¾å°åƒ§", true);

// è¾“å‡º 16ä½ MD5 åŠ å¯†ï¼ŒFurion 4.2.6+ ç‰ˆæœ¬
var md5Hash16 = MD5Encryption.Encrypt("ç™¾å°åƒ§", is16: true);

// Furion 4.8.6.3+ ç‰ˆæœ¬æ”¯æŒ byte[] ç±»å‹ï¼Œå¦‚è·å–æ–‡ä»¶ MD5 Hash
var bytes = File.ReadAllBytes("image.png");
var md5Hash = MD5Encryption.Encrypt(bytes); // åŠ å¯†
var isEqual = MD5Encryption.Compare(bytes, md5Hash);  // æ¯”è¾ƒ
```

### 20.3.2 `DESC` åŠ è§£å¯†

```cs showLineNumbers
// æµ‹è¯• DESC åŠ è§£å¯†
var descHash = DESCEncryption.Encrypt("ç™¾å°åƒ§", "Furion"); // åŠ å¯†
var str = DESCEncryption.Decrypt(descHash, "Furion");  // è§£å¯†
return (descHash, str);
```

### 20.3.3 `AES` åŠ è§£å¯†

```cs showLineNumbers
// æµ‹è¯• AES åŠ è§£å¯†
var key = Guid.NewGuid().ToString("N"); // å¯†é’¥ï¼Œé•¿åº¦å¿…é¡»ä¸º24ä½æˆ–32ä½

var aesHash = AESEncryption.Encrypt("ç™¾å°åƒ§", key); // åŠ å¯†
var str2 = AESEncryption.Decrypt(aesHash, key); // è§£å¯†
return (aesHash, str2);
```

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion 4.8.8.11 +` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

- **å¯¹æ–‡ä»¶ï¼ˆå«è¶…å¤§æ–‡ä»¶ï¼‰è¿›è¡ŒåŠ è§£å¯†**

```cs showLineNumbers {3,8}
// åŠ å¯†
var originBytes = File.ReadAllBytes("xxx.rar"); // è¯»å–æºæ–‡ä»¶å†…å®¹
var encryptBytes = AESEncryption.Encrypt(originBytes, "123456");
// å¯ä»¥é€šè¿‡ encryptBytes.CopyToSave("xxx.åŠ å¯†.rar");   ä¿å­˜åˆ°ç£ç›˜

// è§£å¯†
var encryptBytes = File.ReadAllBytes("xxx.åŠ å¯†.rar"); // è¯»å–åŠ å¯†æ–‡ä»¶å†…å®¹
var originBytes = AESEncryption.Decrypt(encryptBytes, "123456");
// å¯ä»¥é€šè¿‡ originBytes.CopyToSave("xxx.çœŸå®.rar");   ä¿å­˜åˆ°ç£ç›˜
```

### 20.3.4 `JWT` åŠ è§£å¯†

```cs showLineNumbers
var token = JWTEncryption.Encrypt(new Dictionary<string, object>()  // åŠ å¯†
            {
                { "UserId", user.Id },
                { "Account",user.Account }
            });

var tokenData = JWTEncryption.ReadJwtToken("ä½ çš„token");  // è§£å¯†

var (isValid, tokenData, validationResult) = JWTEncryption.Validate("ä½ çš„token"); // éªŒè¯tokenæœ‰æ•ˆæœŸ
```

:::important ç‰¹åˆ«æ³¨æ„

`JWTEncryption` åŠ è§£å¯†å¹¶æœªåŒ…å«åœ¨ `Furion` æ¡†æ¶ä¸­ï¼Œéœ€è¦å®‰è£… `Furion` æ¡†æ¶æä¾›çš„ `Furion.Extras.Authentication.JwtBearer` æ‹“å±•åŒ…ã€‚

:::

### 20.3.5 `PBKDF2` åŠ å¯†

**`Furion v2.12 +` ç‰ˆæœ¬å·²ç§»é™¤ã€‚**

```cs showLineNumbers
// æµ‹è¯• PBKDF2 åŠ å¯†ï¼Œæ¯”è¾ƒ
var basestring = PBKDF2Encryption.Encrypt("ç™¾å°åƒ§");  // åŠ å¯†
var isEqual = PBKDF2Encryption.Compare("ç™¾å°åƒ§", basestring); // æ¯”è¾ƒ
```

:::important æ”¯æŒé€‰æ‹©æ›´å¤šå‚æ•°

`PBKDF2` è¿˜å¯ä»¥é…ç½®æ›´å¤šå‚æ•°ï¼š

- `Startup.cs` ä¸­æ³¨å†ŒæœåŠ¡

```cs showLineNumbers
services.AddPBKDF2EncryptionOptions();
```

- `appsettings.json` é…ç½®ï¼š

```json showLineNumbers
{
  "PBKDF2EncryptionSettings": {
    "InitialIterationCount": 110, // åˆå§‹è¿­ä»£æ¬¡æ•°ç´¯åŠ å€¼
    "KeyDerivation": "HMACSHA256", // åŠ å¯†ç®—æ³•è§„åˆ™  KeyDerivationPrf.HMACSHA256
    "NumBytesRequested": 64 // æ´¾ç”Ÿå¯†é’¥çš„é•¿åº¦ (ä»¥å­—èŠ‚ä¸ºå•ä½) 512 / 8
  }
}
```

- `KeyDerivation` å¯é€‰å€¼æœ‰ï¼š`HMACSHA1`ï¼Œ`HMACSHA256`ï¼Œ`HMACSHA512`

:::

### 20.3.6 `RSA` åŠ å¯†

```cs showLineNumbers
// æµ‹è¯• RSA åŠ å¯†
var (publicKey, privateKey) = RSAEncryption.GenerateSecretKey(2048);  //ç”Ÿæˆ RSA ç§˜é’¥ ç§˜é’¥å¤§å°å¿…é¡»ä¸º 2048 åˆ° 16384ï¼Œå¹¶ä¸”æ˜¯ 8 çš„å€æ•°
var basestring = RSAEncryption.Encrypt("ç™¾å°åƒ§", publicKey);  // åŠ å¯†
var str2 = RSAEncryption.Decrypt(basestring, privateKey); // è§£å¯†
return (basestring, str2);
```

:::important å…³äº `RSA` ç­¾åå’Œæ ¡éªŒ

`Furion` æ¡†æ¶åº•å±‚ä¸å†…ç½® `RSA` ç­¾åå’Œæ ¡éªŒåŠŸèƒ½ï¼Œå¦‚éœ€æ·»åŠ è¯¥åŠŸèƒ½å¯æŸ¥é˜…å¼€å‘è€…æäº¤çš„ä»£ç ï¼š[æŸ¥çœ‹ RSA ç­¾åå’Œæ ¡éªŒ](https://gitee.com/dotnetchina/Furion/pulls/349)

:::

## 20.4 å­—ç¬¦ä¸²æ‹“å±•æ–¹å¼

`Furion` æ¡†æ¶ä¹Ÿæä¾›äº†å­—ç¬¦ä¸²æ‹“å±•æ–¹å¼è¿›è¡Œ `MD5åŠ å¯†ã€AES/DESCåŠ è§£å¯†ã€RSAåŠ è§£å¯†`ã€‚

```cs showLineNumbers
using Furion.DataEncryption.Extensions;

// MD5 åŠ å¯†
var s = "Furion".ToMD5Encrypt();
var b = "Furion".ToMD5Compare(s);   // æ¯”è¾ƒ
// Furion 4.8.6.3+ æ”¯æŒ bytes
var b = bytes.ToMD5Encrypt();
var z = bytes2.ToMD5Compare(bytes);

// AESåŠ è§£å¯†
var s = "Furion".ToAESEncrypt("sfdsfdsfdsfdsfdsfdsfdsfdsfdfdsfdsfdfdfdfd");
var str = s.ToAESDecrypt("sfdsfdsfdsfdsfdsfdsfdsfdsfdfdsfdsfdfdfdfd");

// DESC åŠ è§£å¯†
var s = "Furion".ToDESCEncrypt("sfdsfdsfdsfdsfdsfdsfdsfdsfdfdsfdsfdfdfdfd");
var str = s.ToDESCDecrypt("sfdsfdsfdsfdsfdsfdsfdsfdsfdfdsfdsfdfdfdfd");

// PBKDF2 åŠ å¯†ï¼ˆ`Furion v2.12 +` ç‰ˆæœ¬å·²ç§»é™¤ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼‰
var s = "Furion".ToPBKDF2Encrypt();
var b = "Furion".ToPBKDF2Compare(s);   // æ¯”è¾ƒ

// RSA åŠ è§£å¯†
var (publicKey, privateKey) = RSAEncryption.GenerateSecretKey(2048);  //ç”Ÿæˆ RSA ç§˜é’¥ ç§˜é’¥å¤§å°å¿…é¡»ä¸º 2048 åˆ° 16384ï¼Œå¹¶ä¸”æ˜¯ 8 çš„å€æ•°
var s= "Furion".ToRSAEncrpyt(publicKey);  // åŠ å¯†
var str=s.ToRSADecrypt(privateKey);  // è§£å¯†
```

## 20.5 `SM2`ã€`SM3`ï¼Œ`SM4` å›½å¯†

`Furion` æ¡†æ¶æœªå†…ç½®å›½å¯†ç®—æ³• `SM2-4`ï¼Œä½†æ˜¯å·²æœ‰å¼€å‘è€…è´¡çŒ®å®ç°å¹¶å¼€æºï¼Œå¯æŸ¥é˜… [Gitee ä»“åº“](https://gitee.com/xxcxy/SM/tree/master/GfsDemo/Smcrypto)ï¼Œæ„Ÿè°¢ `QQï¼ˆ373696184ï¼‰å½¢å½±ç›¸å°Â²ÂºÂ²Â²` è´¡çŒ®

```cs showLineNumbers
var data = "{\"lx\":\"1\",\"wxid\":\"\",\"ehealth_code_id\":\"68A018036186B717CC1B051C10996F4EEE805F5F81EB1594C9EB43592545F7F6\",\"ehealth_code\":\"68A018036186B717CC1B051C10996F4EEE805F5F81EB1594C9EB43592545F7F6\",\"xm\":\"æµ‹è¯•\"}";

// SM2
var b = SM2Utils.åŠ å¯†("123");
var b1 = SM2Utils.è§£å¯†(b);

// SM3 ä¸€èˆ¬ç”¨äºæ•°å­—ç­¾å
var sM3Utils = new SM3Utils();
sM3Utils.secretKey = "ASAFSDFDSGSDFSDFSDFSFSF";
var token= sM3Utils.åŠ å¯†("123");

// SM4
var sM4Utils = new SM4Utils();
sM4Utils.secretKey = "BDBDBDBDBDBDBDBDBDBDBDBDBDBDBD";

var a = sM4Utils.åŠ å¯†(data);
var a1 = sM4Utils.è§£å¯†(a);
```

## 20.6 åé¦ˆä¸å»ºè®®

:::note ä¸æˆ‘ä»¬äº¤æµ

ç»™ Furion æ [Issue](https://gitee.com/dotnetchina/Furion/issues/new?issue)ã€‚

:::
