---
id: dotnet-tools
title: 37. ç¼–å†™åŒ…ç®¡ç†å·¥å…·
sidebar_label: 37. ç¼–å†™åŒ…ç®¡ç†å·¥å…· (Tools)
---

import useBaseUrl from "@docusaurus/useBaseUrl";

## 37.1 å…³äºåŒ…ç®¡ç†å·¥å…·

ä½¿ç”¨è¿‡ `NodeJs` çš„æœ‹å‹ä¸€å®šå¯¹ `npm` å‘½ä»¤ä¸ä¼šé™Œç”Ÿï¼Œå¯ä»¥é€šè¿‡ `npm` å®‰è£…é¡¹ç›®éœ€è¦çš„åŒ…æˆ–ç¯å¢ƒéœ€è¦çš„å·¥å…·ï¼Œåœ¨ `.NET Core 2.1+` ä¹‹åï¼Œå¾®è½¯ä¹Ÿæ¨å‡ºäº†æ–°çš„ç‰¹æ€§ï¼Œ`Global/Local Tools`ï¼Œè¯¥ç‰¹æ€§åŠŸèƒ½ä¹Ÿæ­£æ˜¯å—åˆ° `npm` å¯å‘ä¸‹è¯ç”Ÿçš„ã€‚

ä¸åŒçš„æ˜¯ï¼Œ`npm` ä¸­çš„åŒ…é‡‡ç”¨çš„æ˜¯ `JavaScript` ç¼–å†™å¹¶å‘å¸ƒåˆ° [https://www.npmjs.com/](https://www.npmjs.com/) å¹³å°ï¼Œè€Œ `dotnet tools` é‡‡ç”¨ `C#` ç¼–å†™å¹¶å‘å¸ƒåˆ° `https://www.nuget.org/` å¹³å°ä¾›å®‰è£…ä½¿ç”¨ã€‚

### 37.1.1 `dotnet tools` åŒ…ç®¡ç†å¥½å¤„

- è·¨å¹³å°ï¼Œæ”¯æŒ `Linux/Mac/Windows` å¹³å°ä¾›å®‰è£…ä½¿ç”¨
- å®Œæ•´çš„ `C#` ç”Ÿæ€æ”¯æŒ
- ä¸ºæ‰€æ¬²ä¸º~~~ï¼ˆæ‹¥æœ‰æ“ä½œç³»ç»Ÿçš„æƒé™ï¼‰

## 37.2 äº†è§£åŒ…å‘½ä»¤è¯­æ³•

é€šå¸¸åŒ…å‘½ä»¤è¯­æ³•éƒ½éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š

```bash showLineNumbers
<-|--|/>argument-name<=|:| >["|']value['|"] [--] [operand] ... [operand]
```

åœ¨è¿™é‡Œï¼Œ`Furion` å°†ç®€å•ä»‹ç»å‘½ä»¤å¸¸ç”¨çš„çŸ¥è¯†ï¼š

- `å·¥å…·ç¬¦`ï¼šé€šå¸¸æŒ‡çš„æ˜¯ä½ å·¥å…·çš„å”¯ä¸€åç§°ï¼Œä¹Ÿå°±æ˜¯å…³é”®å­—ï¼Œè€Œä¸”æ€»æ˜¯åœ¨æœ€å¼€å¤´ç¼–å†™ï¼Œå¦‚ï¼š`dotnet`ï¼Œ`npm`ï¼Œ`node`
- `çŸ­å‚æ•°`ï¼šçŸ­å‚æ•°æŒ‡çš„æ˜¯ `å•ä¸ªå­—ç¬¦` çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ `-` ä¸€ä¸ªæ¨ªæ†æŒ‡å®šå‚æ•°åŠå€¼ï¼Œå¦‚ï¼š`-v` æˆ– `-v 0.0.1`
- `é•¿å‚æ•°`ï¼šé•¿å‚æ•°æŒ‡çš„æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯è¿æ¥çš„å­—ç¬¦ä¸²ï¼Œè¯¥å‚æ•°é€šå¸¸å’Œ `çŸ­å‚æ•°` åŒæ—¶å­˜åœ¨ï¼Œé€šå¸¸ä½¿ç”¨ `--` æŒ‡å®šå‚æ•°åŠå€¼ï¼Œå¦‚ï¼š`--version` æˆ– `--version 0.0.1`
- `æ“ä½œç¬¦`ï¼šå­—ç¬¦ä¸²ä¸­ä¸å‚æ•°å€¼æ ¼å¼ä¸åŒ¹é…çš„ä»»ä½•æ–‡æœ¬éƒ½è¢«è§†ä¸ºæ“ä½œæ•°ï¼Œä»»ä½•å‡ºç°åœ¨åŒè¿å­—ç¬¦ `--` ä¹‹åä¸”æœªåŒ…å«åœ¨å•å¼•å·æˆ–åŒå¼•å·ä¸­ä¸”ä¸¤ä¾§æœ‰ç©ºæ ¼çš„æ–‡æœ¬éƒ½è¢«è§†ä¸ºæ“ä½œæ•°ï¼Œæ— è®ºå®ƒæ˜¯å¦ä¸å‚æ•°å€¼æ ¼å¼åŒ¹é…ï¼Œé€šå¸¸ç”¨äºå½’ç±»/åˆ†ç±»ä½œç”¨ã€‚

### 37.2.1 çŸ­å‚æ•°ä¾‹å­

- `-a foo`

| çŸ­å‚æ•° | å‚æ•°å€¼ |
| ------ | ------ |
| a      | foo    |

- `-ab`

| çŸ­å‚æ•° | å‚æ•°å€¼ |
| ------ | ------ |
| a      |        |
| b      |        |

- `-abc bar`

| çŸ­å‚æ•° | å‚æ•°å€¼ |
| ------ | ------ |
| a      |        |
| b      |        |
| c      | bar    |

### 37.2.2 é•¿å‚æ•°ä¾‹å­

- `--foo bar`

| é•¿å‚æ•° | å‚æ•°å€¼ |
| ------ | ------ |
| foo    | bar    |

- `--foo --bar`

| é•¿å‚æ•° | å‚æ•°å€¼ |
| ------ | ------ |
| foo    |        |
| bar    |        |

- `--foo bar --hello world`

| é•¿å‚æ•° | å‚æ•°å€¼ |
| ------ | ------ |
| foo    | bar    |
| hello  | world  |

### 37.2.3 æ··åˆå‚æ•°ä¾‹å­

- `-abc foo --hello world /new="slashes are ok too"`

| çŸ­/é•¿å‚æ•° | å‚æ•°å€¼             |
| --------- | ------------------ |
| a         |
| b         |
| c         | foo                |
| hello     | world              |
| new       | slashes are ok too |

### 37.2.4 å¤šä¸ªå€¼å‚æ•°

- `--list 1 --list 2 --list 3`

| é•¿å‚æ•° | å‚æ•°å€¼ |
| ------ | ------ |
| list   | 1,2,3  |

### 37.2.5 æ“ä½œç¬¦

- `-a foo bar "hello world" -b -- -explicit operand`

| çŸ­å‚æ•° | å‚æ•°å€¼ |
| ------ | ------ |
| a      | foo    |
| b      |

| æ“ä½œç¬¦        |
| ------------- |
| bar           |
| "hello world" |
| -explicit     |
| operand       |

äº†è§£æ›´å¤šå…³äºåŒ…å‘½ä»¤è¯­æ³•çš„å®˜æ–¹çŸ¥è¯†ï¼š[https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap12.html](https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap12.html)

## 37.3 ç¼–å†™ç¬¬ä¸€ä¸ªåŒ…

`dotnet tools` å·¥å…·å®é™…ä¸Šæ˜¯ä¸€ä¸ª `æ§åˆ¶å°` åº”ç”¨ç¨‹åºï¼Œä¸åŒçš„æ˜¯ `.csproj` é¡¹ç›®æ–‡ä»¶éœ€è¦æ·»åŠ ç‰¹å®šé…ç½®ã€‚ä¸‹é¢å°†ç»™å¤§å®¶ç¼–å†™ä¸€ä¸ª `HelloTools` åŒ…ç®¡ç†å·¥å…·ã€‚

### 37.3.1 åˆ›å»º `HelloTools` æ§åˆ¶å°åº”ç”¨

<img src={useBaseUrl("img/ts1.png")} />

### 37.3.2 ç¼–è¾‘ `HelloTools.csproj`

å°†æ§åˆ¶å°é¡¹ç›®æ ‡è®°æˆ `dotnet tools` éœ€è¦é…ç½®ä»¥ä¸‹èŠ‚ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

```xml showLineNumbers  {6-11}
<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<OutputType>Exe</OutputType>
		<TargetFramework>net5.0</TargetFramework>
    	<Version>0.0.1</Version>
    	<Description>ç¬¬ä¸€ä¸ª dotnet tools å·¥å…·</Description>
		<ToolCommandName>hello-tools</ToolCommandName>
		<PackAsTool>true</PackAsTool>
		<GeneratePackageOnBuild>true</GeneratePackageOnBuild>
		<PackageOutputPath>./nupkg</PackageOutputPath>
	</PropertyGroup>

</Project>
```

#### é…ç½®å…³é”®èŠ‚ç‚¹è¯´æ˜

- `Version`ï¼šåŒ…å·¥å…·ç‰ˆæœ¬å·
- `Description`ï¼šåŒ…å·¥å…·ä»‹ç»
- `ToolCommandName`ï¼šåŒ…å·¥å…·å…³é”®å­—ï¼Œå¦‚ `dotnet`ã€`npm`ï¼Œåç»­ä½¿ç”¨éƒ½æ˜¯é€šè¿‡è¯¥å…³é”®å­—ä½¿ç”¨
- `PackAsTool`ï¼šæ˜¯å¦å£°æ˜ä¸ºåŒ…ç®¡ç†å·¥å…·ï¼Œè®¾ç½® `true`
- `GeneratePackageOnBuild`ï¼šæ˜¯å¦ç¼–è¯‘æ—¶è‡ªåŠ¨ç”Ÿæˆ `.nupkg` åŒ…ï¼Œæ–¹ä¾¿åç»­ä¸Šä¼ åˆ° `NuGet` å¹³å°
- `PackageOutputPath`ï¼šé…ç½® `.nupkg` åŒ…å­˜å‚¨ç›®å½•ï¼Œæ¨èä½¿ç”¨ `./nupkg`

### 37.3.3 å®‰è£… `Furion.Tools.CommandLine` åŒ…

ä¸ºäº†æ–¹ä¾¿ç®¡ç†å·¥å…·åŒ…å¼€å‘ï¼Œ`Furion` å®˜æ–¹ç‰¹æ„å¼€å‘äº† `Furion.Tools.CommandLine` åŒ…ï¼Œå¸®åŠ©å¤§å®¶å¿«é€Ÿå¼€å‘ç®¡ç†å·¥å…·åŒ…ã€‚

<img src={useBaseUrl("img/ts2.png")} />

### 37.3.4 ç¼–å†™é€»è¾‘ä»£ç 

æˆ‘ä»¬å…ˆå®šä¹‰å‡ ä¸ªéœ€æ±‚ï¼Œç„¶åç¼–å†™é€»è¾‘ä»£ç ï¼š

> éœ€æ±‚ä¸€ï¼šè¾“å…¥ `hello-tools` æ‰“å°ä»‹ç»ä¿¡æ¯
>
> éœ€æ±‚äºŒï¼šè¾“å…¥ `-n` æˆ– `--name` è¾“å‡º `Hello åå­—`
>
> éœ€æ±‚ä¸‰ï¼šè¾“å…¥ `-v` æˆ– `--version` è¾“å‡ºå½“å‰ç‰ˆæœ¬
>
> éœ€æ±‚å››ï¼šè¾“å…¥ `-h` æˆ– `--help` è¾“å‡ºå¸®åŠ©æ–‡æ¡£

:::tip ç”Ÿæˆæ§åˆ¶å° `LOGO`

- ä¸æ”¯æŒä¸­æ–‡ï¼š[http://patorjk.com/software/taag/#p=display&f=Big&t=Furion%20Tools](http://patorjk.com/software/taag/#p=display&f=Big&t=Furion%20Tools)
- æ”¯æŒæ‰€æœ‰å­—ç¬¦ï¼š[https://www.qqxiuzi.cn/zh/dianzhenzi-zifu/](https://www.qqxiuzi.cn/zh/dianzhenzi-zifu/)

:::

```cs showLineNumbers  {1,10,15-18,26-29,37-40,45}
using Furion.Tools.CommandLine;
using System;
using System.Collections.Generic;

namespace HelloTools
{
    class Program
    {
        // é€šè¿‡ Cli.Inject() å®Œæˆå‡†å¤‡å·¥ä½œ
        static void Main(string[] args) => Cli.Inject();

        /// <summary>
        /// è¾“å‡º Hello åå­—
        /// </summary>
        [Argument('n', "name", "æ‚¨çš„åå­—")]
        static string Name { get; set; }
        // å®šä¹‰å‚æ•°å¤„ç†ç¨‹åºï¼Œå¿…é¡» [å±æ€§å]+Handler
        static void NameHandler(ArgumentMetadata argument)
        {
            Console.WriteLine($"Hello {Name}");
        }

        /// <summary>
        /// æŸ¥çœ‹ç‰ˆæœ¬
        /// </summary>
        [Argument('v', "version", "å·¥å…·ç‰ˆæœ¬å·")]
        static bool Version { get; set; }
        // å®šä¹‰å‚æ•°å¤„ç†ç¨‹åºï¼Œå¿…é¡» [å±æ€§å]+Handler
        static void VersionHandler(ArgumentMetadata argument)
        {
            Console.WriteLine(Cli.GetVersion());
        }

        /// <summary>
        /// æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£
        /// </summary>
        [Argument('h', "help", "æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£")]
        static bool Help { get; set; }
        // å®šä¹‰å‚æ•°å¤„ç†ç¨‹åºï¼Œå¿…é¡» [å±æ€§å]+Handler
        static void HelpHandler(ArgumentMetadata argument)
        {
            Cli.GetHelpText("hello-tools");
        }

        // æ‰€æœ‰æœªåŒ¹é…çš„å‚æ•°/æ“ä½œç¬¦å¤„ç†ç¨‹åºï¼Œå›ºå®š NoMatchesHandler æ–¹æ³•å
        static void NoMatchesHandler(bool isEmpty, string[] operands, Dictionary<string, object> noMatches)
        {
            if (isEmpty)
            {
                Console.WriteLine(@"
  _    _      _ _         _______          _
 | |  | |    | | |       |__   __|        | |
 | |__| | ___| | | ___      | | ___   ___ | |___
 |  __  |/ _ \ | |/ _ \     | |/ _ \ / _ \| / __|
 | |  | |  __/ | | (_) |    | | (_) | (_) | \__ \
 |_|  |_|\___|_|_|\___/     |_|\___/ \___/|_|___/


");
                Console.WriteLine($"æ¬¢è¿ä½¿ç”¨{Cli.GetDescription()}");
            }
        }
    }
}
```

:::tip ä»£ç è¯´æ˜

- `Furion` å·¥å…·åŒ…æä¾›äº†éå¸¸æ–¹ä¾¿çš„ `Cli.Inject()` æ–¹æ³•ï¼Œå¯ä»¥å®ç°ä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰åˆå§‹åŒ–å·¥ä½œï¼Œåªéœ€è¦åœ¨ `Main` æ–¹æ³•è°ƒç”¨å³å¯
- é€šè¿‡ `[Argument(çŸ­å‚æ•°ï¼Œé•¿å‚æ•°ï¼Œæç¤ºæ–‡æ¡£)]` å®šä¹‰æ¯ä¸€ä¸ªå‚æ•°å±æ€§ï¼Œå‚æ•°å¿…é¡»æ˜¯ `static` é™æ€
- é€šè¿‡ `[å±æ€§å]Handler` å®šä¹‰æ¯ä¸ªå‚æ•°åŒ¹é…åçš„å¤„ç†ç¨‹åºï¼Œå¦‚ï¼š`VersionHandler`ï¼Œæ ¼å¼ä¸ºï¼š`static void å±æ€§åHandler(ArgumentMetadata argument)`
- é€šè¿‡å›ºå®šæ–¹æ³•å `NoMatchesHandler` å®šä¹‰æœªåŒ¹é…çš„å‚æ•°åŠæ“ä½œç¬¦ï¼Œè¯¥æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼š
  - `isEmpty`ï¼šåˆ¤æ–­æ˜¯å¦æ²¡æœ‰ä¼ é€’ä»»ä½•å‚æ•°ï¼Œé€šå¸¸ç”¨äºè¾“å‡ºä»‹ç»
  - `operands`ï¼šè·å–æ‰€æœ‰æ“ä½œç¬¦åˆ—è¡¨
  - `noMatches`ï¼šè·å–æ‰€æœ‰æœªåŒ¹é…çš„å‚æ•°å­—å…¸

:::

### 37.3.5 å¦‚ä½•è°ƒè¯•åŒ…å·¥å…· ğŸ‘

åŒ…ç®¡ç†å·¥å…·è°ƒè¯•æœ‰åˆ«äºæ™®é€šçš„æ§åˆ¶å°ï¼Œä¸»è¦åŒºåˆ«æ˜¯æµ‹è¯•å„ä¸ªå‚æ•°çš„ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯å¦‚ä½•ä¼ é€’ `Main` æ–¹æ³•çš„ `args` å‚æ•°ã€‚åªéœ€è¦ä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤å³å¯ï¼š

- åœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ  `Properties` ç›®å½•
- åœ¨ `Properties` ç›®å½•ä¸­æ·»åŠ  `launchSettings.json` æ–‡ä»¶ï¼Œå¹¶éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š

```json showLineNumbers  {3,5}
{
  "profiles": {
    "é¡¹ç›®åç§°": {
      "commandName": "Project",
      "commandLineArgs": "ä½ çš„å‘½ä»¤"
    }
  }
}
```

- `é¡¹ç›®åç§°`ï¼šå†™ä½ çš„é¡¹ç›®å®é™…åç§°ï¼Œå¦‚ï¼š`HelloTools`
- `commandName`ï¼šå›ºå®šä¸º `Project`
- `commandLineArgs`ï¼šç¼–å†™æµ‹è¯•å‘½ä»¤ï¼Œåªéœ€è¦å†™å‚æ•°/æ“ä½œç¬¦éƒ¨åˆ†å³å¯ï¼Œå¦‚ï¼š`-v`ï¼Œ`-v -h --Name Furion`

å¦‚ï¼Œæˆ‘ä»¬éœ€è¦æµ‹è¯• `HelloTools` çš„ `-n` å‚æ•°

```json showLineNumbers  {3,5}
{
  "profiles": {
    "HelloTools": {
      "commandName": "Project",
      "commandLineArgs": "-n Furion"
    }
  }
}
```

<img src={useBaseUrl("img/ts3.png")} />

ç‚¹å‡» `è¿è¡Œ/è°ƒè¯•/F5` å¯åŠ¨è°ƒè¯•

<img src={useBaseUrl("img/ts4.png")} />

### 37.3.6 æµ‹è¯•å„ä¸ªå‚æ•°æƒ…å†µ

> éœ€æ±‚ä¸€ï¼šè¾“å…¥ `hello-tools` æ‰“å°ä»‹ç»ä¿¡æ¯

```json showLineNumbers  {5}
{
  "profiles": {
    "HelloTools": {
      "commandName": "Project",
      "commandLineArgs": ""
    }
  }
}
```

<img src={useBaseUrl("img/ts5.png")} />

> éœ€æ±‚äºŒï¼šè¾“å…¥ `-n` æˆ– `--name` è¾“å‡º `Hello åå­—`

```json showLineNumbers  {5}
{
  "profiles": {
    "HelloTools": {
      "commandName": "Project",
      "commandLineArgs": "-n Furion"
    }
  }
}
```

<img src={useBaseUrl("img/ts6.png")} />

> éœ€æ±‚ä¸‰ï¼šè¾“å…¥ `-v` æˆ– `--version` è¾“å‡ºå½“å‰ç‰ˆæœ¬

```json showLineNumbers  {5}
{
  "profiles": {
    "HelloTools": {
      "commandName": "Project",
      "commandLineArgs": "--version"
    }
  }
}
```

<img src={useBaseUrl("img/ts7.png")} />

> éœ€æ±‚å››ï¼šè¾“å…¥ `-h` æˆ– `--help` è¾“å‡ºå¸®åŠ©æ–‡æ¡£

```json showLineNumbers  {5}
{
  "profiles": {
    "HelloTools": {
      "commandName": "Project",
      "commandLineArgs": "-h"
    }
  }
}
```

<img src={useBaseUrl("img/ts8.png")} />

## 37.4 æ‰“åŒ…ï¼ˆæœ¬æœºï¼‰æµ‹è¯•

åˆšåˆšæˆ‘ä»¬å·²ç»å­¦ä¼šè°ƒè¯•åŒ…å·¥å…·äº†ï¼Œä½†æ˜¯è¿˜æœªåšåˆ°ç±»ä¼¼ `npm` åŒ…ä¸€æ ·ï¼Œåœ¨ `cmd/powershell` ä¸­å®‰è£…ä¹‹åå¯åœ¨å‘½ä»¤è¡Œå…¨å±€æµ‹è¯•ï¼Œä¸‹é¢å°†æ•™å¤§å®¶å¦‚ä½•å®ç° `å…¨å±€å®‰è£…` å’Œ `æœ¬åœ°å®‰è£…`ã€‚

### 37.4.1 å…¨å±€æ‰“åŒ…å®‰è£…

**å…¨å±€æ‰“åŒ…å®‰è£…å°±æ˜¯é…ç½®åœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­ï¼Œåœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨ã€‚**

åœ¨ `HelloTools` é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰“å¼€ `cmd/powershell`ï¼ˆ**å°½é‡ä½¿ç”¨ç®¡ç†å‘˜å·¥å…·**ï¼‰æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

#### âœ” å®‰è£…å…¨å±€åŒ…

```bash showLineNumbers
dotnet tool install --global --add-source ./nupkg HelloTools
```

å…¶ä¸­ `HelloTools` å°±æ˜¯ `é¡¹ç›®åç§°`ã€‚

<img src={useBaseUrl("img/ts9.png")} />

ä¹‹åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¹‹å‰ `HelloTools.csproj` ä¸­é…ç½®çš„ `<ToolCommandName>hello-tools</ToolCommandName>` ä½¿ç”¨äº†ã€‚

#### âœ” æµ‹è¯•å…¨å±€åŒ…

<img src={useBaseUrl("img/ts10.png")} />

#### âœ” æ›´æ–°å…¨å±€åŒ…

å¦‚æœæºç å‘ç”Ÿæ”¹å˜ï¼Œåªéœ€è¦ç¼–è¯‘é¡¹ç›®åé‡æ–°æ›´æ–°åŒ…å·¥å…·å³å¯ï¼š

```bash showLineNumbers
dotnet tool update --global --add-source ./nupkg HelloTools
```

#### âœ” å¸è½½å…¨å±€åŒ…

```bash showLineNumbers
dotnet tool uninstall --global HelloTools
```

æƒ³äº†è§£æ›´å¤šå…¨å±€æ‰“åŒ…å®‰è£…çŸ¥è¯†æŸ¥é˜…å®˜æ–¹æ–‡æ¡£å³å¯ï¼š[https://docs.microsoft.com/zh-cn/dotnet/core/tools/global-tools-how-to-use](https://docs.microsoft.com/zh-cn/dotnet/core/tools/global-tools-how-to-use)

### 37.4.2 æœ¬åœ°æ‰“åŒ…å®‰è£…

**æœ¬åœ°æ‰“åŒ…å®‰è£…å°±æ˜¯åªæœ‰åœ¨é¡¹ç›®æ‰€åœ¨ç›®å½•åŠå­å­™ç›®å½•æ–¹å¯ä½¿ç”¨ã€‚**

åœ¨ `HelloTools` é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰“å¼€ `cmd/powershell` æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

#### âœ” åˆ›å»ºæœ¬åœ°æ¸…å•æ–‡ä»¶

```bash showLineNumbers
dotnet new tool-manifest
```

æ‰§è¡Œè¯¥å‘½ä»¤åä¼šè‡ªåŠ¨åˆ›å»º `.config` æ–‡ä»¶å¤¹å¹¶æ·»åŠ  `dotnet-tools.json` æ–‡ä»¶ï¼š

```json showLineNumbers
{
  "version": 1,
  "isRoot": true,
  "tools": {}
}
```

:::warning æ³¨æ„äº‹é¡¹

é€šå¸¸è¯¥æ–‡ä»¶å†…å®¹ä¸éœ€è¦æ‰‹åŠ¨æ›´æ”¹ã€‚

:::

#### âœ” å®‰è£…æœ¬åœ°åŒ…

```bash showLineNumbers
dotnet tool install --add-source ./nupkg HelloTools
```

<img src={useBaseUrl("img/ts11.png")} />

#### âœ” æµ‹è¯•æœ¬åœ°åŒ…

æœ¬åœ°åŒ…æµ‹è¯•å’Œå…¨å±€åŒ…ä¸ä¸€æ ·çš„æ˜¯æœ¬åœ°åŒ…æ˜¯é€šè¿‡ `dotnet å…³é”®å­— å‚æ•°` æµ‹è¯•ï¼š

```bash showLineNumbers
dotnet hello-tools -n Furion
```

<img src={useBaseUrl("img/ts12.png")} />

#### âœ” æ›´æ–°æœ¬åœ°åŒ…

å¦‚æœæºç å‘ç”Ÿæ”¹å˜ï¼Œåªéœ€è¦ç¼–è¯‘é¡¹ç›®åé‡æ–°æ›´æ–°åŒ…å·¥å…·å³å¯ï¼š

```bash showLineNumbers
dotnet tool update --add-source ./nupkg HelloTools
```

#### âœ” å¸è½½æœ¬åœ°åŒ…

```bash showLineNumbers
dotnet tool uninstall HelloTools
```

æƒ³äº†è§£æ›´å¤šæœ¬åœ°æ‰“åŒ…å®‰è£…çŸ¥è¯†æŸ¥é˜…å®˜æ–¹æ–‡æ¡£å³å¯ï¼š[https://docs.microsoft.com/zh-cn/dotnet/core/tools/local-tools-how-to-use](https://docs.microsoft.com/zh-cn/dotnet/core/tools/local-tools-how-to-use)

## 37.5 å‘å¸ƒåˆ° `NuGet` å¹³å° ğŸ‘

å‘å¸ƒåˆ° `NuGet` å¹³å°éå¸¸ç®€å•ï¼Œåªéœ€è¦ä¸¤ä¸ªæ­¥éª¤å³å¯ï¼š

- åˆ‡æ¢é¡¹ç›® `Debug` æ¨¡å¼åˆ° `Release` å¹¶é‡æ–°ç¼–è¯‘é¡¹ç›®
- åœ¨ `NuGet` å¹³å°ä¸Šä¼  `nupkg` æ–‡ä»¶å¤¹å¯¹åº” `é¡¹ç›®åç§°.ç‰ˆæœ¬å·.nupkg` æ–‡ä»¶å³å¯ï¼š[https://www.nuget.org/packages/manage/upload](https://www.nuget.org/packages/manage/upload)

:::tip ä¸Šä¼  NuGet å¹³å°è¡¥é½ä¿¡æ¯

å»ºè®®ä¸Šä¼ åˆ° `NuGet` å¹³å°ç¼–è¾‘ `.csproj` æ–‡ä»¶è¡¥é½ä»¥ä¸‹ä¿¡æ¯ï¼š

```cs showLineNumbers  {13-21}
<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<OutputType>Exe</OutputType>
		<TargetFramework>net5.0</TargetFramework>
		<Version>0.0.1</Version>
		<Description>ç¬¬ä¸€ä¸ª dotnet tools å·¥å…·</Description>
		<ToolCommandName>hello-tools</ToolCommandName>
		<PackAsTool>true</PackAsTool>
		<GeneratePackageOnBuild>true</GeneratePackageOnBuild>
		<PackageOutputPath>./nupkg</PackageOutputPath>

		<Authors>ç™¾å°åƒ§</Authors>
		<Company>ç™¾ç­¾ç§‘æŠ€ï¼ˆå¹¿ä¸œï¼‰æœ‰é™å…¬å¸</Company>
		<Product>Furion</Product>
		<Copyright>Â© 2020-present ç™¾å°åƒ§, ç™¾ç­¾ç§‘æŠ€ï¼ˆå¹¿ä¸œï¼‰æœ‰é™å…¬å¸</Copyright>
		<RepositoryUrl>https://gitee.com/dotnetchina/Furion</RepositoryUrl>
		<RepositoryType>Gitee</RepositoryType>
		<GeneratePackageOnBuild>true</GeneratePackageOnBuild>
		<PackageLicenseExpression>MIT</PackageLicenseExpression>
		<PackageProjectUrl>http://furion.baiqian.ltd</PackageProjectUrl>
	</PropertyGroup>

	<ItemGroup>
		<PackageReference Include="Furion.Tools.CommandLine" Version="2.6.0" />
	</ItemGroup>

</Project>
```

:::

<img src={useBaseUrl("img/ts13.png")} />

<img src={useBaseUrl("img/ts14.png")} />

å‘å¸ƒåˆ° `NuGet` å¹³å°åï¼Œåˆ«äººå°±å¯ä»¥é€šè¿‡ï¼š

#### âœ” å®‰è£… NuGet åŒ…åˆ°æœ¬åœ°

```bash showLineNumbers
dotnet tool install --global é¡¹ç›®å --version ç‰ˆæœ¬å·
```

## 37.6 `Cli` é™æ€ç±»è¯´æ˜

ä¸ºäº†ç®€åŒ–åŒ…å·¥å…·çš„å¼€å‘ï¼Œ`Furion.Tools.CommandLine` çš„ `Cli` é™æ€ç±»æä¾›äº†å¾ˆå¤šæ–¹ä¾¿çš„é™æ€æ–¹æ³•ï¼š

### 37.6.1 æ¶ˆæ¯ç±»

```cs showLineNumbers
// è¾“å‡ºç©ºè¡Œ
Cli.EmptyLine();

// è¾“å‡ºä¸€è¡Œ
Cli.WriteLine("æ¶ˆæ¯");
Cli.WriteLine("æ¶ˆæ¯", ConsoleColor.Blue);   // å­—ä½“é¢œè‰²
Cli.WriteLine("æ¶ˆæ¯", ConsoleColor.Blue, ConsoleColor.White);   // èƒŒæ™¯é¢œè‰²
Cli.WriteLine("æ¶ˆæ¯", ConsoleColor.Blue, ConsoleColor.White, fillLine: true);   // å¡«å……æ•´è¡Œ

// è¾“å‡ºï¼ˆä¸æ¢è¡Œï¼‰
Cli.Write("æ¶ˆæ¯");
Cli.Write("æ¶ˆæ¯", ConsoleColor.Blue);   // å­—ä½“é¢œè‰²
Cli.Write("æ¶ˆæ¯", ConsoleColor.Blue, ConsoleColor.White);   // èƒŒæ™¯é¢œè‰²
Cli.Write("æ¶ˆæ¯", ConsoleColor.Blue, ConsoleColor.White, fillLine: true);   // å¡«å……æ•´è¡Œ

// è¾“å‡ºæç¤ºæ¶ˆæ¯
Cli.Success("æˆåŠŸ");
Cli.Warn("è­¦å‘Š");
Cli.Error("é”™è¯¯");
Cli.Tip("æç¤º");

// æ”¶é›†ç”¨æˆ·è¾“å…¥ï¼ˆæ”¯æŒå¤šè¡Œï¼‰
var inputs = Cli.ReadInput(); // è¾“å…¥ exit é€€å‡ºè¾“å…¥

// é€‰æ‹©æ¶ˆæ¯
var selectId = Cli.ReadOptions("è¯·é€‰æ‹©å–œæ¬¢çš„æ°´æœï¼š", new []{ "è¥¿ç“œ", "è‹¹æœ", "å‡¤æ¢¨"});  // selectId ä» 1 å¼€å§‹
```

### 37.6.2 å·¥å…·ç±»

```cs showLineNumbers
// å®Œæˆå‚æ•°å¡«å……å±æ€§åˆå§‹åŒ–æ“ä½œ
Cli.Inject();

// è·å–å‚æ•°æ‰€æœ‰ä¿¡æ¯
var arguments = Cli.ArgumentMetadatas;

// æ‰‹åŠ¨æ£€æŸ¥å‚æ•°æ˜¯å¦åŒ¹é…
Cli.Check(nameof(å±æ€§å), argument => {
    // å¦‚æœç”¨æˆ·è¾“å…¥è¯¥å‚æ•°
    if(argument?.IsTransmission == true){
        Cli.WriteLine(argument.Value);
    }
    else {
        Cli.Error("ç”¨æˆ·æ²¡æœ‰è¾“å…¥");
    }
});

// åªæœ‰å‚æ•°åŒ¹é…æ‰è¿›å…¥
Cli.CheckMatch(nameof(å±æ€§å), argument => {
    Cli.WriteLine(argument.Value);
})

// æ— å±æ€§æ£€æŸ¥
Cli.Check(new[] {"v", "version"}, (isMatch, value) => {
    // å¦‚æœç”¨æˆ·è¾“å…¥è¯¥å‚æ•°
    if(isMatch){
        Cli.WriteLine(value);
    }
    else {
        Cli.Error("ç”¨æˆ·æ²¡æœ‰è¾“å…¥");
    }
});

// æ— å±æ€§åŒ¹é…
Cli.CheckMatch(new[] {"v", "version"}, value => {
    Cli.WriteLine(value);
});

// æ‰€æœ‰æœªåŒ¹é…çš„å‚æ•°ã€æ“ä½œç¬¦
Cli.CheckNoMatches((isEmpty, operands, noMatches) => {
     if (isEmpty) Cli.WriteLine($"æ¬¢è¿ä½¿ç”¨ {Cli.GetDescription()}");
     if (operands.Length > 0) Cli.Error($"æœªæ‰¾åˆ°è¯¥æ“ä½œç¬¦ï¼š{string.Join(",", operands)}");
     if (noMatches.Count > 0) Cli.Error($"æœªæ‰¾åˆ°è¯¥å‚æ•°ï¼š{string.Join(",", noMatches.Keys)}");
});

// è§£æ Main æ–¹æ³•å‚æ•°ä¿¡æ¯
var argumentModel = Cli.Parse();

// æ‰‹åŠ¨è§£æå‘½ä»¤å­—ç¬¦ä¸²
var argumentModel = Cli.Parse("-abc foo --hello world");

// ç»ˆæ­¢è¾“å‡º/ç»“æŸè¾“å‡º
Cli.Exit();
```

### 37.6.2 ä¿¡æ¯ç±»

```cs showLineNumbers
// è·å–å½“å‰å·¥å…·åŒ…ç‰ˆæœ¬å·
var version = Cli.GetVersion();

// è·å–å½“å‰å·¥å…·åŒ…æè¿°
var description = Cli.GetDescription();
```

### 37.6.3 å…¶ä»–ç±»

æˆ‘ä»¬å¯ä»¥é€šè¿‡ `Environment` è·å–å½“å‰ç¯å¢ƒæ›´å¤šä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

```cs showLineNumbers
// å½“å‰æ‰§è¡Œå‘½ä»¤ç›®å½•
var currentDirectory = Environment.CurrentDirectory;

// è·å–æœºå™¨åç§°
var machineName = Environment.MachineName;

// ç­‰ç­‰ã€‚ã€‚ã€‚ã€‚ã€‚
```

## 37.7 é›†æˆ `Spectre.Console`

`Spectre.Console` æ˜¯ `.NET/C#` å¹³å°éå¸¸ä¼˜ç§€çš„æ§åˆ¶å°åº”ç”¨ç¨‹åº `UI` æ¡†æ¶åº“ï¼Œæä¾›éå¸¸å¤šå¼€ç®±å¯ç”¨ä¸”éå¸¸å¥½çœ‹çš„ `UI` ç»„ä»¶ã€‚å®˜ç½‘åœ°å€ï¼š[https://spectreconsole.net/](https://spectreconsole.net/)

ä½¿ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦é€šè¿‡ `NuGet` å®‰è£… `Spectre.Console.Cli` æ‹“å±•åŒ…å³å¯ã€‚

```bash showLineNumbers
dotnet add package Spectre.Console.Cli
```

ä¹‹ååœ¨æ§åˆ¶å°è¾“å‡ºå¸¦ä¸‹åˆ’çº¿çº¢è‰²çš„ `Hello` å’Œ `world!`ï¼š

```cs showLineNumbers {1,7}
using Spectre.Console;

public static class Program
{
    public static void Main(string[] args)
    {
        AnsiConsole.Markup("[underline red]Hello[/] World!");
    }
}
```

:::tip `Spectre.Console` å’Œ `Spectre.Console.Cli` åŒºåˆ«

`Spectre.Console` æ˜¯ä¸åŒ…å« `args` å‘½ä»¤è¡Œå‚æ•°è§£æçš„ï¼Œä½†ä½œä¸ºä¸€ä¸ª `tools` å·¥å…·å¯¹äºè§£æ `args` å‚æ•°æ˜¾å¾—éå¸¸é‡è¦ï¼Œæ‰€ä»¥æ¨èå®‰è£… `Spectre.Console.Cli`ã€‚

å¦‚æœå®‰è£…äº† `Spectre.Console.Cli` ä¹‹ååˆ™æ— éœ€å®‰è£… `Furion.Tools.CommandLine` æ‹“å±•åŒ…äº†ã€‚

:::

ä¸‹é¢æ˜¯ `Spectre.Console` çš„ `UI` ç»„ä»¶ é¢„è§ˆå›¾ï¼š

<img src={useBaseUrl("img/cli1.png")} />

## 37.8 é›†æˆ `CliWrap`

`CliWrap` åŒæ ·ä¹Ÿæ˜¯ `.NET/C#` å¹³å°éå¸¸ä¼˜ç§€çš„æ‰§è¡Œæœ¬åœ°å‘½ä»¤çš„åº“ï¼Œå¯é€šè¿‡è¯¥åº“å®ç° `CMD/Powershell` å‘½ä»¤æ‰§è¡Œï¼Œéå¸¸å¼ºå¤§ã€‚ä»“åº“åœ°å€ï¼š[https://github.com/Tyrrrz/CliWrap](https://github.com/Tyrrrz/CliWrap)

ä½¿ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦é€šè¿‡ `NuGet` å®‰è£… `Spectre.Console.Cli` æ‹“å±•åŒ…å³å¯ã€‚

```bash showLineNumbers
dotnet add package CliWrap
```

æ¯”å¦‚æ‰§è¡Œ `git commit -m "my commit"` æ“ä½œï¼š

```cs showLineNumbers
// å­—ç¬¦ä¸²å‚æ•°æ–¹å¼
var cmd = Cli.Wrap("git")
    .WithArguments("commit -m \"my commit\"");

// æ•°ç»„å‚æ•°æ–¹å¼
var cmd = Cli.Wrap("git")
    .WithArguments(new[] {"commit", "-m", "my commit"});

// æ‰§è¡Œå‘½ä»¤
var result = cmd.ExecuteAsync();
```

## 37.9 åé¦ˆä¸å»ºè®®

:::note ä¸æˆ‘ä»¬äº¤æµ

ç»™ Furion æ [Issue](https://gitee.com/dotnetchina/Furion/issues/new?issue)ã€‚

:::
