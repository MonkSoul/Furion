---
id: sensitive-detection
title: 30. è„±æ•å¤„ç†
sidebar_label: 30. è„±æ•å¤„ç†
---

import Tag from "@site/src/components/Tag.js";

<details>
  <summary>ğŸ“ æ¨¡å—æ›´æ–°æ—¥å¿—</summary>
  <div>
<div>

- **é—®é¢˜ä¿®å¤**

  - &nbsp;<Tag>ä¿®å¤</Tag> è„±æ•å¤„ç†å¦‚æœå­—å…¸å­˜åœ¨é‡å¤è¯å¯¼è‡´å¼‚å¸¸é—®é¢˜ <sup>4.8.8.4</sup> <sup>â±ï¸2023.04.23</sup> [#I6Y19K](https://gitee.com/dotnetchina/Furion/issues/I6Y19K)

- **å…¶ä»–æ›´æ”¹**

  - &nbsp;<Tag>è°ƒæ•´</Tag> è„±æ•å¤„ç† `sensitive-words.txt` åµŒå…¥æ–‡ä»¶æ”¯æŒ `UTF8 BOM` ç¼–ç ï¼Œæ„Ÿè°¢ [@man119](https://gitee.com/man119) <sup>4.8.6.7</sup> <sup>â±ï¸2023.02.18</sup> [#I6G1JN](https://gitee.com/dotnetchina/Furion/issues/I6G1JN)

</div>
  </div>
</details>

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion 2.4.4 +` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

import useBaseUrl from "@docusaurus/useBaseUrl";

## 30.1 å…³äºè„±æ•

å¼•ç”¨ç™¾åº¦ç™¾ç§‘ï¼š

> æ•°æ®è„±æ•æ˜¯æŒ‡å¯¹æŸäº›æ•æ„Ÿä¿¡æ¯é€šè¿‡è„±æ•è§„åˆ™è¿›è¡Œæ•°æ®çš„å˜å½¢ï¼Œå®ç°æ•æ„Ÿéšç§æ•°æ®çš„å¯é ä¿æŠ¤ã€‚åœ¨æ¶‰åŠå®¢æˆ·å®‰å…¨æ•°æ®æˆ–è€…ä¸€äº›å•†ä¸šæ€§æ•æ„Ÿæ•°æ®çš„æƒ…å†µä¸‹ï¼Œåœ¨ä¸è¿åç³»ç»Ÿè§„åˆ™æ¡ä»¶ä¸‹ï¼Œå¯¹çœŸå®æ•°æ®è¿›è¡Œæ”¹é€ å¹¶æä¾›æµ‹è¯•ä½¿ç”¨ï¼Œå¦‚èº«ä»½è¯å·ã€æ‰‹æœºå·ã€å¡å·ã€å®¢æˆ·å·ç­‰ä¸ªäººä¿¡æ¯éƒ½éœ€è¦è¿›è¡Œæ•°æ®è„±æ•ã€‚æ•°æ®å®‰å…¨æŠ€æœ¯ä¹‹ä¸€ï¼Œæ•°æ®åº“å®‰å…¨æŠ€æœ¯ä¸»è¦åŒ…æ‹¬ï¼šæ•°æ®åº“æ¼æ‰«ã€æ•°æ®åº“åŠ å¯†ã€æ•°æ®åº“é˜²ç«å¢™ã€æ•°æ®è„±æ•ã€æ•°æ®åº“å®‰å…¨å®¡è®¡ç³»ç»Ÿã€‚

åœ¨ `Furion` ç³»ç»Ÿä¸­ï¼Œ`è„±æ•å¤„ç†` æŒ‡çš„æ˜¯å¯¹ä¸ç¬¦åˆç³»ç»Ÿåˆæ³•è¯æ±‡æ£€æµ‹éªŒè¯ã€‚

## 30.2 å¦‚ä½•ä½¿ç”¨

`Furion` æ¡†æ¶å†…ç½®äº†ä¸€å¥—é»˜è®¤çš„è„±æ•è¯æ±‡è„±æ•å¤„ç†æœºåˆ¶ï¼Œå¹¶ä¸”æä¾›è‡ªå®šä¹‰æ“ä½œã€‚

### 30.2.1 æ³¨å†Œ `è„±æ•è¯æ±‡æ£€æµ‹` æœåŠ¡

```cs showLineNumbers  {3}
public void ConfigureServices(IServiceCollection services)
{
    services.AddSensitiveDetection();
}
```

### 30.2.2 åˆ›å»º `sensitive-words.txt` æ–‡ä»¶

åœ¨ `Web` å¯åŠ¨å±‚é¡¹ç›®ä¸­åˆ›å»º `sensitive-words.txt` æ–‡ä»¶ï¼Œ**ç¡®ä¿é‡‡ç”¨ `UTF-8` ç¼–ç æ ¼å¼ï¼ˆ`Furion 4.8.6.7+` æ”¯æŒ `UTF8 BOM` ç¼–ç æ ¼å¼ï¼‰ ä¸”è®¾ç½®ä¸ºåµŒå…¥å¼èµ„æºï¼**

`sensitive-words.txt` å†…å®¹æ ¼å¼ä¸ºæ¯ä¸€è¡Œæ ‡è¯†ä¸€ä¸ªè„±æ•è¯æ±‡ï¼š

```showLineNumbers
åäºº
æ— è¯­
æ»šå¼€
å…«å˜
```

:::tip `Furion 3.8.9+` ç‰ˆæœ¬

åœ¨ `Furion 3.8.9+` ç‰ˆæœ¬æ”¯æŒ `|` åˆ†éš”ç¬¦è¿›è¡Œåˆ†å‰²ï¼Œä¹ŸåŒæ—¶æ”¯æŒ `æ¢è¡Œ` å’Œ `|` æ··ç”¨ï¼Œå¦‚ï¼š

```showLineNumbers
åäºº|æ— è¯­|æ»šå¼€
å…«å˜
```

**æ¨èä½¿ç”¨ `|` æ–¹å¼ï¼Œå¯ä»¥èŠ‚çœè¯åº“å ç”¨å­˜å‚¨ç©ºé—´ã€‚**

:::

æ¥ä¸‹æ¥è®¾ç½®ä¸ºåµŒå…¥å¼èµ„æºï¼š

<img src={useBaseUrl("img/tm.png")} />

### 30.2.3 ä½¿ç”¨è„±æ•æ£€æµ‹

- **å®ç°æ•°æ®éªŒè¯è„±æ•æ£€æµ‹ `[SensitiveDetection]`**

`Furion` æ¡†æ¶æä¾›äº† `[SensitiveDetection]` éªŒè¯ç‰¹æ€§ï¼Œå¯ä»¥å¯¹å‚æ•°ã€å±æ€§è¿›è¡Œè„±æ•éªŒè¯ï¼Œç”¨æ³•å’Œ `[DataValidation]` ä¸€è‡´ï¼Œå¦‚ï¼š

```cs showLineNumbers  {4,9}
// åœ¨å±æ€§ä¸­ä½¿ç”¨
public class Content
{
    [SensitiveDetection]
    public string Text { get; set; }
}

// åœ¨ åŠ¨æ€API/Controller ä¸­ä½¿ç”¨
public void Test([SensitiveDetection] string text)
{

}
```

- **é€šè¿‡ `ISensitiveDetectionProvider` æœåŠ¡ä½¿ç”¨**

`Furion` æ¡†æ¶ä¹Ÿæä¾›äº† `ISensitiveDetectionProvider` æœåŠ¡è¿›è¡Œæ‰‹åŠ¨è„±æ•éªŒè¯å¤„ç†ï¼Œå¦‚ï¼š

```cs showLineNumbers  {4,15,25,35}
public class FurionService
{
    private readonly ISensitiveDetectionProvider _sensitiveDetectionProvider;
    public FurionService(ISensitiveDetectionProvider sensitiveDetectionProvider)
    {
        _sensitiveDetectionProvider = sensitiveDetectionProvider;
    }

    /// <summary>
    /// è·å–æ‰€æœ‰è„±æ•è¯æ±‡
    /// </summary>
    /// <returns></returns>
    public async Task<IEnumerable<string>> GetWordsAsync()
    {
        return await _sensitiveDetectionProvider.GetWordsAsync();
    }

    /// <summary>
    /// åˆ¤æ–­æ˜¯å¦æ˜¯æ­£å¸¸çš„è¯æ±‡
    /// </summary>
    /// <param name="text"></param>
    /// <returns></returns>
    public async Task<bool> VaildedAsync(string text)
    {
        return await _sensitiveDetectionProvider.VaildedAsync(text);
    }

    /// <summary>
    /// æ›¿æ¢éæ­£å¸¸è¯æ±‡
    /// </summary>
    /// <param name="text"></param>
    /// <returns></returns>
    public async Task<string> ReplaceAsync(string text)
    {
        return await _sensitiveDetectionProvider.ReplaceAsync(text, '*');
    }
}
```

### 30.2.4 è„±æ•è¯æ±‡æ›¿æ¢

`Furion` æ¡†æ¶ä¹Ÿæä¾›äº†æ›¿æ¢è„±æ•è¯æ±‡çš„ç‰¹æ€§æ”¯æŒï¼Œå¦‚ï¼š

```cs showLineNumbers  {4}
// åœ¨å±æ€§ä¸­ä½¿ç”¨
public class Content
{
    [SensitiveDetection('*')]
    public string Text { get; set; }
}
```

:::caution ç‰¹åˆ«æ³¨æ„

åœ¨ `Furion 3.8.8+` ç‰ˆæœ¬åæ”¯æŒæ–¹æ³•ç‰¹æ€§ç›´æ¥æ›¿æ¢

```cs showLineNumbers  {1}
public void Test([SensitiveDetection('*')] string text)
{
}
```

:::

## 30.3 è‡ªå®šä¹‰è„±æ•è¯æ±‡å¤„ç†

`Furion` æ¡†æ¶é™¤äº†å†…ç½®äº†ä¸€å¥—é»˜è®¤çš„ `è„±æ•å¤„ç†` ç¨‹åºï¼Œä¹Ÿæ”¯æŒè‡ªå®šä¹‰è„±æ•å¤„ç†ç¨‹åºã€‚

### 30.3.1 è‡ªå®šä¹‰ `ISensitiveDetectionProvider` å®ç°

```cs showLineNumbers  {4,15,25,36}
/// <summary>
/// è‡ªå®šä¹‰è„±æ•è¯æ±‡æ£€æµ‹å™¨
/// </summary>
public class YourSensitiveDetectionProvider : ISensitiveDetectionProvider
{
    // æ”¯æŒæ„é€ å‡½æ•°æ³¨å…¥
    public YourSensitiveDetectionProvider()
    {
    }

    /// <summary>
    /// è¿”å›æ‰€æœ‰è„±æ•è¯æ±‡
    /// </summary>
    /// <returns></returns>
    public async Task<IEnumerable<string>> GetWordsAsync()
    {
        // è¿™é‡Œå†™ä½ è„±æ•è¯æ±‡æ•°æ®çš„æ¥æºï¼ˆå¦‚ä»æ•°æ®åº“è¯»å–ï¼‰ï¼Œå»ºè®®åšå¥½ç¼“å­˜æ“ä½œ
    }

    /// <summary>
    /// åˆ¤æ–­è„±æ•è¯æ±‡æ˜¯å¦æœ‰æ•ˆ
    /// </summary>
    /// <param name="text"></param>
    /// <returns></returns>
    public async Task<bool> VaildedAsync(string text)
    {
        // è¿™é‡Œå†™ä½ å¦‚ä½•åˆ¤æ–­æ˜¯æ­£å¸¸çš„å­—ç¬¦ï¼Œè¿”å› true æ­£å¸¸ï¼Œè¿”å› false è¡¨ç¤ºæ˜¯ä¸ªè„±æ•è¯æ±‡
    }

    /// <summary>
    /// æ›¿æ¢è„±æ•è¯æ±‡
    /// </summary>
    /// <param name="text"></param>
    /// <param name="transfer"></param>
    /// <returns></returns>
    public async Task<string> ReplaceAsync(string text, char transfer = '*')
    {
        // è¿™é‡Œå†™ä½ æ›¿æ¢éæ­£å¸¸å­—ç¬¦ä¸ºæŒ‡å®šå­—ç¬¦
    }
}
```

### 30.3.2 æ³¨å†Œè‡ªå®šä¹‰è„±æ•æä¾›å™¨

```cs showLineNumbers  {3}
public void ConfigureServices(IServiceCollection services)
{
    services.AddSensitiveDetection<YourSensitiveDetectionProvider>();
}
```

ä¹‹åç³»ç»Ÿå°†è‡ªåŠ¨é‡‡ç”¨è‡ªå®šä¹‰çš„æ–¹å¼è¿›è¡Œè„±æ•å¤„ç†ã€‚

## 30.4 åé¦ˆä¸å»ºè®®

:::note ä¸æˆ‘ä»¬äº¤æµ

ç»™ Furion æ [Issue](https://gitee.com/dotnetchina/Furion/issues/new?issue)ã€‚

:::

---
