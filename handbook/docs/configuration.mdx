---
id: configuration
title: 4.1 é…ç½®
sidebar_label: 4.1 é…ç½®
description: çº¦å®šå¤§äºé…ç½®ï¼Œé…ç½®å¤§äºç¡¬ç¼–ç 
---

import useBaseUrl from "@docusaurus/useBaseUrl";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

import Tag from "@site/src/components/Tag.js";

<details>
  <summary>ğŸ“ æ¨¡å—æ›´æ–°æ—¥å¿—</summary>
  <div>
<div>

- **æ–°ç‰¹æ€§**

  - &nbsp;<Tag>æ–°å¢</Tag> é…ç½®æ¨¡å— `IgnoreConfigurationFiles` æ”¯æŒå®Œæ•´çš„æ–‡ä»¶é€šé…ç¬¦ <sup>4.8.8.22</sup> <sup>â±ï¸2023.05.25</sup> [#I78ABL](https://gitee.com/dotnetchina/Furion/issues/I78ABL)

</div>
  </div>
</details>

:::caution è‡ªå®šä¹‰é…ç½®ç‰¹åˆ«æ³¨æ„

å¦‚ï¼š`xxxx.json`ï¼Œå¿…é¡»åœ¨ `VS Studio` ä¸­å³é”®å±æ€§è®¾ç½® `å¤åˆ¶` è¾“å‡ºç›®å½•ä¸º `å¦‚æœè¾ƒæ–°åˆ™å¤åˆ¶`ï¼Œç”Ÿæˆæ“ä½œä¸ºï¼š`å†…å®¹`ã€‚

å¦‚æœ `.json` æ–‡ä»¶é…ç½®åœ¨å¤šä¸ªé¡¹ç›®å±‚ï¼Œä¹Ÿå¿…é¡»ä¿è¯å‘½åå”¯ä¸€ï¼Œä¸ç„¶ç¼–è¯‘åå‡ºç°ç›¸äº’è¦†ç›–çš„æƒ…å†µã€‚

:::

:::tip ä¸­æ–‡ä¹±ç é—®é¢˜

é»˜è®¤æƒ…å†µä¸‹,`.json` æ–‡ä»¶å¹¶æœªé‡‡ç”¨ `utf-8` ç¼–ç ï¼Œæ‰€ä»¥å¦‚æœå­˜åœ¨ä¸­æ–‡è¯»å–åå°±ä¼šå‡ºç°ä¹±ç æƒ…å†µï¼Œè¿™æ—¶å€™ï¼Œåªéœ€è¦ä¿®æ”¹ `.json` æ–‡ä»¶ç¼–ç ä¸º `utf-8` å³å¯ã€‚

:::

## 4.1.1 ä»€ä¹ˆæ˜¯é…ç½®

ç®€å•æ¥è¯´ï¼Œé…ç½®å°†ç³»ç»Ÿåº”ç”¨å¯åŠ¨æ€è°ƒé…çš„é€‰é¡¹æ”¾åœ¨ç»Ÿä¸€åœ°æ–¹ç®¡ç†ï¼Œé€šè¿‡ä¸åŒçš„é…ç½®è®©ç³»ç»Ÿåšå‡ºåŠ¨æ€è°ƒæ•´ã€‚

åœ¨ `ASP.NET Core` åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶é»˜è®¤åŠ è½½ `å¯åŠ¨é¡¹ç›®` ä¸‹çš„ `appsettings.json` ä½œä¸ºåº”ç”¨é…ç½®ã€‚åŒæ—¶è¿˜æ”¯æŒ**ä¸åŒçš„è¿è¡Œç¯å¢ƒ**åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ï¼š

- `Development`ï¼šåŠ è½½ `appsettings.Development.json`
- `Staging`ï¼šåŠ è½½ `appsettings.Staging.json`
- `{Environment}`ï¼š`appsettings.{Environment}.json`

## 4.1.2 é…ç½®çš„ä½¿ç”¨

å‡è®¾æˆ‘ä»¬éœ€è¦åœ¨ç³»ç»Ÿè¿è¡Œæ—¶è·å–**ç³»ç»Ÿåç§°ã€ç‰ˆæœ¬å·åŠç‰ˆæƒä¿¡æ¯**ï¼Œè¿™äº›ä¿¡æ¯å¯èƒ½éšæ—¶å˜åŒ–è€Œä¸”éœ€è¦åœ¨å¤šä¸ªåœ°æ–¹ä½¿ç”¨ã€‚è¿™æ—¶å°±éœ€è¦å°†è¿™äº›ä¿¡æ¯é…ç½®èµ·æ¥ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

### 4.1.2.1 é…ç½® `appsettings.json` ä¿¡æ¯

```json showLineNumbers  {2-6}
{
  "AppInfo": {
    "Name": "Furion",
    "Version": "1.0.0",
    "Company": "Baiqian"
  }
}
```

:::caution ç‰¹åˆ«æ³¨æ„

`appsettings.json` å¤åˆ¶è¾“å‡ºç›®å½•ä¸º`å¦‚æœè¾ƒæ–°åˆ™å¤åˆ¶`ï¼Œç”Ÿæˆæ“ä½œä¸ºï¼š`å†…å®¹`ã€‚

å¦å¤–ï¼ŒæŸäº› `linux` ç³»ç»Ÿä¸æ”¯æŒè¯»å–å¸¦ `æ³¨é‡Š` çš„ json æ–‡ä»¶ï¼Œç›´æ¥è¯»å–å°†ä¼šæŠ¥é”™ã€‚éœ€è¦å°† `json` å†…çš„æ³¨é‡Šå…¨éƒ¨ `åˆ é™¤` æ‰èƒ½æ­£å¸¸è¯»å–ã€‚

:::

### 4.1.2.2 è¯»å– `appsettings.json` ä¿¡æ¯

åœ¨ `Furion` æ¡†æ¶ä¸­ï¼Œæä¾›äº†ä¸¤ç§è¯»å–æ–¹å¼ï¼š

- ä¾èµ–æ³¨å…¥ `IConfiguration` å¯¹è±¡è¯»å–
- é€šè¿‡ `App.Configuration[path]` è¯»å–

<Tabs
  defaultValue="App.Configuration[path]"
  values={[
    {
      label: "App.Configuration[path]",
      value: "App.Configuration[path]",
    },
    { label: "ä¾èµ–æ³¨å…¥æ–¹å¼", value: "ä¾èµ–æ³¨å…¥æ–¹å¼" }
  ]}
>
  <TabItem value="App.Configuration[path]">

```cs showLineNumbers  {11-13}
using Microsoft.AspNetCore.Mvc;

namespace Furion.Web.Entry.Controllers
{
    [Route("api/[controller]")]
    public class DefaultController : ControllerBase
    {
        [HttpGet]
        public string Get()
        {
            return $@"åç§°ï¼š{App.Configuration["AppInfo:Name"]}ï¼Œ
                      ç‰ˆæœ¬ï¼š{App.Configuration["AppInfo:Version"]}ï¼Œ
                      å…¬å¸ï¼š{App.Configuration["AppInfo:Company"]}";
        }
    }
}
```

  </TabItem>
  <TabItem value="ä¾èµ–æ³¨å…¥æ–¹å¼">

```cs showLineNumbers  {2,10-15}
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Configuration;

namespace Furion.Web.Entry.Controllers
{
    [Route("api/[controller]")]
    public class DefaultController : ControllerBase
    {
        [HttpGet]
        public string Get([FromServices] IConfiguration configuration)
        {
            return $@"åç§°ï¼š{configuration["AppInfo:Name"]}ï¼Œ
                      ç‰ˆæœ¬ï¼š{configuration["AppInfo:Version"]}ï¼Œ
                      å…¬å¸ï¼š{configuration["AppInfo:Company"]}";
        }
    }
}
```

  </TabItem>
</Tabs>

:::tip ä¾èµ–æ³¨å…¥çš„æ–¹å¼

é€šè¿‡ä¾èµ–æ³¨å…¥æ³¨å…¥å®ä¾‹æœ‰å‡ ç§æ–¹å¼ï¼š

- æ„é€ å‡½æ•°æ³¨å…¥æ–¹å¼

```cs showLineNumbers  {2}
private readonly IConfiguration _configuration;
public DefaultController(IConfiguration configuration)
{
    _configuration = configuration;
}
```

- å‚æ•°æ³¨å…¥æ–¹å¼ `[FromServices]`

```cs showLineNumbers  {1}
public string Get([FromServices] IConfiguration configuration)
{
}
```

- å±æ€§æ³¨å…¥æ–¹å¼

```cs showLineNumbers  {1}
public IConfiguration Configuration { get; set; }
```

æƒ³äº†è§£æ›´å¤šå…³äºã€Š[ASP.NET Core - ä¾èµ–æ³¨å…¥](https://docs.microsoft.com/zh-cn/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-3.1)ã€‹ çŸ¥è¯†

:::

### 4.1.2.3 å¦‚ä½•é€‰æ‹©è¯»å–æ–¹å¼

- åœ¨å¯ä¾èµ–æ³¨å…¥ç±»ä¸­ï¼Œä¾èµ–æ³¨å…¥ `IConfiguration` è¯»å–
- åœ¨é™æ€ç±»/éä¾èµ–æ³¨å…¥ç±»ä¸­ï¼Œé€‰æ‹© `App.Configuration[path]` è¯»å–

### 4.1.2.4 è¯»å–é…ç½®å¹¶è½¬æ¢æˆç‰¹å®šç±»å‹

`ASP.NET Core` å’Œ `Furion` æä¾›äº†å¤šç§é…ç½®ç±»å‹è¯»å–å¹¶è½¬æ¢æˆç‰¹å®šç±»å‹ï¼ŒåŒ…æ‹¬åŸºç¡€ç±»å‹ï¼Œå¯¹è±¡ç±»å‹ï¼Œæ•°ç»„ï¼Œé›†åˆï¼Œå­—å…¸ç­‰ç­‰ï¼Œå¦‚ï¼š

```cs showLineNumbers {2,5}
// ASP.NET Core
var data = Configuration.GetSection("é…ç½®èŠ‚ç‚¹").Get<ç±»å‹>();

// Furionï¼Œæ¨èï¼ï¼ï¼
var data = App.GetConfig<ç±»å‹>("é…ç½®èŠ‚ç‚¹");
```

## 4.1.3 `è·¯å¾„ç¬¦` æŸ¥æ‰¾èŠ‚ç‚¹

åœ¨ `ASP.NET Core` ä¸­ï¼Œé…ç½®é‡‡ç”¨ `:` åˆ†éš”ç¬¦æ¥è¯»å–åˆ†å±‚é…ç½®æ•°æ®ã€‚å¦‚ä¸Šè¿°ä¾‹å­ä¸­çš„ `AppInfo:Name`ã€‚å¦‚æœ‰æ›´å¤šå±‚çº§æ•°æ®åˆ™åªéœ€è¦é€šè¿‡ `:` è¿›å…¥ä¸‹ä¸€å±‚èŠ‚ç‚¹å³å¯ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹é…ç½®ä¿¡æ¯ï¼š

```json showLineNumbers  {5-12}
{
  "AppInfo": {
    "Name": "Furion",
    "Version": "1.0.0",
    "Company": {
      "Name": "Baiqian",
      "Address": {
        "City": "ä¸­å›½",
        "Province": "å¹¿ä¸œçœ",
        "Detail": "ä¸­å±±å¸‚ä¸œåŒºç´«é©¬å…¬å›­è¥¿é—¨"
      }
    }
  }
}
```

<Tabs
  defaultValue="two"
  values={[
    { label: "è¯»å–ç¬¬äºŒå±‚", value: "two" },
    { label: "è¯»å–ç¬¬ä¸‰å±‚", value: "three" },
    { label: "è¯»å–ç¬¬å››å±‚", value: "four" },
    { label: "è¯»å–ç¬¬Nå±‚", value: "n" },
  ]}
>
  <TabItem value="two">

```cs showLineNumbers
var companyName = App.Configuration["AppInfo:Name"]; // => Furion
```

  </TabItem>
  <TabItem value="three">

```cs showLineNumbers
var companyName = App.Configuration["AppInfo:Company:Name"]; // => Baiqian
```

  </TabItem>
  <TabItem value="four">

```cs showLineNumbers
var companyName = App.Configuration["AppInfo:Company:Address:Detail"]; // => ä¸­å±±å¸‚ä¸œåŒºç´«é©¬å…¬å›­è¥¿é—¨
```

  </TabItem>
  <TabItem value="n">

```cs showLineNumbers
var companyName = App.Configuration["AppInfo:Tier2:Tier3:Tier4...Tiern1:Tiern3..."]; // => ä¸­å±±å¸‚ä¸œåŒºç´«é©¬å…¬å›­è¥¿é—¨
```

  </TabItem>
</Tabs>

### 4.1.3.1 æŸ¥æ‰¾æ•°ç»„èŠ‚ç‚¹

æœ‰äº›æ—¶å€™æˆ‘ä»¬éœ€è¦æˆ–è€…æ•°ç»„ç‰¹å®šçš„æŸäº›ï¼Œå¯ä»¥é€šè¿‡ `App.Configuration["array:0"]` è·å–ï¼Œ`0` æ˜¯ç´¢å¼•æ•°å­—ã€‚

## 4.1.4 è‡ªå®šä¹‰é…ç½®æ–‡ä»¶

:::important XML é…ç½®è¯´æ˜

`Furion v2.8.0` ç‰ˆæœ¬ç§»é™¤äº† `.xml` æ–‡ä»¶è‡ªåŠ¨æ‰«æé…ç½®äº†ï¼Œæ”¹ä¸ºæ‰‹åŠ¨æ·»åŠ é…ç½®ã€‚

:::

å¤§å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„é…ç½®åªéœ€è¦åœ¨ `appsettings.json` ä¸­é…ç½®å³å¯ï¼Œä½†ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æŸäº›ç»„ä»¶æˆ–åŠŸèƒ½æ‹¥æœ‰ç‹¬ç«‹çš„é…ç½®ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°è‡ªå®šä¹‰é…ç½®ï¼Œ`Furion` ç›®å‰æ”¯æŒ `.json` å’Œ `.xml` ä¸¤ç§æ–¹å¼é…ç½®ï¼Œå¦‚ï¼š

```json showLineNumbers  {2-13} title="Furion.Web.Entry/emailsetting.json"
{
  "outlook": {
    "smtp": {
      "server": "smtp.office365.com",
      "port": "587",
      "ssl": "STARTTLS"
    },
    "pop": {
      "server": "outlook.office365.com",
      "port": "995",
      "ssl": "TLS"
    }
  }
}
```

```xml
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <MyKey>MyXMLFile Value</MyKey>
  <Position>
    <Title>Title from  MyXMLFile</Title>
    <Name>Name from MyXMLFile</Name>
  </Position>
  <Logging>
    <LogLevel>
      <Default>Information</Default>
      <Microsoft>Warning</Microsoft>
    </LogLevel>
  </Logging>
</configuration>
```

:::important xml é…ç½®äº‹é¡¹

å¦‚æœé‡‡ç”¨ `xml` é…ç½®ï¼Œé‚£ä¹ˆæ–‡ä»¶åå¿…é¡»ä»¥ `.config.xml` ç»“å°¾ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ã€‚

:::

:::important ç‰¹åˆ«è¯´æ˜

`Furion` æ¡†æ¶ä¼šåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰«ææ¯ä¸€ä¸ªé¡¹ç›®å±‚æ ¹ç›®å½•ä¸‹çš„ `*.json` æ–‡ä»¶åŠ å…¥é…ç½®ä¸­ï¼Œæ‰€ä»¥æ— éœ€æ‰‹å·¥é…ç½®ã€‚

æ–°å¢ `*.json` æ–‡ä»¶çš„å±æ€§ `å¤åˆ¶åˆ°è¾“å‡ºç›®å½•` è®¾ç½®ä¸ºå§‹ç»ˆå¤åˆ¶æˆ–è¾ƒæ–°å¤åˆ¶ï¼Œå¦åˆ™ä¸ä¼šè½½å…¥ã€‚å¦å¤–é…ç½®æ–‡ä»¶ä¸èƒ½å‡ºç°é‡åï¼Œä¹Ÿå°±æ˜¯ä¿è¯æ•´ä¸ªé¡¹ç›®ä¸­é…ç½®æ–‡ä»¶åå­—å”¯ä¸€ã€‚æ¯”å¦‚ä¸èƒ½åœ¨é `Web` å…¶ä»–å±‚å®šä¹‰ `appsettings.json` æ–‡ä»¶ã€‚

åœ¨ `v2.16.7+` ç‰ˆæœ¬ç‰ˆæœ¬ä¹‹åï¼Œæ”¯æŒè‡ªå®šä¹‰é…ç½®æ‰«æç›®å½•ï¼š

```json showLineNumbers
{
  "ConfigurationScanDirectories": ["ç›®å½•1åç§°", "ç›®å½•1åç§°/å­ç›®å½•åç§°"]
}
```

:::

åŒæ—¶ `Furion` æä¾›äº†éå¸¸çµæ´»çš„æ–¹å¼æ”¯æŒè‡ªå®šä¹‰é…ç½®æ–‡ä»¶è¯»å–ï¼Œå¦‚ï¼š

### 4.1.4.1 è¯»å– `emailsetting.json` é…ç½®

è¯»å–è‡ªå®šä¹‰é…ç½®æ–‡ä»¶å’Œè¯»å– `appsettings.json` ä¸€è‡´ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä»å¤šä¸ªé…ç½®æ–‡ä»¶ä¸­è¯»å–è¾“å…¥ï¼Œå¦‚ï¼š

<Tabs
  defaultValue="jtl"
  values={[
    {label: 'App.Configuration[path]', value: 'jtl'},
    {label: 'ä¾èµ–æ³¨å…¥æ–¹å¼', value: 'ylzr'}
  ]}>
  <TabItem value="jtl">

```cs showLineNumbers
var smtpServer = App.Configuration["outlook:smtp:server"]; // => smtp.office365.com
```

  </TabItem>
  <TabItem value="ylzr">

```cs showLineNumbers
var smtpServer = _configuration["outlook:smtp:server"]; // => smtp.office365.com
```

  </TabItem>
</Tabs>

### 4.1.4.2 æ’é™¤ç‰¹å®šé…ç½®æ–‡ä»¶

æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬ä¸éœ€è¦ `.json` æˆ– `.xml` è‡ªåŠ¨è½½å…¥é…ç½®ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å¯åŠ¨å±‚ `appsettings.json` ä¸­æ·»åŠ  `IgnoreConfigurationFiles` èŠ‚ç‚¹å³å¯ï¼š

```json showLineNumbers
{
  "IgnoreConfigurationFiles": ["runtime.json"]
}
```

:::tip é€šé…ç¬¦æ”¯æŒ

`Furion 4.8.8.22+` ç‰ˆæœ¬æ”¯æŒå®Œæ•´çš„é€šé…ç¬¦æ”¯æŒï¼Œå¦‚ï¼š

```json showLineNumbers
{
  "IgnoreConfigurationFiles": ["seed_*.json"]
}
```

é¢å¤–çŸ¥è¯†ï¼š[æ–‡ä»¶é€šé…ç¬¦è¯­æ³•](https://learn.microsoft.com/zh-cn/dotnet/core/extensions/file-globbing)ã€‚

:::

## 4.1.5 ä¸åŒç¯å¢ƒè¯»å–

åœ¨å®é™…åº”ç”¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ ¹æ®ä¸åŒçš„ç¯å¢ƒåŠ è½½ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ `æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²`ã€‚

è¿™æ—¶æˆ‘ä»¬åªéœ€è¦éµå¾ªç‰¹å®šå‘½åè§„èŒƒ `{name}.{Environment}.json` å³å¯ã€‚å¦‚ï¼š

- `appsettings.Development.json`
- `appsettings.Staging.json`
- `appsettings.Production.json`
- `emailsetting.Development.json`
- `emailsetting.Staging.json`
- `emailsetting.Production.json`

è¿™æ—¶ï¼Œ`ASP.NET Core` ä¼šåœ¨åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ä¸åŒç¯å¢ƒçš„é…ç½®æ–‡ä»¶ã€‚

## 4.1.6 é…ç½®æ›´æ”¹é€šçŸ¥ï¼ˆ`çƒ­æ›´æ–°`ï¼‰

åœ¨ `.NET Core` åº”ç”¨ç¨‹åºä¸­ï¼Œé…ç½®æ”¯æŒæ›´æ”¹é€šçŸ¥ï¼Œä¹Ÿå°±æ˜¯çƒ­æ›´æ–°æ“ä½œã€‚**ä¸€æ—¦ç›‘å¬åˆ° `appsetting.json` æˆ–è‡ªå®šä¹‰é…ç½®æ–‡ä»¶å‘ç”Ÿå˜åŠ¨ï¼Œå°±ä¼šè§¦å‘ `OnChange` æ–¹æ³•**ã€‚ä»£ç å¦‚ä¸‹ï¼š

```cs showLineNumbers  {2,4-5}
var appInfoConfiguration = App.Configuration.GetSection("AppInfo");
ChangeToken.OnChange(() => App.Configuration.GetReloadToken(), () =>
{
  var name = appInfoConfiguration["Name"];  // å®æ—¶çš„æœ€æ–°å€¼
  var version = appInfoConfiguration["Version"];  // å®æ—¶çš„æœ€æ–°å€¼
});
```

:::important ç›‘å¬å¯¹è±¡

å¦‚æœç›‘å¬å…¨å±€é…ç½®æ–‡ä»¶ä¼ å…¥ `App.Configuration.GetReloadToken()`ï¼Œå¦‚æœåªéœ€è¦ç›‘å¬ç‰¹å®šèŠ‚ç‚¹ï¼Œä¼ å…¥ `App.Configuration.GetSection("AppInfo")`

:::

## 4.1.7 æ‰‹åŠ¨æ·»åŠ é…ç½®æ–‡ä»¶

:::info è·å–è·¯å¾„è¯´æ˜

- è·å–é¡¹ç›®ç›®å½•ï¼š`AppContext.BaseDirectory`
- è·å–ç½‘ç«™æ ¹ç›®å½•ï¼š`Directory.GetCurrentDirectory()`

:::

æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬çš„é…ç½®æ–‡ä»¶æ²¡æœ‰æ”¾åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è½½å…¥è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

- æ–¹å¼ä¸€ï¼š**`appsettings.json`** ä¸­ ï¼ˆæ¨èï¼‰

:::important æ”¯æŒç‰ˆæœ¬

åœ¨ `v2.16.7+` ç‰ˆæœ¬æœ‰æ•ˆ

:::

```json showLineNumbers {2}
{
  "ConfigurationScanDirectories": ["ç›®å½•1åç§°", "ç›®å½•1åç§°/å­ç›®å½•åç§°"]
}
```

- æ–¹å¼äºŒï¼š**`.NET5`** ä¸­ `Program.cs` ä¸­é…ç½®

```cs showLineNumbers  {10,13}
public class Program
{
    public static void Main(string[] args)
    {
        CreateHostBuilder(args).Build().Run();
    }

    public static IHostBuilder CreateHostBuilder(string[] args) =>
        Host.CreateDefaultBuilder(args)
            .ConfigureAppConfiguration((hostingContext, config) =>
            {
                // åŠ è½½è‡ªå®šä¹‰é…ç½®
                config.AddJsonFile("MyConfig.json", optional: true, reloadOnChange: true);
            })
            .ConfigureWebHostDefaults(webBuilder =>
            {
                webBuilder.UseStartup<Startup>();
            });
}
```

- æ–¹å¼ä¸‰ï¼š**`.NET6`** ä¸­ `Program.cs` ä¸­é…ç½®

```cs showLineNumbers {2-4}
var builder = WebApplication.CreateBuilder(args)
builder.Configuration.AddJsonFile("MyConfig.json", optional: true, reloadOnChange: true);
// æ³¨æ„å…ˆæ·»åŠ é…ç½®å†åˆå§‹åŒ– Furion
builder.Inject();
var app = builder.Build();
app.Run();
```

å¦‚æœä½¿ç”¨ `Serve.Run()` æ¨¡å¼å¯ä½¿ç”¨ä¸‹åˆ—ä»£ç é…ç½®ï¼š

```cs showLineNumbers {2}
Serve.Run(RunOptions.Default.ConfigureConfiguration((env, configuration) => {
  configuration.AddJsonFile("MyConfig.json", optional: true, reloadOnChange: true);
}));
```

## 4.1.8 é…ç½®çš„ä¼˜ç¼ºç‚¹

- ä¼˜ç‚¹

  - èƒ½å¤Ÿåœ¨ç³»ç»Ÿè¿è¡Œæ—¶å¿«é€Ÿè¯»å–
  - æ— éœ€é¢å¤–é…ç½®

- ç¼ºç‚¹

  - å­˜åœ¨é‡å¤è¯»å–
  - é€šè¿‡ç¡¬ç¼–ç å­—ç¬¦ä¸²è¯»å–ï¼Œå®¹æ˜“å‡ºé”™
  - ä¸èƒ½è®¾ç½®é»˜è®¤å€¼
  - ä¸èƒ½åœ¨è¿è¡Œç¯å¢ƒä¸­åŠ¨æ€é…ç½®
  - ä¸èƒ½éªŒè¯é…ç½®æœ‰æ•ˆæ€§
  - ä¸æ”¯æŒæ›´æ”¹é€šçŸ¥

## 4.1.9 é…ç½®ä½¿ç”¨åœºæ™¯

å¦‚æœåªéœ€è¦**ä¸€æ¬¡æ€§è¯»å–**é…ç½®ä¿¡æ¯ï¼Œåˆ™ä½¿ç”¨é…ç½®ï¼Œå¦åˆ™åº”è¯¥ä½¿ç”¨ ã€Š[4.2 é€‰é¡¹](options.mdx)ã€‹ä»£æ›¿ã€‚

## 4.1.10 å®ç°é…ç½®ä¸­å¿ƒ

`ASP.NET Core` é™¤äº†é€šè¿‡é…ç½®æ–‡ä»¶è¯»å–é…ç½®ä¿¡æ¯å¤–ï¼Œè¿˜æ”¯æŒè‡ªå®šä¹‰ `é…ç½®æä¾›ç¨‹åº`ï¼Œé€šè¿‡ `é…ç½®æä¾›ç¨‹åº` å¯ä»¥å®ç°é…ç½®ä¸­å¿ƒï¼Œæ¯”å¦‚é€šè¿‡æ•°æ®åº“æä¾›é…ç½®ã€‚

å…·ä½“å®ç°æŸ¥çœ‹å¾®è½¯å®˜æ–¹æ–‡æ¡£ï¼š[https://docs.microsoft.com/zh-cn/aspnet/core/fundamentals/configuration/?view=aspnetcore-5.0#custom-configuration-provider](https://docs.microsoft.com/zh-cn/aspnet/core/fundamentals/configuration/?view=aspnetcore-5.0#custom-configuration-provider)

ä¸‹é¢ç»™å‡ºé›†æˆ `AgileConfig` ä¾‹å­ï¼š

:::important ç‰ˆæœ¬è¯´æ˜

ä»¥ä¸‹å†…å®¹ä»…é™ `Furion 4.4.9 +` ç‰ˆæœ¬ä½¿ç”¨ã€‚

:::

** `Serve.Run` æ–¹å¼ï¼š**

```cs showLineNumbers {2,4,6,12,14}
Serve.Run(RunOptions.Default.WithArgs(args)
    .ConfigureInject((builder, options) =>
    {
        options.ConfigureAppConfiguration((_, cfb) =>
        {
            cfb.AddAgileConfig(new AgileConfig.Client.ConfigClient(builder.Configuration), obj =>
            {
                Console.WriteLine($"{obj}");
            });
        });

        options.ConfigureWebServices((_, services) =>
        {
            services.AddAgileConfig();
        });
    })
);
```

** `.NET6+` æ–¹å¼**

```cs showLineNumbers {2,6,11,13}
var builder = WebApplication.CreateBuilder(args)
    .Inject((builder, options) =>
    {
        options.ConfigureAppConfiguration((_, cfb) =>
        {
            cfb.AddAgileConfig(new AgileConfig.Client.ConfigClient(builder.Configuration), obj =>
            {
                Console.WriteLine($"{obj}");
            });
        });
        options.ConfigureWebServices((_, services) =>
        {
            services.AddAgileConfig();
        });
    });
```

** `.NET5` æ–¹å¼ï¼š**

```cs showLineNumbers {13,15,17,22,24}
public class Program
{
    public static void Main(string[] args)
    {
        CreateHostBuilder(args).Build().Run();
    }

    public static IHostBuilder CreateHostBuilder(string[] args) =>
        Host.CreateDefaultBuilder(args)
            .ConfigureWebHostDefaults(webBuilder =>
            {
                webBuilder
                .Inject((builder, options) =>
                {
                    options.ConfigureAppConfiguration((_, cfb) =>
                    {
                        cfb.AddAgileConfig(new AgileConfig.Client.ConfigClient(cfb.Build()), obj =>
                        {
                            Console.WriteLine($"{obj}");
                        });
                    });
                    options.ConfigureWebServices((_, services) =>
                    {
                        services.AddAgileConfig();
                    });
                })
                .UseStartup<Startup>();
            });
}
```

## 4.1.11 é‡è½½é…ç½®

`Furion` ä¼šåœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™å¯¹ `IConfiguration` è¿›è¡Œé™æ€ç¼“å­˜ï¼Œå¦‚æœä½¿ç”¨äº† `App.Configuration` é™æ€å±æ€§ä¸”é…ç½®æ•°æ®å·²å‘ç”Ÿå˜æ›´ï¼Œåˆ™è°ƒç”¨ä»¥ä¸‹æ–¹æ³•åˆ·æ–°å³å¯ï¼š

```cs showLineNumbers
App.Configuration.Reload();
```

## 4.1.12 åé¦ˆä¸å»ºè®®

:::note ä¸æˆ‘ä»¬äº¤æµ

ç»™ Furion æ [Issue](https://gitee.com/dotnetchina/Furion/issues/new?issue)ã€‚

:::

---

:::note äº†è§£æ›´å¤š

æƒ³äº†è§£æ›´å¤š `é…ç½®` çŸ¥è¯†å¯æŸ¥é˜… [ASP.NET Core - é…ç½®](https://docs.microsoft.com/zh-cn/aspnet/core/fundamentals/configuration/?view=aspnetcore-5.0) ç« èŠ‚ã€‚

:::
