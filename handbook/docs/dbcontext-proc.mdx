---
id: dbcontext-proc
title: 9.14 å­˜å‚¨è¿‡ç¨‹æ“ä½œ
sidebar_label: 9.14 å­˜å‚¨è¿‡ç¨‹æ“ä½œ
---

:::important æ¸©é¦¨æç¤º

æ¨èä½¿ç”¨ ã€Š[9.18 Sql é«˜çº§ä»£ç†](dbcontext-sql-proxy.mdx)ã€‹ä»£æ›¿æœ¬ç« èŠ‚åŠŸèƒ½ã€‚`Sql é«˜çº§ä»£ç†` èƒ½å¤Ÿæä¾›æ›´å®¹æ˜“ä¸”æ›´æ˜“ç»´æŠ¤çš„æ–¹å¼ã€‚

:::

import useBaseUrl from "@docusaurus/useBaseUrl";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

## 9.14.1 å…³äºå­˜å‚¨è¿‡ç¨‹

å¼•ç”¨ç™¾åº¦ç™¾ç§‘ï¼š

> å­˜å‚¨è¿‡ç¨‹ï¼ˆStored Procedureï¼‰æ˜¯åœ¨å¤§å‹æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œä¸€ç»„ä¸ºäº†å®Œæˆç‰¹å®šåŠŸèƒ½çš„ SQL è¯­å¥é›†ï¼Œå®ƒå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œä¸€æ¬¡ç¼–è¯‘åæ°¸ä¹…æœ‰æ•ˆï¼Œç”¨æˆ·é€šè¿‡æŒ‡å®šå­˜å‚¨è¿‡ç¨‹çš„åå­—å¹¶ç»™å‡ºå‚æ•°ï¼ˆå¦‚æœè¯¥å­˜å‚¨è¿‡ç¨‹å¸¦æœ‰å‚æ•°ï¼‰æ¥æ‰§è¡Œå®ƒã€‚
>
> å­˜å‚¨è¿‡ç¨‹æ˜¯æ•°æ®åº“ä¸­çš„ä¸€ä¸ªé‡è¦å¯¹è±¡ã€‚åœ¨æ•°æ®é‡ç‰¹åˆ«åºå¤§çš„æƒ…å†µä¸‹åˆ©ç”¨å­˜å‚¨è¿‡ç¨‹èƒ½è¾¾åˆ°å€é€Ÿçš„æ•ˆç‡æå‡ã€‚

ç®€å•æ¥è¯´ï¼Œå­˜å‚¨è¿‡ç¨‹å°±æ˜¯å…³ç³»å‹æ•°æ®åº“ä¸­ï¼ˆ`Sqlite` é™¤å¤–ï¼‰ä¸­ç¼–å†™é€»è¾‘çš„å‡½æ•°/æ–¹æ³•ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥å°† `sql` ç¼–è¯‘ç¼“å­˜èµ·æ¥ï¼Œå¤§å¤§æé«˜å­˜å‚¨è¿‡ç¨‹çš„æ‰§è¡Œæ•ˆç‡ã€‚

**è¿™é‡Œä¸è®¨è®ºå­˜å‚¨è¿‡ç¨‹çš„ä¼˜ç¼ºç‚¹ã€‚**

### 9.14.2.0 æ”¯æŒå­˜å‚¨è¿‡ç¨‹çš„æ•°æ®åº“

| SqlServer | Sqlite | Cosmos | InMemoryDatabase | MySql | PostgreSQL | Oracle | Firebird | Dm  |
| --------- | ------ | ------ | ---------------- | ----- | ---------- | ------ | -------- | --- |
| âœ”         |        | âœ”      |                  | âœ”     | âœ”          | âœ”      | âœ”        | âœ”   |

## 9.14.2 å­˜å‚¨è¿‡ç¨‹ä½¿ç”¨

`Furion` æ¡†æ¶ä¸­æä¾›äº†å¤šç§å­˜å‚¨è¿‡ç¨‹æ“ä½œæ–¹å¼ï¼š

- `ISqlRepository`ï¼š`Sql` æ“ä½œä»“å‚¨ï¼Œå¯é€šè¿‡ `ä¾èµ–æ³¨å…¥`
- `ISqlDispatchProxy`ï¼š`Sql` ä»£ç†æ–¹å¼ï¼ˆé«˜çº§ç”¨æ³•ï¼Œæ¨èï¼‰
- é€šè¿‡ä»»æ„å®ä½“ä»“å‚¨æ“ä½œï¼š`personRepository.SqlProcedureQuery(procName)`
- é€šè¿‡å­—ç¬¦ä¸²æ‹“å±•æ–¹æ³•ï¼š`procName.SqlProcedureQuery()`
- é€šè¿‡ `repository.Sql().SqlProcedureQuery()` æ–¹å¼

### 9.14.2.1 åˆå§‹åŒ–æ–¹å¼

<Tabs
  defaultValue="one"
  values={[
    { label: "ISqlRepository", value: "one" },
    { label: "ISqlDispatchProxy", value: "two" },
    { label: "å®ä½“ä»“å‚¨æ–¹å¼", value: "three" },
    { label: "å­—ç¬¦ä¸²æ‹“å±•æ–¹å¼", value: "four" },
  ]}
>
  <TabItem value="one">

```cs showLineNumbers  {1,9-12}
using Furion.DatabaseAccessor;
using Furion.DynamicApiController;

namespace Furion.Application
{
    [DynamicApiController]
    public class SqlService
    {
        private ISqlRepository _sqlRepository;
        public SqlService(ISqlRepository sqlRepository)
        {
            _sqlRepository = sqlRepository;
        }
    }
}
```

  </TabItem>
  <TabItem value="two">

```cs showLineNumbers  {2,7,9-10}
using Furion.Core;
using Furion.DatabaseAccessor;
using System.Collections.Generic;

namespace Furion.Application
{
    public interface ISqlExecuteProxy : ISqlDispatchProxy
    {
        [SqlProcedure("proc_GetPersons")]
        List<Person> GetPersons(string keyword);
    }
}
```

```cs showLineNumbers  {9-12}
using Furion.DatabaseAccessor;
using Furion.DynamicApiController;

namespace Furion.Application
{
    [DynamicApiController]
    public class SqlService
    {
        private ISqlExecuteProxy _sqlExecuteProxy;
        public SqlService(ISqlExecuteProxy sqlExecuteProxy)
        {
            _sqlExecuteProxy = sqlExecuteProxy;
        }
    }
}
```

  </TabItem>
<TabItem value="three">

```cs showLineNumbers
var persons = personRepository.SqlProcedureQuery("proc_GetPersons");
```

  </TabItem>
  <TabItem value="four">

```cs showLineNumbers
var persons = "proc_GetPersons".SqlProcedureQuery();
```

  </TabItem>

</Tabs>

### 9.14.2.2 è¿”å› `DataTable`

```cs showLineNumbers
// ISqlRepository æ–¹æ³•
var dataTable = _sqlRepository.SqlProcedureQuery("proc_GetPersons");

// ISqlDispatchProxy æ–¹å¼
var dataTable = _sqlExecuteProxy.GetPersons();  // æ¨èæ–¹å¼

// å®ä½“ä»“å‚¨æ–¹å¼
var dataTable = _personRepository.SqlProcedureQuery("proc_GetPersons");

// IRepository éæ³›å‹æ–¹å¼
var dataTable = _repository.Sql().SqlProcedureQuery("proc_GetPersons");

// å˜æ€æ‡’äººæ–¹å¼ï¼Œç›´æ¥é€šè¿‡å­˜å‚¨è¿‡ç¨‹åæ‰§è¡Œ
var dataTable = "proc_GetPersons".SqlProcedureQuery();
```

:::note å…³äºå¼‚æ­¥

`Furion` æ¡†æ¶æ¯ä¸€ä¸ªæ•°æ®åº“æ“ä½œéƒ½æ”¯æŒå¼‚æ­¥æ–¹å¼ï¼Œç”±äºç¯‡å¹…æœ‰é™ï¼Œå°±ä¸åˆ—ä¸¾å¼‚æ­¥æ–¹å¼äº†ã€‚

:::

### 9.14.2.3 è¿”å› `DataSet`

```cs showLineNumbers
// ISqlRepository æ–¹æ³•
var dataSet = _sqlRepository.SqlProcedureQueries("proc_GetPersons");

// ISqlDispatchProxy æ–¹å¼
var dataSet = _sqlExecuteProxy.GetPersons();  // æ¨èæ–¹å¼

// å®ä½“ä»“å‚¨æ–¹å¼
var dataSet = _personRepository.SqlProcedureQueries("proc_GetPersons");

// IRepository éæ³›å‹æ–¹å¼
var dataSet = _repository.Sql().SqlProcedureQueries("proc_GetPersons");

// å˜æ€æ‡’äººæ–¹å¼ï¼Œç›´æ¥é€šè¿‡å­˜å‚¨è¿‡ç¨‹åæ‰§è¡Œ
var dataSet = "proc_GetPersons".SqlProcedureQueries();
```

:::note å…³äºå¼‚æ­¥

`Furion` æ¡†æ¶æ¯ä¸€ä¸ªæ•°æ®åº“æ“ä½œéƒ½æ”¯æŒå¼‚æ­¥æ–¹å¼ï¼Œç”±äºç¯‡å¹…æœ‰é™ï¼Œå°±ä¸åˆ—ä¸¾å¼‚æ­¥æ–¹å¼äº†ã€‚

:::

### 9.14.2.4 è¿”å› `List<T>`

```cs showLineNumbers
// ISqlRepository æ–¹æ³•
var list = _sqlRepository.SqlProcedureQuery<Person>("proc_GetPersons");

// ISqlDispatchProxy æ–¹å¼
var list = _sqlExecuteProxy.GetPersons();  // æ¨èæ–¹å¼

// å®ä½“ä»“å‚¨æ–¹å¼
var list = _personRepository.SqlProcedureQuery<Person>("proc_GetPersons");

// IRepository éæ³›å‹æ–¹å¼
var list = _repository.Sql().SqlProcedureQuery<Person>("proc_GetPersons");

// å˜æ€æ‡’äººæ–¹å¼ï¼Œç›´æ¥é€šè¿‡å­˜å‚¨è¿‡ç¨‹åæ‰§è¡Œ
var list = "proc_GetPersons".SqlProcedureQuery<Person>();
```

:::note å…³äºå¼‚æ­¥

`Furion` æ¡†æ¶æ¯ä¸€ä¸ªæ•°æ®åº“æ“ä½œéƒ½æ”¯æŒå¼‚æ­¥æ–¹å¼ï¼Œç”±äºç¯‡å¹…æœ‰é™ï¼Œå°±ä¸åˆ—ä¸¾å¼‚æ­¥æ–¹å¼äº†ã€‚

:::

### 9.14.2.5 è¿”å› `Tuple<T1,...T8>`

`Furion` æ¡†æ¶å¤§å¤§åˆ©ç”¨äº† `Tuple` çš„ç‰¹æ€§ï¼Œå°†è¿”å›å¤šä¸ªç»“æœé›†è½¬æˆ `Tuple<T1,...T8>` ç±»å‹

```cs showLineNumbers
// ISqlRepository æ–¹æ³•

// è¿”å›ä¸€ä¸ªç»“æœé›†
var list1 = _sqlRepository.SqlProcedureQueries<T1>("proc_GetPersons");

// è¿”å›ä¸¤ä¸ªç»“æœé›†
var (list1, list2) = _sqlRepository.SqlProcedureQueries<T1,T2>("proc_GetPersons");

// è¿”å›ä¸‰ä¸ªç»“æœé›†
var (list1, list2, list3) = _sqlRepository.SqlProcedureQueries<T1,T2,T3>("proc_GetPersons");

// è¿”å›å››ä¸ªç»“æœé›†
var (list1, list2, list3, list4) = _sqlRepository.SqlProcedureQueries<T1,T2,T3,T4>("proc_GetPersons");

// è¿”å›äº”ä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5) = _sqlRepository.SqlProcedureQueries<T1,T2,T3,T4,T5>("proc_GetPersons");

// è¿”å›å…­ä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5, list6) = _sqlRepository.SqlProcedureQueries<T1,T2,T3,T4,T5,T6>("proc_GetPersons");

// è¿”å›ä¸ƒä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5, list6, list7) = _sqlRepository.SqlProcedureQueries<T1,T2,T3,T4,T5,T6,T7>("proc_GetPersons");

// è¿”å›å…«ä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5, list6, list7, list8) = _sqlRepository.SqlProcedureQueries<T1,T2,T3,T4,T5,T6,T7,T8>("proc_GetPersons");

// ==================================

// ISqlDispatchProxy æ–¹å¼ï¼Œæ¨èæ–¹å¼ï¼Œè‡ªåŠ¨å¤„ç†å¤šä¸ªç»“æœé›†

// è¿”å›ä¸€ä¸ªç»“æœé›†
var list1 = _sqlRepository.GetDatas();

// è¿”å›ä¸¤ä¸ªç»“æœé›†
var (list1, list2) = _sqlRepository.GetDatas();

// è¿”å›ä¸‰ä¸ªç»“æœé›†
var (list1, list2, list3) = _sqlRepository.GetDatas();

// è¿”å›å››ä¸ªç»“æœé›†
var (list1, list2, list3, list4) = _sqlRepository.GetDatas();

// è¿”å›äº”ä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5) = _sqlRepository.GetDatas();

// è¿”å›å…­ä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5, list6) = _sqlRepository.GetDatas();

// è¿”å›ä¸ƒä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5, list6, list7) = _sqlRepository.GetDatas();

// è¿”å›å…«ä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5, list6, list7, list8) = _sqlRepository.GetDatas();

// ==================================

// å®ä½“ä»“å‚¨æ–¹å¼

// è¿”å›ä¸€ä¸ªç»“æœé›†
var list1 = _personRepository.SqlProcedureQueries<T1>("proc_GetPersons");

// è¿”å›ä¸¤ä¸ªç»“æœé›†
var (list1, list2) = _personRepository.SqlProcedureQueries<T1,T2>("proc_GetPersons");

// è¿”å›ä¸‰ä¸ªç»“æœé›†
var (list1, list2, list3) = _personRepository.SqlProcedureQueries<T1,T2,T3>("proc_GetPersons");

// è¿”å›å››ä¸ªç»“æœé›†
var (list1, list2, list3, list4) = _personRepository.SqlProcedureQueries<T1,T2,T3,T4>("proc_GetPersons");

// è¿”å›äº”ä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5) = _personRepository.SqlProcedureQueries<T1,T2,T3,T4,T5>("proc_GetPersons");

// è¿”å›å…­ä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5, list6) = _personRepository.SqlProcedureQueries<T1,T2,T3,T4,T5,T6>("proc_GetPersons");

// è¿”å›ä¸ƒä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5, list6, list7) = _personRepository.SqlProcedureQueries<T1,T2,T3,T4,T5,T6,T7>("proc_GetPersons");

// è¿”å›å…«ä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5, list6, list7, list8) = _personRepository.SqlProcedureQueries<T1,T2,T3,T4,T5,T6,T7,T8>("proc_GetPersons");

// ==================================

// IRepository éæ³›å‹æ–¹å¼

// è¿”å›ä¸€ä¸ªç»“æœé›†
var list1 = _repository.Sql().SqlProcedureQueries<T1>("proc_GetPersons");

// è¿”å›ä¸¤ä¸ªç»“æœé›†
var (list1, list2) = _repository.Sql().SqlProcedureQueries<T1,T2>("proc_GetPersons");

// è¿”å›ä¸‰ä¸ªç»“æœé›†
var (list1, list2, list3) = _repository.Sql().SqlProcedureQueries<T1,T2,T3>("proc_GetPersons");

// è¿”å›å››ä¸ªç»“æœé›†
var (list1, list2, list3, list4) = _repository.Sql().SqlProcedureQueries<T1,T2,T3,T4>("proc_GetPersons");

// è¿”å›äº”ä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5) = _repository.Sql().SqlProcedureQueries<T1,T2,T3,T4,T5>("proc_GetPersons");

// è¿”å›å…­ä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5, list6) = _repository.Sql().SqlProcedureQueries<T1,T2,T3,T4,T5,T6>("proc_GetPersons");

// è¿”å›ä¸ƒä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5, list6, list7) = _repository.Sql().SqlProcedureQueries<T1,T2,T3,T4,T5,T6,T7>("proc_GetPersons");

// è¿”å›å…«ä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5, list6, list7, list8) = _repository.Sql().SqlProcedureQueries<T1,T2,T3,T4,T5,T6,T7,T8>("proc_GetPersons");

// ==================================

// å˜æ€æ‡’äººæ–¹å¼ï¼Œç›´æ¥é€šè¿‡å­˜å‚¨è¿‡ç¨‹åæ‰§è¡Œ

// è¿”å›ä¸€ä¸ªç»“æœé›†
var list1 = "proc_GetPersons".SqlProcedureQueries<T1>();

// è¿”å›ä¸¤ä¸ªç»“æœé›†
var (list1, list2) = "proc_GetPersons".SqlProcedureQueries<T1,T2>();

// è¿”å›ä¸‰ä¸ªç»“æœé›†
var (list1, list2, list3) = "proc_GetPersons".SqlProcedureQueries<T1,T2,T3>();

// è¿”å›å››ä¸ªç»“æœé›†
var (list1, list2, list3, list4) = "proc_GetPersons".SqlProcedureQueries<T1,T2,T3,T4>();

// è¿”å›äº”ä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5) = "proc_GetPersons".SqlProcedureQueries<T1,T2,T3,T4,T5>();

// è¿”å›å…­ä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5, list6) = "proc_GetPersons".SqlProcedureQueries<T1,T2,T3,T4,T5,T6>();

// è¿”å›ä¸ƒä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5, list6, list7) = "proc_GetPersons".SqlProcedureQueries<T1,T2,T3,T4,T5,T6,T7>();

// è¿”å›å…«ä¸ªç»“æœé›†
var (list1, list2, list3, list4, list5, list6, list7, list8) = "proc_GetPersons".SqlProcedureQueries<T1,T2,T3,T4,T5,T6,T7,T8>();
```

:::note å…³äºå¼‚æ­¥

`Furion` æ¡†æ¶æ¯ä¸€ä¸ªæ•°æ®åº“æ“ä½œéƒ½æ”¯æŒå¼‚æ­¥æ–¹å¼ï¼Œç”±äºç¯‡å¹…æœ‰é™ï¼Œå°±ä¸åˆ—ä¸¾å¼‚æ­¥æ–¹å¼äº†ã€‚

:::

### 9.14.2.6 è¿”å› `å•è¡Œå•åˆ— object`

```cs showLineNumbers
// ISqlRepository æ–¹æ³•
var value = _sqlRepository.SqlProcedureScalar("proc_GetName");

// ISqlDispatchProxy æ–¹å¼
var value = _sqlExecuteProxy.GetName();  // æ¨èæ–¹å¼

// å®ä½“ä»“å‚¨æ–¹å¼
var value = _personRepository.SqlProcedureScalar("proc_GetName");

// IRepository éæ³›å‹æ–¹å¼
var value = _repository.Sql().SqlProcedureScalar("proc_GetName");

// å˜æ€æ‡’äººæ–¹å¼ï¼Œç›´æ¥é€šè¿‡å­˜å‚¨è¿‡ç¨‹åæ‰§è¡Œ
var value = "proc_GetName".SqlProcedureScalar();
```

:::note å…³äºå¼‚æ­¥

`Furion` æ¡†æ¶æ¯ä¸€ä¸ªæ•°æ®åº“æ“ä½œéƒ½æ”¯æŒå¼‚æ­¥æ–¹å¼ï¼Œç”±äºç¯‡å¹…æœ‰é™ï¼Œå°±ä¸åˆ—ä¸¾å¼‚æ­¥æ–¹å¼äº†ã€‚

:::

### 9.14.2.7 è¿”å› `å•è¡Œå•åˆ— <T>`

```cs showLineNumbers
// ISqlRepository æ–¹æ³•
var value = _sqlRepository.SqlProcedureScalar<string>("proc_GetName");

// ISqlDispatchProxy æ–¹å¼
var value = _sqlExecuteProxy.GetName();  // æ¨èæ–¹å¼

// å®ä½“ä»“å‚¨æ–¹å¼
var value = _personRepository.SqlProcedureScalar<string>("proc_GetName");

// IRepository éæ³›å‹æ–¹å¼
var value = _repository.Sql().SqlProcedureScalar<string>("proc_GetName");

// å˜æ€æ‡’äººæ–¹å¼ï¼Œç›´æ¥é€šè¿‡å­˜å‚¨è¿‡ç¨‹åæ‰§è¡Œ
var value = "proc_GetName".SqlProcedureScalar<string>();
```

:::note å…³äºå¼‚æ­¥

`Furion` æ¡†æ¶æ¯ä¸€ä¸ªæ•°æ®åº“æ“ä½œéƒ½æ”¯æŒå¼‚æ­¥æ–¹å¼ï¼Œç”±äºç¯‡å¹…æœ‰é™ï¼Œå°±ä¸åˆ—ä¸¾å¼‚æ­¥æ–¹å¼äº†ã€‚

:::

### 9.14.2.8 æ‰§è¡Œä½†æ— è¿”å›

```cs showLineNumbers
// ISqlRepository æ–¹æ³•
_sqlRepository.SqlProcedureNonQuery("proc_UpdateData");

// ISqlDispatchProxy æ–¹å¼
_sqlExecuteProxy.UpdateData();  // æ¨èæ–¹å¼

// å®ä½“ä»“å‚¨æ–¹å¼
_personRepository.SqlProcedureNonQuery("proc_UpdateData");

// IRepository éæ³›å‹æ–¹å¼
_repository.Sql().SqlProcedureNonQuery("proc_UpdateData");

// å˜æ€æ‡’äººæ–¹å¼ï¼Œç›´æ¥é€šè¿‡å­˜å‚¨è¿‡ç¨‹åæ‰§è¡Œ
"proc_UpdateData".SqlProcedureNonQuery();
```

:::note å…³äºå¼‚æ­¥

`Furion` æ¡†æ¶æ¯ä¸€ä¸ªæ•°æ®åº“æ“ä½œéƒ½æ”¯æŒå¼‚æ­¥æ–¹å¼ï¼Œç”±äºç¯‡å¹…æœ‰é™ï¼Œå°±ä¸åˆ—ä¸¾å¼‚æ­¥æ–¹å¼äº†ã€‚

:::

## 9.14.3 æ‰§è¡Œå¤æ‚å­˜å‚¨è¿‡ç¨‹

åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ç§ä¾‹å­éå¸¸å¤æ‚ï¼Œé‚£å°±æ˜¯æ—¢æœ‰ `INPUT` å‚æ•°ï¼Œåˆæœ‰ `OUTPUT` å‚æ•°ï¼Œè¿˜æœ‰ `RETURN` å‚æ•°ï¼ŒåŒæ—¶è¿˜è¾“å‡º ç»“æœé›† ğŸ’¥ï¼Œå¦‚ï¼š

```sql showLineNumbers  {3,4,10-12,15-17,22}
CREATE PROC PROC_Output
    @Id INT,    // è¾“å…¥å‚æ•°
    @Name NVARCHAR(32) OUTPUT,  // è¾“å‡ºå‚æ•°ï¼Œè¿˜å¸¦é•¿åº¦
    @Age INT OUTPUT // è¾“å‡ºå‚æ•°
AS
BEGIN
    SET @Name = 'Furion Output';

    // è¾“å‡ºç»“æœé›†
    SELECT *
    FROM dbo.Test
    WHERE Id > @Id;

    // è¾“å‡ºç»“æœé›†
    SELECT TOP 10
           *
    FROM dbo.Test;

    SET @Age = 27;

    // å¸¦ RETURN è¿”å›
    RETURN 10;
END;
```

### 9.14.3.1 åˆ›å»ºå‚æ•°æ¨¡å‹

```cs showLineNumbers  {1,10,13,16}
using Furion.DatabaseAccessor;
using System.Data;

namespace Furion.Application
{
    public class ProcOutputModel
    {
        public int Id { get; set; } // è¾“å…¥å‚æ•°

        [DbParameter(ParameterDirection.Output, Size = 32)]
        public string Name { get; set; }    // è¾“å‡ºå‚æ•°

        [DbParameter(ParameterDirection.Output)]
        public int Age { get; set; }    // è¾“å‡ºå‚æ•°

        [DbParameter(ParameterDirection.ReturnValue)]
        public int ReturnValue { get; set; }    // è¿”å›å€¼
    }
}
```

### 9.14.3.2 æ‰§è¡Œå¤æ‚å­˜å‚¨è¿‡ç¨‹

- ** `DataSet` ** æ–¹å¼

```cs showLineNumbers
// ISqlRepository æ–¹æ³•
ProcedureOutputResult result = _sqlRepository.SqlProcedureOutput("proc_Complex", new ProcOutputModel{});

// ISqlDispatchProxy æ–¹å¼
ProcedureOutputResult result = _sqlExecuteProxy.Complex(new ProcOutputModel{});  // æ¨èæ–¹å¼

// å®ä½“ä»“å‚¨æ–¹å¼
ProcedureOutputResult result = _personRepository.SqlProcedureOutput("proc_Complex", new ProcOutputModel{});

// IRepository éæ³›å‹æ–¹å¼
ProcedureOutputResult result = _repository.Sql().SqlProcedureOutput("proc_Complex", new ProcOutputModel{});

// å˜æ€æ‡’äººæ–¹å¼ï¼Œç›´æ¥é€šè¿‡å­˜å‚¨è¿‡ç¨‹åæ‰§è¡Œ
ProcedureOutputResult result = "proc_Complex".SqlProcedureOutput(new ProcOutputModel{});
```

```cs showLineNumbers
// è·å– OUTPUT å‚æ•°å€¼
var outputs = result.OutputValues;

// è·å– RETURN è¿”å›å€¼
var reval = result.ReturnValue;

// è·å–è¿”å›ç»“æœé›†
var dataSet = result.Result;
```

- `Tuple<T1,...T8>` æ–¹å¼

```cs showLineNumbers
// ISqlRepository æ–¹æ³•
ProcedureOutputResult<(List<Test>, List<Test>)> result = _sqlRepository.SqlProcedureOutput<(List<Test>, List<Test>)>("proc_Complex", new ProcOutputModel{});

// ISqlDispatchProxy æ–¹å¼
ProcedureOutputResult<(List<Test>, List<Test>)> result = _sqlExecuteProxy.Complex(new ProcOutputModel{});  // æ¨èæ–¹å¼

// å®ä½“ä»“å‚¨æ–¹å¼
ProcedureOutputResult<(List<Test>, List<Test>)> result = _personRepository.SqlProcedureOutput<(List<Test>, List<Test>)>("proc_Complex", new ProcOutputModel{});

// IRepository éæ³›å‹æ–¹å¼
ProcedureOutputResult<(List<Test>, List<Test>)> result = _repository.Sql().SqlProcedureOutput<(List<Test>, List<Test>)>("proc_Complex", new ProcOutputModel{});

// å˜æ€æ‡’äººæ–¹å¼ï¼Œç›´æ¥é€šè¿‡å­˜å‚¨è¿‡ç¨‹åæ‰§è¡Œ
ProcedureOutputResult<(List<Test>, List<Test>)> result = "proc_Complex".SqlProcedureOutput<(List<Test>, List<Test>)>(new ProcOutputModel{});
```

```cs showLineNumbers
// è·å– OUTPUT å‚æ•°å€¼
var outputs = result.OutputValues;

// è·å– RETURN è¿”å›å€¼
var reval = result.ReturnValue;

// è·å–è¿”å›ç»“æœé›†
var (list1,list2) = result.Result;
```

:::note å…³äºå¼‚æ­¥

`Furion` æ¡†æ¶æ¯ä¸€ä¸ªæ•°æ®åº“æ“ä½œéƒ½æ”¯æŒå¼‚æ­¥æ–¹å¼ï¼Œç”±äºç¯‡å¹…æœ‰é™ï¼Œå°±ä¸åˆ—ä¸¾å¼‚æ­¥æ–¹å¼äº†ã€‚

:::

## 9.14.3 å…³äº `[DbParameter]`

`[DbParameter]` ç‰¹æ€§æ˜¯ç”¨æ¥æ ‡æ³¨ `Sql`ï¼Œ`å‡½æ•°`ï¼Œ`å­˜å‚¨è¿‡ç¨‹` å‚æ•°çš„ï¼Œå¯é…ç½®å±æ€§ï¼š

- `Direction`ï¼šè®¾ç½®å‚æ•°æ–¹å‘ï¼Œ`ParameterDirection` æšä¸¾ç±»å‹ï¼Œé»˜è®¤ `ParameterDirection.Input`
- `DbType`ï¼šè®¾ç½®å‚æ•°ç±»å‹ï¼Œ`DbType` æšä¸¾ç±»å‹ï¼Œæ— é»˜è®¤
- `Size`ï¼šè®¾ç½®å‚æ•°é•¿åº¦çš„ï¼Œ`int` ç±»å‹

å…¶ä¸­ `Direction` å±æ€§æ˜¯é»˜è®¤æ„é€ å‡½æ•°å‚æ•°ã€‚

## 9.14.4 å…³äº `ProcedureOutputResult`

`ProcedureOutputResult` å’Œ `ProcedureOutputResult<TResult>` æ˜¯å¤æ‚å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œè¿”å›æ¨¡å‹ç±»ï¼Œæœ‰ä»¥ä¸‹å±æ€§ï¼š

- `OutputValues`ï¼šå¤šä¸ªè¾“å‡ºå€¼ï¼Œ`ProcedureOutputValue` ç±»å‹
- `ReturnValue`ï¼šè¿”å›å€¼ï¼Œ`object` ç±»å‹
- `Result`ï¼šç»“æœé›†ï¼Œéæ³›å‹ç‰ˆæœ¬æ˜¯ `DataSet`ç±»å‹ï¼Œå¦åˆ™æ˜¯ æ³›å‹ç±»å‹

## 9.14.5 å­˜å‚¨è¿‡ç¨‹å‚æ•°

æ‰€æœ‰ `sql` å‚æ•°éƒ½æ”¯æŒå››ç§æ–¹å¼ï¼š

- `DbParameter[]`ï¼šæ•°ç»„ç±»å‹
- `new {}`ï¼šåŒ¿åç±»å‹
- `new Class{}`ï¼šå¼ºç±»å‹ç±»å‹ï¼ˆæ”¯æŒå¤æ‚å­˜å‚¨è¿‡ç¨‹å‚æ•°ï¼‰
- `Dictionary<string,object>` ç±»å‹

## 9.14.6 åé¦ˆä¸å»ºè®®

:::note ä¸æˆ‘ä»¬äº¤æµ

ç»™ Furion æ [Issue](https://gitee.com/dotnetchina/Furion/issues/new?issue)ã€‚

:::
