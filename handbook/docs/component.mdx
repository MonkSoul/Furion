---
id: component
title: 3.2 ç»„ä»¶åŒ–å¯åŠ¨
sidebar_label: 3.2 ç»„ä»¶åŒ–å¯åŠ¨
description: ç»„ä»¶åŒ–é…ç½®ä¾èµ–æœåŠ¡æˆ–è®¸æ˜¯æœ€ä½³å®è·µ
---

import Tag from "@site/src/components/Tag.js";

<details>
  <summary>ğŸ“ æ¨¡å—æ›´æ–°æ—¥å¿—</summary>
  <div>
<div>

- **å…¶ä»–æ›´æ”¹**

  - &nbsp;<Tag>è°ƒæ•´</Tag> ç»„ä»¶ `Component` æ¨¡å¼æ”¯æŒ `[DependsOn]` æ”¯æŒç»§æ‰¿ <sup>4.8.8.16</sup> <sup>â±ï¸2023.05.15</sup> [#I733RF](https://gitee.com/dotnetchina/Furion/issues/I733RF)

</div>
  </div>
</details>

## 3.2.1 å†å²èƒŒæ™¯

åœ¨ `.NET Core 2+` ä¹‹åï¼Œå¾®è½¯æ¨å‡ºäº† `Startup.cs` æ¨¡å¼ï¼Œåœ¨è¿™æ ·çš„æ¨¡å¼ä¸­ï¼Œéœ€è¦ä»»ä½•æœåŠ¡æˆ–è€…ä¸­é—´ä»¶å¤„ç†ï¼Œåªéœ€è¦åœ¨ `Startup.cs` æ–‡ä»¶çš„ä¸¤ä¸ªæ–¹æ³•ï¼ˆ`ConfigureServices` å’Œ `Configure`ï¼‰ä¸­é…ç½®å³å¯ã€‚

**ä½†åœ¨ `.NET6` ä¹‹åï¼Œå¾®è½¯ä¸å†æ¨èä½¿ç”¨ `Startup.cs` æ¨¡å¼ã€‚**

åœ¨è¿™é‡Œï¼Œä¸é˜è¿° `Startup.cs` çš„ä¼˜ç‚¹ï¼Œå°±åˆ—ä¸¾å‡ ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„ç¼ºç‚¹ï¼š

- é»˜è®¤æƒ…å†µä¸‹å¿…é¡»æ”¾åœ¨å¯åŠ¨å±‚ä¸”ä¸»æœºå¯åŠ¨æ—¶éœ€é€šè¿‡ `.UseStartup<>` è¿›è¡Œæ³¨å†Œï¼Œæ­¤é—®é¢˜åœ¨ `Furion` å·²è§£å†³ `AppStartup`
- é…ç½®æœåŠ¡å¾ˆå®¹æ˜“ç¼–å†™å‡ºåˆè‡­åˆé•¿çš„ `service.AddXXX()` å’Œ `app.AddXXX()` ä»£ç ï¼Œä¸ç®¡æ˜¯é˜…è¯»æ€§å’Œçµæ´»æ€§å¤§å¤§å‡åˆ†
- **å¯¹æœåŠ¡æ³¨å†Œå’Œä¸­é—´ä»¶æ³¨å†Œæœ‰é¡ºåºè¦æ±‚ï¼Œä¸åŒçš„é¡ºåºå¯èƒ½äº§ç”Ÿä¸åŒçš„æ•ˆæœï¼Œç”šè‡³å‡ºç°å¼‚å¸¸**
- **ä¸èƒ½å®ç°æ¨¡å—åŒ–è‡ªåŠ¨è£…è½½æ³¨å†Œï¼Œæ·»åŠ æ–°çš„æ¨¡å—éœ€è¦æ‰‹åŠ¨æ³¨å†Œï¼Œæ³¨å†Œåˆå¾—è€ƒè™‘æ¨¡å—åŒ–ä¹‹é—´ä¾èµ–é¡ºåºé—®é¢˜**
- **ä¸èƒ½å¯¹æ¨¡å—æ³¨å†Œè¿›è¡Œç›‘è§†ï¼Œæ¯”å¦‚åŠ è½½ä¹‹å‰ï¼ŒåŠ è½½å¤±è´¥ï¼ŒåŠ è½½ä¹‹å**

## 3.2.2 å…ˆçœ‹ä¸€ä¸ªä¾‹å­

åœ¨ä¸€ä¸ªå¤§å‹çš„ `.NET Core` é¡¹ç›®ä¸­ï¼Œä¼šç»å¸¸çœ‹åˆ°è¿™æ ·çš„ä»£ç ï¼š

```cs showLineNumbers {12-26,31-50}
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;

namespace Furion.Web.Core;

public sealed class FurWebCoreStartup : AppStartup
{
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddCorsAccessor();
        services.AddControllers().AddInject();
        services.AddRemoteRequest();
        services.AddEventBus();
        services.AddAppLocalization();
        services.AddViewEngine();
        services.AddSensitiveDetection();
        services.AddVirtualFileServer();
        services.AddX();
        services.AddXX();
        services.AddXXX();
        services.AddXXXX();
        services.AddXXXXX();
        services.AddXXXXXX();
        // .....
    }

    public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
    {
        if (env.IsDevelopment())
        {
            app.UseDeveloperExceptionPage();
        }
        app.UseHttpsRedirection();
        app.UseRouting();
        app.UseCorsAccessor();
        app.UseAuthentication();
        app.UseAuthorization();
        app.UseInject();
        app.UseX();
        app.UseXX();
        app.UseXXX();
        app.UseXXXX();
        app.UseXXXXX();
        app.UseXXXXXX();
        app.UseEndpoints(endpoints =>
        {
            endpoints.MapControllers();
        });
    }
}
```

å¯èƒ½å¯¹äºå¤§éƒ¨åˆ† `.NET` å¼€å‘è€…æ¥è¯´è²Œä¼¼æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯ä»”ç»†ç§ç§ï¼Œè¿™é‡Œå……æ–¥ç€å¤§é‡çš„ `.AddXXXX()` å’Œ `.UseXXXX()`ï¼Œ**çœŸçš„ç¾è§‚ï¼ŒçœŸçš„å¥½å—**ï¼Ÿè€Œä¸”ç¨æœ‰ä¸æ…ç§»åŠ¨äº†å®ƒä»¬çš„æ³¨å†Œé¡ºåºå¯èƒ½ä¼šå¼•å‘ç¾éš¾ï¼Œè¿˜æœ‰å¯èƒ½å¤šä¸ªæœåŠ¡ä¹‹é—´ç›¸äº’ä¾èµ–ï¼Œè¦ä¹ˆå…¨éƒ¨ç§»é™¤ï¼Œè¦ä¹ˆå…¨éƒ¨ä¿ç•™ï¼Œæœªæ¥æ›¿ä»£ä½ å¼€å‘å²—ä½çš„äººçŸ¥é“å—ï¼Ÿ

**è¯•é—®ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯æ— è§£å—ï¼Ÿ**

## 3.2.3 å½“ç„¶æœ‰è§£

åœ¨ `Furion 3.7.3+` ç‰ˆæœ¬ä¹‹åï¼Œå€ŸåŠ© `Docker-Compose` çš„è®¾è®¡ç†å¿µï¼Œæ¨å‡ºäº†å…¨æ–°çš„ `Component ç»„ä»¶åŒ–` æ¨¡å¼ï¼Œé€šè¿‡ç»„ä»¶åŒ–å¼€å‘å¯ä»¥å®ç°ç»„ä»¶ä¹‹é—´ç›¸äº’ä¾èµ–ï¼Œç›¸äº’é“¾æ¥ï¼Œè¿˜å¯ä»¥å…±äº«å‚æ•°ï¼Œä½ ä»…ä»…éœ€è¦ç¼–å†™ä¸€ä¸ªå…¥å£ç»„ä»¶å³å¯ã€‚

**å…ˆçœ‹ä¸€ä¸ªä¾‹å­ï¼š**

- åˆ›å»º `EntryServiceComponent` å…¥å£æœåŠ¡ç»„ä»¶

```cs showLineNumbers {2,6}
// åˆ›å»ºå…¥å£æœåŠ¡ç»„ä»¶å®ç° IServeComponent æ¥å£
public sealed class EntryServiceComponent : IServiceComponent
{
    public void Load(IServiceCollection services, ComponentContext componentContext)
    {
        // åšä»»ä½•ä½ æƒ³åšçš„äº‹æƒ…ï¼Œå¦‚ service.AddYourInitService(); å¦‚æ·»åŠ ä½ çš„æ¨¡å—åˆå§‹åŒ–é…ç½®
    }
}
```

- é€šè¿‡ `AddComponent<>` æ³¨å†Œå…¥å£ç»„ä»¶

```cs showLineNumbers {2}
// é€šè¿‡ .AddComponent æ³¨å†Œä¸€ä¸ªå…¥å£æœåŠ¡ç»„ä»¶
Serve.Run(RunOptions.Default.AddComponent<EntryServiceComponent>());
```

**æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿå®é™…é¡¹ç›®çš„å¼€å‘éœ€æ±‚ï¼š**

1. éœ€è¦æ·»åŠ è·¨åŸŸæœåŠ¡ï¼Œåˆ›å»º `CorsServiceComponent` ç»„ä»¶

```cs showLineNumbers {1,5}
public sealed class CorsServiceComponent : IServiceComponent
{
    public void Load(IServiceCollection services, ComponentContext componentContext)
    {
        services.AddCorsAccessor();
    }
}
```

2. éœ€è¦æ·»åŠ åŠ¨æ€ `WebAPI` æœåŠ¡ï¼Œåˆ›å»º `DynamicApiServiceComponent` ç»„ä»¶

```cs showLineNumbers {1,5}
public sealed class DynamicApiServiceComponent : IServiceComponent
{
    public void Load(IServiceCollection services, ComponentContext componentContext)
    {
        services.AddDynamicApiControllers();
    }
}
```

3. éœ€è¦æ·»åŠ  `XXX` ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œåˆ›å»º `XXXServiceComponent` ç»„ä»¶

```cs showLineNumbers {1,5}
public sealed class XXXServiceComponent : IServiceComponent
{
    public void Load(IServiceCollection services, ComponentContext componentContext)
    {
        services.AddXXX();
    }
}
```

æœ‰äº†è¿™ä¹ˆå¤šæœåŠ¡ç»„ä»¶ï¼Œé‚£æ€ä¹ˆå°†å®ƒä»¬å…³è”èµ·æ¥å‘¢ï¼Œè€Œä¸”èƒ½å¤Ÿæ­£ç¡®çš„å¤„ç†å®ƒä»¬çš„é¡ºåºå‘¢ï¼Ÿæ¯”å¦‚ `AddXXX()` å¿…é¡»ç­‰ `AddDynamicApiControllers()` æ³¨å†Œæ‰èƒ½æ³¨å†Œï¼Œè¿™æ—¶å€™åªéœ€è¦ä¸º `XXXServiceComponent` æ·»åŠ ä¾èµ–å³å¯ï¼Œå¦‚ï¼š

```cs showLineNumbers {1-3}
[DependsOn(
    typeof(DynamicApiServiceComponent)
)]
public sealed class XXXServiceComponent : IServiceComponent
{
    // ....
}
```

è¿™æ ·è¡¨ç¤º `XXXServiceComponent` ä¾èµ– `DynamicApiServiceComponent` ç»„ä»¶ï¼Œåªæœ‰ `DynamicApiServiceComponent` å®Œæˆæ³¨å†Œæ‰ä¼šæ³¨å†Œ `XXXServiceComponent`ã€‚

é‚£ä¹ˆæœ€åçš„ `EntryServiceComponent` çš„ä»£ç å°†ä¼šæ˜¯ï¼š

```cs showLineNumbers {1-4}
[DependsOn(
    typeof(CorsServiceComponent),
    typeof(XXXServiceComponent)
)]
public sealed class EntryServiceComponent : IServiceComponent
{
   // ....
}
```

æœ€åç”Ÿæˆçš„è°ƒç”¨é¡ºåºä¸ºï¼š`AddCorsAccessor()` -> `AddDynamicApiControllers()` -> `AddXXX()` -> `AddEntry()`ã€‚

**çœ‹åˆ°è¿™é‡Œï¼Œæ˜¯å¦å·²æ‰¾åˆ°ç­”æ¡ˆï¼šæ¯ä¸€ä¸ªé¡¹ç›®åªæœ‰ä¸€ä¸ªå…¥å£ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶åªåšä¸€ä»¶äº‹ï¼Œç»„ä»¶ä¹‹é—´å¯ä»¥é€šè¿‡ `DependsOn` é…ç½®ä¾èµ–ï¼Œç»„ä»¶ä¹‹é—´è¿˜èƒ½å…±äº«ä¸Šä¸‹æ–‡æ•°æ® `ComponentContext`ã€‚**

æ²¡é”™ï¼Œè¿™å°±æ˜¯ Furion ç›®å‰èƒ½å¤Ÿæƒ³åˆ°çš„æœ€ä¼˜è§£å†³æ–¹æ¡ˆã€‚

## 3.2.4 `IComponent`

åœ¨ `Furion 3.7.3+` ç‰ˆæœ¬ï¼Œæ–°å¢äº† `Components` æ¨¡å—ï¼Œè¯¥æ¨¡å—çš„æ ¹æ¥å£ä¸º `IComponent`ï¼Œå«æœ‰ä¸¤ä¸ªæ´¾ç”Ÿæ¥å£ `IServiceComponent` å’Œ `IApplicationComponent`ã€‚

### 3.2.4.1 `IServiceComponent`

`IServiceComponent` æ¥å£ç®€ç§°**æœåŠ¡ç»„ä»¶**å¯¹åº”çš„æ˜¯ `Startup.cs` ä¸­çš„ `ConfigureService`ï¼Œæ¥å£ç­¾åä¸ºï¼š

```cs showLineNumbers {6,13}
namespace System;

/// <summary>
/// æœåŠ¡ç»„ä»¶ä¾èµ–æ¥å£
/// </summary>
public interface IServiceComponent : IComponent
{
    /// <summary>
    /// è£…è½½æœåŠ¡
    /// </summary>
    /// <param name="services"><see cref="IServiceCollection"/></param>
    /// <param name="componentContext">ç»„ä»¶ä¸Šä¸‹æ–‡</param>
    void Load(IServiceCollection services, ComponentContext componentContext);
}
```

éœ€è¦æ³¨å†ŒæœåŠ¡å¯åœ¨ `Load` æ–¹æ³•ä¸­æ³¨å†Œå³å¯ã€‚

### 3.2.4.2 `IApplicationComponent`

`IApplicationComponent` æ¥å£ç®€ç§°**ä¸­é—´ä»¶ç»„ä»¶**å¯¹åº”çš„æ˜¯ `Startup.cs` ä¸­çš„ `Configure`ï¼Œæ¥å£ç­¾åä¸ºï¼š

```cs showLineNumbers {6,14}
namespace System;

/// <summary>
/// åº”ç”¨ä¸­é—´ä»¶æ¥å£
/// </summary>
public interface IApplicationComponent : IComponent
{
    /// <summary>
    /// è£…ç½®ä¸­é—´ä»¶
    /// </summary>
    /// <param name="app"><see cref="IApplicationBuilder"/></param>
    /// <param name="env"><see cref="IWebHostEnvironment"/></param>
    /// <param name="componentContext">ç»„ä»¶ä¸Šä¸‹æ–‡</param>
    void Load(IApplicationBuilder app, IWebHostEnvironment env, ComponentContext componentContext);
}
```

éœ€è¦æ³¨å†Œä¸­é—´ä»¶å¯åœ¨ `Load` æ–¹æ³•ä¸­æ³¨å†Œå³å¯ã€‚

### 3.2.4.3 `IWebComponent`

`IWebComponent` æ¥å£ç®€ç§°** `Web` ç»„ä»¶**å¯¹åº”çš„æ˜¯ `Program.cs` ä¸­çš„ `WebApplicationBuilder`ï¼Œæ¥å£ç­¾åä¸ºï¼š

```cs showLineNumbers {6,13}
namespace System;

/// <summary>
/// WebApplicationBuilder ç»„ä»¶ä¾èµ–æ¥å£
/// </summary>
public interface IWebComponent : IComponent
{
    /// <summary>
    /// è£…ç½® Web åº”ç”¨æ„å»ºå™¨
    /// </summary>
    /// <param name="app"><see cref="WebApplicationBuilder"/></param>
    /// <param name="componentContext">ç»„ä»¶ä¸Šä¸‹æ–‡</param>
    void Load(WebApplicationBuilder builder, ComponentContext componentContext);
}
```

éœ€è¦æ³¨å†Œä¸­é—´ä»¶å¯åœ¨ `Load` æ–¹æ³•ä¸­æ³¨å†Œå³å¯ã€‚

### 3.2.4.4 æ³¨å†Œç»„ä»¶

`Furion` æä¾›äº†å¤šç§æ³¨å†Œç»„ä»¶çš„æ–¹å¼ï¼š

- æ–¹å¼ä¸€

é€šè¿‡ `RunOptions`ï¼Œ`LegacyRunOptions`ï¼Œ`GenericRunOptions` æ–¹å¼ï¼š

```cs showLineNumbers {2-3,7}
Serve.Run(RunOptions.Default
    .AddComponent<TComponent>()
    .UseComponent<TComponent>());

// .NET6+ è¿˜æ”¯æŒ AddWebComponent<TComponent>();
Serve.Run(RunOptions.Default
    .AddWebComponent<TComponent>());
```

- æ–¹å¼äºŒ

é€šè¿‡ `services.AddComponent` å’Œ `app.UseComponent` æ–¹å¼

```cs showLineNumbers {2,5,8}
// æœåŠ¡ç»„ä»¶
service.AddComponent<TComponent>();

// ä¸­é—´ä»¶ç»„ä»¶
app.UseComponent<TComponent>();

// .NET6+ è¿˜æ”¯æŒ AddWebComponent<TComponent>();
builder.AddWebComponent<TComponent>();
```

- æ–¹å¼ä¸‰

ç»„ä»¶æ³¨å†Œå¯ä»¥ä¼ é€’å‚æ•°ï¼Œé€šè¿‡æœ€åçš„å‚æ•°æŒ‡å®šã€‚

```cs showLineNumbers {2,5,8}
// æœåŠ¡ç»„ä»¶
service.AddComponent<TComponent>(options);

// ä¸­é—´ä»¶ç»„ä»¶
app.UseComponent<TComponent>(options);

// .NET6+ è¿˜æ”¯æŒ AddWebComponent<TComponent>();
builder.AddWebComponent<TComponent>(options);
```

:::tip ç±»å‹ `Type` æ³¨å†Œæ–¹å¼

é™¤äº†æä¾›æ³›å‹æ³¨å†Œç»„ä»¶çš„æ–¹å¼ï¼Œè¿˜æä¾›äº† `.AddComponent(typeof(XXXComponent))` å’Œ `.UseComponent(typeof(XXXComponent))` æ–¹å¼ã€‚

:::

## 3.2.5 ç»„ä»¶è®¾è®¡åŸåˆ™

### 3.2.5.1 èŒè´£å•ä¸€æ€§

ç»„ä»¶çš„è®¾è®¡ç†åº”éµå¾ª**èŒè´£å•ä¸€æ€§åŸåˆ™**ï¼Œå…·æœ‰å•ä¸€æ€§åˆæœ‰èŒè´£æ˜ç¡®æ€§ï¼Œé€šä¿—ç‚¹è¯´æ¯ä¸€ä¸ªç»„ä»¶å°½å¯èƒ½çš„åªåšä¸€ä»¶äº‹ï¼Œå¦‚æœç»„ä»¶ä¹‹é—´æœ‰ä¾èµ–ï¼Œé€šè¿‡ `[DependsOn]` å£°æ˜é…ç½®ï¼Œå¦‚ï¼š

```cs showLineNumbers {1,5}
[DependsOn(
    typeof(OtherServiceComponent),
    "Other.Assembly;Other.Assembly.OtherServiceComponent"
)]
public sealed class YourServiceComponent : IServiceComponent
{
    public void Load(IServiceCollection services, ComponentContext componentContext)
    {
        services.AddXXX();
    }
}
```

### 3.2.5.2 çº¦å®šå¤§äºé…ç½®

ç”±äºç»„ä»¶é€šå¸¸åŒ…å«æœåŠ¡å’Œä¸­é—´ä»¶ä¸¤ä¸ªæ³¨å†Œï¼Œæ‰€ä»¥æ¨èç»„ä»¶ç±»çš„å‘½åç»Ÿä¸€ä¸ºï¼š`XXXComponent.cs`ï¼Œç„¶ååœ¨ `XXXComponent.cs` ä¸­åˆ†åˆ«å†™ `IServiceComponent` å’Œ `IApplicationComponent` ç»„ä»¶ã€‚

å°½å¯èƒ½æ¯ä¸€ä¸ªæœåŠ¡ç»„ä»¶ï¼ˆ`IServiceComponent`ï¼‰ä»¥ `ServiceComponent` ç»“å°¾ï¼Œæ¯ä¸€ä¸ªä¸­é—´ä»¶ç»„ä»¶ï¼ˆ`IApplicationComponent`ï¼‰ä»¥ `ApplicationComponent` ç»“å°¾ã€‚å¦‚ï¼š

```cs showLineNumbers {3-4,9-10,15-16} title="XXXComponent.cs"
namespace Your.Components;

// æœåŠ¡ç»„ä»¶
public sealed class XXXServiceComponent : IServiceComponent
{
    // ....
}

// ä¸­é—´ä»¶ç»„ä»¶
public sealed class XXXApplicationComponent : IApplicationComponent
{
    // ....
}

// WebApplicationBuilder ç»„ä»¶
public sealed class XXXWebComponent : IWebComponent
{
    // ....
}
```

:::tip å°çŸ¥è¯†

å¦‚æœæ²¡æœ‰ `IServiceComponent` æˆ– `IApplicationComponent`ï¼Œåˆ™å†™å…¶ä¸€å³å¯ã€‚

:::

## 3.2.6 `[DependsOn]` è¯¦è§£

ç”±äºç»„ä»¶å’Œç»„ä»¶ä¹‹é—´å­˜åœ¨ä¾èµ–æ–¹å¼ï¼Œç”šè‡³æ²¡æœ‰ä¾èµ–å…³ç³»ä½†æ”¯æŒå”¤é†’å…¶ä»–ç»„ä»¶åŠŸèƒ½ï¼Œæ‰€ä»¥ `Furion` æä¾›äº† `[DependsOn]` ç‰¹æ€§ã€‚

### 3.2.6.1 é…ç½®ä»‹ç»

- `DependsOn`
  - `DependComponents`ï¼šé…ç½®ç»„ä»¶ä¾èµ–å…³ç³»ï¼Œ`Type[]` ç±»å‹ï¼Œä¸€æ—¦é…ç½®äº†ä¾èµ–å…³ç³»ï¼Œé‚£ä¹ˆè¢«ä¾èµ–çš„ç»„ä»¶ä¼šå…ˆäºå½“å‰ç»„ä»¶æ³¨å†Œ
  - `Links`ï¼šé…ç½®ç»„ä»¶é“¾æ¥å…³ç³»ï¼Œ`Type[]` ç±»å‹ï¼Œè¯¥é…ç½®ä¸»è¦è§£å†³ä¸€äº›ç»„ä»¶å¹¶ä¸æ˜¯ä» `æ ¹ç»„ä»¶` è¿›è¡Œé…ç½®ï¼Œè€Œæ˜¯å¤„äºå’Œ `æ ¹ç»„ä»¶` å¹³è¡Œçš„æƒ…å†µï¼Œç±»ä¼¼å¤šå…¥å£ç»„ä»¶

:::tip æ„é€ å‡½æ•°è¯´æ˜

`DependComponents` æ˜¯ `DependsOnAttribute` ç‰¹æ€§çš„é»˜è®¤æ„é€ å‡½æ•°ï¼Œæ”¯æŒ `Type` å’Œ `String` ç±»å‹ï¼Œå¦‚ï¼š

```cs showLineNumbers {2-4}
[DependsOn(
    typeof(XXXComponent),
    typeof(XXXXComponent),
    "ç¨‹åºé›†;ç±»å‹å®Œæ•´é™å®šå" // ä¼šè‡ªåŠ¨åŠ è½½ç¨‹åºé›†ä¸­ç‰¹å®šçš„ç»„ä»¶ï¼Œåç»­æ¨¡å—åŒ–å¼€å‘éå¸¸æ–¹ä¾¿
)]
```

å¦‚éœ€é…ç½® `Links`ï¼Œåªéœ€è¦è¿™æ ·æ¥å£ï¼š

```cs showLineNumbers {3-6}
[DependsOn(
    typeof(XXXComponent),
    Links = new object[]{
        typeof(XXXComponent),
        typeof(XXXXComponent)
    }
)]
```

:::

### 3.2.6.2 é‡å¤ä¾èµ–é—®é¢˜

`Furion` æ¡†æ¶ä¸­å·²ç»å¤„ç†äº†ç»„ä»¶é‡å¤ä¾èµ–é—®é¢˜ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆå¥½æœ€ä½³çš„æ³¨å†Œé¡ºåºå¹¶å»é™¤é‡å¤ä¾èµ–æ³¨å†Œé—®é¢˜ã€‚

### 3.2.6.3 å¾ªç¯ä¾èµ–é—®é¢˜

å¾ªç¯ä¾èµ–å®é™…ä¸Šæ˜¯ä¸€ç§é”™è¯¯æ³¨å†Œç»„ä»¶çš„æ–¹å¼ï¼Œä¼šå¯¼è‡´å‡ºç°å†…å­˜æº¢å‡ºæƒ…å†µï¼Œæ—©æœŸç»„ä»¶åŒ–ç‰ˆæœ¬æ¡†æ¶å¤„ç†äº†å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ä¸»åŠ¨å¿½ç•¥æˆ–æŠ¥é”™ï¼Œä½†æ˜¯è€ƒè™‘æ­¤è¡Œä¸ºæœ¬èº«å¸¦æœ‰æ½œåœ¨çš„å®‰å…¨é—®é¢˜ï¼Œæ‰€ä»¥ç§»é™¤äº†å¾ªç¯ä¾èµ–å¤„ç†ï¼Œè€Œæ˜¯é€‰æ‹©åœ¨å¼€å‘é˜¶æ®µæŠ›å‡ºå¼‚å¸¸æ–¹å¼ã€‚

## 3.2.7 `ComponentContext` è¯¦è§£

`ComponentContext` æ˜¯ç»„ä»¶æ³¨å†Œ `Load` æ–¹æ³•çš„æœ€åå‚æ•°ï¼Œè¯¥å‚æ•°æä¾›äº†ç»„ä»¶ä¹‹é—´çš„ä¸€äº›å…ƒæ•°æ®ã€‚

### 3.2.7.1 å±æ€§ä»‹ç»

- `ComponentContext`
  - `ComponentType`ï¼šç»„ä»¶ç±»å‹ï¼Œ`Type` ç±»å‹
  - `CalledContext`ï¼šä¸Šçº§ç»„ä»¶ï¼Œ`ComponentContext` ç±»å‹ï¼Œä¹Ÿå°±æ˜¯ `DependsOn` ä¸­çš„ç»„ä»¶ä¸Šä¸‹æ–‡ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ˜¯å‰ä¸€ä¸ªç»„ä»¶çš„ä¸Šä¸‹æ–‡
  - `RootContext`ï¼šæ ¹ç»„ä»¶/å…¥å£ç»„ä»¶ï¼Œ`ComponentContext` ç±»å‹
  - `DependComponents`ï¼šç»„ä»¶ä¾èµ–çš„æ‰€æœ‰ç»„ä»¶åˆ—è¡¨ï¼Œ`Type[]` ç±»å‹
  - `LinkComponents`ï¼šç»„ä»¶é“¾æ¥çš„æ‰€æœ‰ç»„ä»¶åˆ—è¡¨ï¼Œ`Type[]` ç±»å‹

### 3.2.7.2 å‚æ•°é…ç½®/è·å–

åœ¨æ³¨å†Œç»„ä»¶å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `.AddComponent` å’Œ `.UseComponent` æœ€åçš„å‚æ•°æ¥æŒ‡å®šç»„ä»¶çš„å‚æ•°ï¼Œé‚£ä¹ˆå¦‚ä½•åœ¨ç»„ä»¶ä¸­è·å–ä½ ä¼ é€’çš„å‚æ•°å‘¢ï¼Ÿ

`ComponentContext` æä¾›äº†å¤šç§æ–¹æ³•ï¼š

- `GetProperty<TComponent, TComponentOptions>()`ï¼šè·å–ç»„ä»¶çš„å‚æ•°
- `GetProperty<TComponentOptions>(Type)`ï¼šé€šè¿‡ç±»å‹è·å–ç»„ä»¶å‚æ•°
- `GetProperty<TComponentOptions>(string)`ï¼šé€šè¿‡æŒ‡å®š `key` è·å–
- `GetProperties()`ï¼šè·å–ç»„ä»¶æ‰€æœ‰å‚æ•°åˆ—è¡¨ï¼ˆåŒ…æ‹¬ä¾èµ–ï¼Œé“¾æ¥ç­‰ï¼‰
- `SetProperty<TComponent>(object)`ï¼šè®¾ç½®ç‰¹å®šç»„ä»¶å‚æ•°
- `SetProperty(Type, object)`ï¼šè®¾ç½®ç‰¹å®šç±»å‹ç»„ä»¶çš„å‚æ•°
- `SetProperty(string, object)`ï¼šè®¾ç½®æŒ‡å®š `key` çš„å‚æ•°å€¼

#### ä¾‹å­è¯´æ˜

æ³¨å†Œæ—¶ä¼ å…¥ `EntryOption` å‚æ•°

```cs showLineNumbers
service.AddComponent<EntryServiceComponent>(new EntryOption {});
```

åœ¨ç»„ä»¶å†…éƒ¨è·å–ï¼š

```cs showLineNumbers {5,7}
public sealed class EntryServiceComponent : IServiceComponent
{
    public void Load(IServiceCollection services, ComponentContext componentContext)
    {
        var options = componentContext.GetProperty<EntryServiceComponent, EntryOption>();

        services.AddXXXX(options);
    }
}
```

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ `componentContext.SetProperty<XXXServiceComponent>(new xxxOptions{})` æ¥è®¾ç½®ä¸‹æ¸¸ç»„ä»¶çš„å‚æ•°ã€‚

## 3.2.8 å®ç° `Startup.cs` æ¨¡å¼

ç»„ä»¶æ¨¡å¼æ˜¯éå¸¸å¼ºå¤§ä¸”çµæ´»çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç»„ä»¶çš„æ¨¡å¼æ¨¡æ‹Ÿå‡ºä¼ ç»Ÿçš„ `Startup.cs`ï¼Œå¦‚ï¼š

```cs showLineNumbers {1,6-7,11,16-21} title="StartupComponent"
// æ¨¡æ‹Ÿ ConfigureService
public sealed class StartupServiceComponent : IServiceComponent
{
    public void Load(IServiceCollection services, ComponentContext componentContext)
    {
         services.AddControllers()
                        .AddInject();
    }
}

// æ¨¡æ‹Ÿ Configure
public sealed class StartupApplicationComponent : IApplicationComponent
{
    public void Load(IApplicationBuilder app, IWebHostEnvironment env, ComponentContext componentContext)
    {
        app.UseRouting();
        app.UseInject(string.Empty);
        app.UseEndpoints(endpoints =>
        {
            endpoints.MapControllers();
        });
    }
}
```

åªéœ€è¦é€šè¿‡ `service.AddComponent<StartupComponent>()` æ³¨å†Œå³å¯ï¼Œå¦‚æœä½¿ç”¨ `Serve.Run()` æ¨¡å¼å°†æ›´ç®€å•ï¼Œå¦‚ï¼š

```cs showLineNumbers {2-3}
Serve.Run(RunOptions.Default
            .AddComponent<StartupServiceComponent>()
            .UseComponent<StartupApplicationComponent>());
```

æ˜¯ä¸æ˜¯å¾ˆçµæ´»å•Š~

## 3.2.9 æœ€ä½³å®è·µï¼Ÿ

åœ¨å†™æœ€ä½³å®è·µæ—¶æ˜¯æœ€ç—›è‹¦çš„ï¼Œå› ä¸ºæœ€ä½³å®è·µåº”è¯¥æ˜¯æŠŠå¾®è½¯åº•å±‚æ‰€æœ‰çš„ `service.AddXXX` å’Œ `app.AddXXX` ç‹¬ç«‹æˆä¸€ä¸ªä¸ªç»„ä»¶ï¼Œæ¯”å¦‚ `servers.AddControllers()` å¯¹åº”ä¸€ä¸ª `ControllersServiceComponent`ã€‚

è¿™æ ·åšçš„è¯å·¥ä½œé‡æ˜¯éå¸¸å¤§çš„ï¼Œä½†å¦‚æœä¸è¿™æ ·åšï¼Œç»„ä»¶åŒ–å°±æ— æ³•å½»åº•ã€‚

æ‰€ä»¥ç°é˜¶æ®µæš‚æ—¶é‡‡ç”¨è‡ªç”±å®šåˆ¶ç»„ä»¶æ–¹å¼ï¼Œæ¯”å¦‚è‡ªå·±åœ¨é¡¹ç›®ä¸­ç¼–å†™ `ControllersServiceComponent` è¿™ç±»ç»„ä»¶ã€‚

## 3.2.10 åé¦ˆä¸å»ºè®®

:::note ä¸æˆ‘ä»¬äº¤æµ

ç»™ Furion æ [Issue](https://gitee.com/dotnetchina/Furion/issues/new?issue)ã€‚

:::
