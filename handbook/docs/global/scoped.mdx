---
id: scoped
title: 11. Scoped é™æ€ç±»
sidebar_label: 11. Scoped é™æ€ç±»
---

import Tag from "@site/src/components/Tag.js";

<details>
  <summary>ğŸ“ æ¨¡å—æ›´æ–°æ—¥å¿—</summary>
  <div>
<div>

- **é—®é¢˜ä¿®å¤**

  - &nbsp;<Tag>ä¿®å¤</Tag> `Scoped.CreateUowAsync` ä½œç”¨åŸŸå·¥ä½œå•å…ƒå¼‚å¸¸æ— æ³•å›æ»šé—®é¢˜ <sup>4.8.8.44</sup> <sup>â±ï¸2023.09.23</sup> [#I833I9](https://gitee.com/dotnetchina/Furion/issues/I833I9)

</div>
  </div>
</details>

## 11.1 åˆ›å»ºä¸€ä¸ªä¾èµ–æ³¨å…¥ä½œç”¨åŸŸèŒƒå›´

```cs showLineNumbers
// åŒæ­¥
Scoped.Create((factory, scope) => {
     var services = scope.ServiceProvider;
});

// å¼‚æ­¥
await Scoped.CreateAsync(async (factory, scope) => {
     var services = scope.ServiceProvider;
     await _calcService.GetAsync();
     // ...
})
```

:::important æ•°æ®åº“æ“ä½œæ³¨æ„

å¦‚æœä½œç”¨åŸŸä¸­å¯¹**æ•°æ®åº“æœ‰ä»»ä½•å˜æ›´æ“ä½œ**ï¼Œéœ€æ‰‹åŠ¨è°ƒç”¨ `SaveChanges` æˆ–å¸¦ `Now` ç»“å°¾çš„æ–¹æ³•ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ `Scoped.CreateUow(handler)` ä»£æ›¿ã€‚

:::

## 11.2 åˆ›å»ºä¸€ä¸ªå¸¦å·¥ä½œå•å…ƒçš„ä½œç”¨åŸŸ

```cs showLineNumbers
// åŒæ­¥
Scoped.CreateUow((factory, scope) => {
     var services = scope.ServiceProvider;
});

// å¼‚æ­¥
await Scope.CreateUowAsync(async (factory, scope) => {
     var services = scope.ServiceProvider;
     await _calcService.GetAsync();
     // ...
});
```

æ­¤æ–¹æ³•å°†åœ¨æ‰§è¡Œå®Œæ¯•ä¹‹åè‡ªåŠ¨è°ƒç”¨ `SaveChanges()`

## 11.3 åˆ›å»ºä¸€ä¸ªä¾èµ–æ³¨å…¥ä½œç”¨åŸŸèŒƒå›´ï¼ˆå¸¦è¿”å›å€¼ï¼‰

:::warning ç§»é™¤å£°æ˜

åœ¨ `Furion v2.18+` ç‰ˆæœ¬ç§»é™¤å¸¦è¿”å›å€¼çš„ä½œç”¨åŸŸï¼ˆè¯¥æ–¹æ³•å±äºå¤šä½™æ“ä½œï¼‰

:::

```cs showLineNumbers  {1}
var obj = Scoped.CreateRef<string>((factory, scope) => {
     var services = scope.ServiceProvider;
     return "è¿”å›å€¼";
});
```

## 11.4 åˆ›å»ºä¸€ä¸ªå¸¦å·¥ä½œå•å…ƒçš„ä½œç”¨åŸŸï¼ˆå¸¦è¿”å›å€¼ï¼‰

:::warning ç§»é™¤å£°æ˜

åœ¨ `Furion v2.18+` ç‰ˆæœ¬ç§»é™¤å¸¦è¿”å›å€¼çš„ä½œç”¨åŸŸï¼ˆè¯¥æ–¹æ³•å±äºå¤šä½™æ“ä½œï¼‰

:::

```cs showLineNumbers
var obj = Scoped.CreateUowRef<string>((factory, scope) => {
     var services = scope.ServiceProvider;
     return "è¿”å›å€¼";
});
```
