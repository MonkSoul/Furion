<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/furion/blog/rss.xml" title="Furion Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/furion/blog/atom.xml" title="Furion Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Furion" href="/furion/opensearch.xml"><title data-react-helmet="true">18. æ—¥å¿—è®°å½• | Furion</title><meta data-react-helmet="true" property="og:url" content="https://furion.pro/furion/docs/logging"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="18. æ—¥å¿—è®°å½• | Furion"><meta data-react-helmet="true" name="description" content="18.1 å…³äºæ—¥å¿—"><meta data-react-helmet="true" property="og:description" content="18.1 å…³äºæ—¥å¿—"><link data-react-helmet="true" rel="shortcut icon" href="/furion/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://furion.pro/furion/docs/logging"><link data-react-helmet="true" rel="alternate" href="https://furion.pro/furion/docs/logging" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://furion.pro/furion/docs/logging" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/furion/assets/css/styles.9213d4d0.css">
<link rel="preload" href="/furion/assets/js/runtime~main.0713a489.js" as="script">
<link rel="preload" href="/furion/assets/js/main.a56f4d74.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div class="furion-give-me-star">â­ï¸ å¦‚æœä½ å–œæ¬¢ <a href="https://gitee.com/dotnetchina/Furion" target="_blank">Furion</a> ï¼Œå¯ä»¥åœ¨ <a href="https://gitee.com/dotnetchina/Furion" target="_blank">Gitee</a> ä¸­ç»™ä¸ª<a href="https://gitee.com/dotnetchina/Furion" target="_blank"><img class="furion-gitee-star" src="https://gitee.com/dotnetchina/Furion/badge/star.svg?theme=gvp" alt="star"></a> â­ï¸</div><div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/furion/"><img src="/furion/img/furionlogo.png" alt="Furion Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/furion/img/furionlogo.png" alt="Furion Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Furion</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/furion/docs">æ–‡æ¡£</a><a class="navbar__item navbar__link" href="/furion/docs/global/app">é™æ€ç±»</a><a class="navbar__item navbar__link" href="/furion/docs/settings/appsettings">é…ç½®</a><a class="navbar__item navbar__link" href="/furion/blog">åšå®¢</a><a class="navbar__item navbar__link" href="/furion/docs/upgrade">æ›´æ–°æ—¥å¿—</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link">æºç </a><ul class="dropdown__menu"><li><a href="https://gitee.com/dotnetchina/Furion" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Gitee<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/MonkSoul/Furion" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a href="https://www.chinadot.net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>ç¤¾åŒº<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a class="navbar__item navbar__link" href="/furion/docs/case">æ¡ˆä¾‹</a><a class="navbar__item navbar__link" href="/furion/docs/donate">æ”¯æŒâœ¨</a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/furion/"><img src="/furion/img/furionlogo.png" alt="Furion Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/furion/img/furionlogo.png" alt="Furion Logo" class="themedImage_1VuW themedImage--dark_hz6m"><b>Furion</b></a><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">1. åºè¨€</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">2. å…¥é—¨æŒ‡å—</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/appstartup">3. åº”ç”¨å¯åŠ¨ Startup</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">4. é…ç½®ä¸é€‰é¡¹</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/dynamic-api-controller">5. åŠ¨æ€ WebAPI</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/specification-document">6. è§„èŒƒåŒ–æ¥å£æ–‡æ¡£ (Swagger)</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/friendly-exception">7. å‹å¥½å¼‚å¸¸å¤„ç†</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/data-validation">8. æ•°æ®æ ¡éªŒ</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">9. æ•°æ®åº“æ“ä½œæŒ‡å—ï¼ˆEFCoreï¼‰</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">10. SqlSugar æˆ–å…¶ä»– ORM</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/saas">11. SaaS å¤šç§Ÿæˆ·</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/dependency-injection">12. ä¾èµ–æ³¨å…¥/æ§åˆ¶åè½¬</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/object-mapper">13. å¯¹è±¡æ•°æ®æ˜ å°„ Mapper</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/cache">14. åˆ†å¸ƒå¼ç¼“å­˜</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/auth-control">15. å®‰å…¨é‰´æƒ</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/cors">16. CORS è·¨åŸŸ</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/view-engine">17. è§†å›¾å¼•æ“</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/furion/docs/logging">18. æ—¥å¿—è®°å½•</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/http">19. è¿œç¨‹è¯·æ±‚ (HttpClient)</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/encryption">20. æ•°æ®åŠ è§£å¯†</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/local-language">21. å…¨çƒåŒ–å’Œæœ¬åœ°åŒ–ï¼ˆå¤šè¯­è¨€ï¼‰</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/event-bus">22. äº‹ä»¶æ€»çº¿</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/json-serialization">23. JSON åºåˆ—åŒ–</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/signalr">24. å³æ—¶é€šè®¯</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/process-service">25. è¾…åŠ©è§’è‰²æœåŠ¡ (Worker Service)</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/job">26. å®šæ—¶ä»»åŠ¡/åå°ä»»åŠ¡</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/idgenerator">27. åˆ†å¸ƒå¼ ID ç”Ÿæˆ</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/module-dev">28. æ¨¡å—åŒ–å¼€å‘</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/clayobj">29. ç²˜åœŸå¯¹è±¡</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/sensitive-detection">30. è„±æ•å¤„ç†</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/file-provider">31. è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/sesssion-state">32. ä¼šè¯å’ŒçŠ¶æ€ç®¡ç†</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/microservice">33. Anno å¾®æœåŠ¡</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">34. æ‰˜ç®¡éƒ¨ç½²</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">35. æŒç»­éƒ¨ç½²é›†æˆ</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">36. æµ‹è¯•æŒ‡å—</a></li><li class="menu__list-item"><a class="menu__link" href="/furion/docs/contribute">37. è´¡çŒ®æŒ‡å—</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">18. æ—¥å¿—è®°å½•</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="181-å…³äºæ—¥å¿—"></a>18.1 å…³äºæ—¥å¿—<a class="hash-link" href="#181-å…³äºæ—¥å¿—" title="Direct link to heading">#</a></h2><p>é€šå¸¸æ—¥å¿—æŒ‡çš„æ˜¯<strong>ç³»ç»Ÿæ—¥å¿—</strong>å’Œ<strong>ç¨‹åºæ—¥å¿—</strong>ã€‚</p><p><strong>ç³»ç»Ÿæ—¥å¿—</strong> æ˜¯è®°å½•ç³»ç»Ÿä¸­ç¡¬ä»¶ã€è½¯ä»¶å’Œç³»ç»Ÿé—®é¢˜çš„ä¿¡æ¯ï¼ŒåŒæ—¶è¿˜å¯ä»¥ç›‘è§†ç³»ç»Ÿä¸­å‘ç”Ÿçš„äº‹ä»¶ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å®ƒæ¥æ£€æŸ¥é”™è¯¯å‘ç”Ÿçš„åŸå› ï¼Œæˆ–è€…å¯»æ‰¾å—åˆ°æ”»å‡»æ—¶æ”»å‡»è€…ç•™ä¸‹çš„ç—•è¿¹ã€‚ç³»ç»Ÿæ—¥å¿—åŒ…æ‹¬ç³»ç»Ÿæ—¥å¿—ã€åº”ç”¨ç¨‹åºæ—¥å¿—å’Œå®‰å…¨æ—¥å¿—ã€‚</p><p><strong>ç¨‹åºæ—¥å¿—</strong> æ˜¯ç¨‹åºè¿è¡Œä¸­äº§ç”Ÿçš„æ—¥å¿—ï¼Œé€šå¸¸ç”±æ¡†æ¶è¿è¡Œæ—¶æˆ–å¼€å‘è€…æä¾›çš„æ—¥å¿—ã€‚åŒ…æ‹¬è¯·æ±‚æ—¥å¿—ï¼Œå¼‚å¸¸æ—¥å¿—ã€å®¡è®¡æ—¥å¿—ã€è¡Œä¸ºæ—¥å¿—ç­‰ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="182-æ—¥å¿—ä½œç”¨"></a>18.2 æ—¥å¿—ä½œç”¨<a class="hash-link" href="#182-æ—¥å¿—ä½œç”¨" title="Direct link to heading">#</a></h2><p>åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œéƒ½ä¸å¯é¿å…çš„ä½¿ç”¨åˆ°æ—¥å¿—ã€‚æ²¡æœ‰æ—¥å¿—è™½ç„¶ä¸ä¼šå½±å“é¡¹ç›®çš„æ­£ç¡®è¿è¡Œï¼Œä½†æ˜¯æ²¡æœ‰æ—¥å¿—çš„é¡¹ç›®å¯ä»¥è¯´æ˜¯ä¸å®Œæ•´çš„ã€‚æ—¥å¿—åœ¨è°ƒè¯•ï¼Œé”™è¯¯æˆ–è€…å¼‚å¸¸å®šä½ï¼Œæ•°æ®åˆ†æä¸­çš„ä½œç”¨æ˜¯ä¸è¨€è€Œå–»çš„ã€‚</p><ul><li>è°ƒè¯•</li></ul><p>åœ¨é¡¹ç›®è°ƒè¯•æ—¶ï¼ŒæŸ¥çœ‹æ ˆä¿¡æ¯å¯ä»¥æ–¹ä¾¿åœ°çŸ¥é“å½“å‰ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ï¼Œè¾“å‡ºçš„æ—¥å¿—ä¾¿äºè®°å½•ç¨‹åºåœ¨ä¹‹å‰çš„è¿è¡Œç»“æœã€‚</p><ul><li>é”™è¯¯å®šä½</li></ul><p>ä¸è¦ä»¥ä¸ºé¡¹ç›®èƒ½æ­£ç¡®è·‘èµ·æ¥å°±å¯ä»¥é«˜æ•æ— å¿§ï¼Œé¡¹ç›®åœ¨è¿è¡Œä¸€æ®µæ—¶å€™åï¼Œå¯èƒ½ç”±äºæ•°æ®é—®é¢˜ï¼Œç½‘ç»œé—®é¢˜ï¼Œå†…å­˜é—®é¢˜ç­‰å‡ºç°å¼‚å¸¸ã€‚è¿™æ—¶æ—¥å¿—å¯ä»¥å¸®åŠ©å¼€å‘æˆ–è€…è¿ç»´äººå‘˜å¿«é€Ÿå®šä½é”™è¯¯ä½ç½®ï¼Œæå‡ºè§£å†³æ–¹æ¡ˆã€‚</p><ul><li>æ•°æ®åˆ†æ</li></ul><p>å¤§æ•°æ®çš„å…´èµ·ï¼Œä½¿å¾—å¤§é‡çš„æ—¥å¿—åˆ†ææˆä¸ºå¯èƒ½ï¼ŒELK ä¹Ÿè®©æ—¥å¿—åˆ†æé—¨æ§›é™ä½äº†å¾ˆå¤šã€‚æ—¥å¿—ä¸­è•´å«äº†å¤§é‡çš„ç”¨æˆ·æ•°æ®ï¼ŒåŒ…æ‹¬ç‚¹å‡»è¡Œä¸ºï¼Œå…´è¶£åå¥½ç­‰ï¼Œç”¨æˆ·ç”»åƒå¯¹äºå…¬å¸ä¸‹ä¸€æ­¥çš„æˆ˜ç•¥æ–¹å‘æœ‰ä¸€å®šæŒ‡å¼•ä½œç”¨ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="183-æ—¥å¿—çº§åˆ«"></a>18.3 æ—¥å¿—çº§åˆ«<a class="hash-link" href="#183-æ—¥å¿—çº§åˆ«" title="Direct link to heading">#</a></h2><p>æ—¥å¿—çº§åˆ«å¯ä»¥æœ‰æ•ˆçš„å¯¹æ—¥å¿—ä¿¡æ¯è¿›è¡Œå½’ç±»ï¼Œæ–¹ä¾¿å‡†ç¡®çš„æŸ¥çœ‹ç‰¹å®šæ—¥å¿—å†…å®¹ã€‚é€šå¸¸æ—¥å¿—ç±»åˆ«æœ‰ä»¥ä¸‹çº§åˆ«ï¼š</p><table><thead><tr><th align="center">çº§åˆ«</th><th>å€¼</th><th align="center">æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td align="center">Traceï¼ˆè·Ÿè¸ªï¼‰</td><td>0</td><td align="center">LogTrace</td><td>åŒ…å«æœ€è¯¦ç»†çš„æ¶ˆæ¯ã€‚ è¿™äº›æ¶ˆæ¯å¯èƒ½åŒ…å«æ•æ„Ÿçš„åº”ç”¨æ•°æ®ã€‚ è¿™äº›æ¶ˆæ¯é»˜è®¤æƒ…å†µä¸‹å¤„äºç¦ç”¨çŠ¶æ€ï¼Œå¹¶ä¸”ä¸åº”åœ¨ç”Ÿäº§ä¸­å¯ç”¨ã€‚</td></tr><tr><td align="center">Debugï¼ˆè°ƒè¯•ï¼‰</td><td>1</td><td align="center">LogDebug</td><td>ç”¨äºè°ƒè¯•å’Œå¼€å‘ã€‚ ç”±äºé‡å¤§ï¼Œè¯·åœ¨ç”Ÿäº§ä¸­å°å¿ƒä½¿ç”¨ã€‚</td></tr><tr><td align="center">Informationï¼ˆä¿¡æ¯ï¼‰</td><td>2</td><td align="center">LogInformation</td><td>è·Ÿè¸ªåº”ç”¨çš„å¸¸è§„æµã€‚ å¯èƒ½å…·æœ‰é•¿æœŸå€¼ã€‚</td></tr><tr><td align="center">Warningï¼ˆè­¦å‘Šï¼‰</td><td>3</td><td align="center">LogWarning</td><td>å¯¹äºå¼‚å¸¸äº‹ä»¶æˆ–æ„å¤–äº‹ä»¶ã€‚ é€šå¸¸åŒ…æ‹¬ä¸ä¼šå¯¼è‡´åº”ç”¨å¤±è´¥çš„é”™è¯¯æˆ–æƒ…å†µã€‚</td></tr><tr><td align="center">Errorï¼ˆé”™è¯¯ï¼‰</td><td>4</td><td align="center">LogError</td><td>è¡¨ç¤ºæ— æ³•å¤„ç†çš„é”™è¯¯å’Œå¼‚å¸¸ã€‚ è¿™äº›æ¶ˆæ¯è¡¨ç¤ºå½“å‰æ“ä½œæˆ–è¯·æ±‚å¤±è´¥ï¼Œè€Œä¸æ˜¯æ•´ä¸ªåº”ç”¨å¤±è´¥ã€‚</td></tr><tr><td align="center">Criticalï¼ˆä¸¥é‡ï¼‰</td><td>5</td><td align="center">LogCritical</td><td>éœ€è¦ç«‹å³å…³æ³¨çš„å¤±è´¥ã€‚ ä¾‹å¦‚æ•°æ®ä¸¢å¤±ã€ç£ç›˜ç©ºé—´ä¸è¶³ã€‚</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="184-å¦‚ä½•ä½¿ç”¨"></a>18.4 å¦‚ä½•ä½¿ç”¨<a class="hash-link" href="#184-å¦‚ä½•ä½¿ç”¨" title="Direct link to heading">#</a></h2><p>åœ¨ <code>.NET 5</code> æ¡†æ¶ä¸­ï¼Œå¾®è½¯å·²ç»ä¸ºæˆ‘ä»¬å†…ç½®äº† <code>æ—¥å¿—ç»„ä»¶</code>ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œæ— éœ€æˆ‘ä»¬å¼•ç”¨ç¬¬ä¸‰æ–¹åŒ…è¿›è¡Œæ—¥å¿—è®°å½•ã€‚<code>.NET 5</code> æ¡†æ¶ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§æ—¥å¿—å¯¹è±¡åˆ›å»ºæ–¹å¼ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="1841-iloggert-æ³›å‹æ–¹å¼"></a>18.4.1 <code>ILogger&lt;T&gt;</code> æ³›å‹æ–¹å¼<a class="hash-link" href="#1841-iloggert-æ³›å‹æ–¹å¼" title="Direct link to heading">#</a></h3><p>ä½¿ç”¨éå¸¸ç®€å•ï¼Œå¯ä»¥é€šè¿‡ <code>ILogger&lt;T&gt;</code> å¯¹è±¡è¿›è¡Œæ³¨å…¥ï¼Œå¦‚ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class PrivacyModel : PageModel</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private readonly ILogger&lt;PrivacyModel&gt; _logger;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    public PrivacyModel(ILogger&lt;PrivacyModel&gt; logger)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        _logger = logger;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public void OnGet()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        _logger.LogInformation(&quot;GET Pages.PrivacyModel called.&quot;);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>å°çŸ¥è¯†</h5></div><div class="admonition-content"><p>é€šè¿‡æ³›å‹ <code>ILogger&lt;T&gt;</code> æ–¹å¼å†™å…¥æ—¥å¿—ï¼Œé‚£ä¹ˆé»˜è®¤å°† <code>T</code> ç±»å‹å®Œæ•´ç±»å‹åç§°ä½œä¸º <code>æ—¥å¿—ç±»åˆ«</code>ã€‚</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="1842-iloggerfactory-å·¥å‚æ–¹å¼"></a>18.4.2 <code>ILoggerFactory</code> å·¥å‚æ–¹å¼<a class="hash-link" href="#1842-iloggerfactory-å·¥å‚æ–¹å¼" title="Direct link to heading">#</a></h3><p>ä½¿ç”¨å·¥å‚æ–¹å¼ï¼Œéœ€æ‰‹åŠ¨ä¼ å…¥ <code>æ—¥å¿—ç±»åˆ«</code>ï¼Œå¦‚ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class ContactModel : PageModel</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private readonly ILogger _logger;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    public ContactModel(ILoggerFactory logger)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">        _logger = logger.CreateLogger(&quot;MyCategory&quot;);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public void OnGet()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        _logger.LogInformation(&quot;GET Pages.ContactModel called.&quot;);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="1843-æ‡’äººæ¨¡å¼-"></a>18.4.3 <code>æ‡’äººæ¨¡å¼</code> ğŸ˜<a class="hash-link" href="#1843-æ‡’äººæ¨¡å¼-" title="Direct link to heading">#</a></h3><p>åœ¨ <code>Furion</code> æ¡†æ¶ä¸­ï¼Œæä¾›äº†æ›´æ‡’çš„æ–¹å¼å†™å…¥æ—¥å¿—ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡å­—ç¬¦ä¸²æ‹“å±•çš„æ–¹å¼å†™å…¥ï¼Œå¦‚ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;ç®€å•æ—¥å¿—&quot;.LogInformation();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;ç™¾å°åƒ§ æ–°å¢äº†ä¸€æ¡è®°å½•&quot;.LogInformation&lt;HomeController&gt;();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;ç¨‹åºå‡ºç°å¼‚å¸¸å•¦&quot;.LogError&lt;HomeController&gt;();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;è¿™æ˜¯è‡ªå®šä¹‰ç±»åˆ«æ—¥å¿—&quot;.SetCategory(&quot;ç±»åˆ«&quot;).LogInformation();</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>é€šè¿‡å­—ç¬¦ä¸²æ‹“å±•æ–¹å¼å¯ä»¥åœ¨ä»»ä½•æ—¶å€™æ–¹ä¾¿è®°å½•æ—¥å¿—ï¼Œä¸“é—¨ä¸ºæ‡’äººæä¾›çš„ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="185-å†™å…¥å…¶ä»–ä»‹è´¨"></a>18.5 å†™å…¥å…¶ä»–ä»‹è´¨<a class="hash-link" href="#185-å†™å…¥å…¶ä»–ä»‹è´¨" title="Direct link to heading">#</a></h2><p><code>.NET 5</code> æ¡†æ¶ä¸­å¹¶æœªæä¾›å†™å…¥<code>æ–‡ä»¶ã€æ•°æ®åº“</code> æˆ–å…¶ä»–ä»‹è´¨çš„æä¾›å™¨ï¼Œé»˜è®¤åªæä¾›äº† <code>Debugã€Console</code> ä¸¤ç§æ–¹å¼ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦å¼•ç”¨ç¬¬ä¸‰æ–¹æ—¥å¿—ç»„ä»¶ï¼Œæ–¹ä¾¿æˆ‘ä»¬å†™å…¥åˆ°å¤šä¸ªä»‹è´¨ä¸­ã€‚</p><p>åœ¨è¿™é‡Œï¼Œ<code>Furion</code> å®˜æ–¹æ¨èä½¿ç”¨ <code>Serilog</code> æ—¥å¿—ç»„ä»¶ï¼Œä¸ºæ­¤ï¼Œ<code>Furion</code> æä¾›äº† <code>Furion.Extras.Logging.Serilog</code> æ‹“å±•åŒ…ï¼Œæ–¹ä¾¿å¿«é€Ÿå’Œ <code>Furion</code> æ¡†æ¶ç»“åˆã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="1851-serilog-æ‹“å±•åŒ…ä½¿ç”¨"></a>18.5.1 <code>Serilog</code> æ‹“å±•åŒ…ä½¿ç”¨<a class="hash-link" href="#1851-serilog-æ‹“å±•åŒ…ä½¿ç”¨" title="Direct link to heading">#</a></h3><ul><li>å®‰è£… <code>Furion.Extras.Logging.Serilog</code> æ‹“å±•åŒ…</li></ul><p>åœ¨ <code>Furion.Core</code> å±‚å®‰è£… <code>Furion.Extras.Logging.Serilog</code> æ‹“å±•åŒ…</p><ul><li>åœ¨ <code>Program.cs</code> ä¸­è°ƒç”¨ <code>UseSerilogDefault()</code></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">using Microsoft.AspNetCore.Hosting;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">using Microsoft.Extensions.Hosting;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">namespace Furion.Web.Entry</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public class Program</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public static void Main(string[] args)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            CreateHostBuilder(args).Build().Run();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public static IHostBuilder CreateHostBuilder(string[] args)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return Host.CreateDefaultBuilder(args)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .ConfigureWebHostDefaults(webBuilder =&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    webBuilder.Inject()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        .UseStartup&lt;Startup&gt;();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                })</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">                .UseSerilogDefault();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>ç‰¹åˆ«æ³¨æ„</h5></div><div class="admonition-content"><p><code>.UseSerilogDefault()</code> é»˜è®¤é›†æˆäº† <code>æ§åˆ¶å°</code> å’Œ <code>æ–‡ä»¶</code> æ–¹å¼ã€‚å¦‚éœ€è‡ªå®šä¹‰å†™å…¥ï¼Œåˆ™ä¼ å…¥éœ€è¦å†™å…¥çš„ä»‹è´¨å³å¯ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">.UseSerilogDefault(config =&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    config.WriteTo.Console(outputTemplate: &quot;[{Timestamp:HH:mm:ss} {Level:u3}] {Message:lj} {Properties:j}{NewLine}{Exception}&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          .WriteTo.File(&quot;log.log&quot;, rollingInterval: RollingInterval.Day, rollOnFileSizeLimit: true);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>æ‹“å±•ï¼šå¯æŒ‰æ—¥å¿—çº§åˆ« å•ç‹¬è¾“å‡º</h5></div><div class="admonition-content"><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">.UseSerilogDefault(config =&gt;//é»˜è®¤é›†æˆäº† æ§åˆ¶å° å’Œ æ–‡ä»¶ æ–¹å¼ã€‚å¦‚éœ€è‡ªå®šä¹‰å†™å…¥ï¼Œåˆ™ä¼ å…¥éœ€è¦å†™å…¥çš„ä»‹è´¨å³å¯ï¼š</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     string date = DateTime.Now.ToString(&quot;yyyy-MM-dd&quot;);//æŒ‰æ—¶é—´åˆ›å»ºæ–‡ä»¶å¤¹</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     string outputTemplate = &quot;{NewLine}ã€{Level:u3}ã€‘{Timestamp:yyyy-MM-dd HH:mm:ss.fff}&quot; +</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     &quot;{NewLine}#Msg#{Message:lj}&quot; +</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     &quot;{NewLine}#Pro #{Properties:j}&quot; +</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     &quot;{NewLine}#Exc#{Exception}&quot; +</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     new string(&#x27;-&#x27;, 50);//è¾“å‡ºæ¨¡æ¿</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     ///1.è¾“å‡ºæ‰€æœ‰restrictedToMinimumLevelï¼šLogEventLevelç±»å‹</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     config</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         //.MinimumLevel.Debug() // æ‰€æœ‰Sinkçš„æœ€å°è®°å½•çº§åˆ«</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         //.MinimumLevel.Override(&quot;Microsoft&quot;, LogEventLevel.Fatal)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         //.Enrich.FromLogContext()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         .WriteTo.Console(outputTemplate: outputTemplate)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         .WriteTo.File($&quot;_log/{date}/application.log&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                outputTemplate: outputTemplate,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 restrictedToMinimumLevel: LogEventLevel.Information,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 rollingInterval: RollingInterval.Day,//æ—¥å¿—æŒ‰æ—¥ä¿å­˜ï¼Œè¿™æ ·ä¼šåœ¨æ–‡ä»¶åç§°åè‡ªåŠ¨åŠ ä¸Šæ—¥æœŸåç¼€</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 //rollOnFileSizeLimit: true,          // é™åˆ¶å•ä¸ªæ–‡ä»¶çš„æœ€å¤§é•¿åº¦</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 //retainedFileCountLimit: 10,         // æœ€å¤§ä¿å­˜æ–‡ä»¶æ•°,ç­‰äºnullæ—¶æ°¸è¿œä¿ç•™æ–‡ä»¶ã€‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 //fileSizeLimitBytes: 10 * 1024,      // æœ€å¤§å•ä¸ªæ–‡ä»¶å¤§å°</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 encoding: Encoding.UTF8            // æ–‡ä»¶å­—ç¬¦ç¼–ç </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             )</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     #region 2.æŒ‰LogEventLevel.è¾“å‡ºç‹¬ç«‹å‘å¸ƒ/å•æ–‡ä»¶</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///2.1ä»…è¾“å‡º LogEventLevel.Debug ç±»å‹</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .WriteTo.Logger(lg =&gt; lg.Filter.ByIncludingOnly(evt =&gt; evt.Level == LogEventLevel.Debug)//ç­›é€‰è¿‡æ»¤</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .WriteTo.File($&quot;_log/{date}/{LogEventLevel.Debug}.log&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                outputTemplate: outputTemplate,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                rollingInterval: RollingInterval.Day,//æ—¥å¿—æŒ‰æ—¥ä¿å­˜ï¼Œè¿™æ ·ä¼šåœ¨æ–‡ä»¶åç§°åè‡ªåŠ¨åŠ ä¸Šæ—¥æœŸåç¼€</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                encoding: Encoding.UTF8            // æ–‡ä»¶å­—ç¬¦ç¼–ç </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             )</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         )</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///2.2ä»…è¾“å‡º LogEventLevel.Error ç±»å‹</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .WriteTo.Logger(lg =&gt; lg.Filter.ByIncludingOnly(evt =&gt; evt.Level == LogEventLevel.Error)//ç­›é€‰è¿‡æ»¤</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .WriteTo.File($&quot;_log/{date}/{LogEventLevel.Error}.log&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                outputTemplate: outputTemplate,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                rollingInterval: RollingInterval.Day,//æ—¥å¿—æŒ‰æ—¥ä¿å­˜ï¼Œè¿™æ ·ä¼šåœ¨æ–‡ä»¶åç§°åè‡ªåŠ¨åŠ ä¸Šæ—¥æœŸåç¼€</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                encoding: Encoding.UTF8            // æ–‡ä»¶å­—ç¬¦ç¼–ç </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             )</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         )</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     #endregion æŒ‰LogEventLevel ç‹¬ç«‹å‘å¸ƒ/å•æ–‡ä»¶</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         ;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> });</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><ul><li>æ›¿æ¢ <code>appsetting.json</code> é»˜è®¤æ—¥å¿—å†…å®¹</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token property">&quot;Logging&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;LogLevel&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;Default&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Information&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;Microsoft&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Warning&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;Microsoft.Hosting.Lifetime&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Information&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;Microsoft.EntityFrameworkCore&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Information&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>æ›¿æ¢ä¸ºï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token property">&quot;Serilog&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;MinimumLevel&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;Default&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Information&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;Override&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;System&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Warning&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;Microsoft&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Warning&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;Microsoft.Hosting.Lifetime&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Information&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;Microsoft.EntityFrameworkCore&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Information&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="1852-è®°å½•è¯·æ±‚æ—¥å¿—"></a>18.5.2 è®°å½•è¯·æ±‚æ—¥å¿—<a class="hash-link" href="#1852-è®°å½•è¯·æ±‚æ—¥å¿—" title="Direct link to heading">#</a></h3><p><code>Serilog</code> æ—¥å¿—ç»„ä»¶ä¹Ÿæä¾›äº†éå¸¸æ–¹ä¾¿å¿«æ·çš„è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶ï¼Œåªéœ€è¦åœ¨ <code>Startup.cs</code> ä¸­å¯ç”¨å³å¯ã€‚å¦‚ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">public void Configure(IApplicationBuilder app, IWebHostEnvironment env)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     app.UseStaticFiles();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     app.UseSerilogRequestLogging();    // å¿…é¡»åœ¨ UseStaticFiles å’Œ UseRouting ä¹‹é—´</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     app.UseRouting();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="186-æ—¥å¿—ç¤ºä¾‹"></a>18.6 æ—¥å¿—ç¤ºä¾‹<a class="hash-link" href="#186-æ—¥å¿—ç¤ºä¾‹" title="Direct link to heading">#</a></h2><p>ä¸‹é¢ä¾¿æ˜¯æ—¥å¿—è¾“å‡ºæ—¥å¿—çš„æ¨¡æ¿ï¼Œæ”¯æŒå„ç§è‡ªå®šä¹‰æ–¹å¼</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">2020-12-21 15:54:43.775 +08:00 [INF] Application started. Press Ctrl+C to shut down.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2020-12-21 15:54:43.897 +08:00 [INF] Hosting environment: Development</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2020-12-21 15:54:43.899 +08:00 [INF] Content root path: D:\MONK\Furion\samples\Furion.Web.Entry</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2020-12-21 15:55:00.651 +08:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2020-12-21 15:55:00.817 +08:00 [INF] Entity Framework Core 5.0.1 initialized &#x27;DefaultDbContext&#x27; using provider &#x27;Microsoft.EntityFrameworkCore.Sqlite&#x27; with options: SensitiveDataLoggingEnabled DetailedErrorsEnabled MaxPoolSize=100 MigrationsAssembly=Furion.Database.Migrations</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2020-12-21 15:55:01.711 +08:00 [WRN] Compiling a query which loads related collections for more than one collection navigation either via &#x27;Include&#x27; or through projection but no &#x27;QuerySplittingBehavior&#x27; has been configured. By default Entity Framework will use &#x27;QuerySplittingBehavior.SingleQuery&#x27; which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that&#x27;s triggering this warning call &#x27;ConfigureWarnings(w =&gt; w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2020-12-21 15:55:01.919 +08:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType=&#x27;&quot;Text&quot;&#x27;, CommandTimeout=&#x27;30&#x27;]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SELECT &quot;p&quot;.&quot;Id&quot;, &quot;p&quot;.&quot;Name&quot;, &quot;p&quot;.&quot;Age&quot;, &quot;p&quot;.&quot;Address&quot;, &quot;p0&quot;.&quot;PhoneNumber&quot;, &quot;p0&quot;.&quot;QQ&quot;, &quot;p&quot;.&quot;CreatedTime&quot;, &quot;p0&quot;.&quot;Id&quot;, &quot;c&quot;.&quot;Id&quot;, &quot;c&quot;.&quot;Name&quot;, &quot;c&quot;.&quot;Gender&quot;, &quot;t&quot;.&quot;Id&quot;, &quot;t&quot;.&quot;Name&quot;, &quot;t&quot;.&quot;PersonsId&quot;, &quot;t&quot;.&quot;PostsId&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">FROM &quot;Person&quot; AS &quot;p&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LEFT JOIN &quot;PersonDetail&quot; AS &quot;p0&quot; ON &quot;p&quot;.&quot;Id&quot; = &quot;p0&quot;.&quot;PersonId&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LEFT JOIN &quot;Children&quot; AS &quot;c&quot; ON &quot;p&quot;.&quot;Id&quot; = &quot;c&quot;.&quot;PersonId&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LEFT JOIN (</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SELECT &quot;p2&quot;.&quot;Id&quot;, &quot;p2&quot;.&quot;Name&quot;, &quot;p1&quot;.&quot;PersonsId&quot;, &quot;p1&quot;.&quot;PostsId&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    FROM &quot;PersonPost&quot; AS &quot;p1&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    INNER JOIN &quot;Post&quot; AS &quot;p2&quot; ON &quot;p1&quot;.&quot;PostsId&quot; = &quot;p2&quot;.&quot;Id&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) AS &quot;t&quot; ON &quot;p&quot;.&quot;Id&quot; = &quot;t&quot;.&quot;PersonsId&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ORDER BY &quot;p&quot;.&quot;Id&quot;, &quot;p0&quot;.&quot;Id&quot;, &quot;c&quot;.&quot;Id&quot;, &quot;t&quot;.&quot;PersonsId&quot;, &quot;t&quot;.&quot;PostsId&quot;, &quot;t&quot;.&quot;Id&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2020-12-21 15:55:25.354 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType=&#x27;&quot;Text&quot;&#x27;, CommandTimeout=&#x27;30&#x27;]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SELECT &quot;p&quot;.&quot;Id&quot;, &quot;p&quot;.&quot;Name&quot;, &quot;p&quot;.&quot;Age&quot;, &quot;p&quot;.&quot;Address&quot;, &quot;p0&quot;.&quot;PhoneNumber&quot;, &quot;p0&quot;.&quot;QQ&quot;, &quot;p&quot;.&quot;CreatedTime&quot;, &quot;p0&quot;.&quot;Id&quot;, &quot;c&quot;.&quot;Id&quot;, &quot;c&quot;.&quot;Name&quot;, &quot;c&quot;.&quot;Gender&quot;, &quot;t&quot;.&quot;Id&quot;, &quot;t&quot;.&quot;Name&quot;, &quot;t&quot;.&quot;PersonsId&quot;, &quot;t&quot;.&quot;PostsId&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">FROM &quot;Person&quot; AS &quot;p&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LEFT JOIN &quot;PersonDetail&quot; AS &quot;p0&quot; ON &quot;p&quot;.&quot;Id&quot; = &quot;p0&quot;.&quot;PersonId&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LEFT JOIN &quot;Children&quot; AS &quot;c&quot; ON &quot;p&quot;.&quot;Id&quot; = &quot;c&quot;.&quot;PersonId&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LEFT JOIN (</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SELECT &quot;p2&quot;.&quot;Id&quot;, &quot;p2&quot;.&quot;Name&quot;, &quot;p1&quot;.&quot;PersonsId&quot;, &quot;p1&quot;.&quot;PostsId&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    FROM &quot;PersonPost&quot; AS &quot;p1&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    INNER JOIN &quot;Post&quot; AS &quot;p2&quot; ON &quot;p1&quot;.&quot;PostsId&quot; = &quot;p2&quot;.&quot;Id&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) AS &quot;t&quot; ON &quot;p&quot;.&quot;Id&quot; = &quot;t&quot;.&quot;PersonsId&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ORDER BY &quot;p&quot;.&quot;Id&quot;, &quot;p0&quot;.&quot;Id&quot;, &quot;c&quot;.&quot;Id&quot;, &quot;t&quot;.&quot;PersonsId&quot;, &quot;t&quot;.&quot;PostsId&quot;, &quot;t&quot;.&quot;Id&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2020-12-21 15:58:27.328 +08:00 [INF] Application started. Press Ctrl+C to shut down.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2020-12-21 15:58:27.442 +08:00 [INF] Hosting environment: Development</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2020-12-21 15:58:27.444 +08:00 [INF] Content root path: D:\MONK\Furion\samples\Furion.Web.Entry</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2020-12-21 15:58:27.909 +08:00 [INF] HTTP GET / responded 200 in 457.0657 ms</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2020-12-21 15:58:33.336 +08:00 [INF] HTTP GET /api/index.html responded 200 in 95.9277 ms</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2020-12-21 15:58:34.187 +08:00 [INF] HTTP GET /swagger/Default/swagger.json responded 200 in 674.9800 ms</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="187-æ‰“å°æ—¥å¿—åˆ°-swagger-ä¸­"></a>18.7 æ‰“å°æ—¥å¿—åˆ° <code>Swagger</code> ä¸­<a class="hash-link" href="#187-æ‰“å°æ—¥å¿—åˆ°-swagger-ä¸­" title="Direct link to heading">#</a></h2><p>åœ¨ <code>Furion</code> æ¡†æ¶ä¸­é»˜è®¤é›†æˆäº† <code>MiniProfiler</code> ç»„ä»¶å¹¶ä¸ <code>Swagger</code> è¿›è¡Œäº†ç»“åˆï¼Œå¦‚éœ€æ‰“å°æ—¥å¿—æˆ–è°ƒè¯•ä»£ç ï¼Œåªéœ€è°ƒç”¨ä»¥ä¸‹æ–¹æ³•å³å¯ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">App.PrintToMiniProfiler(&quot;åˆ†ç±»&quot;, &quot;çŠ¶æ€&quot;, &quot;è¦æ‰“å°çš„æ¶ˆæ¯&quot;);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="188-åœ¨åå°ä»»åŠ¡ä¸­ä½¿ç”¨"></a>18.8 åœ¨åå°ä»»åŠ¡ä¸­ä½¿ç”¨<a class="hash-link" href="#188-åœ¨åå°ä»»åŠ¡ä¸­ä½¿ç”¨" title="Direct link to heading">#</a></h2><p>ç”±äº <code>DbContext</code> é»˜è®¤æ³¨å†Œä¸º <code>Scoped</code> ç”Ÿå­˜å‘¨æœŸï¼Œæ‰€ä»¥åœ¨åå°ä»»åŠ¡ä¸­ä½¿ç”¨ <code>IServiceScopeFactory</code> è·å–æ‰€æœ‰æœåŠ¡ï¼Œå¦‚ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class JobService : BackgroundService</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // æ—¥å¿—å¯¹è±¡</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private readonly ILogger&lt;JobService&gt; _logger;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // æœåŠ¡å·¥å‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private readonly IServiceScopeFactory _scopeFactory;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public JobService(ILogger&lt;JobService&gt; logger</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        , IServiceScopeFactory scopeFactory)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        _logger = logger;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        _scopeFactory = scopeFactory;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    protected override Task ExecuteAsync(CancellationToken stoppingToken)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        _logger.LogInformation(&quot;å†™æ—¥å¿—~~&quot;);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        using (var scope = _scopeFactory.CreateScope())</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            var services = scope.ServiceProvider;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // è·å–æ•°æ®åº“ä¸Šä¸‹æ–‡</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            var dbContext = Db.GetDbContext(services);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // è·å–ä»“å‚¨</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            var respository = Db.GetRepository&lt;Person&gt;(services);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // è§£æå…¶ä»–æœåŠ¡</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            var otherService = services.GetService&lt;XXX&gt;();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return Task.CompletedTask;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="189-å…³äºæ—¥å¿—æ–‡ä»¶é‡å¤ç”Ÿæˆé—®é¢˜"></a>18.9 å…³äºæ—¥å¿—æ–‡ä»¶é‡å¤ç”Ÿæˆé—®é¢˜<a class="hash-link" href="#189-å…³äºæ—¥å¿—æ–‡ä»¶é‡å¤ç”Ÿæˆé—®é¢˜" title="Direct link to heading">#</a></h2><p>æ—¥å¿—é‡å¤ç”Ÿæˆçš„åŸå› æ˜¯åˆ›å»ºäº†å¤šä¸ª <code>ILogger</code> å¯¹è±¡å¯¼è‡´çš„ï¼Œé€šå¸¸æœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼š</p><ol><li>è®¾ç½® <code>å­—ç¬¦ä¸²</code> æ‹“å±•æ—¥å¿—ä½œç”¨åŸŸ</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;æ—¥å¿—å†…å®¹&quot;.SetLoggerScoped(serviceProvider).LogInformation();</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="2"><li>ä¿®æ”¹ <code>Program.cs</code> æ³¨å†Œæ–¹å¼</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">using Microsoft.AspNetCore.Hosting;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">using Microsoft.Extensions.Hosting;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">namespace FurStart</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public class Program</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public static void Main(string[] args)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            CreateHostBuilder(args).Build().Run();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public static IHostBuilder CreateHostBuilder(string[] args) =&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            Host.CreateDefaultBuilder(args)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .ConfigureWebHostDefaults(webBuilder =&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    webBuilder</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .UseStartup&lt;Startup&gt;()</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">                    .UseSerilogDefault();   // å†™åˆ°è¿™é‡Œ</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                })</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             //   .UseSerilogDefault(); // æ³¨é‡Š</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="1810-å¤šçº¿ç¨‹å…±äº«ä½œç”¨åŸŸ"></a>18.10 å¤šçº¿ç¨‹å…±äº«ä½œç”¨åŸŸ<a class="hash-link" href="#1810-å¤šçº¿ç¨‹å…±äº«ä½œç”¨åŸŸ" title="Direct link to heading">#</a></h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„ <code>å­—ç¬¦ä¸²</code> å’Œ <code>å®ä½“</code> æ‹“å±•éƒ½æœ‰è‡ªå·±ç‹¬ç«‹ç»´æŠ¤çš„ <code>ServiceProvider</code> ä½œç”¨åŸŸã€‚</p><p>åœ¨ <code>Web</code> è¯·æ±‚ä¸­ï¼Œé»˜è®¤æ˜¯ <code>HttpContext.RequestServices</code>ï¼Œä½†åœ¨ <code>é Web</code>ï¼Œå¦‚å¤šçº¿ç¨‹æ“ä½œï¼Œåå°ä»»åŠ¡ï¼Œäº‹ä»¶æ€»çº¿ç­‰åœºæ™¯ä¸‹ä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„ä½œç”¨åŸŸï¼Œå®é™…ä¸Šè¿™æ˜¯éå¸¸ä¸å¿…è¦çš„å†…å­˜å¼€é”€ã€‚</p><p>è¿™æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡ <code>.SetXXXScoped(service)</code> å…±äº«å½“å‰æœåŠ¡æä¾›å™¨ä½œç”¨åŸŸå³å¯ï¼Œå¦‚ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Scoped.Create(async (fac, scope) =&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &quot;å†™æ—¥å¿—&quot;.SetLoggerScoped(scope.ServiceProvider).LogInformation();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="1811-åé¦ˆä¸å»ºè®®"></a>18.11 åé¦ˆä¸å»ºè®®<a class="hash-link" href="#1811-åé¦ˆä¸å»ºè®®" title="Direct link to heading">#</a></h2><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>ä¸æˆ‘ä»¬äº¤æµ</h5></div><div class="admonition-content"><p>ç»™ Furion æ <a href="https://gitee.com/dotnetchina/Furion/issues/new?issue" target="_blank" rel="noopener noreferrer">Issue</a>ã€‚</p></div></div><hr><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>äº†è§£æ›´å¤š</h5></div><div class="admonition-content"><p>æƒ³äº†è§£æ›´å¤š <code>æ—¥å¿—</code> çŸ¥è¯†å¯æŸ¥é˜… <a href="https://docs.microsoft.com/zh-cn/aspnet/core/fundamentals/logging/?view=aspnetcore-5.0" target="_blank" rel="noopener noreferrer">ASP.NET Core - æ—¥å¿—</a> ç« èŠ‚ å’Œ <a href="https://serilog.net/" target="_blank" rel="noopener noreferrer">Serilog</a> æ–‡æ¡£ã€‚</p></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://gitee.com/dotnetchina/Furion/tree/master/handbook/docs/logging.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF">Last updated on <b><time datetime="2021-07-13T05:59:30.000Z">7/13/2021</time></b> by <b>Monk</b></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/furion/docs/view-engine"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« 17. è§†å›¾å¼•æ“</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/furion/docs/http"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">19. è¿œç¨‹è¯·æ±‚ (HttpClient) Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#181-å…³äºæ—¥å¿—" class="table-of-contents__link">18.1 å…³äºæ—¥å¿—</a></li><li><a href="#182-æ—¥å¿—ä½œç”¨" class="table-of-contents__link">18.2 æ—¥å¿—ä½œç”¨</a></li><li><a href="#183-æ—¥å¿—çº§åˆ«" class="table-of-contents__link">18.3 æ—¥å¿—çº§åˆ«</a></li><li><a href="#184-å¦‚ä½•ä½¿ç”¨" class="table-of-contents__link">18.4 å¦‚ä½•ä½¿ç”¨</a><ul><li><a href="#1841-iloggert-æ³›å‹æ–¹å¼" class="table-of-contents__link">18.4.1 <code>ILogger&lt;T&gt;</code> æ³›å‹æ–¹å¼</a></li><li><a href="#1842-iloggerfactory-å·¥å‚æ–¹å¼" class="table-of-contents__link">18.4.2 <code>ILoggerFactory</code> å·¥å‚æ–¹å¼</a></li><li><a href="#1843-æ‡’äººæ¨¡å¼-" class="table-of-contents__link">18.4.3 <code>æ‡’äººæ¨¡å¼</code> ğŸ˜</a></li></ul></li><li><a href="#185-å†™å…¥å…¶ä»–ä»‹è´¨" class="table-of-contents__link">18.5 å†™å…¥å…¶ä»–ä»‹è´¨</a><ul><li><a href="#1851-serilog-æ‹“å±•åŒ…ä½¿ç”¨" class="table-of-contents__link">18.5.1 <code>Serilog</code> æ‹“å±•åŒ…ä½¿ç”¨</a></li><li><a href="#1852-è®°å½•è¯·æ±‚æ—¥å¿—" class="table-of-contents__link">18.5.2 è®°å½•è¯·æ±‚æ—¥å¿—</a></li></ul></li><li><a href="#186-æ—¥å¿—ç¤ºä¾‹" class="table-of-contents__link">18.6 æ—¥å¿—ç¤ºä¾‹</a></li><li><a href="#187-æ‰“å°æ—¥å¿—åˆ°-swagger-ä¸­" class="table-of-contents__link">18.7 æ‰“å°æ—¥å¿—åˆ° <code>Swagger</code> ä¸­</a></li><li><a href="#188-åœ¨åå°ä»»åŠ¡ä¸­ä½¿ç”¨" class="table-of-contents__link">18.8 åœ¨åå°ä»»åŠ¡ä¸­ä½¿ç”¨</a></li><li><a href="#189-å…³äºæ—¥å¿—æ–‡ä»¶é‡å¤ç”Ÿæˆé—®é¢˜" class="table-of-contents__link">18.9 å…³äºæ—¥å¿—æ–‡ä»¶é‡å¤ç”Ÿæˆé—®é¢˜</a></li><li><a href="#1810-å¤šçº¿ç¨‹å…±äº«ä½œç”¨åŸŸ" class="table-of-contents__link">18.10 å¤šçº¿ç¨‹å…±äº«ä½œç”¨åŸŸ</a></li><li><a href="#1811-åé¦ˆä¸å»ºè®®" class="table-of-contents__link">18.11 åé¦ˆä¸å»ºè®®</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">æ–‡æ¡£</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/furion/docs/get-start">å…¥é—¨</a></li><li class="footer__item"><a class="footer__link-item" href="/furion/docs">æŒ‡å—</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">ç¤¾åŒº</h4><ul class="footer__items"><li class="footer__item"><a href="https://gitee.com/dotnetchina/Furion/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">è®¨è®º</a></li><li class="footer__item"><a href="https://gitee.com/dotnetchina/Furion/board" target="_blank" rel="noopener noreferrer" class="footer__link-item">çœ‹æ¿</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">æ›´å¤š</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/furion/blog">åšå®¢</a></li><li class="footer__item"><a href="https://gitee.com/dotnetchina/Furion" target="_blank" rel="noopener noreferrer" class="footer__link-item">ä»“åº“</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://gitee.com/dotnetchina" target="_blank" rel="noopener noreferrer" class="footerLogoLink_qW4Z"><img class="footer__logo" src="/furion/img/chinadotnet.png" style="background:#fff;padding:5px 10px"></a></div><div class="footer__copyright">Copyright Â© 2020-2021 ç™¾å°åƒ§, Baiqian Co.,Ltd.</div></div></div></footer></div>
<script src="/furion/assets/js/runtime~main.0713a489.js"></script>
<script src="/furion/assets/js/main.a56f4d74.js"></script>
</body>
</html>